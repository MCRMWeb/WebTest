import{w as G,b as V,c as X,r as u,j as t,L as A,y as U,x as Q,D as st,a as _t}from"./index-BnnvMoJY.js";import{a as w,C as it,D as dt,M as ut}from"./Modal-6Vc_q6vv.js";import{C as T}from"./CustomIcon-B_KIhGJT.js";import"./XMarkIcon-CXLPhbNs.js";const ft="_container_5p93n_1",gt="_nav_5p93n_11",mt="_nav_linkBtn_5p93n_15",pt="_nav_settingsIcon_5p93n_19",bt="_nav_buttons_5p93n_23",ht="_nav_buttons_link_5p93n_28",xt="_nav_buttons_iconSetting_5p93n_33",kt="_setting_5p93n_1",yt="_nav_error_5p93n_36",jt="_nav_form_5p93n_43",Pt="_nav_form_left_5p93n_49",vt="_nav_form_input_5p93n_59",Nt="_nav_form_btn_5p93n_64",St="_nav_form_list_5p93n_95",Mt="_nav_form_check_5p93n_100",Ct="_nav_form_check_text_5p93n_106",wt="_navStock_5p93n_110",$t="_navStock_linkBtn_5p93n_113",It="_navStock_settingsIcon_5p93n_118",Et="_navStock_buttons_5p93n_122",Dt="_navStock_buttons_link_5p93n_127",At="_navStock_buttons_iconSetting_5p93n_132",Tt="_navStock_error_5p93n_135",Rt="_stockForm_5p93n_143",Bt="_stockForm_input_5p93n_154",Ft="_stockForm_btn_5p93n_160",Lt="_stockForm_list_5p93n_191",Wt="_stockForm_check_5p93n_196",zt="_stockForm_check_text_5p93n_202",Ht="_formWrapper_5p93n_206",qt="_formWrapper_buttons_5p93n_212",Ut="_formWrapper_btn_5p93n_218",Gt="_formWrapper_btn_cancel_5p93n_230",Ot="_formWrapper_btn_save_5p93n_233",Zt="_found_5p93n_237",Xt="_table_5p93n_261",Vt="_table_head_5p93n_266",Qt="_table_head_row_5p93n_269",Kt="_table_head_col_5p93n_275",Jt="_table_head_minCol_5p93n_278",Yt="_table_head_minCol_still_5p93n_289",te="_table_head_minCol_cancel_5p93n_293",ee="_table_body_row_5p93n_296",oe="_table_body_row_focus_5p93n_302",se="_table_body_col_5p93n_306",ne="_table_body_minCol_5p93n_315",ae="_table_body_minCol_still_5p93n_326",ce="_table_body_minCol_cancel_5p93n_330",le="_table_body_img_5p93n_333",re="_table_body_icon_5p93n_337",_e="_table_body_nameHover_5p93n_341",ie="_table_body_name_5p93n_341",de="_table_body_name_focused_5p93n_382",ue="_table_body_nameString_5p93n_385",fe="_table_body_amount_5p93n_394",ge="_table_body_amount_focused_5p93n_402",me="_table_body_catalog_5p93n_405",pe="_table_body_catalog_top_5p93n_415",be="_table_body_catalog_icon_5p93n_434",he="_table_body_catalog_iconActive_5p93n_437",xe="_table_body_catalog_drop_5p93n_440",ke="_table_body_catalog_dropActive_5p93n_465",ye="_table_body_catalog_search_5p93n_470",je="_table_body_catalog_item_5p93n_484",Pe="_table_body_catalog_text_5p93n_492",ve="_table_body_buttons_5p93n_498",Ne="_table_body_del_5p93n_503",Se="_table_body_generation_5p93n_503",Me="_table_body_barcodeSave_5p93n_503",Ce="_table_body_still_5p93n_503",we="_table_body_category_5p93n_518",$e="_table_body_category_btn_5p93n_523",Ie="_table_body_category_span_5p93n_538",Ee="_table_body_qr_5p93n_553",De="_table_body_barcode_5p93n_503",Ae="_table_body_barcode_focused_5p93n_570",Te="_table_body_error_5p93n_573",Re="_table_body_unit_5p93n_581",Be="_table_body_unit_dropdown_5p93n_584",Fe="_table_body_minCol_check_5p93n_589",Le="_ikpuWrapper_5p93n_600",We="_ikpuWrapper_ikpuModalBlock_5p93n_609",ze="_ikpuWrapper_content_5p93n_619",He="_ikpuWrapper_buttons_5p93n_625",qe="_ikpuWrapper_save_5p93n_631",Ue="_ikpuWrapper_delete_5p93n_641",Ge="_ikpuWrapper_cancel_5p93n_651",Oe="_left_5p93n_662",Ze="_left_content_5p93n_665",Xe="_left_content_item_5p93n_670",Ve="_right_5p93n_680",Qe="_right_block_5p93n_684",Ke="_right_bottom_5p93n_690",Je="_right_bottom_item_5p93n_698",Ye="_right_bottom_item_img_5p93n_708",to="_right_bottom_BaseItem_5p93n_713",eo="_right_bottom_BaseItem_img_5p93n_724",oo="_foundProducts_5p93n_729",so="_foundProducts_modal_5p93n_737",no="_foundProducts_top_5p93n_762",ao="_foundProducts_top_buttons_5p93n_776",co="_foundProducts_top_add_5p93n_781",lo="_foundProducts_top_close_5p93n_798",ro="_foundProducts_item_5p93n_802",_o="_foundProducts_item_mxik_5p93n_810",io="_foundProducts_item_content_5p93n_835",uo="_foundProducts_item_photo_5p93n_840",fo="_foundProducts_item_list_5p93n_853",go="_foundProducts_item_list_box_5p93n_859",mo="_foundProducts_item_title_5p93n_881",po="_foundProducts_item_myIcon_5p93n_885",bo="_foundProducts_item_desc_5p93n_892",ho="_foundProducts_item_btn_5p93n_896",xo="_foundProducts_item_btn_active_5p93n_910",ko="_foundProducts_title_5p93n_914",yo="_foundProducts_more_5p93n_922",jo="_foundProducts_allActive_5p93n_939",Po="_foundProducts_buttons_5p93n_945",vo="_foundProducts_btn_5p93n_951",No="_foundProducts_btn_cancel_5p93n_963",So="_foundProducts_btn_save_5p93n_966",Mo="_foundProducts_list_5p93n_969",Co="_errorModal_5p93n_974",wo="_errorModal_block_5p93n_983",$o="_addingProducts_5p93n_1001",Io="_leftMenu_5p93n_1005",Eo="_leftMenu_list_5p93n_1018",Do="_leftMenu_li_5p93n_1018",Ao="_leftMenu_li_icon_5p93n_1058",To="_leftMenu_li_icon_active_5p93n_1062",Ro="_leftMenu_li_active_5p93n_1066",Bo="_leftMenu_link_5p93n_1081",Fo="_leftMenu_link_active_5p93n_1096",Lo="_leftMenu_linkArrow_5p93n_1100",Wo="_leftMenu_linkArrow_active_5p93n_1106",zo="_leftMenu_active_5p93n_1112",Ho="_miniInfo_content_5p93n_1124",qo="_miniInfo_imgBlock_5p93n_1132",Uo="_miniInfo_list_5p93n_1142",o={container:ft,nav:gt,nav_linkBtn:mt,nav_settingsIcon:pt,nav_buttons:bt,nav_buttons_link:ht,nav_buttons_iconSetting:xt,setting:kt,nav_error:yt,nav_form:jt,nav_form_left:Pt,nav_form_input:vt,nav_form_btn:Nt,nav_form_list:St,nav_form_check:Mt,nav_form_check_text:Ct,navStock:wt,navStock_linkBtn:$t,navStock_settingsIcon:It,navStock_buttons:Et,navStock_buttons_link:Dt,navStock_buttons_iconSetting:At,navStock_error:Tt,stockForm:Rt,stockForm_input:Bt,stockForm_btn:Ft,stockForm_list:Lt,stockForm_check:Wt,stockForm_check_text:zt,formWrapper:Ht,formWrapper_buttons:qt,formWrapper_btn:Ut,formWrapper_btn_cancel:Gt,formWrapper_btn_save:Ot,found:Zt,table:Xt,table_head:Vt,table_head_row:Qt,table_head_col:Kt,table_head_minCol:Jt,table_head_minCol_still:Yt,table_head_minCol_cancel:te,table_body_row:ee,table_body_row_focus:oe,table_body_col:se,table_body_minCol:ne,table_body_minCol_still:ae,table_body_minCol_cancel:ce,table_body_img:le,table_body_icon:re,table_body_nameHover:_e,table_body_name:ie,table_body_name_focused:de,table_body_nameString:ue,table_body_amount:fe,table_body_amount_focused:ge,table_body_catalog:me,table_body_catalog_top:pe,table_body_catalog_icon:be,table_body_catalog_iconActive:he,table_body_catalog_drop:xe,table_body_catalog_dropActive:ke,table_body_catalog_search:ye,table_body_catalog_item:je,table_body_catalog_text:Pe,table_body_buttons:ve,table_body_del:Ne,table_body_generation:Se,table_body_barcodeSave:Me,table_body_still:Ce,table_body_category:we,table_body_category_btn:$e,table_body_category_span:Ie,table_body_qr:Ee,table_body_barcode:De,table_body_barcode_focused:Ae,table_body_error:Te,table_body_unit:Re,table_body_unit_dropdown:Be,table_body_minCol_check:Fe,ikpuWrapper:Le,ikpuWrapper_ikpuModalBlock:We,ikpuWrapper_content:ze,ikpuWrapper_buttons:He,ikpuWrapper_save:qe,ikpuWrapper_delete:Ue,ikpuWrapper_cancel:Ge,left:Oe,left_content:Ze,left_content_item:Xe,right:Ve,right_block:Qe,right_bottom:Ke,right_bottom_item:Je,right_bottom_item_img:Ye,right_bottom_BaseItem:to,right_bottom_BaseItem_img:eo,foundProducts:oo,foundProducts_modal:so,foundProducts_top:no,foundProducts_top_buttons:ao,foundProducts_top_add:co,foundProducts_top_close:lo,foundProducts_item:ro,foundProducts_item_mxik:_o,foundProducts_item_content:io,foundProducts_item_photo:uo,foundProducts_item_list:fo,foundProducts_item_list_box:go,foundProducts_item_title:mo,foundProducts_item_myIcon:po,foundProducts_item_desc:bo,foundProducts_item_btn:ho,foundProducts_item_btn_active:xo,foundProducts_title:ko,foundProducts_more:yo,foundProducts_allActive:jo,foundProducts_buttons:Po,foundProducts_btn:vo,foundProducts_btn_cancel:No,foundProducts_btn_save:So,foundProducts_list:Mo,errorModal:Co,errorModal_block:wo,addingProducts:$o,leftMenu:Io,leftMenu_list:Eo,leftMenu_li:Do,leftMenu_li_icon:Ao,leftMenu_li_icon_active:To,leftMenu_li_active:Ro,leftMenu_link:Bo,leftMenu_link_active:Fo,leftMenu_linkArrow:Lo,leftMenu_linkArrow_active:Wo,leftMenu_active:zo,miniInfo_content:Ho,miniInfo_imgBlock:qo,miniInfo_list:Uo};async function tt(e,s,a,l,i){try{if(e==="По тексту"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search-subposition?search_text=${s}&page=${a}&size=${l}&lang=${i}`);console.log("По тексту res",c);const f=await c.data.data.content,d=await c.data.data.totalElements,_=await c.data.data.totalPages;return{data:f,totalElements:d,totalPages:_}}else if(e==="По штрих-коду"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?gtin=${s}&size=${l}&page=${a}&lang=${i}`),f=await c.data.data.content,d=await c.data.data.totalElements,_=await c.data.data.totalPages;return console.log("По штрих-коду res",c),{data:f,totalElements:d,totalPages:_}}else if(e==="По ИКПУ"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?mxikCode=${s}&size=${l}&page=${a}&lang=${i}`);console.log("По ИКПУ res",c);const f=await c.data.data.content,d=await c.data.data.totalElements,_=await c.data.data.totalPages;return{data:f,totalElements:d,totalPages:_}}else if(e==="Расширинный по тексту"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?text=${s}&size=${l}&page=${a}&lang=${i}`);console.log("Расширинный по тексту res",c);const f=await c.data.data.content,d=await c.data.data.totalElements,_=await c.data.data.totalPages;return{data:f,totalElements:d,totalPages:_}}else if(e==="По номеру рег. удостовирения"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/dv-cert-number?dvCertNumber=${s}&page=${a}&size=${l}&lang=${i}`);console.log("По номеру рег. удостовирения res",c);const f=await c.data.data.content,d=await c.data.data.totalElements,_=await c.data.data.totalPages;return{data:f,totalElements:d,totalPages:_}}else if(e==="По ТН ВЭД"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?tnvedCode=${s}&size=${l}&page=${a}&lang=${i}`);console.log("По ТН ВЭД res",c);const f=await c.data.data.content,d=await c.data.data.totalElements,_=await c.data.data.totalPages;return{data:f,totalElements:d,totalPages:_}}else if(e==="По бренду"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?brandName=${s}&size=${l}&page=${a}&lang=${i}`);console.log("По бренду res",c);const f=await c.data.data.content,d=await c.data.data.totalElements,_=await c.data.data.totalPages;return{data:f,totalElements:d,totalPages:_}}else if(e==="По MHH"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/mnn-name?mnn_name=${s}&page=${a}&size=${l}&lang=${i}`);console.log("По MHH res",c);const f=await c.data.data,d=await c.data.recordTotal,_=await d/l;return{data:f,totalElements:d,totalPages:_}}}catch(c){console.log(c)}}async function nt(e){var a;const s=V.get("multi-store");try{return(await X.post("nomenclatures/is-unique-name",{multiStoreId:Number(s),nameRu:(a=e.subPositionName)==null?void 0:a.toString()})).data.success}catch(l){return console.log("Ошибка произошла при проверки наличия продукта на складе по наименованию",l),!1}}async function et(e,s){try{return(await G.get(`https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/mxik/picture-names?lang=${s}&mxik_code=${e}`)).data}catch(a){console.log("Ошибка при получении картинок к продукту",a)}}function Go(){var l,i;const{checkedProductsByCode:e}=w(),[s,a]=u.useState([]);return u.useEffect(()=>{a([...e])},[e]),console.log("localProduct",s),t.jsx("div",{className:o.miniInfo,children:s.length>0&&t.jsxs("div",{className:o.miniInfo_content,children:[t.jsx("div",{className:o.miniInfo_imgBlock,children:t.jsx("img",{src:(i=(l=s[0])==null?void 0:l.photos)!=null&&i.length?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+s[0].photos[0]:"/noPhoto.jpg",alt:""})}),t.jsxs("ul",{className:o.miniInfo_list,children:[t.jsxs("li",{children:[t.jsx("span",{children:"Штрихкод:"}),t.jsx("span",{children:s&&s[0].internationalCode||"-"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"ИКПУ:"}),t.jsx("span",{children:s&&s[0].mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Бренд:"}),t.jsx("span",{children:s&&s[0].brandName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Наименование:"}),t.jsx("span",{children:s&&s[0].subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Ед. Изм:"}),t.jsx("span",{children:s&&s[0].attributeName})]})]})]})})}const Oo="_globalModal_15wz1_1",Zo="_globalModal_back_15wz1_13",Xo="_globalModal_container_15wz1_45",Vo="_globalModal_left_15wz1_54",Qo="_globalModal_left_top_15wz1_59",Ko="_globalModal_left_desc_15wz1_64",Jo="_globalModal_left_bottom_15wz1_71",Yo="_globalModal_left_bottom_link_15wz1_76",ts="_globalModal_left_bottom_label_15wz1_94",es="_globalModal_right_15wz1_109",os="_globalModal_right_top_15wz1_114",ss="_globalModal_right_top_desc_15wz1_119",ns="_globalModal_right_bottom_15wz1_134",as="_globalModal_right_bottom_link_15wz1_139",cs="_globalModal_right_bottom_label_15wz1_157",ls="_globalModal_confirm_15wz1_172",rs="_globalModal_confirm_info_15wz1_184",_s="_globalModal_confirm_desc_15wz1_191",is="_globalModal_confirm_buttons_15wz1_207",ds="_globalModal_confirm_btn_15wz1_216",R={globalModal:Oo,globalModal_back:Zo,globalModal_container:Xo,globalModal_left:Vo,globalModal_left_top:Qo,globalModal_left_desc:Ko,globalModal_left_bottom:Jo,globalModal_left_bottom_link:Yo,globalModal_left_bottom_label:ts,globalModal_right:es,globalModal_right_top:os,globalModal_right_top_desc:ss,globalModal_right_bottom:ns,globalModal_right_bottom_link:as,globalModal_right_bottom_label:cs,globalModal_confirm:ls,globalModal_confirm_info:rs,globalModal_confirm_desc:_s,globalModal_confirm_buttons:is,globalModal_confirm_btn:ds};function at({staticText:e,method:s,setModalOpen:a}){const{globalRemember:l,setGlobalRemember:i,programRemember:c,setProgramRemember:f}=w();console.log("staticText",e,"method",s);const d=_=>{s=="program"?(i(_===!0?!1:l),f(_)):s=="global"&&(f(_===!0?!1:c),i(_)),a(!1)};return t.jsx("div",{className:R.globalModal_confirm,children:t.jsxs("div",{className:R.globalModal_confirm_info,children:[e==null?void 0:e.map(_=>t.jsx("p",{className:R.globalModal_confirm_desc,children:_.title},_.id)),t.jsxs("div",{className:R.globalModal_confirm_buttons,children:[t.jsx("button",{className:R.globalModal_confirm_btn,onClick:()=>d(!1),children:"Отменить"}),t.jsx("button",{className:R.globalModal_confirm_btn,onClick:()=>d(!0),children:"Применить"})]})]})})}const us=[{id:U(),title:"Данная настройка позволяет автоматически производить поиск товара в ручном режиме в национальной базе товаров и услуг PУз"},{id:U(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function fs(){const{programRemember:e,searchText:s,setGlobalModal:a,setErrorMessage:l}=w(),i=u.useRef(null),[c,f]=u.useState(!1);u.useEffect(()=>{console.log("globalRemember",e),i.current&&(console.log("checkboxRef.current",i.current.checked),i.current.checked=e)},[e,i]);const d=()=>{f(!0)},_=()=>{l(`по штрихкоду ${s} ничего не найдено, попробуйте найти по названию`),a(!1)};return t.jsxs("div",{className:R.globalModal_left,children:[c&&t.jsx(at,{staticText:us,method:"program",setModalOpen:f}),t.jsxs("div",{className:R.globalModal_left_top,children:[t.jsx(T,{name:"MapPinIcon",width:35,height:35}),t.jsx("p",{className:R.globalModal_left_desc,children:"Данный товар не найден в национальной базе товаров и услуг."})]}),t.jsxs("div",{className:R.globalModal_left_bottom,children:[t.jsx(A,{to:"#",className:R.globalModal_left_bottom_link,onClick:_,children:"Искать в программе"}),t.jsxs("div",{className:R.globalModal_left_bottom_label,onClick:d,children:[t.jsx("input",{type:"checkbox",className:R.globalModal_left_bottom_checkbox,ref:i}),t.jsx("span",{children:"Запомнить это действие "})]})]})]})}async function ct(e){try{console.log("getGlobalProduct barcode",e);const s=await G.get(`https://api.barcodelookup.com/v3/products?barcode=${e}&formatted=y&key=7yd26itc9ov4fdwfymvp888cyuepbl`);console.log("getGlobalProduct res",s)}catch(s){console.log("Ошибкра при поиске продукта в глобальной базе",s)}}const gs=[{id:U(),title:"Данная настройка позволяет автоматически производить поиск в глобальной базе, в случаи если в национальной базе товары не были найдены"},{id:U(),title:"Внимание! В случаи глобального поиска, ИКПУ не будет присвоен."},{id:U(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function ms(){const{searchText:e,globalRemember:s,setGlobalModal:a}=w(),l=u.useRef(null),[i,c]=u.useState(!1);u.useEffect(()=>{console.log("globalRemember",s),l.current&&(console.log("checkboxRef.current",l.current.checked),l.current.checked=s)},[s,l]),u.useEffect(()=>{console.log("globalRemember",s),l.current&&(console.log("checkboxRef.current",l.current.checked),l.current.checked=s)},[s,l]);const f=async b=>{const g=await ct(b);console.log("handleGlobalSearch data",g)},d=()=>{f(e),a(!1)},_=()=>{c(!0)};return t.jsxs("div",{className:R.globalModal_right,children:[i&&t.jsx(at,{staticText:gs,method:"global",setModalOpen:c}),t.jsxs("div",{className:R.globalModal_right_top,children:[t.jsx(T,{name:"GlobeAltIcon",width:35,height:35}),t.jsxs("p",{className:R.globalModal_right_top_desc,children:[t.jsx("span",{children:"Ипользовать глобальный поиск"}),t.jsx("span",{children:"(В этом случаи, товару не будет присвоен ИКПУ)"})]})]}),t.jsxs("div",{className:R.globalModal_right_bottom,children:[t.jsx(A,{to:"#",className:R.globalModal_right_bottom_link,onClick:d,children:"Искать глобально"}),t.jsxs("div",{className:R.globalModal_right_bottom_label,onClick:_,children:[t.jsx("input",{type:"checkbox",ref:l,className:R.globalModal_right_bottom_checkbox}),t.jsx("span",{children:"Запомнить это действие"})]})]})]})}function ps(){const{setGlobalModal:e,setSearchText:s}=w(),a=()=>{s(""),e(!1)};return t.jsxs("div",{className:R.globalModal,children:[t.jsxs(A,{to:"#",className:R.globalModal_back,onClick:a,children:[t.jsx(T,{name:"ChevronLeftIcon",width:20,height:15}),t.jsx("span",{children:"Назад"})]}),t.jsxs("div",{className:R.globalModal_container,children:[t.jsx(fs,{}),t.jsx(ms,{})]})]})}function bs(){const s=Q().pathname,{pickedSearch:a,setPickedSearch:l,searchText:i,setSearchText:c,searchParams:f,TemporaryData:d,setTemporaryData:_,setSearchResponse:b,setTotalElementsStore:g,setTotalPagesStore:p,setCheckedProductsByCode:k,checkedProductsByCode:n,setPage:r,page:x,perPage:m,lang:y,globalModal:j,setGlobalModal:M,globalRemember:I,programRemember:h,errorMessage:N,setErrorMessage:S}=w(),[B,L]=u.useState([]);u.useEffect(()=>{L([...n])},[n]),u.useEffect(()=>{S(""),c("")},[s]),u.useEffect(()=>{(a=="По штрих-коду"||a=="По ИКПУ"||a=="По ТН ВЭД")&&(i.toString(),i.length<13&&l("По ТН ВЭД"),i.length==13&&l("По штрих-коду"),i.length>13&&l("По ИКПУ"))},[i]),u.useEffect(()=>{const C=document.querySelector(`input[name="search"][value="${a}"]`);C&&(C.checked=!0)},[a]);const O=C=>{l(C.currentTarget.value)},P=async C=>{if(C.preventDefault(),b([]),r(0),V.get("access_token")||await st(),i.length>0&&a!="По штрих-коду"&&a!="По ИКПУ"){console.log("1 СЦЕНАРИЙ по тексту");const{data:E,totalElements:F,totalPages:W}=await tt(a,i.trim(),0,m,y);if(E.length==0){S("ничего не найдено");return}F&&W&&(g(F),p(W));const z=[];for(const Z of E){const H=await et(Z.mxikCode,y);z.push({...Z,id:U(),photos:H,createdByHand:!1})}b(z)}if(i.length>0&&a=="По штрих-коду"||a=="По ИКПУ"){const{data:E,totalElements:F,totalPages:W}=await tt(a,i.trim(),x,m,y);E.length==0&&S("ничего не найдено"),F&&W&&(g(F),p(W));const z=[];for(const H of E){const K=await nt(H),rt=await et(H.mxikCode,y);K&&z.push({...H,id:U(),photos:rt,createdByHand:!1})}if(E.length==0)if(I===!0){const H=await ct(i);console.log("navAddProduct fetchData",H)}else h===!0?(console.log("programRemember === true что дальше? (NavAddProduct 207)",h),S(`по данному кду "${i}" ничего не найдено, попробуйте найти по названию`)):M(!0);else if(E.length==1&&z.length==0){S("Этот продукт уже есть на складе");return}else if(E.length>0&&z.length>0&&z.filter(H=>d.some(K=>K.mxikCode===H.mxikCode))[0]){S("Вы уже ввбрали это продукт");return}const Z=z.filter(H=>!d.some(K=>K.mxikCode===H.mxikCode));k([...Z]),_([...Z,...d])}},q=C=>{C!=i&&S(""),/^[a-zA-Z]+$/.test(C)?(console.log("тексе"),a!="Расширинный по тексту"&&a!="По бренду"&&a!="По номеру рег. удостовирения"&&a!="По MHH"&&(l("По тексту"),S(""))):/^\d+$/.test(C)?(console.log("число"),C.length<=4?(l("По ТН ВЭД"),S(""),console.log("По ТН ВЭД")):C.length>4&&C.length<=13?(console.log("По штрих-коду"),S(""),l("По штрих-коду")):C.length>13&&C.length<=17?(l("По ИКПУ"),S(""),console.log("По ИКПУ")):C.length>17?(console.log("value",C),console.log("код ИКПУ не валидный"),S("код ИКПУ не валидный")):S("Введен невалидный символ")):a!="Расширинный по тексту"&&a!="По бренду"&&a!="По номеру рег. удостовирения"&&a!="По MHH"&&l("По тексту"),c(C)};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:o.nav,children:[j&&t.jsx(ps,{}),t.jsxs("form",{action:"",className:o.nav_form,onSubmit:C=>P(C),children:[t.jsxs("div",{className:o.nav_form_left,children:[t.jsxs("ul",{className:o.nav_buttons,children:[t.jsx("li",{children:t.jsxs(A,{className:`${o.back} ${o.nav_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(T,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(A,{to:"/addingProducts/settingsAddProducts",className:`${o.nav_linkBtn} ${o.nav_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(T,{name:"Cog8ToothIcon",className:o.nav_buttons_iconSetting})]})})]}),t.jsxs("fieldset",{children:[t.jsx("input",{value:i,type:"text",className:o.nav_form_input,placeholder:a,onChange:C=>q(C.currentTarget.value)}),t.jsx("button",{type:"submit",className:o.nav_form_btn,children:"Поиск"})]})]}),B.length>0&&d.length>0&&t.jsx(Go,{}),t.jsx("ul",{className:o.nav_form_list,children:f==null?void 0:f.map(C=>t.jsx("li",{children:t.jsxs("label",{className:o.nav_form_check,children:[t.jsx("input",{type:"radio",name:"search",value:C.title,onClick:v=>O(v)}),t.jsx("span",{className:o.nav_form_check_text,children:C.title})]})},C.id))})]}),t.jsx("span",{className:o.nav_error,children:N})]})})}function hs({staticList:e}){return t.jsx("div",{className:o.left,children:t.jsx("div",{className:o.left_content,children:e.map(s=>t.jsxs("div",{className:o.left_content_item,children:[t.jsx("h3",{children:s.title}),t.jsx("p",{children:s.value})]},s.id))})})}function xs(){const{imagesSrc:e,setImagesSrc:s}=w(),[a,l]=u.useState(null),i=u.useRef([]),c=n=>{i.current.forEach(r=>{r&&r.getAttribute("id")==n&&r.click()})};function f(n,r){l(r)}function d(n){n.target.style.background="white"}function _(n){n.target.style.background="white"}function b(n){n.preventDefault(),n.target.style.background="lightgray"}function g(n,r){n.preventDefault(),n.target.style.background="white";const x=e.map(m=>m.id===r.id?{...m,order:(a==null?void 0:a.order)||m.order}:m.id===(a==null?void 0:a.id)?{...m,order:r.order}:m);s(x),l(null)}function p(n,r){return n.order>r.order?1:-1}const k=n=>{var x,m;const r=(m=(x=n==null?void 0:n.target)==null?void 0:x.files)==null?void 0:m[0];if(r&&(r==null?void 0:r.type)==="image/jpeg"||(r==null?void 0:r.type)==="image/png"||(r==null?void 0:r.type)==="image/webp"){const y=n.target.getAttribute("id"),j=[...e],M=j.find(h=>h.id==y),I=j.findIndex(h=>h.id==y);if(M){const h=new FileReader;h.onload=N=>{var S;(S=N.target)!=null&&S.result&&(M.src=URL.createObjectURL(r),j.splice(I,1,M),s([...j]))},h.readAsDataURL(r)}}};return t.jsx("div",{className:o.right,children:t.jsx("div",{className:o.right_block,children:t.jsx("div",{className:o.right_bottom,children:e.sort(p).map((n,r)=>{var x;return t.jsxs("div",{draggable:!0,onDragStart:m=>f(m,n),onDragLeave:m=>d(m),onDragEnd:m=>_(m),onDragOver:m=>b(m),onDrop:m=>g(m,n),className:r==0?o.right_bottom_BaseItem:o.right_bottom_item,onDoubleClick:()=>c(n.id),children:[t.jsx("input",{id:n.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:k,ref:m=>{i.current[r]=m}}),t.jsx("img",{src:n.src=="/noPhoto.jpg"||((x=n.src)==null?void 0:x.toString().split(":")[0])=="blob"?n.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+n.src,width:r==0?150:50,height:r==0?150:50,alt:"",className:`${r==0?o.right_bottom_baseImg:o.right_bottom_img}`})]},n.id)})})})})}function ks({addingImgToProduct:e,handleCancel:s}){const{ikpuStatus:a}=w();return t.jsxs("div",{className:o.ikpuWrapper_buttons,children:[t.jsx(A,{to:"#",className:o.ikpuWrapper_save,onClick:l=>e(l),children:"Coхранить"}),a.type==="info photo"&&t.jsx(A,{to:"#",className:o.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(A,{to:"#",onClick:l=>s(l),className:o.ikpuWrapper_cancel,children:"Отмена"})]})}const J=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:3,title:"Группа:",value:""},{id:4,title:"Класс:",value:""},{id:5,title:"Позиция:",value:""},{id:6,title:"Субпозиция:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""},{id:9,title:"Описание:",value:""}];function ys(){const{searchResponseItem:e,imagesSrc:s,setImagesSrc:a,setSearchResponseItem:l,setIkpuStatus:i,ikpuStatus:c}=w(),[f,d]=u.useState([]);u.useEffect(()=>{if(e){const g=J==null?void 0:J.map(p=>{let k;return p.title=="ИКПУ:"&&(k=e.mxikCode),p.title=="Штрих-код:"&&(k=e.internationalCode),p.title=="Группа:"&&(k=e.groupName),p.title=="Класс:"&&(k=e.className),p.title=="Позиция:"&&(k=e.positionName),p.title=="Субпозиция:"&&(k=e.subPositionName),p.title=="Наименование:"&&(k=e.className),p.title=="Бренд:"&&(k=e.brandName),p.title=="Описание:"&&(k=e.attributeName),{id:p.id,title:p.title,value:k}});d([...g])}},[e]),u.useEffect(()=>{if(e.photos){const g=s.map((p,k)=>{var n,r;return{id:p.id,order:p.order,src:(n=e==null?void 0:e.photos)!=null&&n[k]?(r=e==null?void 0:e.photos)==null?void 0:r[k]:"/noPhoto.jpg"}});g&&a(g)}},[]);const _=g=>{g.preventDefault();const p=s==null?void 0:s.map(k=>k.src);e.photos=p,l(e),i({status:!1,type:""})};function b(g){g.preventDefault();const p=s.map(k=>({id:k.id,order:k.order,src:k.src}));a(p),i({status:!1,type:""})}return t.jsx(t.Fragment,{children:t.jsx("div",{className:o.ikpuWrapper,onClick:b,children:t.jsxs("div",{className:o.ikpuWrapper_ikpuModalBlock,onClick:g=>g.stopPropagation(),style:{width:c.type==="info photo"?"700px":"250px",minHeight:c.type==="info photo"?"500px":"400px"},children:[t.jsxs("div",{className:o.ikpuWrapper_content,children:[c.type==="info photo"&&t.jsx(hs,{staticList:f}),t.jsx(xs,{})]}),t.jsx(ks,{addingImgToProduct:_,handleCancel:b})]})})})}function js({item:e}){const{TemporaryData:s,setTemporaryData:a}=w(),[l,i]=u.useState(e.crmArrivalPrice??"0"),[c,f]=u.useState(""),[d,_]=u.useState(!1),b=n=>{if(/^[a-zA-Z]+$/.test(n))f("Введите число");else if(/^\d+$/.test(n))if(n.length==2&&n[0]=="0"){const r=n[1];i(r),f(""),g(r)}else f(""),i(n),g(n);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(n)?f("Введите число"):n==""&&(g("0"),f(""),i("0"))},g=n=>{s.forEach(r=>{r.id==e.id&&(r.crmArrivalPrice=Number(n))}),a(s)},p=()=>{_(!0)},k=()=>{_(!1)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",value:l,onFocus:p,onBlur:k,className:`${o.table_body_amount} ${d?o.table_body_amount_focused:""}`,onChange:n=>b(n.target.value)})]})}function Ps({item:e}){const{TemporaryData:s,setTemporaryData:a}=w(),[l,i]=u.useState(e.crmSellingPrice??"0"),[c,f]=u.useState(""),[d,_]=u.useState(!1),b=n=>{if(/^[a-zA-Z]+$/.test(n))f("Введите число");else if(/^\d+$/.test(n))if(n.length==2&&n[0]=="0"){const r=n[1];i(r),f(""),g(r)}else f(""),i(n),g(n);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(n)?f("Введите число"):n==""&&(g("0"),f(""),i("0"))},g=n=>{s.forEach(r=>{r.id==e.id&&(r.crmSellingPrice=Number(n))}),a(s)},p=()=>{_(!0)},k=()=>{_(!1)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",value:l,onFocus:p,onBlur:k,className:`${o.table_body_amount} ${d?o.table_body_amount_focused:""}`,onChange:n=>b(n.target.value)})]})}function vs({item:e}){const{TemporaryData:s,setTemporaryData:a}=w(),[l,i]=u.useState(e.crmAmount??"0"),[c,f]=u.useState(""),[d,_]=u.useState(!1),b=n=>{if(/^[a-zA-Z]+$/.test(n))f("Введите число");else if(/^\d+$/.test(n))if(n.length==2&&n[0]=="0"){const r=n[1];i(r),f(""),g(r)}else f(""),i(n),g(n);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(n)?f("Введите число"):n==""&&(g("0"),f(""),i("0"))},g=n=>{s.forEach(r=>{r.id==e.id&&(r.crmAmount=Number(n))}),a(s)},p=()=>{_(!0)},k=()=>{_(!1)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{onFocus:p,onBlur:k,type:"text",value:l,className:`${o.table_body_amount} ${d?o.table_body_amount_focused:""}`,onChange:n=>b(n.target.value)})]})}function Ns({item:e}){const{TemporaryData:s,setTemporaryData:a}=w(),[l,i]=u.useState(e.crmNameProduct??""),[c,f]=u.useState(!1),[d,_]=u.useState(""),[b,g]=u.useState(!1);u.useEffect(()=>{k(l)},[l]);const p=y=>{i(y),_("")},k=y=>{s.forEach(j=>{j.id==e.id&&(j.crmNameProduct=y)}),a(s)},n=()=>{console.log("hover"),f(!0)},r=()=>{console.log("hover"),f(!1)},x=()=>{g(!0)},m=()=>{g(!1)};return e.createdByHand===!0?t.jsxs("div",{className:o.table_body_nameBlock,children:[t.jsx("span",{className:o.table_body_error,children:d}),t.jsx("textarea",{onChange:y=>p(y.target.value),value:`${l}`,onFocus:x,onBlur:m,className:`${o.table_body_name} ${b?o.table_body_name_focused:""}`,placeholder:e!=null&&e.subPositionName?e==null?void 0:e.subPositionName:e.crmNameProduct?e.crmNameProduct:"Добавьте наименование",children:l})]}):t.jsxs("div",{className:o.table_body_nameBlock,children:[c&&t.jsx("span",{className:o.table_body_nameHover,children:e.subPositionName}),t.jsx("span",{onMouseEnter:n,onMouseLeave:r,className:o.table_body_nameString,children:e.subPositionName})]})}const Ss=(e=0,s=9)=>Math.floor(Math.random()*(s+1-e)+e).toString();function ot(e=13){let s="";for(let a=1;a<=e;a++){const l=Ss();s+=l}return s}function Ms({i:e,item:s}){const{TemporaryData:a,setTemporaryData:l}=w(),[i,c]=u.useState(""),[f,d]=u.useState(""),[_,b]=u.useState(!1),g=u.useRef(null);u.useEffect(()=>{var m;g!=null&&g.current&&e==0&&((m=g==null?void 0:g.current)==null||m.focus())},[g]);const p=m=>{/^[a-zA-Z]+$/.test(m)?d("Введите число"):/^\d+$/.test(m)?(d(""),c(m)):/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(m)?d("Введите число"):m==""&&(d(""),c(m))},k=()=>{const y=13-i.split("").length,j=y>0?ot(y):ot(),M=y>0?i+j:j;c(M)},n=()=>{if(i.length==13)a.forEach(m=>{m.id==s.id&&(m.internationalCode=i)}),l(a);else{const m=13-i.length;d(`Еще ${m} символов`)}},r=()=>{b(!0)},x=()=>{b(!1)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:f}),t.jsx("input",{type:"text",onChange:m=>p(m.target.value),maxLength:13,value:i,ref:g,onFocus:r,onBlur:x,className:`${o.table_body_barcode} ${_?o.table_body_barcode_focused:""}`}),t.jsxs("div",{className:o.table_body_buttons,children:[t.jsx("button",{className:o.table_body_generation,onClick:k,children:"Генерировать"}),t.jsx("button",{className:o.table_body_barcodeSave,onClick:n,children:"Сохранить"})]})]})}function Cs({item:e}){const{TemporaryData:s,setTemporaryData:a}=w(),[l,i]=u.useState(e.crmQR??!1);u.useEffect(()=>{c(l)},[l]);const c=f=>{s.forEach(d=>{d.id==e.id&&(d.crmQR=f)}),a(s)};return t.jsxs("div",{className:o.table_body_qr,onClick:()=>i(!l),children:[l&&t.jsx(T,{name:"PlusIcon"}),!l&&t.jsx(T,{name:"MinusIcon"}),t.jsx(it,{status:l,width:50})]})}const ws="_modalCategory_5j9ek_1",$s="_modalCategory_block_5j9ek_10",Is="_modalCategory_nav_5j9ek_16",Es="_modalCategory_nav_title_5j9ek_23",Ds="_modalCategory_nav_close_5j9ek_29",As="_modalCategory_content_5j9ek_32",Ts="_modalCategory_content_message_5j9ek_39",Rs="_modalCategory_content_link_5j9ek_47",Bs="_modalCategory_content_link_active_5j9ek_76",Fs="_modalCategory_content_item_5j9ek_86",Ls="_modalCategory_content_block_5j9ek_108",Ws="_modalCategory_content_block_title_5j9ek_112",zs="_settings_5j9ek_120",Hs="_settings_title_5j9ek_123",qs="_settings_content_5j9ek_128",Us="_settings_content_top_5j9ek_131",Gs="_settings_content_buttons_5j9ek_134",Os="_settings_content_btn_5j9ek_144",Zs="_settings_content_btn_cancel_5j9ek_156",Xs="_settings_content_btn_save_5j9ek_159",Vs="_settings_tools_5j9ek_162",Qs="_settings_tools_link_5j9ek_167",Ks="_settings_tools_link_active_5j9ek_182",$={modalCategory:ws,modalCategory_block:$s,modalCategory_nav:Is,modalCategory_nav_title:Es,modalCategory_nav_close:Ds,modalCategory_content:As,modalCategory_content_message:Ts,modalCategory_content_link:Rs,modalCategory_content_link_active:Bs,modalCategory_content_item:Fs,modalCategory_content_block:Ls,modalCategory_content_block_title:Ws,settings:zs,settings_title:Hs,settings_content:qs,settings_content_top:Us,settings_content_buttons:Gs,settings_content_btn:Os,settings_content_btn_cancel:Zs,settings_content_btn_save:Xs,settings_tools:Vs,settings_tools_link:Qs,settings_tools_link_active:Ks};function Js({setCancel:e}){return t.jsxs("div",{className:$.modalCategory_nav,children:[t.jsx("h2",{className:$.modalCategory_nav_title,children:"Котегория"}),t.jsx("button",{className:$.modalCategory_nav_close,onClick:e,children:t.jsx(T,{width:24,height:24,name:"XMarkIcon"})})]})}async function Ys(e,s){try{return await X.get(`categories?page=${e}&perPage=${s}`)}catch(a){console.log("Ошибка при получении супер категорий при добавлении продукта на склад",a)}}function tn({superId:e,setSuperId:s,setCategoryId:a}){const[l,i]=u.useState(1),[c,f]=u.useState(1),[d]=u.useState(10),[_,b]=u.useState([]);u.useEffect(()=>{g(l,d)},[]);async function g(n,r){var j,M;const x=await Ys(n,r),m=await((j=x==null?void 0:x.data)==null?void 0:j.pagination),y=await((M=x==null?void 0:x.data)==null?void 0:M.data);f(m.total_pages),b([..._,...y])}const p=n=>{n.preventDefault();const r=l+1;i(r),g(r,d),console.log("addPage",r)},k=n=>{a(0),s(n)};return t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Суперкотегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[_==null?void 0:_.map(n=>t.jsxs(A,{to:"#",className:`${$.modalCategory_content_link} ${n.id==e?$.modalCategory_content_link_active:""} `,onClick:r=>k(n.id),children:[n.name.ru,t.jsx(T,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},n.id)),l<c&&t.jsx(A,{to:"#",className:$.modalCategory_content_link,onClick:n=>p(n),children:"Ещё..."})]})]})}async function en(e,s,a){try{return await X.get(`categories?parentId=${a}&page=${e}&perPage=${s}`)}catch(l){console.log("Ошибка при получении категорий при добавлении продукта на склад",l)}}function on({superId:e,categoryId:s,setCategoryId:a,setSubId:l}){const[i,c]=u.useState([]),[f,d]=u.useState(1),[_,b]=u.useState(1),[g]=u.useState(10);u.useEffect(()=>{c([]),d(1),e!==0&&p(1,10)},[e]);async function p(r,x){var M,I;const m=await en(r,x,e),y=await((M=m==null?void 0:m.data)==null?void 0:M.pagination),j=await((I=m==null?void 0:m.data)==null?void 0:I.data);b(y.total_pages),c(h=>[...h,...j])}const k=r=>{r.preventDefault();const x=f+1;d(x),p(x,g)},n=r=>{l(0),a(r)};return i.length>0&&t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Котегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[i==null?void 0:i.map(r=>t.jsxs(A,{to:"#",className:`${$.modalCategory_content_link} ${r.id==s?$.modalCategory_content_link_active:""} `,onClick:x=>n(r.id),children:[r.name.ru,t.jsx(T,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},r.id)),f<_&&t.jsx(A,{to:"#",className:$.modalCategory_content_link,onClick:r=>k(r),children:"Ещё..."})]})]})}async function sn(e,s,a){try{return await X.get(`categories?parentId=${a}&page=${e}&perPage=${s}`)}catch(l){console.log("Ошибка при получении субкатегорий при добавлении продукта на склад",l)}}function nn({categoryId:e,subId:s,setSubId:a,setPickedCategory:l}){const[i,c]=u.useState([]),[f,d]=u.useState(1),[_,b]=u.useState(1),[g]=u.useState(10);u.useEffect(()=>{c([]),d(1),e!==0&&p(1,10)},[e]);async function p(r,x){var M,I;const m=await sn(r,x,e),y=await((M=m==null?void 0:m.data)==null?void 0:M.pagination),j=await((I=m==null?void 0:m.data)==null?void 0:I.data);b(y.total_pages),c(h=>[...h,...j])}const k=r=>{r.preventDefault();const x=f+1;d(x),p(x,g)},n=(r,x)=>{r.preventDefault(),a(x.id),l(x)};return i.length>0&&t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Подкотегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[i==null?void 0:i.map(r=>t.jsxs(A,{to:"#",className:`${$.modalCategory_content_link} ${r.id==s?$.modalCategory_content_link_active:""} `,onClick:x=>n(x,r),children:[r.name.ru,t.jsx(T,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},r.id)),f<_&&t.jsx(A,{to:"#",className:$.modalCategory_content_link,onClick:r=>k(r),children:"Ещё..."})]})]})}function an({setPickedSubCategoryToProduct:e,setCancel:s}){return t.jsxs("div",{className:$.settings_content_buttons,children:[t.jsx(A,{to:"#",className:`${$.settings_content_btn} ${$.settings_content_btn_save}`,onClick:a=>e(a),children:"Сохранить"}),t.jsx("button",{className:`${$.settings_content_btn} ${$.settings_content_btn_cancel}`,onClick:s,children:"Отмена"})]})}function cn({item:e,setModalStatus:s}){const{TemporaryData:a,setTemporaryData:l}=w(),[i,c]=u.useState(""),[f,d]=u.useState(!1),[_,b]=u.useState(0),[g,p]=u.useState(0),[k,n]=u.useState(0),[r,x]=u.useState({});u.useEffect(()=>{console.log("pickedCategory",r)},[r]);function m(j){if(j.preventDefault(),_===0){d(!0),c("Выберите Суперкотегорию");return}else if(g===0){d(!0),c("Выберите Категорию");return}else if(k===0){d(!0),c("Выберите Подкотегорию");return}else a.forEach(M=>{M.id===e.id&&(M.crmCategory=r)}),l([...a]),y()}const y=()=>{b(0),p(0),n(0),c(""),d(!1),x({}),s(!1)};return t.jsx("div",{className:$.modalCategory,onClick:y,children:t.jsxs("div",{className:$.modalCategory_block,onClick:j=>j.stopPropagation(),children:[t.jsx(Js,{setCancel:y}),t.jsx("p",{className:$.modalCategory_content_message,children:i||""}),t.jsxs("div",{className:$.modalCategory_content,children:[t.jsx(tn,{superId:_,setSuperId:b,setCategoryId:p}),t.jsx(on,{superId:_,categoryId:g,setCategoryId:p,setSubId:n}),t.jsx(nn,{categoryId:g,subId:k,setSubId:n,setPickedCategory:x}),t.jsx(an,{setPickedSubCategoryToProduct:m,setCancel:y})]})]})})}function ln({item:e}){var _,b,g;const[s,a]=u.useState(!1),[l,i]=u.useState(!1),c=()=>{a(!0)},f=()=>{console.log("hover"),i(!0)},d=()=>{console.log("hover"),i(!1)};return t.jsxs("div",{className:o.table_body_category,children:[s&&t.jsx(cn,{item:e,setModalStatus:a}),l&&t.jsx("span",{className:o.table_body_nameHover,children:(_=e==null?void 0:e.crmCategory)!=null&&_.name.ru?e==null?void 0:e.crmCategory.name.ru:""}),t.jsx("span",{className:o.table_body_category_span,onMouseEnter:f,onMouseLeave:d,children:(b=e==null?void 0:e.crmCategory)!=null&&b.name.ru?e==null?void 0:e.crmCategory.name.ru:""}),t.jsx("button",{onClick:c,className:o.table_body_category_btn,children:t.jsx("span",{children:(g=e==null?void 0:e.crmCategory)!=null&&g.name.ru?"Изменить":"Выбрать"})})]})}const rn=[{id:U(),title:"шт.",isActive:!0,navIcon:""},{id:U(),title:"лт.",isActive:!0,navIcon:""},{id:U(),title:"кг.",isActive:!0,navIcon:""}];function _n({item:e}){const[s,a]=u.useState(!1),[l,i]=u.useState([...rn]),{TemporaryData:c,setTemporaryData:f}=w(),[d,_]=u.useState("шт.");u.useEffect(()=>{b()},[d]);const b=()=>{c.forEach(g=>{if(g.id==e.id){const p=[{code:0,mxikCode:e.mxikCode,nameLat:"",nameRu:d,nameUz:"",packageType:""}];g.packageNames=p}}),f(c),a(!1)};return t.jsx("div",{className:o.table_body_unit,children:t.jsx(dt,{className:o.table_body_unit_dropdown,width:"100px",openBlock:s,setOpenBlock:a,versionList:l,setVersionList:i,currentVersion:d,setCurrentVersion:_})})}function dn({i:e,item:s,column:a}){const{ikpuStatus:l,setSearchResponseItem:i,setIkpuStatus:c,setTemporaryData:f,TemporaryData:d}=w();u.useEffect(()=>{e==0&&(d.forEach(n=>{n.id==s.id?n.crmBlockFocused=!0:n.crmBlockFocused=!1}),f([...d]))},[]);const _=u.useRef(null);u.useEffect(()=>{_.current&&(s.crmCheckbox===!0?(console.log("item.crmCheckbox true",s.crmCheckbox),_.current.checked=!0):(console.log("item.crmCheckbox false",s.crmCheckbox),_.current.checked=!1))},[_,s.crmCheckbox]);const b=n=>{const r=n;d.forEach(x=>{x.id===s.id&&(x.crmCheckbox=n)}),f([...d]),console.log("checed",r)},g=(n,r)=>{r==="info photo"?(i(n),c({status:!l.status,type:"info photo"})):r==="photo"&&(i(n),c({status:!l.status,type:"photo"}))},p=()=>{if(console.log(1e4,"delPeoductItem"),d.length>0){console.log("item.id",s.id);const n=d.filter(r=>r.id!==s.id);console.log("filteredTemporaryData",n),f([...n])}},k=()=>{d.forEach(n=>{n.id==s.id?n.crmBlockFocused=!0:n.crmBlockFocused=!1}),f([...d])};return t.jsxs("tr",{"data-id":s==null?void 0:s.id,className:`${o.table_body_row} ${s.crmBlockFocused?o.table_body_row_focus:""}`,style:{gridTemplateColumns:`110px repeat(${a.length}, 200px) 110px 110px`},onClick:k,children:[t.jsx("td",{className:`${o.table_body_col} ${o.table_body_minCol_check}`,children:t.jsx("label",{children:t.jsx("input",{type:"checkbox",ref:_,onChange:n=>b(n.target.checked)})})}),a==null?void 0:a.map(n=>{var r,x,m,y,j,M,I,h;return t.jsxs("td",{"data-id":s==null?void 0:s.id,className:o.table_body_col,children:[(n==null?void 0:n.title)=="Количество"&&t.jsx(vs,{item:s}),(n==null?void 0:n.title)=="Приходная цена"&&t.jsx(js,{item:s}),(n==null?void 0:n.title)=="Продажная цена"&&t.jsx(Ps,{item:s}),(n==null?void 0:n.title)=="Наименование"&&t.jsx(Ns,{item:s}),(n==null?void 0:n.title)=="Фото"?t.jsx("img",{onClick:()=>g(s,"photo"),src:((r=s.photos)==null?void 0:r[0])=="/noPhoto.jpg"?(x=s.photos)==null?void 0:x[0]:((m=s.photos)==null?void 0:m.length)==0?"/noPhoto.jpg":(j=(y=s.photos)==null?void 0:y[0])!=null&&j.startsWith("blob")?(M=s.photos)==null?void 0:M[0]:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+((I=s.photos)==null?void 0:I[0]),width:40,height:40,alt:"",className:o.table_body_img}):"",(n==null?void 0:n.title)=="QR Код"&&t.jsx(Cs,{item:s}),(n==null?void 0:n.title)=="Ед.измерения"&&(s.createdByHand===!0?t.jsx(_n,{item:s}):((h=s==null?void 0:s.packageNames)==null?void 0:h[0].nameRu)??"-"),(n==null?void 0:n.title)=="ИКПУ"&&(s==null?void 0:s.mxikCode),(n==null?void 0:n.title)=="Подкатегория"&&t.jsx(ln,{item:s}),(n==null?void 0:n.title)=="Штрих-код"&&(s!=null&&s.internationalCode?s==null?void 0:s.internationalCode:t.jsx(Ms,{item:s,i:e}))]},n==null?void 0:n.id)}),t.jsx("td",{className:`${o.table_body_minCol} ${o.table_body_minCol_still}`,children:t.jsx("span",{onClick:()=>g(s,"info photo"),className:o.table_body_still,children:t.jsx(T,{name:"EllipsisHorizontalIcon",className:o.table_body_icon})})}),t.jsx("td",{className:`${o.table_body_minCol} ${o.table_body_minCol_cancel}`,children:t.jsx("span",{className:o.table_body_del,onClick:p,children:t.jsx(T,{name:"TrashIcon",width:20,height:20})})})]})}function un({column:e}){const{TemporaryData:s,setTemporaryData:a}=w(),[l,i]=u.useState([]),c=u.useRef(null);u.useEffect(()=>{s.some(d=>d.crmCheckbox===!1)?c.current&&(c.current.checked=!1):c.current&&(c.current.checked=!0),i([...s])},[s]);const f=d=>{s.forEach(_=>{_.crmCheckbox=d}),a([...s])};return t.jsxs("table",{className:o.table,children:[t.jsx("thead",{className:o.table_head,children:t.jsxs("tr",{className:o.table_head_row,style:{gridTemplateColumns:`110px repeat(${e.length}, 200px) 110px 110px`},children:[t.jsx("td",{className:`${o.table_head_minCol} ${o.table_head_minCol_check}`,children:t.jsx("input",{ref:c,type:"checkbox",onChange:d=>f(d.target.checked)})}),e==null?void 0:e.map(d=>t.jsx("td",{className:o.table_head_col,children:d.title},d.id)),t.jsx("td",{className:`${o.table_head_minCol} ${o.table_head_minCol_still}`,children:"Ещё"}),t.jsx("td",{className:`${o.table_head_minCol} ${o.table_head_minCol_cancel}`,children:"Отменить"})]})}),t.jsx("tbody",{className:o.table_body,children:l==null?void 0:l.map((d,_)=>t.jsx(dn,{item:d,column:e,i:_},d==null?void 0:d.id))})]})}function fn({clearTable:e,setData:s}){return t.jsxs("div",{className:o.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${o.formWrapper_btn} ${o.formWrapper_btn_save}`,onClick:s,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${o.formWrapper_btn} ${o.formWrapper_btn_cancel}`,onClick:a=>e(a),children:"Отмена"})]})}function gn(){const e=u.useRef(null),[s,a]=u.useState(!1),[l,i]=u.useState(0),[c,f]=u.useState(0),d=h=>{e.current&&(a(!0),i(h.pageX-e.current.offsetLeft),f(e.current.scrollLeft))},_=()=>{a(!1)},b=()=>{a(!1)},g=h=>{if(!s||!e.current)return;h.preventDefault();const S=(h.pageX-e.current.offsetLeft-l)*2;e.current.scrollLeft=c-S},{settingsParams:p,ikpuStatus:k,TemporaryData:n,setTemporaryData:r,setCheckedProducts:x}=w(),[m,y]=u.useState([]);u.useEffect(()=>{const h=p.filter(N=>N.checked);y(()=>[...h])},[p]);const j=async h=>{h.preventDefault();for(const N of n)await M(N)};async function M(h){var N,S,B;try{const L=V.get("multi-store"),O={multiStoreId:Number(L),categoryId:Number((N=h==null?void 0:h.crmCategory)==null?void 0:N.id),barcode:Number(h==null?void 0:h.internationalCode),nameUz:"string",nameUzc:"string",nameRu:h.subPositionName?h.subPositionName:(S=h==null?void 0:h.crmNameProduct)==null?void 0:S.toString(),mxik:(B=h==null?void 0:h.mxikCode)==null?void 0:B.toString(),brand:h.brandName??null,oldPrice:Number(h==null?void 0:h.crmArrivalPrice),price:Number(h==null?void 0:h.crmSellingPrice),oldPriceCourse:0,priceCourse:0,nds:0,discount:0};await X.post("nomenclatures",O),r([]),x([])}catch(L){console.log(`Ошибка произошла при попытке добавить ${h==null?void 0:h.crmNameProduct} на сервер`,L)}}const I=h=>{h.preventDefault(),r([]),x([])};return t.jsxs("div",{className:o.formWrapper,children:[t.jsxs("div",{className:o.found,ref:e,onMouseDown:d,onMouseLeave:_,onMouseUp:b,onMouseMove:g,children:[k.status===!0&&t.jsx(ys,{}),t.jsx(un,{column:m})]}),t.jsx(fn,{clearTable:I,setData:j})]})}const mn="_layout_5my6h_1",pn="_layout_back_5my6h_4",bn="_layout_title_5my6h_14",hn="_layout_list_5my6h_19",xn="_layout_link_5my6h_25",kn="_layout_link_active_5my6h_35",yn="_form_list_5my6h_39",jn="_form_check_5my6h_44",Pn="_navSetting_5my6h_51",vn="_found_5my6h_55",Nn="_table_5my6h_76",Sn="_table_head_5my6h_80",Mn="_table_head_row_5my6h_83",Cn="_table_head_col_5my6h_87",wn="_addSettings_list_5my6h_91",$n="_addSettings_li_5my6h_91",D={layout:mn,layout_back:pn,layout_title:bn,layout_list:hn,layout_link:xn,layout_link_active:kn,form_list:yn,form_check:jn,navSetting:Pn,found:vn,table:Nn,table_head:Sn,table_head_row:Mn,table_head_col:Cn,addSettings_list:wn,addSettings_li:$n},In=[{id:1,title:"отображения колонок",href:"/addingProducts/settingsAddProducts"},{id:2,title:"настройки",href:"/addingProducts/settingsAddProducts/settings"}];function En(){const s=Q().pathname;return t.jsxs("nav",{className:D.layout,children:[t.jsx(A,{className:D.layout_back,to:"/addingProducts",children:"Закрыть"}),t.jsx("h2",{className:D.layout_title,children:"Настройки"}),t.jsx("ul",{className:D.layout_list,children:In.map(a=>t.jsx("li",{children:t.jsx(A,{to:a.href,className:`${D.layout_link} ${a.href==s?D.layout_link_active:""}`,children:a.title})},a.id))})]})}function Dn(){const e=u.useRef([]),{necessarilySettings:s,settingsParams:a,setSettingsParams:l}=w();u.useEffect(()=>{e.current.forEach((c,f)=>{c&&(c.checked=a[f].checked,s.forEach(d=>{c.value==d&&(c.checked=!0)}))})},[a]);const i=c=>{const f=a.map(d=>({id:d.id,title:d.title,checked:d.title==c.currentTarget.value?c.currentTarget.checked:d.checked}));l(f)};return t.jsx("nav",{className:D.navSetting,children:t.jsx("form",{action:"",className:D.form,children:t.jsx("ul",{className:D.form_list,children:a==null?void 0:a.map((c,f)=>t.jsx("li",{children:t.jsxs("label",{className:D.form_check,children:[t.jsx("input",{type:"checkbox",value:c.title,ref:d=>{e.current[f]=d},onChange:d=>i(d)}),t.jsx("span",{className:D.form_check_text,children:c.title})]})},c.id))})})})}function An(){const{globalRemember:e,setGlobalRemember:s,programRemember:a,setProgramRemember:l}=w(),i=c=>{console.log("val",c),c==="program"?l(!a):c==="global"&&s(!e)};return t.jsx("div",{className:D.addSettings,children:t.jsx("div",{className:"container",children:t.jsxs("ul",{className:D.addSettings_list,children:[t.jsxs("li",{className:D.addSettings_li,onClick:()=>i("program"),children:[t.jsx("span",{className:D.addSettings_span,children:"Отменить выбор программного поиска"}),t.jsx("input",{type:"checkbox",className:D.addSettings_input,checked:a,readOnly:!0})]}),t.jsxs("li",{className:D.addSettings_li,onClick:()=>i("global"),children:[t.jsx("span",{className:D.addSettings_span,children:"Отменить выбор глобального поиска"}),t.jsx("input",{type:"checkbox",className:D.addSettings_input,checked:e,readOnly:!0})]})]})})})}function Tn(){const{settingsParams:e}=w(),a=Q().pathname,[l,i]=u.useState([]);return u.useEffect(()=>{const c=e.filter(f=>f.checked);i(()=>[...c])},[e]),t.jsxs("div",{className:"container",children:[t.jsx(En,{}),a=="/addingProducts/settingsAddProducts"&&t.jsx(Dn,{}),a=="/addingProducts/settingsAddProducts/settings"&&t.jsx(An,{}),t.jsx("section",{className:D.found,children:t.jsxs("table",{className:D.table,children:[t.jsx("thead",{className:D.table_head,children:t.jsx("tr",{className:D.table_head_row,style:{gridTemplateColumns:`repeat(${l.length}, 200px)`},children:l==null?void 0:l.map(c=>t.jsx("td",{className:D.table_head_col,children:c.title},c.id))})}),t.jsx("tbody",{className:D.table_body,children:t.jsx("tr",{className:D.table_body_row,children:t.jsx("td",{className:D.table_body_col})})})]})})]})}function Rn({staticList:e}){return t.jsx("div",{className:o.left,children:t.jsxs("div",{className:o.left_content,children:[e.map(s=>t.jsxs("div",{className:o.left_content_item,children:[t.jsx("h3",{children:s.title}),t.jsx("p",{children:s.value})]},s.id)),t.jsx("span",{style:{fontSize:"14px"},children:"(нужны картинки с сервера при get, post, patch запрсе по name)"})]})})}function Bn(){const{stockImagesSrc:e,setStockImagesSrc:s}=w(),[a,l]=u.useState(null),i=u.useRef([]),c=n=>{i.current.forEach(r=>{r&&r.getAttribute("id")==n&&r.click()})};function f(n,r){l(r)}function d(n){n.target.style.background="white"}function _(n){n.target.style.background="white"}function b(n){n.preventDefault(),n.target.style.background="lightgray"}function g(n,r){n.preventDefault(),n.target.style.background="white";const x=e.map(m=>m.id===r.id?{...m,order:(a==null?void 0:a.order)||m.order}:m.id===(a==null?void 0:a.id)?{...m,order:r.order}:m);s(x),l(null)}function p(n,r){return n.order>r.order?1:-1}const k=n=>{var x,m;const r=(m=(x=n==null?void 0:n.target)==null?void 0:x.files)==null?void 0:m[0];if(r&&(r==null?void 0:r.type)==="image/jpeg"||(r==null?void 0:r.type)==="image/png"||(r==null?void 0:r.type)==="image/webp"){const y=n.target.getAttribute("id"),j=[...e],M=j.find(h=>h.id==y),I=j.findIndex(h=>h.id==y);if(M){const h=new FileReader;h.onload=N=>{var S;(S=N.target)!=null&&S.result&&(M.src=URL.createObjectURL(r),j.splice(I,1,M),s([...j]))},h.readAsDataURL(r)}}};return t.jsx("div",{className:o.right,children:t.jsx("div",{className:o.right_block,children:t.jsx("div",{className:o.right_bottom,children:e.sort(p).map((n,r)=>{var x;return t.jsxs("div",{draggable:!0,onDragStart:m=>f(m,n),onDragLeave:m=>d(m),onDragEnd:m=>_(m),onDragOver:m=>b(m),onDrop:m=>g(m,n),className:r==0?o.right_bottom_BaseItem:o.right_bottom_item,onDoubleClick:()=>c(n.id),children:[t.jsx("input",{id:n.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:k,ref:m=>{i.current[r]=m}}),t.jsx("img",{src:n.src=="/noPhoto.jpg"||((x=n.src)==null?void 0:x.toString().split(":")[0])=="blob"?n.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+n.src,width:r==0?150:50,height:r==0?150:50,alt:"",className:`${r==0?o.right_bottom_baseImg:o.right_bottom_img}`})]},n.id)})})})})}function Fn({addingImgToProduct:e,handleCancel:s}){return t.jsxs("div",{className:o.ikpuWrapper_buttons,children:[t.jsx(A,{to:"#",className:o.ikpuWrapper_save,onClick:a=>e(a),children:"Coхранить"}),t.jsx(A,{to:"#",className:o.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(A,{to:"#",onClick:a=>s(a),className:o.ikpuWrapper_cancel,children:"Отмена"})]})}const Y=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""}];function Ln(){const{searchResponseItem:e,stockImagesSrc:s,setStockImagesSrc:a,setSearchResponseItem:l,setStockIkpuStatus:i}=w(),[c,f]=u.useState([]);u.useEffect(()=>{if(e){const b=Y==null?void 0:Y.map(g=>{var k;let p;return g.title=="ИКПУ:"&&(p=e.mxik),g.title=="Штрих-код:"&&(p=e.barcode),g.title=="Группа:"&&(p=e.groupName),g.title=="Класс:"&&(p=e.className),g.title=="Позиция:"&&(p=e.positionName),g.title=="Субпозиция:"&&(p=e.subPositionName),g.title=="Наименование:"&&(p=(k=e.name)==null?void 0:k.ru),g.title=="Бренд:"&&(p=e.brand),g.title=="Описание:"&&(p=e.description),{id:g.id,title:g.title,value:p}});f([...b])}},[e]),u.useEffect(()=>{if(e.photos){const b=s.map((g,p)=>{var k,n;return{id:g.id,order:g.order,src:(k=e==null?void 0:e.photos)!=null&&k[p]?(n=e==null?void 0:e.photos)==null?void 0:n[p]:"/noPhoto.jpg"}});b&&a(b)}},[]);const d=b=>{b.preventDefault();const g=s==null?void 0:s.map(p=>p.src);e.photos=g,l(e),i(!1)};function _(b){b.preventDefault();const g=s.map(p=>({id:p.id,order:p.order,src:p.src}));a(g),i(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:o.ikpuWrapper,onClick:_,children:t.jsxs("div",{className:o.ikpuWrapper_ikpuModalBlock,onClick:b=>b.stopPropagation(),children:[t.jsxs("div",{className:o.ikpuWrapper_content,children:[t.jsx(Rn,{staticList:c}),t.jsx(Bn,{})]}),t.jsx(Fn,{addingImgToProduct:d,handleCancel:_})]})})})}function Wn({item:e}){const[s,a]=u.useState(e.oldPrice),{stockTemporaryData:l,setStockTemporaryData:i}=w(),c=f=>{const d=f.target.value;a(Number(d));const _=l.filter(g=>g.id==e.id)[0],b=l.findIndex(g=>g.id==e.id);_&&(_.oldPrice=Number(d),l.splice(b,1,_),i([...l]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:s,className:o.table_body_amount,min:0,onChange:c})})}function zn({item:e}){const[s,a]=u.useState(e.price),{stockTemporaryData:l,setStockTemporaryData:i}=w(),c=f=>{const d=f.target.value;a(Number(d));const _=l.filter(g=>g.id==e.id)[0],b=l.findIndex(g=>g.id==e.id);_.price&&(_.price=Number(d),l.splice(b,1,_),i([...l]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:s,className:o.table_body_amount,min:0,onChange:c})})}function Hn({item:e}){const[s,a]=u.useState(0),{stockTemporaryData:l,setStockTemporaryData:i}=w(),c=f=>{const d=f.target.valueAsNumber;a(d);const _=l.find(b=>b.id==e.id);if(_){const b=l.findIndex(p=>p.id==e.id),g=[...l];g.splice(b,1,_),i(g)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:s,min:0,className:o.table_body_amount,onChange:c})})}function qn({item:e,column:s}){const{stockTemporaryData:a,setSearchResponseItem:l,setStockIkpuStatus:i,setStockTemporaryData:c}=w(),f=_=>{l(_),i(!0)},d=()=>{a&&c(a.filter(_=>_.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:o.table_head_row,style:{gridTemplateColumns:`repeat(${s.length}, 200px)`},children:[s==null?void 0:s.map(_=>{var b;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:o.table_body_col,children:[(_==null?void 0:_.title)=="Количество"&&t.jsx(Hn,{item:e}),(_==null?void 0:_.title)=="Приходная цена"&&t.jsx(Wn,{item:e}),(_==null?void 0:_.title)=="Продажная цена"&&t.jsx(zn,{item:e}),(_==null?void 0:_.title)=="Наименование"&&t.jsx("span",{className:o.table_body_nameString,children:(b=e==null?void 0:e.name)==null?void 0:b.ru}),(_==null?void 0:_.title)=="Фото"?t.jsx("img",{src:"/noPhoto.jpg",width:40,height:40,alt:"",className:o.table_body_img}):"",(_==null?void 0:_.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(_==null?void 0:_.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(_==null?void 0:_.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>f(e),children:t.jsx(T,{name:"FolderOpenIcon",className:o.table_body_icon})}):"",(_==null?void 0:_.title)=="Штрих-код"&&(e!=null&&e.barcode)?e==null?void 0:e.barcode:""]},_==null?void 0:_.id)}),t.jsx("td",{className:o.table_body_del,onClick:d,children:t.jsx(T,{name:"TrashIcon",width:20,height:20})})]})}function Un({column:e}){const{stockTemporaryData:s}=w(),[a,l]=u.useState([]);return u.useEffect(()=>{l(s)},[s]),t.jsxs("table",{className:o.table,children:[t.jsx("thead",{className:o.table_head,children:t.jsx("tr",{className:o.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(i=>t.jsx("td",{className:o.table_head_col,children:i.title},i.id))})}),t.jsx("tbody",{className:o.table_body,children:a==null?void 0:a.map(i=>t.jsx(qn,{item:i,column:e},i==null?void 0:i.id))})]})}function Gn({clearTable:e,setData:s}){return t.jsxs("div",{className:o.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${o.formWrapper_btn} ${o.formWrapper_btn_save}`,onClick:s,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${o.formWrapper_btn} ${o.formWrapper_btn_cancel}`,onClick:a=>e(a),children:"Отмена"})]})}function On(){const e=u.useRef(null),[s,a]=u.useState(!1),[l,i]=u.useState(0),[c,f]=u.useState(0),d=N=>{e.current&&(a(!0),i(N.pageX-e.current.offsetLeft),f(e.current.scrollLeft))},_=()=>{a(!1)},b=()=>{a(!1)},g=N=>{if(!s||!e.current)return;N.preventDefault();const B=(N.pageX-e.current.offsetLeft-l)*2;e.current.scrollLeft=c-B},{settingsParams:p,stockIkpuStatus:k,stockTemporaryData:n,openModalCategory:r,setStockTemporaryData:x,setCheckedProducts:m}=w(),[y,j]=u.useState([]);u.useEffect(()=>{const N=p.filter(S=>S.checked&&S.title!="Подкатегория");j(()=>[...N])},[p]);const M=N=>{N.preventDefault(),n.forEach(S=>{I(S)})};async function I(N){var S;try{const B={nameRu:(S=N.name)==null?void 0:S.ru,oldPrice:N.oldPrice,price:N.price};await X.patch(`nomenclatures/${N.id}`,B),x([]),m([])}catch(B){console.log(`Ошибка произошла при попытке добавить ${N==null?void 0:N.crmNameProduct} на сервер`,B)}}const h=N=>{N.preventDefault(),x([]),m([])};return t.jsxs("div",{className:o.formWrapper,children:[r&&t.jsx(ut,{}),t.jsxs("div",{className:o.found,ref:e,onMouseDown:d,onMouseLeave:_,onMouseUp:b,onMouseMove:g,children:[k&&t.jsx(Ln,{}),t.jsx(Un,{column:y})]}),t.jsx(Gn,{clearTable:h,setData:M})]})}async function lt(e,s,a,l,i){try{if(e==="По тексту"){console.log("fetchStockProducts page",l,"perPage",i);const c=await X.get(`nomenclatures?multiStoreId=${s}&name=${a}&page=${l}&perPage=${i}`);console.log("fetchStockProducts res",c);const f=await c.data.data,d=await c.data.pagination.total,_=await c.data.pagination.total_pages;return{data:f,totalElements:d,totalPages:_}}}catch(c){console.log("Ошибка при получении продуктов со склада",c)}}function Zn(){const s=Q().pathname,{stockPickedSearch:a,setStockPickedSearch:l,stockSearchParams:i,stockSearchText:c,setStockSearchText:f,setStockSearchResponse:d,stockTemporaryData:_,setTotalElementsStore:b,setTotalPagesStore:g,stockPage:p,perPage:k,setStockPage:n}=w(),[r,x]=u.useState("");u.useEffect(()=>{x(""),f("")},[s]),u.useEffect(()=>{(a=="По штрих-коду"||a=="По ИКПУ")&&(c.toString(),c.length<13&&l("По ТН ВЭД"),c.length==13&&l("По штрих-коду"),c.length>13&&l("По ИКПУ")),c.length>0&&x("")},[c]),u.useEffect(()=>{const j=document.querySelector(`input[name="search"][value="${a}"]`);j&&(j.checked=!0)},[a]);const m=j=>{l(j.currentTarget.value)},y=async j=>{j.preventDefault(),d([]),n(1);const M=V.get("access_token"),I=V.get("multi-store");if((!M||!I)&&await st(),c.length>0&&I){const{data:h,totalElements:N,totalPages:S}=await lt(a,I,c,p,k);console.log("totalElements",N,"totalPages",S),h.length==0&&x("ничего не найдено"),N&&S&&(b(N),g(S));const B=h.filter(L=>!_.some(O=>O.id===L.id));d(B)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:o.navStock,children:[t.jsxs("ul",{className:o.navStock_buttons,children:[t.jsx("li",{children:t.jsxs(A,{className:`${o.back} ${o.navStock_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(T,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(A,{to:"/addingProducts/settingsAddProducts",className:`${o.navStock_linkBtn} ${o.navStock_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(T,{name:"Cog8ToothIcon",className:o.navStock_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:o.stockForm,onSubmit:j=>y(j),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:c,type:a=="По штрих-коду"||a=="По ИКПУ"?"number":"text",className:o.stockForm_input,placeholder:a,onChange:j=>f(j.currentTarget.value)}),t.jsx("button",{type:"submit",className:o.stockForm_btn,children:"Поиск"})]}),t.jsx("ul",{className:o.stockForm_list,children:i==null?void 0:i.map(j=>t.jsx("li",{children:t.jsxs("label",{className:o.stockForm_check,children:[t.jsx("input",{type:"radio",name:"search",value:j.title,onClick:M=>m(M)}),t.jsx("span",{className:o.stockForm_check_text,children:j.title})]})},j.id))})]}),t.jsx("span",{className:o.navStock_error,children:r})]})})}function Xn({addSelectedProducts:e,setCancel:s}){const{setAddBlockStatus:a}=_t(),l=()=>{s(),a(!1)};return t.jsxs("div",{className:o.foundProducts_buttons,children:[t.jsx(A,{to:"#",className:`${o.foundProducts_btn} ${o.foundProducts_btn_save}`,onClick:()=>e(),children:"Сохранить"}),t.jsx("button",{className:`${o.foundProducts_btn} ${o.foundProducts_btn_cancel}`,onClick:l,children:"Отмена"})]})}function Vn(){const{stockSearchResponse:e,setStockSearchResponse:s,stockCheckedProducts:a,setStockCheckedProducts:l,stockTemporaryData:i,setStockTemporaryData:c,totalElementsStore:f,setTotalElementsStore:d,totalPagesStore:_,setTotalPagesStore:b,stockSearchText:g,setStockSearchText:p,stockPickedSearch:k,stockPage:n,setStockPage:r,setPerPage:x,perPage:m}=w(),[y,j]=u.useState([]),[M,I]=u.useState([]),[h,N]=u.useState(!1),S=u.useRef([]),B=u.useRef(null);u.useEffect(()=>{j([...e]),console.log("stockSearchResponse",e)},[e]);const L=()=>{a&&c([...a,...i]),s([]),l([]),C()},O=(v,E)=>{if(v){I([...M,E]);const F=y.filter(W=>W.id==E)[0];l([...a,F])}else if(!v&&B.current){const F=M.filter(z=>z!=E);I([...F]);const W=a.filter(z=>z.id!=E);l([...W]),N(!1),B.current.checked=!1}B.current&&v&&M.length+1==y.length&&(N(!0),B.current.checked=!0,l([...y]))},P=v=>{if(N(v),v){S.current.forEach(F=>{F&&(F.checked=v)});const E=y.map(F=>F.id);I([...E]),l([...y])}else I([]),S.current.forEach(E=>{E&&(E.checked=v)}),l([])},q=async v=>{v.preventDefault();const E=n+1;r(E);const F=V.get("multi-store");if(F){const{data:W}=await lt(k,F,g,E,m),z=W.filter(Z=>!i.some(H=>H.id===Z.id));console.log("filteredSearchResponse",z),console.log("stockSearchResponse",e),console.log("stockSearchText",g),B.current&&(N(!1),B.current.checked=!1,s([...z,...e]))}},C=()=>{s([]),l([]),d(0),b(0),p(""),r(1),x(5)};return t.jsx("section",{className:o.foundProducts,onClick:C,children:t.jsxs("div",{className:o.foundProducts_modal,onClick:v=>v.stopPropagation(),children:[t.jsxs("div",{className:o.foundProducts_top,children:[t.jsxs("h2",{className:o.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",f]}),t.jsxs("span",{children:["Текущее количество - ",y.length]}),t.jsxs("span",{children:["Выбрано элементов - ",M.length]})]}),n<_&&_!=1&&t.jsx("span",{className:o.foundProducts_more,onClick:v=>q(v),children:"добавить ещё..."}),y.length>1&&t.jsxs("label",{className:o.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:v=>P(v.target.checked),ref:B}),t.jsx("span",{children:h?"Отключить все":"Выбрать все"})]}),t.jsx(Xn,{addSelectedProducts:L,setCancel:C})]}),t.jsx("ul",{className:o.foundProducts_list,children:y==null?void 0:y.map((v,E)=>{var F;return t.jsxs("li",{className:o.foundProducts_item,children:[t.jsx("span",{className:o.foundProducts_item_photo,children:t.jsx("img",{src:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:o.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:v==null?void 0:v.barcode})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:v==null?void 0:v.mxik})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:v==null?void 0:v.brand})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:(F=v==null?void 0:v.name)==null?void 0:F.ru})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:v==null?void 0:v.attributeName})]})]}),t.jsxs("label",{className:`
                ${o.foundProducts_item_btn}
                ${h||M.includes(v.id)?o.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:W=>O(W.target.checked,v.id),ref:W=>{S.current[E]=W}}),"Выбрать"]})]},v==null?void 0:v.id)})})]})})}async function Qn(e){try{const s=await G.get(`https://tasnif.soliq.uz/api/cl-api/integration-mxik/get/history/${e}`);return console.log("res ",s),await s.data.data.packageNames}catch(s){console.log("",s)}}function Kn(){const{searchResponse:e,searchText:s,TemporaryData:a,pickedSearch:l,setSearchText:i,setTemporaryData:c,setCheckedProducts:f,setSearchResponse:d,totalElementsStore:_,setTotalElementsStore:b,setTotalPagesStore:g,page:p,setPage:k,perPage:n,lang:r,errorMessage:x,setErrorMessage:m}=w(),[y,j]=u.useState([]),[M,I]=u.useState([]),h=u.useRef(null);u.useEffect(()=>{const P=setTimeout(()=>{m("")},1e3);return()=>{clearTimeout(P)}},[x]),u.useEffect(()=>{j([...e]);const P=M.filter(q=>e.some(C=>C.id===q));I(P),j([...e])},[e]);const N=async P=>{if(await nt(P))if(a.some(v=>v.mxikCode===P.mxikCode))m("Этот продукт уже выбран"),L();else{const v=await Qn(P.mxikCode),E={...P,crmNameProduct:P.subPositionName,crmAmount:0,crmArrivalPrice:0,crmSellingPrice:0,packageNames:v??null,crmCheckbox:!1};c([E,...a]),L()}else m("Этот продукт уже есть на складе"),L()},S=async()=>{const P=p+1;k(P);const{data:q}=await tt(l,s,P,n,r),C=[];for(const v of q){const E=await et(v.mxikCode,r);C.push({...v,id:U(),photos:E})}d([...e,...C])},B=()=>{const P=h.current;P&&P.scrollHeight-P.scrollTop===P.clientHeight&&S()},L=()=>{d([]),f([]),b(0),g(0),i(""),k(0)},O=()=>{const P={attributeName:null,brandName:null,classCode:"",className:"",commonUnitCode:null,commonUnitName:null,crmAmount:0,crmArrivalPrice:0,crmNameProduct:"",crmSellingPrice:0,groupCode:"",groupName:"",id:U(),internationalCode:null,mxikCode:"",myProduct:0,packages:null,photos:["/noPhoto.jpg"],positionCode:"",positionName:"",subPositionName:"",unitCode:null,unitName:null,units:[],createdByHand:!0};c([P,...a]),L()};return t.jsx("section",{className:o.foundProducts,onClick:L,children:t.jsxs("div",{ref:h,className:o.foundProducts_modal,onScroll:B,onClick:P=>P.stopPropagation(),children:[t.jsxs("div",{className:o.foundProducts_top,children:[t.jsx("h2",{className:o.foundProducts_title,children:t.jsxs("span",{children:["Найдено совпадений - ",_]})}),t.jsxs("div",{className:o.foundProducts_top_buttons,children:[t.jsxs("button",{className:o.foundProducts_top_add,onClick:O,children:[t.jsx(T,{name:"PlusCircleIcon"}),"Добавить в ручную"]}),t.jsx("button",{className:o.foundProducts_top_close,onClick:L,children:t.jsx(T,{name:"XMarkIcon"})})]})]}),t.jsx("ul",{className:o.foundProducts_list,children:y==null?void 0:y.map(P=>{var q;return t.jsxs("li",{className:o.foundProducts_item,onClick:()=>N(P),children:[t.jsxs("h2",{className:o.foundProducts_item_mxik,children:[t.jsx("span",{className:o.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:P==null?void 0:P.mxikCode}),t.jsx("span",{className:o.foundProducts_item_desc,children:P==null?void 0:P.subPositionName})]}),t.jsxs("div",{className:o.foundProducts_item_content,children:[t.jsxs("ul",{className:o.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Группа:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(P==null?void 0:P.groupName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Класс:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(P==null?void 0:P.className)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Позиция:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(P==null?void 0:P.positionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Субпозиция:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(P==null?void 0:P.subPositionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Штрихкод:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(P==null?void 0:P.internationalCode)??"-"})]})]}),t.jsx("span",{className:o.foundProducts_item_photo,children:t.jsx("img",{src:(q=P==null?void 0:P.photos)!=null&&q[0]?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+P.photos[0]:"/noPhoto.jpg",width:50,height:50,alt:""})})]})]},P==null?void 0:P.id)})})]})})}function Jn(){const s=Q().pathname,[a,l]=u.useState(!1);return t.jsxs("div",{className:`${o.leftMenu} ${a?o.leftMenu_active:""}`,children:[t.jsx("button",{className:o.leftMenu_btn,onClick:()=>l(!a),children:t.jsx(T,{name:"Bars3Icon"})}),t.jsxs("ul",{className:o.leftMenu_list,children:[t.jsxs("li",{className:`${o.leftMenu_li} ${s=="/addingProducts"?o.leftMenu_li_active:""}`,children:[t.jsx(T,{name:"ShoppingCartIcon",className:`${o.leftMenu_li_icon} ${a?"":o.leftMenu_li_icon_active}`}),t.jsx(A,{to:"/addingProducts",className:`${o.leftMenu_link} ${a?o.leftMenu_link_active:""}`,children:"Добавить номенклатуру"}),t.jsx(T,{name:"ChevronRightIcon",className:`${o.leftMenu_linkArrow} ${a?o.leftMenu_linkArrow_active:""}`})]}),t.jsxs("li",{className:`${o.leftMenu_li} ${s!="/addingProducts"?o.leftMenu_li_active:""}`,children:[t.jsx(T,{name:"ShoppingCartIcon",className:`${o.leftMenu_li_icon} ${a?"":o.leftMenu_li_icon_active}`}),t.jsx(A,{to:"/addingProducts/stockProducts",className:`${o.leftMenu_link} ${a?o.leftMenu_link_active:""}`,children:"Создать номенклатуру"}),t.jsx(T,{name:"ChevronRightIcon",className:`${o.leftMenu_linkArrow} ${a?o.leftMenu_linkArrow_active:""}`})]})]})]})}function sa(){const s=Q().pathname,{stockSearchResponse:a,TemporaryData:l,stockTemporaryData:i,setTemporaryData:c,setCheckedProducts:f,searchResponse:d}=w();u.useEffect(()=>{_()},[]);const _=()=>{c([]),f([])};return t.jsxs("div",{className:o.addingProducts,children:[t.jsx(Jn,{}),s=="/addingProducts"&&t.jsxs("div",{className:o.container,children:[t.jsx(bs,{}),l.length>0&&d.length==0&&t.jsx(gn,{}),d.length>0&&t.jsx(Kn,{})]}),s=="/addingProducts/stockProducts"&&t.jsxs("div",{className:o.container,children:[t.jsx(Zn,{}),a.length>0&&t.jsx(Vn,{}),i.length>0&&t.jsx(On,{})]}),s.startsWith("/addingProducts/settingsAddProducts")&&t.jsx(Tn,{})]})}export{sa as default};
