import{w as C,v as H,q as U,r as k,j as t,y as O,L as W,D as et,x as Z,a as ot}from"./index-B3j9hlWv.js";import{a as I,M as st}from"./Modal-Ck0IkVZV.js";import{C as L}from"./CustomIcon-BU2ESBbe.js";import"./XMarkIcon-DbSrmpME.js";const at="_container_pqzlv_1",ct="_nav_pqzlv_8",rt="_nav_linkBtn_pqzlv_11",lt="_nav_settingsIcon_pqzlv_16",it="_nav_buttons_pqzlv_20",dt="_nav_buttons_link_pqzlv_25",_t="_nav_buttons_iconSetting_pqzlv_30",ut="_setting_pqzlv_1",pt="_nav_error_pqzlv_33",ft="_navStock_pqzlv_41",gt="_navStock_linkBtn_pqzlv_44",ht="_navStock_settingsIcon_pqzlv_49",mt="_navStock_buttons_pqzlv_53",bt="_navStock_buttons_link_pqzlv_58",xt="_navStock_buttons_iconSetting_pqzlv_63",kt="_navStock_error_pqzlv_66",vt="_form_pqzlv_74",jt="_form_input_pqzlv_85",Pt="_form_btn_pqzlv_90",yt="_form_list_pqzlv_121",Nt="_form_check_pqzlv_126",St="_form_check_text_pqzlv_132",wt="_stockForm_pqzlv_136",zt="_stockForm_input_pqzlv_147",qt="_stockForm_btn_pqzlv_153",$t="_stockForm_list_pqzlv_184",Mt="_stockForm_check_pqzlv_189",It="_stockForm_check_text_pqzlv_195",At="_formWrapper_pqzlv_199",Dt="_formWrapper_buttons_pqzlv_204",Tt="_formWrapper_btn_pqzlv_210",Et="_formWrapper_btn_cancel_pqzlv_222",Wt="_formWrapper_btn_save_pqzlv_225",Rt="_found_pqzlv_229",Lt="_table_pqzlv_253",Bt="_table_head_pqzlv_258",Ft="_table_head_row_pqzlv_261",Ct="_table_head_col_pqzlv_267",Ht="_table_body_row_pqzlv_270",Ut="_table_body_col_pqzlv_274",Ot="_table_body_img_pqzlv_283",Xt="_table_body_icon_pqzlv_286",Kt="_table_body_name_pqzlv_290",Qt="_table_body_nameString_pqzlv_323",Vt="_table_body_amount_pqzlv_330",Zt="_table_body_catalog_pqzlv_338",Gt="_table_body_catalog_top_pqzlv_348",Jt="_table_body_catalog_icon_pqzlv_367",Yt="_table_body_catalog_iconActive_pqzlv_370",te="_table_body_catalog_drop_pqzlv_373",ee="_table_body_catalog_dropActive_pqzlv_398",se="_table_body_catalog_search_pqzlv_403",ne="_table_body_catalog_item_pqzlv_417",oe="_table_body_catalog_text_pqzlv_425",ae="_table_body_del_pqzlv_431",ce="_ikpuWrapper_pqzlv_451",re="_ikpuWrapper_ikpuModalBlock_pqzlv_460",le="_ikpuWrapper_content_pqzlv_470",ie="_ikpuWrapper_buttons_pqzlv_475",de="_ikpuWrapper_save_pqzlv_481",_e="_ikpuWrapper_delete_pqzlv_491",ue="_ikpuWrapper_cancel_pqzlv_501",pe="_left_pqzlv_512",fe="_left_content_pqzlv_515",ge="_left_content_item_pqzlv_520",he="_right_pqzlv_530",me="_right_block_pqzlv_535",be="_right_bottom_pqzlv_541",xe="_right_bottom_item_pqzlv_548",ke="_right_bottom_item_img_pqzlv_558",ve="_right_bottom_BaseItem_pqzlv_563",je="_right_bottom_BaseItem_img_pqzlv_574",Pe="_foundProducts_pqzlv_579",ye="_foundProducts_modal_pqzlv_588",Ne="_foundProducts_top_pqzlv_612",Se="_foundProducts_title_pqzlv_626",we="_foundProducts_more_pqzlv_634",ze="_foundProducts_allActive_pqzlv_651",qe="_foundProducts_buttons_pqzlv_657",$e="_foundProducts_btn_pqzlv_663",Me="_foundProducts_btn_cancel_pqzlv_675",Ie="_foundProducts_btn_save_pqzlv_678",Ae="_foundProducts_list_pqzlv_681",De="_foundProducts_item_pqzlv_685",Te="_foundProducts_item_photo_pqzlv_692",Ee="_foundProducts_item_list_pqzlv_702",We="_foundProducts_item_title_pqzlv_714",Re="_foundProducts_item_desc_pqzlv_717",Le="_foundProducts_item_btn_pqzlv_721",Be="_foundProducts_item_btn_active_pqzlv_735",Fe="_errorModal_pqzlv_740",Ce="_errorModal_block_pqzlv_749",He="_addingProducts_pqzlv_767",Ue="_leftMenu_pqzlv_771",Oe="_leftMenu_list_pqzlv_784",Xe="_leftMenu_li_pqzlv_784",Ke="_leftMenu_li_icon_pqzlv_824",Qe="_leftMenu_li_icon_active_pqzlv_828",Ve="_leftMenu_li_active_pqzlv_832",Ze="_leftMenu_link_pqzlv_847",Ge="_leftMenu_link_active_pqzlv_862",Je="_leftMenu_linkArrow_pqzlv_866",Ye="_leftMenu_linkArrow_active_pqzlv_872",ts="_leftMenu_active_pqzlv_878",es="_miniInfo_content_pqzlv_890",ss="_miniInfo_imgBlock_pqzlv_898",ns="_miniInfo_list_pqzlv_908",s={container:at,nav:ct,nav_linkBtn:rt,nav_settingsIcon:lt,nav_buttons:it,nav_buttons_link:dt,nav_buttons_iconSetting:_t,setting:ut,nav_error:pt,navStock:ft,navStock_linkBtn:gt,navStock_settingsIcon:ht,navStock_buttons:mt,navStock_buttons_link:bt,navStock_buttons_iconSetting:xt,navStock_error:kt,form:vt,form_input:jt,form_btn:Pt,form_list:yt,form_check:Nt,form_check_text:St,stockForm:wt,stockForm_input:zt,stockForm_btn:qt,stockForm_list:$t,stockForm_check:Mt,stockForm_check_text:It,formWrapper:At,formWrapper_buttons:Dt,formWrapper_btn:Tt,formWrapper_btn_cancel:Et,formWrapper_btn_save:Wt,found:Rt,table:Lt,table_head:Bt,table_head_row:Ft,table_head_col:Ct,table_body_row:Ht,table_body_col:Ut,table_body_img:Ot,table_body_icon:Xt,table_body_name:Kt,table_body_nameString:Qt,table_body_amount:Vt,table_body_catalog:Zt,table_body_catalog_top:Gt,table_body_catalog_icon:Jt,table_body_catalog_iconActive:Yt,table_body_catalog_drop:te,table_body_catalog_dropActive:ee,table_body_catalog_search:se,table_body_catalog_item:ne,table_body_catalog_text:oe,table_body_del:ae,ikpuWrapper:ce,ikpuWrapper_ikpuModalBlock:re,ikpuWrapper_content:le,ikpuWrapper_buttons:ie,ikpuWrapper_save:de,ikpuWrapper_delete:_e,ikpuWrapper_cancel:ue,left:pe,left_content:fe,left_content_item:ge,right:he,right_block:me,right_bottom:be,right_bottom_item:xe,right_bottom_item_img:ke,right_bottom_BaseItem:ve,right_bottom_BaseItem_img:je,foundProducts:Pe,foundProducts_modal:ye,foundProducts_top:Ne,foundProducts_title:Se,foundProducts_more:we,foundProducts_allActive:ze,foundProducts_buttons:qe,foundProducts_btn:$e,foundProducts_btn_cancel:Me,foundProducts_btn_save:Ie,foundProducts_list:Ae,foundProducts_item:De,foundProducts_item_photo:Te,foundProducts_item_list:Ee,foundProducts_item_title:We,foundProducts_item_desc:Re,foundProducts_item_btn:Le,foundProducts_item_btn_active:Be,errorModal:Fe,errorModal_block:Ce,addingProducts:He,leftMenu:Ue,leftMenu_list:Oe,leftMenu_li:Xe,leftMenu_li_icon:Ke,leftMenu_li_icon_active:Qe,leftMenu_li_active:Ve,leftMenu_link:Ze,leftMenu_link_active:Ge,leftMenu_linkArrow:Je,leftMenu_linkArrow_active:Ye,leftMenu_active:ts,miniInfo_content:es,miniInfo_imgBlock:ss,miniInfo_list:ns};async function G(e,o,n,r,_){try{if(e==="По тексту"){const a=await C.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search-subposition?search_text=${o}&page=${n}&size=${r}&lang=${_}`);console.log("По тексту res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:c}}else if(e==="По штрих-коду"){const a=await C.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?gtin=${o}&size=${r}&page=${n}&lang=${_}`),f=await a.data.data.content,d=await a.data.data.totalElements,c=await a.data.data.totalPages;return console.log("По штрих-коду res",a),{data:f,totalElements:d,totalPages:c}}else if(e==="По ИКПУ"){const a=await C.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?mxikCode=${o}&size=${r}&page=${n}&lang=${_}`);console.log("По ИКПУ res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:c}}else if(e==="Расширинный по тексту"){const a=await C.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?text=${o}&size=${r}&page=${n}&lang=${_}`);console.log("Расширинный по тексту res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:c}}else if(e==="По номеру рег. удостовирения"){const a=await C.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/dv-cert-number?dvCertNumber=${o}&page=${n}&size=${r}&lang=${_}`);console.log("По номеру рег. удостовирения res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:c}}else if(e==="По ТН ВЭД"){const a=await C.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?tnvedCode=${o}&size=${r}&page=${n}&lang=${_}`);console.log("По ТН ВЭД res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:c}}else if(e==="По бренду"){const a=await C.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?brandName=${o}&size=${r}&page=${n}&lang=${_}`);console.log("По бренду res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:c}}else if(e==="По MHH"){const a=await C.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/mnn-name?mnn_name=${o}&page=${n}&size=${r}&lang=${_}`);console.log("По MHH res",a);const f=await a.data.data,d=await a.data.recordTotal,c=await d/r;return{data:f,totalElements:d,totalPages:c}}}catch(a){console.log(a)}}async function J(e){var n;const o=H.get("multi-store");try{return(await U.post("nomenclatures/is-unique-name",{multiStoreId:Number(o),nameRu:(n=e.subPositionName)==null?void 0:n.toString()})).data.success}catch(r){return console.log("Ошибка произошла при проверки наличия продукта на складе по наименованию",r),!1}}async function Y(e,o){try{return(await C.get(`https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/mxik/picture-names?lang=${o}&mxik_code=${e}`)).data}catch(n){console.log("Ошибка при получении картинок к продукту",n)}}function os(){var r,_;const{checkedProductsByCode:e}=I(),[o,n]=k.useState([]);return k.useEffect(()=>{n([...e])},[e]),console.log("localProduct",o),t.jsx("div",{className:s.miniInfo,children:o.length>0&&t.jsxs("div",{className:s.miniInfo_content,children:[t.jsx("div",{className:s.miniInfo_imgBlock,children:t.jsx("img",{src:o&&o[0].photos&&((r=o[0].photos)==null?void 0:r.length)>0?(_=o[0].photos)==null?void 0:_[0]:"/noPhoto.jpg",alt:""})}),t.jsxs("ul",{className:s.miniInfo_list,children:[t.jsxs("li",{children:[t.jsx("span",{children:"Штрихкод:"}),t.jsx("span",{children:o&&o[0].internationalCode||"-"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"ИКПУ:"}),t.jsx("span",{children:o&&o[0].mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Бренд:"}),t.jsx("span",{children:o&&o[0].brandName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Наименование:"}),t.jsx("span",{children:o&&o[0].subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Ед. Изм:"}),t.jsx("span",{children:o&&o[0].attributeName})]})]})]})})}function as(){const o=O().pathname,{pickedSearch:n,setPickedSearch:r,searchText:_,setSearchText:a,searchParams:f,TemporaryData:d,setTemporaryData:c,setSearchResponse:g,setTotalElementsStore:u,setTotalPagesStore:h,setCheckedProductsByCode:b,checkedProductsByCode:i,page:p,perPage:w,lang:x}=I(),[v,P]=k.useState(""),[z,M]=k.useState([]);k.useEffect(()=>{M([...i])},[i]),k.useEffect(()=>{P(""),a("")},[o]),k.useEffect(()=>{(n=="По штрих-коду"||n=="По ИКПУ"||n=="По ТН ВЭД")&&(_.toString(),_.length<13&&r("По ТН ВЭД"),_.length==13&&r("По штрих-коду"),_.length>13&&r("По ИКПУ"))},[_]),k.useEffect(()=>{const y=document.querySelector(`input[name="search"][value="${n}"]`);y&&(y.checked=!0)},[n]);const $=y=>{r(y.currentTarget.value)},A=async y=>{if(y.preventDefault(),H.get("access_token")||await et(),_.length>0&&n!="По штрих-коду"&&n!="По ИКПУ"){console.log("1 СЦЕНАРИЙ по тексту");const{data:D,totalElements:F,totalPages:R}=await G(n,_,p,w,x);D.length==0&&P("ничего не найдено"),F&&R&&(u(F),h(R));const l=[];for(const j of D){const q=await J(j),E=await Y(j.mxikCode,x);q&&l.push({...j,id:Z(),photos:E})}D.length==0?P("Ничего не найдено"):D.length>1&&l.length==0?P("Все найденые совпадения уже есть на складе"):D.length==1&&l.length==0?P("Этот продукт уже есть на складе"):D.length>0&&l.length>0&&l.filter(j=>d.some(q=>q.mxikCode===j.mxikCode))[0]&&P("Вы уже ввбрали это продукт");const N=l.filter(j=>!d.some(q=>q.mxikCode===j.mxikCode));g(N)}if(_.length>0&&n=="По штрих-коду"||n=="По ИКПУ"){console.log("2 СЦЕНАРИЙ по коду");const{data:D,totalElements:F,totalPages:R}=await G(n,_,p,w,x);D.length==0&&P("ничего не найдено"),F&&R&&(u(F),h(R));const l=[];for(const j of D){const q=await J(j),E=await Y(j.mxikCode,x);q&&l.push({...j,id:Z(),photos:E})}if(D.length==0)P("Ничего не найдено");else if(D.length>1&&l.length==0)P("Все найденые совпадения уже есть на складе");else if(D.length==1&&l.length==0){P("Этот продукт уже есть на складе");return}else if(D.length>0&&l.length>0&&l.filter(j=>d.some(q=>q.mxikCode===j.mxikCode))[0]){P("Вы уже ввбрали это продукт");return}const N=l.filter(j=>!d.some(q=>q.mxikCode===j.mxikCode));b([...N]),c([...d,...N]),a("")}},m=y=>{console.log("value",y),/^[a-zA-Z]+$/.test(y)?(console.log("тексе"),n!="Расширинный по тексту"&&n!="По бренду"&&n!="По номеру рег. удостовирения"&&n!="По MHH"&&(r("По тексту"),P(""))):/^\d+$/.test(y)?(console.log("число"),y.length<=4?(r("По ТН ВЭД"),P(""),console.log("По ТН ВЭД")):y.length>4&&y.length<=13?(console.log("По штрих-коду"),P(""),r("По штрих-коду")):y.length>13&&y.length<=17?(r("По ИКПУ"),P(""),console.log("По ИКПУ")):y.length>17?(console.log("value",y),console.log("код ИКПУ не валидный"),P("код ИКПУ не валидный")):P("Введен невалидный символ")):n!="Расширинный по тексту"&&n!="По бренду"&&n!="По номеру рег. удостовирения"&&n!="По MHH"&&r("По тексту"),a(y)},S=y=>{y.key==="Backspace"&&(P(""),console.log("Backspace was pressed"))};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.nav,children:[t.jsxs("ul",{className:s.nav_buttons,children:[t.jsx("li",{children:t.jsxs(W,{className:`${s.back} ${s.nav_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(L,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(W,{to:"/addingProducts/settingsAddProducts",className:`${s.nav_linkBtn} ${s.nav_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(L,{name:"Cog8ToothIcon",className:s.nav_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:s.form,onSubmit:y=>A(y),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:_,type:"text",className:s.form_input,placeholder:n,onKeyDown:S,onChange:y=>m(y.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.form_btn,children:"Поиск"})]}),z.length>0&&d.length>0&&t.jsx(os,{}),t.jsx("ul",{className:s.form_list,children:f==null?void 0:f.map(y=>t.jsx("li",{children:t.jsxs("label",{className:s.form_check,children:[t.jsx("input",{type:"radio",name:"search",value:y.title,onClick:B=>$(B)}),t.jsx("span",{className:s.form_check_text,children:y.title})]})},y.id))})]}),t.jsx("span",{className:s.nav_error,children:v})]})})}function cs({setCancel:e,addSelectedProducts:o}){return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(W,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>o(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:e,children:"Отмена"})]})}function rs(){const{searchResponse:e,checkedProducts:o,searchText:n,TemporaryData:r,pickedSearch:_,setSearchText:a,setTemporaryData:f,setCheckedProducts:d,setSearchResponse:c,totalElementsStore:g,setTotalElementsStore:u,totalPagesStore:h,setTotalPagesStore:b,page:i,setPage:p,perPage:w,lang:x}=I(),[v,P]=k.useState([]),[z,M]=k.useState([]),[$,A]=k.useState(!1),m=k.useRef([]),S=k.useRef(null);k.useEffect(()=>{P([...e]);const l=z.filter(N=>e.some(j=>j.id===N));M(l),P([...e])},[e]);const y=(l,N)=>{if(l){M([...z,N]);const j=v.filter(q=>q.id==N)[0];console.log("выбран newProduct",j,"checkedProducts",o,"allRef.current",S.current),d([...o,j])}else if(!l){const j=z.filter(E=>E!=N);M([...j]);const q=o.filter(E=>E.id!=N);console.log("не выбран newProducts",q),d([...q]),S.current&&(A(!1),S.current.checked=!1)}S.current&&l&&z.length+1==v.length&&(A(!0),S.current.checked=!0,d([...v]))},B=l=>{if(A(l),l){m.current.forEach(j=>{j&&(j.checked=l)});const N=v.map(j=>j.id);M([...N]),d([...v])}else M([]),m.current.forEach(N=>{N&&(N.checked=l)}),d([])},D=()=>{if(o){const l=o.map(N=>({...N,crmNameProduct:N.subPositionName,crmAmount:0,crmArrivalPrice:0,crmSellingPrice:0}));console.log("addSelectedProducts myItem",l),f([...r,...l]),R()}},F=async l=>{l.preventDefault();const N=i+1;p(N);const{data:j}=await G(_,n,N,w,x),q=[];for(const E of j){const X=await J(E),K=await Y(E.mxikCode,x);X&&q.push({...E,id:Z(),photos:K})}S.current&&(A(!1),S.current.checked=!1,c([...q,...e]))},R=()=>{c([]),d([]),u(0),b(0),a(""),p(0)};return t.jsx("section",{className:s.foundProducts,onClick:R,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:l=>l.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",g]}),t.jsxs("span",{children:["Текущее количество - ",v.length]}),t.jsxs("span",{children:["Выбрано элементов - ",z.length]})]}),i+1<h&&h!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:l=>F(l),children:"добавить ещё..."}),v.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:l=>B(l.target.checked),ref:S}),t.jsx("span",{children:$?"Отключить все":"Выбрать все"})]}),t.jsx(cs,{addSelectedProducts:D,setCancel:R})]}),t.jsx("ul",{className:s.foundProducts_list,children:v==null?void 0:v.map((l,N)=>{var j;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:(j=l==null?void 0:l.photos)!=null&&j[0]?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+l.photos[0]:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:l==null?void 0:l.internationalCode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:l==null?void 0:l.mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:l==null?void 0:l.brandName})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:l==null?void 0:l.subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:l==null?void 0:l.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${$||z.includes(l.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:q=>y(q.target.checked,l.id),ref:q=>{m.current[N]=q}}),"Выбрать"]})]},l==null?void 0:l.id)})})]})})}function ls({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsx("div",{className:s.left_content,children:e.map(o=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:o.title}),t.jsx("p",{children:o.value})]},o.id))})})}function is(){const{imagesSrc:e,setImagesSrc:o}=I(),[n,r]=k.useState(null),_=k.useRef([]),a=i=>{_.current.forEach(p=>{p&&p.getAttribute("id")==i&&p.click()})};function f(i,p){r(p)}function d(i){i.target.style.background="white"}function c(i){i.target.style.background="white"}function g(i){i.preventDefault(),i.target.style.background="lightgray"}function u(i,p){i.preventDefault(),i.target.style.background="white";const w=e.map(x=>x.id===p.id?{...x,order:(n==null?void 0:n.order)||x.order}:x.id===(n==null?void 0:n.id)?{...x,order:p.order}:x);o(w),r(null)}function h(i,p){return i.order>p.order?1:-1}const b=i=>{var w,x;const p=(x=(w=i==null?void 0:i.target)==null?void 0:w.files)==null?void 0:x[0];if(p&&(p==null?void 0:p.type)==="image/jpeg"||(p==null?void 0:p.type)==="image/png"||(p==null?void 0:p.type)==="image/webp"){const v=i.target.getAttribute("id"),P=[...e],z=P.find($=>$.id==v),M=P.findIndex($=>$.id==v);if(z){const $=new FileReader;$.onload=A=>{var m;(m=A.target)!=null&&m.result&&(z.src=URL.createObjectURL(p),P.splice(M,1,z),o([...P]))},$.readAsDataURL(p)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(h).map((i,p)=>{var w;return t.jsxs("div",{draggable:!0,onDragStart:x=>f(x,i),onDragLeave:x=>d(x),onDragEnd:x=>c(x),onDragOver:x=>g(x),onDrop:x=>u(x,i),className:p==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>a(i.id),children:[t.jsx("input",{id:i.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:b,ref:x=>{_.current[p]=x}}),t.jsx("img",{src:i.src=="/noPhoto.jpg"||((w=i.src)==null?void 0:w.toString().split(":")[0])=="blob"?i.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+i.src,width:p==0?150:50,height:p==0?150:50,alt:"",className:`${p==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},i.id)})})})})}function ds({addingImgToProduct:e,handleCancel:o}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(W,{to:"#",className:s.ikpuWrapper_save,onClick:n=>e(n),children:"Coхранить"}),t.jsx(W,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(W,{to:"#",onClick:n=>o(n),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const Q=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:3,title:"Группа:",value:""},{id:4,title:"Класс:",value:""},{id:5,title:"Позиция:",value:""},{id:6,title:"Субпозиция:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""},{id:9,title:"Описание:",value:""}];function _s(){const{searchResponseItem:e,imagesSrc:o,setImagesSrc:n,setSearchResponseItem:r,setIkpuStatus:_}=I(),[a,f]=k.useState([]);k.useEffect(()=>{if(e){const g=Q==null?void 0:Q.map(u=>{let h;return u.title=="ИКПУ:"&&(h=e.mxikCode),u.title=="Штрих-код:"&&(h=e.internationalCode),u.title=="Группа:"&&(h=e.groupName),u.title=="Класс:"&&(h=e.className),u.title=="Позиция:"&&(h=e.positionName),u.title=="Субпозиция:"&&(h=e.subPositionName),u.title=="Наименование:"&&(h=e.className),u.title=="Бренд:"&&(h=e.brandName),u.title=="Описание:"&&(h=e.attributeName),{id:u.id,title:u.title,value:h}});f([...g])}},[e]),k.useEffect(()=>{if(e.photos){const g=o.map((u,h)=>{var b,i;return{id:u.id,order:u.order,src:(b=e==null?void 0:e.photos)!=null&&b[h]?(i=e==null?void 0:e.photos)==null?void 0:i[h]:"/noPhoto.jpg"}});g&&n(g)}},[]);const d=g=>{g.preventDefault();const u=o==null?void 0:o.map(h=>h.src);e.photos=u,r(e),_(!1)};function c(g){g.preventDefault();const u=o.map(h=>({id:h.id,order:h.order,src:h.src}));n(u),_(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:c,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(ls,{staticList:a}),t.jsx(is,{})]}),t.jsx(ds,{addingImgToProduct:d,handleCancel:c})]})})})}function us({item:e}){const[o,n]=k.useState(0),{TemporaryData:r,setTemporaryData:_}=I(),a=f=>{const d=f.target.valueAsNumber;n(d);const c=r.find(g=>g.id==e.id);if(c){const g=r.findIndex(h=>h.id==e.id),u=[...r];u.splice(g,1,c),_(u)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:o,className:s.table_body_amount,min:0,onChange:a})})}function ps({item:e}){const[o,n]=k.useState(0),{TemporaryData:r,setTemporaryData:_}=I(),a=f=>{const d=f.target.valueAsNumber;n(d);const c=r.find(g=>g.id==e.id);if(c){c.crmSellingPrice=d;const g=r.findIndex(h=>h.id==e.id),u=[...r];u.splice(g,1,c),_(u)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:o,className:s.table_body_amount,min:0,onChange:a})})}function fs({item:e}){const[o,n]=k.useState(0),{TemporaryData:r,setTemporaryData:_}=I(),a=f=>{const d=f.target.valueAsNumber;n(d);const c=r.find(g=>g.id==e.id);if(c){const g=r.findIndex(h=>h.id==e.id),u=[...r];u.splice(g,1,c),_(u)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:o,min:0,className:s.table_body_amount,onChange:a})})}function gs({item:e,column:o}){const{ikpuStatus:n,setSearchResponseItem:r,setIkpuStatus:_,setTemporaryData:a,TemporaryData:f,setOpenModalCategory:d,setCurrentProduct:c}=I(),g=b=>{r(b),_(!n)},u=()=>{f&&a(f.filter(b=>b.id!==e.id))},h=b=>{b.preventDefault(),d(!0),c(e)};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${o.length}, 200px)`},children:[o==null?void 0:o.map(b=>{var i,p,w,x,v,P,z,M;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(b==null?void 0:b.title)=="Количество"&&t.jsx(fs,{item:e}),(b==null?void 0:b.title)=="Приходная цена"&&t.jsx(us,{item:e}),(b==null?void 0:b.title)=="Продажная цена"&&t.jsx(ps,{item:e}),(b==null?void 0:b.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:e.subPositionName}),(b==null?void 0:b.title)=="Фото"?t.jsx("img",{src:((i=e.photos)==null?void 0:i[0])=="/noPhoto.jpg"?(p=e.photos)==null?void 0:p[0]:((w=e.photos)==null?void 0:w.length)==0?"/noPhoto.jpg":(v=(x=e.photos)==null?void 0:x[0])!=null&&v.startsWith("blob")?(P=e.photos)==null?void 0:P[0]:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+((z=e.photos)==null?void 0:z[0]),width:40,height:40,alt:"",className:s.table_body_img}):"",(b==null?void 0:b.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(b==null?void 0:b.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(b==null?void 0:b.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>g(e),children:t.jsx(L,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(b==null?void 0:b.title)=="Подкатегория"&&t.jsx(W,{to:"#",onClick:$=>h($),children:(M=e==null?void 0:e.crmCategory)!=null&&M.name.ru?e==null?void 0:e.crmCategory.name.ru:"Выбрать"}),(b==null?void 0:b.title)=="Штрих-код"&&(e==null?void 0:e.internationalCode)]},b==null?void 0:b.id)}),t.jsx("td",{className:s.table_body_del,onClick:u,children:t.jsx(L,{name:"TrashIcon",width:20,height:20})})]})}function hs({column:e}){const{TemporaryData:o}=I();return t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(n=>t.jsx("td",{className:s.table_head_col,children:n.title},n.id))})}),t.jsx("tbody",{className:s.table_body,children:o==null?void 0:o.map(n=>t.jsx(gs,{item:n,column:e},n==null?void 0:n.id))})]})}function ms({clearTable:e,setData:o}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:o,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:n=>e(n),children:"Отмена"})]})}function bs(){const e=k.useRef(null),[o,n]=k.useState(!1),[r,_]=k.useState(0),[a,f]=k.useState(0),d=m=>{e.current&&(n(!0),_(m.pageX-e.current.offsetLeft),f(e.current.scrollLeft))},c=()=>{n(!1)},g=()=>{n(!1)},u=m=>{if(!o||!e.current)return;m.preventDefault();const y=(m.pageX-e.current.offsetLeft-r)*2;e.current.scrollLeft=a-y},{settingsParams:h,ikpuStatus:b,TemporaryData:i,openModalCategory:p,setTemporaryData:w,setCheckedProducts:x,nameProduct:v}=I(),[P,z]=k.useState([]);k.useEffect(()=>{const m=h.filter(S=>S.checked);z(()=>[...m])},[h]);const M=async m=>{m.preventDefault();for(const S of i)await $(S)};async function $(m){var S,y,B;try{const D=H.get("multi-store"),F={multiStoreId:Number(D),categoryId:Number((S=m==null?void 0:m.crmCategory)==null?void 0:S.id),barcode:Number(m==null?void 0:m.internationalCode),nameUz:"string",nameUzc:"string",nameRu:v||((y=m==null?void 0:m.crmNameProduct)==null?void 0:y.toString()),mxik:(B=m==null?void 0:m.mxikCode)==null?void 0:B.toString(),brand:m.brandName??null,oldPrice:Number(m==null?void 0:m.crmArrivalPrice),price:Number(m==null?void 0:m.crmSellingPrice),oldPriceCourse:0,priceCourse:0,nds:0,discount:0};await U.post("nomenclatures",F),w([]),x([])}catch(D){console.log(`Ошибка произошла при попытке добавить ${m==null?void 0:m.crmNameProduct} на сервер`,D)}}const A=m=>{m.preventDefault(),w([]),x([])};return t.jsxs("div",{className:s.formWrapper,children:[p&&t.jsx(st,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:d,onMouseLeave:c,onMouseUp:g,onMouseMove:u,children:[b&&t.jsx(_s,{}),t.jsx(hs,{column:P})]}),t.jsx(ms,{clearTable:A,setData:M})]})}function tt(){const{errorModal:e}=I();return t.jsx("div",{className:s.errorModal,children:t.jsx("div",{className:s.errorModal_block,children:t.jsx("p",{children:e==null?void 0:e.message})})})}const xs="_layout_1pbgc_1",ks="_layout_back_1pbgc_4",vs="_layout_title_1pbgc_14",js="_layout_list_1pbgc_19",Ps="_layout_link_1pbgc_25",ys="_layout_link_active_1pbgc_34",Ns="_form_list_1pbgc_38",Ss="_form_check_1pbgc_43",ws="_navSetting_1pbgc_49",zs="_found_1pbgc_53",qs="_table_1pbgc_74",$s="_table_head_1pbgc_78",Ms="_table_head_row_1pbgc_81",Is="_table_head_col_1pbgc_85",T={layout:xs,layout_back:ks,layout_title:vs,layout_list:js,layout_link:Ps,layout_link_active:ys,form_list:Ns,form_check:Ss,navSetting:ws,found:zs,table:qs,table_head:$s,table_head_row:Ms,table_head_col:Is};function As(){const e=k.useRef([]),{necessarilySettings:o,settingsParams:n,setSettingsParams:r}=I();k.useEffect(()=>{e.current.forEach((a,f)=>{a&&(a.checked=n[f].checked,o.forEach(d=>{a.value==d&&(a.checked=!0)}))})},[n]);const _=a=>{const f=n.map(d=>({id:d.id,title:d.title,checked:d.title==a.currentTarget.value?a.currentTarget.checked:d.checked}));r(f)};return t.jsx("nav",{className:T.navSetting,children:t.jsx("form",{action:"",className:T.form,children:t.jsx("ul",{className:T.form_list,children:n==null?void 0:n.map((a,f)=>t.jsx("li",{children:t.jsxs("label",{className:T.form_check,children:[t.jsx("input",{type:"checkbox",value:a.title,ref:d=>{e.current[f]=d},onChange:d=>_(d)}),t.jsx("span",{className:T.form_check_text,children:a.title})]})},a.id))})})})}function Ds(){const o=O().pathname,{settingsParams:n}=I(),[r,_]=k.useState([]);k.useEffect(()=>{const f=n.filter(d=>d.checked);_(()=>[...f])},[n]);const a=[{id:1,title:"отображения колонок",href:"/addingProducts/settingsAddProducts"}];return t.jsxs("div",{className:"container",children:[t.jsxs("nav",{className:T.layout,children:[t.jsx(W,{className:T.layout_back,to:"/addingProducts",children:"Закрыть"}),t.jsx("h2",{className:T.layout_title,children:"Настройки"}),t.jsx("ul",{className:T.layout_list,children:a.map(f=>t.jsx("li",{children:t.jsx(W,{to:f.href,className:`${T.layout_link} ${f.href==o?T.layout_link_active:""}`,children:f.title})},f.id))}),o=="/addingProducts/settingsAddProducts"&&t.jsx(As,{})]}),t.jsx("section",{className:T.found,children:t.jsxs("table",{className:T.table,children:[t.jsx("thead",{className:T.table_head,children:t.jsx("tr",{className:T.table_head_row,style:{gridTemplateColumns:`repeat(${r.length}, 200px)`},children:r==null?void 0:r.map(f=>t.jsx("td",{className:T.table_head_col,children:f.title},f.id))})}),t.jsx("tbody",{className:T.table_body,children:t.jsx("tr",{className:T.table_body_row,children:t.jsx("td",{className:T.table_body_col})})})]})})]})}function Ts({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsxs("div",{className:s.left_content,children:[e.map(o=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:o.title}),t.jsx("p",{children:o.value})]},o.id)),t.jsx("span",{style:{fontSize:"14px"},children:"(нужны картинки с сервера при get, post, patch запрсе по name)"})]})})}function Es(){const{stockImagesSrc:e,setStockImagesSrc:o}=I(),[n,r]=k.useState(null),_=k.useRef([]),a=i=>{_.current.forEach(p=>{p&&p.getAttribute("id")==i&&p.click()})};function f(i,p){r(p)}function d(i){i.target.style.background="white"}function c(i){i.target.style.background="white"}function g(i){i.preventDefault(),i.target.style.background="lightgray"}function u(i,p){i.preventDefault(),i.target.style.background="white";const w=e.map(x=>x.id===p.id?{...x,order:(n==null?void 0:n.order)||x.order}:x.id===(n==null?void 0:n.id)?{...x,order:p.order}:x);o(w),r(null)}function h(i,p){return i.order>p.order?1:-1}const b=i=>{var w,x;const p=(x=(w=i==null?void 0:i.target)==null?void 0:w.files)==null?void 0:x[0];if(p&&(p==null?void 0:p.type)==="image/jpeg"||(p==null?void 0:p.type)==="image/png"||(p==null?void 0:p.type)==="image/webp"){const v=i.target.getAttribute("id"),P=[...e],z=P.find($=>$.id==v),M=P.findIndex($=>$.id==v);if(z){const $=new FileReader;$.onload=A=>{var m;(m=A.target)!=null&&m.result&&(z.src=URL.createObjectURL(p),P.splice(M,1,z),o([...P]))},$.readAsDataURL(p)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(h).map((i,p)=>{var w;return t.jsxs("div",{draggable:!0,onDragStart:x=>f(x,i),onDragLeave:x=>d(x),onDragEnd:x=>c(x),onDragOver:x=>g(x),onDrop:x=>u(x,i),className:p==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>a(i.id),children:[t.jsx("input",{id:i.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:b,ref:x=>{_.current[p]=x}}),t.jsx("img",{src:i.src=="/noPhoto.jpg"||((w=i.src)==null?void 0:w.toString().split(":")[0])=="blob"?i.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+i.src,width:p==0?150:50,height:p==0?150:50,alt:"",className:`${p==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},i.id)})})})})}function Ws({addingImgToProduct:e,handleCancel:o}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(W,{to:"#",className:s.ikpuWrapper_save,onClick:n=>e(n),children:"Coхранить"}),t.jsx(W,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(W,{to:"#",onClick:n=>o(n),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const V=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""}];function Rs(){const{searchResponseItem:e,stockImagesSrc:o,setStockImagesSrc:n,setSearchResponseItem:r,setStockIkpuStatus:_}=I(),[a,f]=k.useState([]);k.useEffect(()=>{if(e){const g=V==null?void 0:V.map(u=>{var b;let h;return u.title=="ИКПУ:"&&(h=e.mxik),u.title=="Штрих-код:"&&(h=e.barcode),u.title=="Группа:"&&(h=e.groupName),u.title=="Класс:"&&(h=e.className),u.title=="Позиция:"&&(h=e.positionName),u.title=="Субпозиция:"&&(h=e.subPositionName),u.title=="Наименование:"&&(h=(b=e.name)==null?void 0:b.ru),u.title=="Бренд:"&&(h=e.brand),u.title=="Описание:"&&(h=e.description),{id:u.id,title:u.title,value:h}});f([...g])}},[e]),k.useEffect(()=>{if(e.photos){const g=o.map((u,h)=>{var b,i;return{id:u.id,order:u.order,src:(b=e==null?void 0:e.photos)!=null&&b[h]?(i=e==null?void 0:e.photos)==null?void 0:i[h]:"/noPhoto.jpg"}});g&&n(g)}},[]);const d=g=>{g.preventDefault();const u=o==null?void 0:o.map(h=>h.src);e.photos=u,r(e),_(!1)};function c(g){g.preventDefault();const u=o.map(h=>({id:h.id,order:h.order,src:h.src}));n(u),_(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:c,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(Ts,{staticList:a}),t.jsx(Es,{})]}),t.jsx(Ws,{addingImgToProduct:d,handleCancel:c})]})})})}function Ls({item:e}){const[o,n]=k.useState(e.oldPrice),{stockTemporaryData:r,setStockTemporaryData:_}=I(),a=f=>{const d=f.target.value;n(Number(d));const c=r.filter(u=>u.id==e.id)[0],g=r.findIndex(u=>u.id==e.id);c&&(c.oldPrice=Number(d),r.splice(g,1,c),_([...r]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:o,className:s.table_body_amount,min:0,onChange:a})})}function Bs({item:e}){const[o,n]=k.useState(e.price),{stockTemporaryData:r,setStockTemporaryData:_}=I(),a=f=>{const d=f.target.value;n(Number(d));const c=r.filter(u=>u.id==e.id)[0],g=r.findIndex(u=>u.id==e.id);c.price&&(c.price=Number(d),r.splice(g,1,c),_([...r]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:o,className:s.table_body_amount,min:0,onChange:a})})}function Fs({item:e}){const[o,n]=k.useState(0),{stockTemporaryData:r,setStockTemporaryData:_}=I(),a=f=>{const d=f.target.valueAsNumber;n(d);const c=r.find(g=>g.id==e.id);if(c){const g=r.findIndex(h=>h.id==e.id),u=[...r];u.splice(g,1,c),_(u)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:o,min:0,className:s.table_body_amount,onChange:a})})}function Cs({item:e,column:o}){const{stockTemporaryData:n,setSearchResponseItem:r,setStockIkpuStatus:_,setStockTemporaryData:a}=I(),f=c=>{r(c),_(!0)},d=()=>{n&&a(n.filter(c=>c.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${o.length}, 200px)`},children:[o==null?void 0:o.map(c=>{var g;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(c==null?void 0:c.title)=="Количество"&&t.jsx(Fs,{item:e}),(c==null?void 0:c.title)=="Приходная цена"&&t.jsx(Ls,{item:e}),(c==null?void 0:c.title)=="Продажная цена"&&t.jsx(Bs,{item:e}),(c==null?void 0:c.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:(g=e==null?void 0:e.name)==null?void 0:g.ru}),(c==null?void 0:c.title)=="Фото"?t.jsx("img",{src:"/noPhoto.jpg",width:40,height:40,alt:"",className:s.table_body_img}):"",(c==null?void 0:c.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(c==null?void 0:c.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(c==null?void 0:c.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>f(e),children:t.jsx(L,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(c==null?void 0:c.title)=="Штрих-код"&&(e!=null&&e.barcode)?e==null?void 0:e.barcode:""]},c==null?void 0:c.id)}),t.jsx("td",{className:s.table_body_del,onClick:d,children:t.jsx(L,{name:"TrashIcon",width:20,height:20})})]})}function Hs({column:e}){const{stockTemporaryData:o}=I(),[n,r]=k.useState([]);return k.useEffect(()=>{r(o)},[o]),t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(_=>t.jsx("td",{className:s.table_head_col,children:_.title},_.id))})}),t.jsx("tbody",{className:s.table_body,children:n==null?void 0:n.map(_=>t.jsx(Cs,{item:_,column:e},_==null?void 0:_.id))})]})}function Us({clearTable:e,setData:o}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:o,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:n=>e(n),children:"Отмена"})]})}function Os(){const e=k.useRef(null),[o,n]=k.useState(!1),[r,_]=k.useState(0),[a,f]=k.useState(0),d=m=>{e.current&&(n(!0),_(m.pageX-e.current.offsetLeft),f(e.current.scrollLeft))},c=()=>{n(!1)},g=()=>{n(!1)},u=m=>{if(!o||!e.current)return;m.preventDefault();const y=(m.pageX-e.current.offsetLeft-r)*2;e.current.scrollLeft=a-y},{settingsParams:h,stockIkpuStatus:b,stockTemporaryData:i,openModalCategory:p,setStockTemporaryData:w,setCheckedProducts:x,nameProduct:v}=I(),[P,z]=k.useState([]);k.useEffect(()=>{const m=h.filter(S=>S.checked&&S.title!="Подкатегория");z(()=>[...m])},[h]);const M=m=>{m.preventDefault(),i.forEach(S=>{$(S)})};async function $(m){var S;try{const y=H.get("multi-store"),B={nameRu:(S=m.name)==null?void 0:S.ru,oldPrice:m.oldPrice,price:m.price};await U.patch(`nomenclatures/${m.id}`,B),w([]),x([])}catch(y){console.log(`Ошибка произошла при попытке добавить ${m==null?void 0:m.crmNameProduct} на сервер`,y)}}const A=m=>{m.preventDefault(),w([]),x([])};return t.jsxs("div",{className:s.formWrapper,children:[p&&t.jsx(st,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:d,onMouseLeave:c,onMouseUp:g,onMouseMove:u,children:[b&&t.jsx(Rs,{}),t.jsx(Hs,{column:P})]}),t.jsx(Us,{clearTable:A,setData:M})]})}async function nt(e,o,n,r,_){try{if(e==="По тексту"){console.log("fetchStockProducts page",r,"perPage",_);const a=await U.get(`nomenclatures?multiStoreId=${o}&name=${n}&page=${r}&perPage=${_}`);console.log("fetchStockProducts res",a);const f=await a.data.data,d=await a.data.pagination.total,c=await a.data.pagination.total_pages;return{data:f,totalElements:d,totalPages:c}}}catch(a){console.log("Ошибка при получении продуктов со склада",a)}}function Xs(){const o=O().pathname,{stockPickedSearch:n,setStockPickedSearch:r,stockSearchParams:_,stockSearchText:a,setStockSearchText:f,setStockSearchResponse:d,stockTemporaryData:c,setTotalElementsStore:g,setTotalPagesStore:u,stockPage:h,perPage:b}=I(),[i,p]=k.useState("");k.useEffect(()=>{p(""),f("")},[o]),k.useEffect(()=>{(n=="По штрих-коду"||n=="По ИКПУ")&&(a.toString(),a.length<13&&r("По ТН ВЭД"),a.length==13&&r("По штрих-коду"),a.length>13&&r("По ИКПУ")),a.length>0&&p("")},[a]),k.useEffect(()=>{const v=document.querySelector(`input[name="search"][value="${n}"]`);v&&(v.checked=!0)},[n]);const w=v=>{r(v.currentTarget.value)},x=async v=>{v.preventDefault();const P=H.get("access_token"),z=H.get("multi-store");if((!P||!z)&&await et(),a.length>0&&z){const{data:M,totalElements:$,totalPages:A}=await nt(n,z,a,h,b);console.log("totalElements",$,"totalPages",A),M.length==0&&p("ничего не найдено"),$&&A&&(g($),u(A));const m=M.filter(S=>!c.some(y=>y.id===S.id));d(m)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.navStock,children:[t.jsxs("ul",{className:s.navStock_buttons,children:[t.jsx("li",{children:t.jsxs(W,{className:`${s.back} ${s.navStock_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(L,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(W,{to:"/addingProducts/settingsAddProducts",className:`${s.navStock_linkBtn} ${s.navStock_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(L,{name:"Cog8ToothIcon",className:s.navStock_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:s.stockForm,onSubmit:v=>x(v),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:a,type:n=="По штрих-коду"||n=="По ИКПУ"?"number":"text",className:s.stockForm_input,placeholder:n,onChange:v=>f(v.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.stockForm_btn,children:"Поиск"})]}),t.jsx("ul",{className:s.stockForm_list,children:_==null?void 0:_.map(v=>t.jsx("li",{children:t.jsxs("label",{className:s.stockForm_check,children:[t.jsx("input",{type:"radio",name:"search",value:v.title,onClick:P=>w(P)}),t.jsx("span",{className:s.stockForm_check_text,children:v.title})]})},v.id))})]}),t.jsx("span",{className:s.navStock_error,children:i})]})})}function Ks({addSelectedProducts:e,setCancel:o}){const{setAddBlockStatus:n}=ot(),r=()=>{o(),n(!1)};return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(W,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>e(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:r,children:"Отмена"})]})}function Qs(){const{stockSearchResponse:e,setStockSearchResponse:o,stockCheckedProducts:n,setStockCheckedProducts:r,stockTemporaryData:_,setStockTemporaryData:a,totalElementsStore:f,setTotalElementsStore:d,totalPagesStore:c,setTotalPagesStore:g,stockSearchText:u,setStockSearchText:h,stockPickedSearch:b,stockPage:i,setStockPage:p,setPerPage:w,perPage:x}=I(),[v,P]=k.useState([]),[z,M]=k.useState([]),[$,A]=k.useState(!1),m=k.useRef([]),S=k.useRef(null);k.useEffect(()=>{P([...e]),console.log("stockSearchResponse",e)},[e]);const y=()=>{n&&a([...n,..._]),o([]),r([]),R()},B=(l,N)=>{if(l){M([...z,N]);const j=v.filter(q=>q.id==N)[0];r([...n,j])}else if(!l&&S.current){const j=z.filter(E=>E!=N);M([...j]);const q=n.filter(E=>E.id!=N);r([...q]),A(!1),S.current.checked=!1}S.current&&l&&z.length+1==v.length&&(A(!0),S.current.checked=!0,r([...v]))},D=l=>{if(A(l),l){m.current.forEach(j=>{j&&(j.checked=l)});const N=v.map(j=>j.id);M([...N]),r([...v])}else M([]),m.current.forEach(N=>{N&&(N.checked=l)}),r([])},F=async l=>{l.preventDefault();const N=i+1;p(N);const j=H.get("multi-store");if(j){const{data:q}=await nt(b,j,u,N,x),E=q.filter(X=>!_.some(K=>K.id===X.id));console.log("filteredSearchResponse",E),console.log("stockSearchResponse",e),console.log("stockSearchText",u),S.current&&(A(!1),S.current.checked=!1,o([...E,...e]))}},R=()=>{o([]),r([]),d(0),g(0),h(""),p(1),w(5)};return t.jsx("section",{className:s.foundProducts,onClick:R,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:l=>l.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",f]}),t.jsxs("span",{children:["Текущее количество - ",v.length]}),t.jsxs("span",{children:["Выбрано элементов - ",z.length]})]}),i<c&&c!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:l=>F(l),children:"добавить ещё..."}),v.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:l=>D(l.target.checked),ref:S}),t.jsx("span",{children:$?"Отключить все":"Выбрать все"})]}),t.jsx(Ks,{addSelectedProducts:y,setCancel:R})]}),t.jsx("ul",{className:s.foundProducts_list,children:v==null?void 0:v.map((l,N)=>{var j;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:l==null?void 0:l.barcode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:l==null?void 0:l.mxik})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:l==null?void 0:l.brand})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:(j=l==null?void 0:l.name)==null?void 0:j.ru})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:l==null?void 0:l.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${$||z.includes(l.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:q=>B(q.target.checked,l.id),ref:q=>{m.current[N]=q}}),"Выбрать"]})]},l==null?void 0:l.id)})})]})})}function Ys(){const o=O().pathname,{searchResponse:n,stockSearchResponse:r,errorModal:_,TemporaryData:a,stockTemporaryData:f,setTemporaryData:d,setCheckedProducts:c}=I(),[g,u]=k.useState(!1);k.useEffect(()=>{h()},[]);const h=()=>{d([]),c([])};return t.jsxs("div",{className:s.addingProducts,children:[t.jsxs("div",{className:`${s.leftMenu} ${g?s.leftMenu_active:""}`,children:[t.jsx("button",{className:s.leftMenu_btn,onClick:()=>u(!g),children:t.jsx(L,{name:"Bars3Icon"})}),t.jsxs("ul",{className:s.leftMenu_list,children:[t.jsxs("li",{className:`${s.leftMenu_li} ${o=="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(L,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${g?"":s.leftMenu_li_icon_active}`}),t.jsx(W,{to:"/addingProducts",className:`${s.leftMenu_link} ${g?s.leftMenu_link_active:""}`,children:"Добавить номенклатуру"}),t.jsx(L,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${g?s.leftMenu_linkArrow_active:""}`})]}),t.jsxs("li",{className:`${s.leftMenu_li} ${o!="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(L,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${g?"":s.leftMenu_li_icon_active}`}),t.jsx(W,{to:"/addingProducts/stockProducts",className:`${s.leftMenu_link} ${g?s.leftMenu_link_active:""}`,children:"Создать номенклатуру"}),t.jsx(L,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${g?s.leftMenu_linkArrow_active:""}`})]})]})]}),o=="/addingProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx(as,{}),t.jsxs(t.Fragment,{children:[n.length>0&&t.jsx(rs,{}),a.length>0&&t.jsx(bs,{}),_.status&&t.jsx(tt,{})]})]}),o=="/addingProducts/stockProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx(Xs,{}),r.length>0&&t.jsx(Qs,{}),f.length>0&&t.jsx(Os,{}),_.status&&t.jsx(tt,{})]}),o=="/addingProducts/settingsAddProducts"&&t.jsx(Ds,{})]})}export{Ys as default};
