import{w as H,b as X,c as Q,r as b,j as t,L as E,y as U,x as K,D as et,a as rt}from"./index-zVuRyqU_.js";import{a as z,M as st}from"./Modal-CpdEex2g.js";import{C as F}from"./CustomIcon-C3u0Wtew.js";import"./XMarkIcon-EmH-TKji.js";const it="_container_12jze_1",dt="_nav_12jze_8",_t="_nav_linkBtn_12jze_12",ut="_nav_settingsIcon_12jze_16",ft="_nav_buttons_12jze_20",mt="_nav_buttons_link_12jze_25",gt="_nav_buttons_iconSetting_12jze_30",pt="_setting_12jze_1",ht="_nav_error_12jze_33",bt="_nav_form_12jze_40",jt="_nav_form_left_12jze_46",xt="_nav_form_input_12jze_56",kt="_nav_form_btn_12jze_61",Pt="_nav_form_list_12jze_92",vt="_nav_form_check_12jze_97",Nt="_nav_form_check_text_12jze_103",yt="_navStock_12jze_107",St="_navStock_linkBtn_12jze_110",Mt="_navStock_settingsIcon_12jze_115",zt="_navStock_buttons_12jze_119",wt="_navStock_buttons_link_12jze_124",It="_navStock_buttons_iconSetting_12jze_129",$t="_navStock_error_12jze_132",Dt="_stockForm_12jze_140",At="_stockForm_input_12jze_151",Tt="_stockForm_btn_12jze_157",Rt="_stockForm_list_12jze_188",Et="_stockForm_check_12jze_193",Wt="_stockForm_check_text_12jze_199",Lt="_formWrapper_12jze_203",Bt="_formWrapper_buttons_12jze_209",Ft="_formWrapper_btn_12jze_215",Ct="_formWrapper_btn_cancel_12jze_227",qt="_formWrapper_btn_save_12jze_230",Ht="_found_12jze_234",Ot="_table_12jze_258",Ut="_table_head_12jze_263",Gt="_table_head_row_12jze_266",Xt="_table_head_col_12jze_272",Kt="_table_body_row_12jze_275",Qt="_table_body_col_12jze_279",Jt="_table_body_img_12jze_288",Vt="_table_body_icon_12jze_291",Zt="_table_body_name_12jze_295",Yt="_table_body_nameString_12jze_328",te="_table_body_amount_12jze_335",ee="_table_body_catalog_12jze_343",se="_table_body_catalog_top_12jze_353",oe="_table_body_catalog_icon_12jze_372",ne="_table_body_catalog_iconActive_12jze_375",ae="_table_body_catalog_drop_12jze_378",ce="_table_body_catalog_dropActive_12jze_403",le="_table_body_catalog_search_12jze_408",re="_table_body_catalog_item_12jze_422",ie="_table_body_catalog_text_12jze_430",de="_table_body_del_12jze_436",_e="_ikpuWrapper_12jze_456",ue="_ikpuWrapper_ikpuModalBlock_12jze_465",fe="_ikpuWrapper_content_12jze_475",me="_ikpuWrapper_buttons_12jze_480",ge="_ikpuWrapper_save_12jze_486",pe="_ikpuWrapper_delete_12jze_496",he="_ikpuWrapper_cancel_12jze_506",be="_left_12jze_517",je="_left_content_12jze_520",xe="_left_content_item_12jze_525",ke="_right_12jze_535",Pe="_right_block_12jze_540",ve="_right_bottom_12jze_546",Ne="_right_bottom_item_12jze_553",ye="_right_bottom_item_img_12jze_563",Se="_right_bottom_BaseItem_12jze_568",Me="_right_bottom_BaseItem_img_12jze_579",ze="_foundProducts_12jze_584",we="_foundProducts_modal_12jze_592",Ie="_foundProducts_top_12jze_617",$e="_foundProducts_item_12jze_631",De="_foundProducts_item_mxik_12jze_639",Ae="_foundProducts_item_content_12jze_664",Te="_foundProducts_item_photo_12jze_669",Re="_foundProducts_item_list_12jze_682",Ee="_foundProducts_item_list_box_12jze_688",We="_foundProducts_item_title_12jze_710",Le="_foundProducts_item_myIcon_12jze_714",Be="_foundProducts_item_desc_12jze_721",Fe="_foundProducts_item_btn_12jze_725",Ce="_foundProducts_item_btn_active_12jze_739",qe="_foundProducts_title_12jze_743",He="_foundProducts_more_12jze_751",Oe="_foundProducts_allActive_12jze_768",Ue="_foundProducts_buttons_12jze_774",Ge="_foundProducts_btn_12jze_780",Xe="_foundProducts_btn_cancel_12jze_792",Ke="_foundProducts_btn_save_12jze_795",Qe="_foundProducts_list_12jze_798",Je="_errorModal_12jze_803",Ve="_errorModal_block_12jze_812",Ze="_addingProducts_12jze_830",Ye="_leftMenu_12jze_834",ts="_leftMenu_list_12jze_847",es="_leftMenu_li_12jze_847",ss="_leftMenu_li_icon_12jze_887",os="_leftMenu_li_icon_active_12jze_891",ns="_leftMenu_li_active_12jze_895",as="_leftMenu_link_12jze_910",cs="_leftMenu_link_active_12jze_925",ls="_leftMenu_linkArrow_12jze_929",rs="_leftMenu_linkArrow_active_12jze_935",is="_leftMenu_active_12jze_941",ds="_miniInfo_content_12jze_953",_s="_miniInfo_imgBlock_12jze_961",us="_miniInfo_list_12jze_971",s={container:it,nav:dt,nav_linkBtn:_t,nav_settingsIcon:ut,nav_buttons:ft,nav_buttons_link:mt,nav_buttons_iconSetting:gt,setting:pt,nav_error:ht,nav_form:bt,nav_form_left:jt,nav_form_input:xt,nav_form_btn:kt,nav_form_list:Pt,nav_form_check:vt,nav_form_check_text:Nt,navStock:yt,navStock_linkBtn:St,navStock_settingsIcon:Mt,navStock_buttons:zt,navStock_buttons_link:wt,navStock_buttons_iconSetting:It,navStock_error:$t,stockForm:Dt,stockForm_input:At,stockForm_btn:Tt,stockForm_list:Rt,stockForm_check:Et,stockForm_check_text:Wt,formWrapper:Lt,formWrapper_buttons:Bt,formWrapper_btn:Ft,formWrapper_btn_cancel:Ct,formWrapper_btn_save:qt,found:Ht,table:Ot,table_head:Ut,table_head_row:Gt,table_head_col:Xt,table_body_row:Kt,table_body_col:Qt,table_body_img:Jt,table_body_icon:Vt,table_body_name:Zt,table_body_nameString:Yt,table_body_amount:te,table_body_catalog:ee,table_body_catalog_top:se,table_body_catalog_icon:oe,table_body_catalog_iconActive:ne,table_body_catalog_drop:ae,table_body_catalog_dropActive:ce,table_body_catalog_search:le,table_body_catalog_item:re,table_body_catalog_text:ie,table_body_del:de,ikpuWrapper:_e,ikpuWrapper_ikpuModalBlock:ue,ikpuWrapper_content:fe,ikpuWrapper_buttons:me,ikpuWrapper_save:ge,ikpuWrapper_delete:pe,ikpuWrapper_cancel:he,left:be,left_content:je,left_content_item:xe,right:ke,right_block:Pe,right_bottom:ve,right_bottom_item:Ne,right_bottom_item_img:ye,right_bottom_BaseItem:Se,right_bottom_BaseItem_img:Me,foundProducts:ze,foundProducts_modal:we,foundProducts_top:Ie,foundProducts_item:$e,foundProducts_item_mxik:De,foundProducts_item_content:Ae,foundProducts_item_photo:Te,foundProducts_item_list:Re,foundProducts_item_list_box:Ee,foundProducts_item_title:We,foundProducts_item_myIcon:Le,foundProducts_item_desc:Be,foundProducts_item_btn:Fe,foundProducts_item_btn_active:Ce,foundProducts_title:qe,foundProducts_more:He,foundProducts_allActive:Oe,foundProducts_buttons:Ue,foundProducts_btn:Ge,foundProducts_btn_cancel:Xe,foundProducts_btn_save:Ke,foundProducts_list:Qe,errorModal:Je,errorModal_block:Ve,addingProducts:Ze,leftMenu:Ye,leftMenu_list:ts,leftMenu_li:es,leftMenu_li_icon:ss,leftMenu_li_icon_active:os,leftMenu_li_active:ns,leftMenu_link:as,leftMenu_link_active:cs,leftMenu_linkArrow:ls,leftMenu_linkArrow_active:rs,leftMenu_active:is,miniInfo_content:ds,miniInfo_imgBlock:_s,miniInfo_list:us};async function Z(e,n,o,c,r){try{if(e==="По тексту"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search-subposition?search_text=${n}&page=${o}&size=${c}&lang=${r}`);console.log("По тексту res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,l=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:l}}else if(e==="По штрих-коду"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?gtin=${n}&size=${c}&page=${o}&lang=${r}`),f=await a.data.data.content,d=await a.data.data.totalElements,l=await a.data.data.totalPages;return console.log("По штрих-коду res",a),{data:f,totalElements:d,totalPages:l}}else if(e==="По ИКПУ"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?mxikCode=${n}&size=${c}&page=${o}&lang=${r}`);console.log("По ИКПУ res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,l=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:l}}else if(e==="Расширинный по тексту"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?text=${n}&size=${c}&page=${o}&lang=${r}`);console.log("Расширинный по тексту res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,l=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:l}}else if(e==="По номеру рег. удостовирения"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/dv-cert-number?dvCertNumber=${n}&page=${o}&size=${c}&lang=${r}`);console.log("По номеру рег. удостовирения res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,l=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:l}}else if(e==="По ТН ВЭД"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?tnvedCode=${n}&size=${c}&page=${o}&lang=${r}`);console.log("По ТН ВЭД res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,l=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:l}}else if(e==="По бренду"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?brandName=${n}&size=${c}&page=${o}&lang=${r}`);console.log("По бренду res",a);const f=await a.data.data.content,d=await a.data.data.totalElements,l=await a.data.data.totalPages;return{data:f,totalElements:d,totalPages:l}}else if(e==="По MHH"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/mnn-name?mnn_name=${n}&page=${o}&size=${c}&lang=${r}`);console.log("По MHH res",a);const f=await a.data.data,d=await a.data.recordTotal,l=await d/c;return{data:f,totalElements:d,totalPages:l}}}catch(a){console.log(a)}}async function ot(e){var o;const n=X.get("multi-store");try{return(await Q.post("nomenclatures/is-unique-name",{multiStoreId:Number(n),nameRu:(o=e.subPositionName)==null?void 0:o.toString()})).data.success}catch(c){return console.log("Ошибка произошла при проверки наличия продукта на складе по наименованию",c),!1}}async function Y(e,n){try{return(await H.get(`https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/mxik/picture-names?lang=${n}&mxik_code=${e}`)).data}catch(o){console.log("Ошибка при получении картинок к продукту",o)}}function fs(){var c,r;const{checkedProductsByCode:e}=z(),[n,o]=b.useState([]);return b.useEffect(()=>{o([...e])},[e]),console.log("localProduct",n),t.jsx("div",{className:s.miniInfo,children:n.length>0&&t.jsxs("div",{className:s.miniInfo_content,children:[t.jsx("div",{className:s.miniInfo_imgBlock,children:t.jsx("img",{src:(r=(c=n[0])==null?void 0:c.photos)!=null&&r.length?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+n[0].photos[0]:"/noPhoto.jpg",alt:""})}),t.jsxs("ul",{className:s.miniInfo_list,children:[t.jsxs("li",{children:[t.jsx("span",{children:"Штрихкод:"}),t.jsx("span",{children:n&&n[0].internationalCode||"-"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"ИКПУ:"}),t.jsx("span",{children:n&&n[0].mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Бренд:"}),t.jsx("span",{children:n&&n[0].brandName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Наименование:"}),t.jsx("span",{children:n&&n[0].subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Ед. Изм:"}),t.jsx("span",{children:n&&n[0].attributeName})]})]})]})})}const ms="_globalModal_15wz1_1",gs="_globalModal_back_15wz1_13",ps="_globalModal_container_15wz1_45",hs="_globalModal_left_15wz1_54",bs="_globalModal_left_top_15wz1_59",js="_globalModal_left_desc_15wz1_64",xs="_globalModal_left_bottom_15wz1_71",ks="_globalModal_left_bottom_link_15wz1_76",Ps="_globalModal_left_bottom_label_15wz1_94",vs="_globalModal_right_15wz1_109",Ns="_globalModal_right_top_15wz1_114",ys="_globalModal_right_top_desc_15wz1_119",Ss="_globalModal_right_bottom_15wz1_134",Ms="_globalModal_right_bottom_link_15wz1_139",zs="_globalModal_right_bottom_label_15wz1_157",ws="_globalModal_confirm_15wz1_172",Is="_globalModal_confirm_info_15wz1_184",$s="_globalModal_confirm_desc_15wz1_191",Ds="_globalModal_confirm_buttons_15wz1_207",As="_globalModal_confirm_btn_15wz1_216",A={globalModal:ms,globalModal_back:gs,globalModal_container:ps,globalModal_left:hs,globalModal_left_top:bs,globalModal_left_desc:js,globalModal_left_bottom:xs,globalModal_left_bottom_link:ks,globalModal_left_bottom_label:Ps,globalModal_right:vs,globalModal_right_top:Ns,globalModal_right_top_desc:ys,globalModal_right_bottom:Ss,globalModal_right_bottom_link:Ms,globalModal_right_bottom_label:zs,globalModal_confirm:ws,globalModal_confirm_info:Is,globalModal_confirm_desc:$s,globalModal_confirm_buttons:Ds,globalModal_confirm_btn:As};function nt({staticText:e,method:n,setModalOpen:o}){const{globalRemember:c,setGlobalRemember:r,programRemember:a,setProgramRemember:f}=z();console.log("staticText",e,"method",n);const d=l=>{n=="program"?(r(l===!0?!1:c),f(l)):n=="global"&&(f(l===!0?!1:a),r(l)),o(!1)};return t.jsx("div",{className:A.globalModal_confirm,children:t.jsxs("div",{className:A.globalModal_confirm_info,children:[e==null?void 0:e.map(l=>t.jsx("p",{className:A.globalModal_confirm_desc,children:l.title},l.id)),t.jsxs("div",{className:A.globalModal_confirm_buttons,children:[t.jsx("button",{className:A.globalModal_confirm_btn,onClick:()=>d(!1),children:"Отменить"}),t.jsx("button",{className:A.globalModal_confirm_btn,onClick:()=>d(!0),children:"Применить"})]})]})})}const Ts=[{id:U(),title:"Данная настройка позволяет автоматически производить поиск товара в ручном режиме в национальной базе товаров и услуг PУз"},{id:U(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function Rs(){const{programRemember:e,searchText:n,setGlobalModal:o,setErrorMessage:c}=z(),r=b.useRef(null),[a,f]=b.useState(!1);b.useEffect(()=>{console.log("globalRemember",e),r.current&&(console.log("checkboxRef.current",r.current.checked),r.current.checked=e)},[e,r]);const d=()=>{f(!0)},l=()=>{c(`по штрихкоду ${n} ничего не найдено, попробуйте найти по названию`),o(!1)};return t.jsxs("div",{className:A.globalModal_left,children:[a&&t.jsx(nt,{staticText:Ts,method:"program",setModalOpen:f}),t.jsxs("div",{className:A.globalModal_left_top,children:[t.jsx(F,{name:"MapPinIcon",width:35,height:35}),t.jsx("p",{className:A.globalModal_left_desc,children:"Данный товар не найден в национальной базе товаров и услуг."})]}),t.jsxs("div",{className:A.globalModal_left_bottom,children:[t.jsx(E,{to:"#",className:A.globalModal_left_bottom_link,onClick:l,children:"Искать в программе"}),t.jsxs("div",{className:A.globalModal_left_bottom_label,onClick:d,children:[t.jsx("input",{type:"checkbox",className:A.globalModal_left_bottom_checkbox,ref:r}),t.jsx("span",{children:"Запомнить это действие "})]})]})]})}async function at(e){try{console.log("getGlobalProduct barcode",e);const n=await H.get(`https://api.barcodelookup.com/v3/products?barcode=${e}&formatted=y&key=7yd26itc9ov4fdwfymvp888cyuepbl`);console.log("getGlobalProduct res",n)}catch(n){console.log("Ошибкра при поиске продукта в глобальной базе",n)}}const Es={method:"get",maxBodyLength:1/0,url:"https://api.barcodelookup.com/v3/products?barcode=6950376750044&formatted=y&key=7yd26itc9ov4fdwfymvp888cyuepbl",headers:{Host:"127.0.0.1:64443",Origin:"https://amocrm.mcrm.uz"}};H.request(Es).then(e=>{console.log(JSON.stringify(e.data))}).catch(e=>{console.log(e)});const Ws=[{id:U(),title:"Данная настройка позволяет автоматически производить поиск в глобальной базе, в случаи если в национальной базе товары не были найдены"},{id:U(),title:"Внимание! В случаи глобального поиска, ИКПУ не будет присвоен."},{id:U(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function Ls(){const{searchText:e,globalRemember:n,setGlobalModal:o}=z(),c=b.useRef(null),[r,a]=b.useState(!1);b.useEffect(()=>{console.log("globalRemember",n),c.current&&(console.log("checkboxRef.current",c.current.checked),c.current.checked=n)},[n,c]),b.useEffect(()=>{console.log("globalRemember",n),c.current&&(console.log("checkboxRef.current",c.current.checked),c.current.checked=n)},[n,c]);const f=async p=>{const _=await at(p);console.log("handleGlobalSearch data",_)},d=()=>{f(e),o(!1)},l=()=>{a(!0)};return t.jsxs("div",{className:A.globalModal_right,children:[r&&t.jsx(nt,{staticText:Ws,method:"global",setModalOpen:a}),t.jsxs("div",{className:A.globalModal_right_top,children:[t.jsx(F,{name:"GlobeAltIcon",width:35,height:35}),t.jsxs("p",{className:A.globalModal_right_top_desc,children:[t.jsx("span",{children:"Ипользовать глобальный поиск"}),t.jsx("span",{children:"(В этом случаи, товару не будет присвоен ИКПУ)"})]})]}),t.jsxs("div",{className:A.globalModal_right_bottom,children:[t.jsx(E,{to:"#",className:A.globalModal_right_bottom_link,onClick:d,children:"Искать глобально"}),t.jsxs("div",{className:A.globalModal_right_bottom_label,onClick:l,children:[t.jsx("input",{type:"checkbox",ref:c,className:A.globalModal_right_bottom_checkbox}),t.jsx("span",{children:"Запомнить это действие"})]})]})]})}function Bs(){const{setGlobalModal:e,setSearchText:n}=z(),o=()=>{n(""),e(!1)};return t.jsxs("div",{className:A.globalModal,children:[t.jsxs(E,{to:"#",className:A.globalModal_back,onClick:o,children:[t.jsx(F,{name:"ChevronLeftIcon",width:20,height:15}),t.jsx("span",{children:"Назад"})]}),t.jsxs("div",{className:A.globalModal_container,children:[t.jsx(Rs,{}),t.jsx(Ls,{})]})]})}function Fs(){const n=K().pathname,{pickedSearch:o,setPickedSearch:c,searchText:r,setSearchText:a,searchParams:f,TemporaryData:d,setTemporaryData:l,setSearchResponse:p,setTotalElementsStore:_,setTotalPagesStore:m,setCheckedProductsByCode:h,checkedProductsByCode:i,page:u,perPage:N,lang:j,globalModal:P,setGlobalModal:I,globalRemember:w,programRemember:D,errorMessage:S,setErrorMessage:y}=z(),[g,M]=b.useState([]);b.useEffect(()=>{M([...i])},[i]),b.useEffect(()=>{y(""),a("")},[n]),b.useEffect(()=>{(o=="По штрих-коду"||o=="По ИКПУ"||o=="По ТН ВЭД")&&(r.toString(),r.length<13&&c("По ТН ВЭД"),r.length==13&&c("По штрих-коду"),r.length>13&&c("По ИКПУ"))},[r]),b.useEffect(()=>{const v=document.querySelector(`input[name="search"][value="${o}"]`);v&&(v.checked=!0)},[o]);const W=v=>{c(v.currentTarget.value)},x=async v=>{if(v.preventDefault(),p([]),X.get("access_token")||await et(),r.length>0&&o!="По штрих-коду"&&o!="По ИКПУ"){console.log("1 СЦЕНАРИЙ по тексту"),console.log(222,"searchText",r);const{data:k,totalElements:T,totalPages:R}=await Z(o,r,u,N,j);if(console.log(3333,"data",k),k.length==0){y("ничего не найдено");return}T&&R&&(_(T),m(R));const B=[];for(const q of k){const C=await Y(q.mxikCode,j);B.push({...q,id:U(),photos:C})}p(B)}if(r.length>0&&o=="По штрих-коду"||o=="По ИКПУ"){console.log("2 СЦЕНАРИЙ по коду");const{data:k,totalElements:T,totalPages:R}=await Z(o,r,u,N,j);k.length==0&&y("ничего не найдено"),T&&R&&(_(T),m(R));const B=[];for(const C of k){const G=await ot(C),lt=await Y(C.mxikCode,j);G&&B.push({...C,id:U(),photos:lt})}if(k.length==0)if(w===!0){const C=await at(r);console.log("navAddProduct fetchData",C)}else D===!0?(console.log("programRemember === true что дальше? (NavAddProduct 207)",D),y(`по штрихкоду ${r} ничего не найдено, попробуйте найти по названию`)):I(!0);else if(k.length==1&&B.length==0){y("Этот продукт уже есть на складе");return}else if(k.length>0&&B.length>0&&B.filter(C=>d.some(G=>G.mxikCode===C.mxikCode))[0]){y("Вы уже ввбрали это продукт");return}const q=B.filter(C=>!d.some(G=>G.mxikCode===C.mxikCode));h([...q]),l([...d,...q])}},L=v=>{v!=r&&y(""),console.log("value",v),/^[a-zA-Z]+$/.test(v)?(console.log("тексе"),o!="Расширинный по тексту"&&o!="По бренду"&&o!="По номеру рег. удостовирения"&&o!="По MHH"&&(c("По тексту"),y(""))):/^\d+$/.test(v)?(console.log("число"),v.length<=4?(c("По ТН ВЭД"),y(""),console.log("По ТН ВЭД")):v.length>4&&v.length<=13?(console.log("По штрих-коду"),y(""),c("По штрих-коду")):v.length>13&&v.length<=17?(c("По ИКПУ"),y(""),console.log("По ИКПУ")):v.length>17?(console.log("value",v),console.log("код ИКПУ не валидный"),y("код ИКПУ не валидный")):y("Введен невалидный символ")):o!="Расширинный по тексту"&&o!="По бренду"&&o!="По номеру рег. удостовирения"&&o!="По MHH"&&c("По тексту"),a(v)};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.nav,children:[P&&t.jsx(Bs,{}),t.jsxs("form",{action:"",className:s.nav_form,onSubmit:v=>x(v),children:[t.jsxs("div",{className:s.nav_form_left,children:[t.jsxs("ul",{className:s.nav_buttons,children:[t.jsx("li",{children:t.jsxs(E,{className:`${s.back} ${s.nav_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(F,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(E,{to:"/addingProducts/settingsAddProducts",className:`${s.nav_linkBtn} ${s.nav_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(F,{name:"Cog8ToothIcon",className:s.nav_buttons_iconSetting})]})})]}),t.jsxs("fieldset",{children:[t.jsx("input",{value:r,type:"text",className:s.nav_form_input,placeholder:o,onChange:v=>L(v.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.nav_form_btn,children:"Поиск"})]})]}),g.length>0&&d.length>0&&t.jsx(fs,{}),t.jsx("ul",{className:s.nav_form_list,children:f==null?void 0:f.map(v=>t.jsx("li",{children:t.jsxs("label",{className:s.nav_form_check,children:[t.jsx("input",{type:"radio",name:"search",value:v.title,onClick:O=>W(O)}),t.jsx("span",{className:s.nav_form_check_text,children:v.title})]})},v.id))})]}),t.jsx("span",{className:s.nav_error,children:S})]})})}function Cs({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsx("div",{className:s.left_content,children:e.map(n=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:n.title}),t.jsx("p",{children:n.value})]},n.id))})})}function qs(){const{imagesSrc:e,setImagesSrc:n}=z(),[o,c]=b.useState(null),r=b.useRef([]),a=i=>{r.current.forEach(u=>{u&&u.getAttribute("id")==i&&u.click()})};function f(i,u){c(u)}function d(i){i.target.style.background="white"}function l(i){i.target.style.background="white"}function p(i){i.preventDefault(),i.target.style.background="lightgray"}function _(i,u){i.preventDefault(),i.target.style.background="white";const N=e.map(j=>j.id===u.id?{...j,order:(o==null?void 0:o.order)||j.order}:j.id===(o==null?void 0:o.id)?{...j,order:u.order}:j);n(N),c(null)}function m(i,u){return i.order>u.order?1:-1}const h=i=>{var N,j;const u=(j=(N=i==null?void 0:i.target)==null?void 0:N.files)==null?void 0:j[0];if(u&&(u==null?void 0:u.type)==="image/jpeg"||(u==null?void 0:u.type)==="image/png"||(u==null?void 0:u.type)==="image/webp"){const P=i.target.getAttribute("id"),I=[...e],w=I.find(S=>S.id==P),D=I.findIndex(S=>S.id==P);if(w){const S=new FileReader;S.onload=y=>{var g;(g=y.target)!=null&&g.result&&(w.src=URL.createObjectURL(u),I.splice(D,1,w),n([...I]))},S.readAsDataURL(u)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(m).map((i,u)=>{var N;return t.jsxs("div",{draggable:!0,onDragStart:j=>f(j,i),onDragLeave:j=>d(j),onDragEnd:j=>l(j),onDragOver:j=>p(j),onDrop:j=>_(j,i),className:u==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>a(i.id),children:[t.jsx("input",{id:i.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:h,ref:j=>{r.current[u]=j}}),t.jsx("img",{src:i.src=="/noPhoto.jpg"||((N=i.src)==null?void 0:N.toString().split(":")[0])=="blob"?i.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+i.src,width:u==0?150:50,height:u==0?150:50,alt:"",className:`${u==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},i.id)})})})})}function Hs({addingImgToProduct:e,handleCancel:n}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(E,{to:"#",className:s.ikpuWrapper_save,onClick:o=>e(o),children:"Coхранить"}),t.jsx(E,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(E,{to:"#",onClick:o=>n(o),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const J=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:3,title:"Группа:",value:""},{id:4,title:"Класс:",value:""},{id:5,title:"Позиция:",value:""},{id:6,title:"Субпозиция:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""},{id:9,title:"Описание:",value:""}];function Os(){const{searchResponseItem:e,imagesSrc:n,setImagesSrc:o,setSearchResponseItem:c,setIkpuStatus:r}=z(),[a,f]=b.useState([]);b.useEffect(()=>{if(e){const p=J==null?void 0:J.map(_=>{let m;return _.title=="ИКПУ:"&&(m=e.mxikCode),_.title=="Штрих-код:"&&(m=e.internationalCode),_.title=="Группа:"&&(m=e.groupName),_.title=="Класс:"&&(m=e.className),_.title=="Позиция:"&&(m=e.positionName),_.title=="Субпозиция:"&&(m=e.subPositionName),_.title=="Наименование:"&&(m=e.className),_.title=="Бренд:"&&(m=e.brandName),_.title=="Описание:"&&(m=e.attributeName),{id:_.id,title:_.title,value:m}});f([...p])}},[e]),b.useEffect(()=>{if(e.photos){const p=n.map((_,m)=>{var h,i;return{id:_.id,order:_.order,src:(h=e==null?void 0:e.photos)!=null&&h[m]?(i=e==null?void 0:e.photos)==null?void 0:i[m]:"/noPhoto.jpg"}});p&&o(p)}},[]);const d=p=>{p.preventDefault();const _=n==null?void 0:n.map(m=>m.src);e.photos=_,c(e),r(!1)};function l(p){p.preventDefault();const _=n.map(m=>({id:m.id,order:m.order,src:m.src}));o(_),r(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:l,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:p=>p.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(Cs,{staticList:a}),t.jsx(qs,{})]}),t.jsx(Hs,{addingImgToProduct:d,handleCancel:l})]})})})}function Us({item:e}){const[n,o]=b.useState(0),{TemporaryData:c,setTemporaryData:r}=z(),a=f=>{const d=f.target.valueAsNumber;o(d);const l=c.find(p=>p.id==e.id);if(l){const p=c.findIndex(m=>m.id==e.id),_=[...c];_.splice(p,1,l),r(_)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function Gs({item:e}){const[n,o]=b.useState(0),{TemporaryData:c,setTemporaryData:r}=z(),a=f=>{const d=f.target.valueAsNumber;o(d);const l=c.find(p=>p.id==e.id);if(l){l.crmSellingPrice=d;const p=c.findIndex(m=>m.id==e.id),_=[...c];_.splice(p,1,l),r(_)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function Xs({item:e}){const[n,o]=b.useState(0),{TemporaryData:c,setTemporaryData:r}=z(),a=f=>{const d=f.target.valueAsNumber;o(d);const l=c.find(p=>p.id==e.id);if(l){const p=c.findIndex(m=>m.id==e.id),_=[...c];_.splice(p,1,l),r(_)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,min:0,className:s.table_body_amount,onChange:a})})}function Ks({item:e,column:n}){const{ikpuStatus:o,setSearchResponseItem:c,setIkpuStatus:r,setTemporaryData:a,TemporaryData:f,setOpenModalCategory:d,setCurrentProduct:l}=z(),p=h=>{c(h),r(!o)},_=()=>{f&&a(f.filter(h=>h.id!==e.id))},m=h=>{h.preventDefault(),d(!0),l(e)};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${n.length}, 200px)`},children:[n==null?void 0:n.map(h=>{var i,u,N,j,P,I,w,D;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(h==null?void 0:h.title)=="Количество"&&t.jsx(Xs,{item:e}),(h==null?void 0:h.title)=="Приходная цена"&&t.jsx(Us,{item:e}),(h==null?void 0:h.title)=="Продажная цена"&&t.jsx(Gs,{item:e}),(h==null?void 0:h.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:e.subPositionName}),(h==null?void 0:h.title)=="Фото"?t.jsx("img",{src:((i=e.photos)==null?void 0:i[0])=="/noPhoto.jpg"?(u=e.photos)==null?void 0:u[0]:((N=e.photos)==null?void 0:N.length)==0?"/noPhoto.jpg":(P=(j=e.photos)==null?void 0:j[0])!=null&&P.startsWith("blob")?(I=e.photos)==null?void 0:I[0]:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+((w=e.photos)==null?void 0:w[0]),width:40,height:40,alt:"",className:s.table_body_img}):"",(h==null?void 0:h.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(h==null?void 0:h.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(h==null?void 0:h.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>p(e),children:t.jsx(F,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(h==null?void 0:h.title)=="Подкатегория"&&t.jsx(E,{to:"#",onClick:S=>m(S),children:(D=e==null?void 0:e.crmCategory)!=null&&D.name.ru?e==null?void 0:e.crmCategory.name.ru:"Выбрать"}),(h==null?void 0:h.title)=="Штрих-код"&&(e==null?void 0:e.internationalCode)]},h==null?void 0:h.id)}),t.jsx("td",{className:s.table_body_del,onClick:_,children:t.jsx(F,{name:"TrashIcon",width:20,height:20})})]})}function Qs({column:e}){const{TemporaryData:n}=z();return t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(o=>t.jsx("td",{className:s.table_head_col,children:o.title},o.id))})}),t.jsx("tbody",{className:s.table_body,children:n==null?void 0:n.map(o=>t.jsx(Ks,{item:o,column:e},o==null?void 0:o.id))})]})}function Js({clearTable:e,setData:n}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:n,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:o=>e(o),children:"Отмена"})]})}function Vs(){const e=b.useRef(null),[n,o]=b.useState(!1),[c,r]=b.useState(0),[a,f]=b.useState(0),d=g=>{e.current&&(o(!0),r(g.pageX-e.current.offsetLeft),f(e.current.scrollLeft))},l=()=>{o(!1)},p=()=>{o(!1)},_=g=>{if(!n||!e.current)return;g.preventDefault();const W=(g.pageX-e.current.offsetLeft-c)*2;e.current.scrollLeft=a-W},{settingsParams:m,ikpuStatus:h,TemporaryData:i,openModalCategory:u,setTemporaryData:N,setCheckedProducts:j,nameProduct:P}=z(),[I,w]=b.useState([]);b.useEffect(()=>{const g=m.filter(M=>M.checked);w(()=>[...g])},[m]);const D=async g=>{g.preventDefault();for(const M of i)await S(M)};async function S(g){var M,W,x;try{const L=X.get("multi-store"),v={multiStoreId:Number(L),categoryId:Number((M=g==null?void 0:g.crmCategory)==null?void 0:M.id),barcode:Number(g==null?void 0:g.internationalCode),nameUz:"string",nameUzc:"string",nameRu:P||((W=g==null?void 0:g.crmNameProduct)==null?void 0:W.toString()),mxik:(x=g==null?void 0:g.mxikCode)==null?void 0:x.toString(),brand:g.brandName??null,oldPrice:Number(g==null?void 0:g.crmArrivalPrice),price:Number(g==null?void 0:g.crmSellingPrice),oldPriceCourse:0,priceCourse:0,nds:0,discount:0};await Q.post("nomenclatures",v),N([]),j([])}catch(L){console.log(`Ошибка произошла при попытке добавить ${g==null?void 0:g.crmNameProduct} на сервер`,L)}}const y=g=>{g.preventDefault(),N([]),j([])};return t.jsxs("div",{className:s.formWrapper,children:[u&&t.jsx(st,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:d,onMouseLeave:l,onMouseUp:p,onMouseMove:_,children:[h&&t.jsx(Os,{}),t.jsx(Qs,{column:I})]}),t.jsx(Js,{clearTable:y,setData:D})]})}function tt(){const{errorModal:e}=z();return t.jsx("div",{className:s.errorModal,children:t.jsx("div",{className:s.errorModal_block,children:t.jsx("p",{children:e==null?void 0:e.message})})})}const Zs="_layout_5my6h_1",Ys="_layout_back_5my6h_4",to="_layout_title_5my6h_14",eo="_layout_list_5my6h_19",so="_layout_link_5my6h_25",oo="_layout_link_active_5my6h_35",no="_form_list_5my6h_39",ao="_form_check_5my6h_44",co="_navSetting_5my6h_51",lo="_found_5my6h_55",ro="_table_5my6h_76",io="_table_head_5my6h_80",_o="_table_head_row_5my6h_83",uo="_table_head_col_5my6h_87",fo="_addSettings_list_5my6h_91",mo="_addSettings_li_5my6h_91",$={layout:Zs,layout_back:Ys,layout_title:to,layout_list:eo,layout_link:so,layout_link_active:oo,form_list:no,form_check:ao,navSetting:co,found:lo,table:ro,table_head:io,table_head_row:_o,table_head_col:uo,addSettings_list:fo,addSettings_li:mo},go=[{id:1,title:"отображения колонок",href:"/addingProducts/settingsAddProducts"},{id:2,title:"настройки",href:"/addingProducts/settingsAddProducts/settings"}];function po(){const n=K().pathname;return t.jsxs("nav",{className:$.layout,children:[t.jsx(E,{className:$.layout_back,to:"/addingProducts",children:"Закрыть"}),t.jsx("h2",{className:$.layout_title,children:"Настройки"}),t.jsx("ul",{className:$.layout_list,children:go.map(o=>t.jsx("li",{children:t.jsx(E,{to:o.href,className:`${$.layout_link} ${o.href==n?$.layout_link_active:""}`,children:o.title})},o.id))})]})}function ho(){const e=b.useRef([]),{necessarilySettings:n,settingsParams:o,setSettingsParams:c}=z();b.useEffect(()=>{e.current.forEach((a,f)=>{a&&(a.checked=o[f].checked,n.forEach(d=>{a.value==d&&(a.checked=!0)}))})},[o]);const r=a=>{const f=o.map(d=>({id:d.id,title:d.title,checked:d.title==a.currentTarget.value?a.currentTarget.checked:d.checked}));c(f)};return t.jsx("nav",{className:$.navSetting,children:t.jsx("form",{action:"",className:$.form,children:t.jsx("ul",{className:$.form_list,children:o==null?void 0:o.map((a,f)=>t.jsx("li",{children:t.jsxs("label",{className:$.form_check,children:[t.jsx("input",{type:"checkbox",value:a.title,ref:d=>{e.current[f]=d},onChange:d=>r(d)}),t.jsx("span",{className:$.form_check_text,children:a.title})]})},a.id))})})})}function bo(){const{globalRemember:e,setGlobalRemember:n,programRemember:o,setProgramRemember:c}=z(),r=a=>{console.log("val",a),a==="program"?c(!o):a==="global"&&n(!e)};return t.jsx("div",{className:$.addSettings,children:t.jsx("div",{className:"container",children:t.jsxs("ul",{className:$.addSettings_list,children:[t.jsxs("li",{className:$.addSettings_li,onClick:()=>r("program"),children:[t.jsx("span",{className:$.addSettings_span,children:"Отменить выбор программного поиска"}),t.jsx("input",{type:"checkbox",className:$.addSettings_input,checked:o,readOnly:!0})]}),t.jsxs("li",{className:$.addSettings_li,onClick:()=>r("global"),children:[t.jsx("span",{className:$.addSettings_span,children:"Отменить выбор глобального поиска"}),t.jsx("input",{type:"checkbox",className:$.addSettings_input,checked:e,readOnly:!0})]})]})})})}function jo(){const{settingsParams:e}=z(),o=K().pathname,[c,r]=b.useState([]);return b.useEffect(()=>{const a=e.filter(f=>f.checked);r(()=>[...a])},[e]),t.jsxs("div",{className:"container",children:[t.jsx(po,{}),o=="/addingProducts/settingsAddProducts"&&t.jsx(ho,{}),o=="/addingProducts/settingsAddProducts/settings"&&t.jsx(bo,{}),t.jsx("section",{className:$.found,children:t.jsxs("table",{className:$.table,children:[t.jsx("thead",{className:$.table_head,children:t.jsx("tr",{className:$.table_head_row,style:{gridTemplateColumns:`repeat(${c.length}, 200px)`},children:c==null?void 0:c.map(a=>t.jsx("td",{className:$.table_head_col,children:a.title},a.id))})}),t.jsx("tbody",{className:$.table_body,children:t.jsx("tr",{className:$.table_body_row,children:t.jsx("td",{className:$.table_body_col})})})]})})]})}function xo({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsxs("div",{className:s.left_content,children:[e.map(n=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:n.title}),t.jsx("p",{children:n.value})]},n.id)),t.jsx("span",{style:{fontSize:"14px"},children:"(нужны картинки с сервера при get, post, patch запрсе по name)"})]})})}function ko(){const{stockImagesSrc:e,setStockImagesSrc:n}=z(),[o,c]=b.useState(null),r=b.useRef([]),a=i=>{r.current.forEach(u=>{u&&u.getAttribute("id")==i&&u.click()})};function f(i,u){c(u)}function d(i){i.target.style.background="white"}function l(i){i.target.style.background="white"}function p(i){i.preventDefault(),i.target.style.background="lightgray"}function _(i,u){i.preventDefault(),i.target.style.background="white";const N=e.map(j=>j.id===u.id?{...j,order:(o==null?void 0:o.order)||j.order}:j.id===(o==null?void 0:o.id)?{...j,order:u.order}:j);n(N),c(null)}function m(i,u){return i.order>u.order?1:-1}const h=i=>{var N,j;const u=(j=(N=i==null?void 0:i.target)==null?void 0:N.files)==null?void 0:j[0];if(u&&(u==null?void 0:u.type)==="image/jpeg"||(u==null?void 0:u.type)==="image/png"||(u==null?void 0:u.type)==="image/webp"){const P=i.target.getAttribute("id"),I=[...e],w=I.find(S=>S.id==P),D=I.findIndex(S=>S.id==P);if(w){const S=new FileReader;S.onload=y=>{var g;(g=y.target)!=null&&g.result&&(w.src=URL.createObjectURL(u),I.splice(D,1,w),n([...I]))},S.readAsDataURL(u)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(m).map((i,u)=>{var N;return t.jsxs("div",{draggable:!0,onDragStart:j=>f(j,i),onDragLeave:j=>d(j),onDragEnd:j=>l(j),onDragOver:j=>p(j),onDrop:j=>_(j,i),className:u==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>a(i.id),children:[t.jsx("input",{id:i.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:h,ref:j=>{r.current[u]=j}}),t.jsx("img",{src:i.src=="/noPhoto.jpg"||((N=i.src)==null?void 0:N.toString().split(":")[0])=="blob"?i.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+i.src,width:u==0?150:50,height:u==0?150:50,alt:"",className:`${u==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},i.id)})})})})}function Po({addingImgToProduct:e,handleCancel:n}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(E,{to:"#",className:s.ikpuWrapper_save,onClick:o=>e(o),children:"Coхранить"}),t.jsx(E,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(E,{to:"#",onClick:o=>n(o),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const V=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""}];function vo(){const{searchResponseItem:e,stockImagesSrc:n,setStockImagesSrc:o,setSearchResponseItem:c,setStockIkpuStatus:r}=z(),[a,f]=b.useState([]);b.useEffect(()=>{if(e){const p=V==null?void 0:V.map(_=>{var h;let m;return _.title=="ИКПУ:"&&(m=e.mxik),_.title=="Штрих-код:"&&(m=e.barcode),_.title=="Группа:"&&(m=e.groupName),_.title=="Класс:"&&(m=e.className),_.title=="Позиция:"&&(m=e.positionName),_.title=="Субпозиция:"&&(m=e.subPositionName),_.title=="Наименование:"&&(m=(h=e.name)==null?void 0:h.ru),_.title=="Бренд:"&&(m=e.brand),_.title=="Описание:"&&(m=e.description),{id:_.id,title:_.title,value:m}});f([...p])}},[e]),b.useEffect(()=>{if(e.photos){const p=n.map((_,m)=>{var h,i;return{id:_.id,order:_.order,src:(h=e==null?void 0:e.photos)!=null&&h[m]?(i=e==null?void 0:e.photos)==null?void 0:i[m]:"/noPhoto.jpg"}});p&&o(p)}},[]);const d=p=>{p.preventDefault();const _=n==null?void 0:n.map(m=>m.src);e.photos=_,c(e),r(!1)};function l(p){p.preventDefault();const _=n.map(m=>({id:m.id,order:m.order,src:m.src}));o(_),r(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:l,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:p=>p.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(xo,{staticList:a}),t.jsx(ko,{})]}),t.jsx(Po,{addingImgToProduct:d,handleCancel:l})]})})})}function No({item:e}){const[n,o]=b.useState(e.oldPrice),{stockTemporaryData:c,setStockTemporaryData:r}=z(),a=f=>{const d=f.target.value;o(Number(d));const l=c.filter(_=>_.id==e.id)[0],p=c.findIndex(_=>_.id==e.id);l&&(l.oldPrice=Number(d),c.splice(p,1,l),r([...c]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function yo({item:e}){const[n,o]=b.useState(e.price),{stockTemporaryData:c,setStockTemporaryData:r}=z(),a=f=>{const d=f.target.value;o(Number(d));const l=c.filter(_=>_.id==e.id)[0],p=c.findIndex(_=>_.id==e.id);l.price&&(l.price=Number(d),c.splice(p,1,l),r([...c]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function So({item:e}){const[n,o]=b.useState(0),{stockTemporaryData:c,setStockTemporaryData:r}=z(),a=f=>{const d=f.target.valueAsNumber;o(d);const l=c.find(p=>p.id==e.id);if(l){const p=c.findIndex(m=>m.id==e.id),_=[...c];_.splice(p,1,l),r(_)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,min:0,className:s.table_body_amount,onChange:a})})}function Mo({item:e,column:n}){const{stockTemporaryData:o,setSearchResponseItem:c,setStockIkpuStatus:r,setStockTemporaryData:a}=z(),f=l=>{c(l),r(!0)},d=()=>{o&&a(o.filter(l=>l.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${n.length}, 200px)`},children:[n==null?void 0:n.map(l=>{var p;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(l==null?void 0:l.title)=="Количество"&&t.jsx(So,{item:e}),(l==null?void 0:l.title)=="Приходная цена"&&t.jsx(No,{item:e}),(l==null?void 0:l.title)=="Продажная цена"&&t.jsx(yo,{item:e}),(l==null?void 0:l.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:(p=e==null?void 0:e.name)==null?void 0:p.ru}),(l==null?void 0:l.title)=="Фото"?t.jsx("img",{src:"/noPhoto.jpg",width:40,height:40,alt:"",className:s.table_body_img}):"",(l==null?void 0:l.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(l==null?void 0:l.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(l==null?void 0:l.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>f(e),children:t.jsx(F,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(l==null?void 0:l.title)=="Штрих-код"&&(e!=null&&e.barcode)?e==null?void 0:e.barcode:""]},l==null?void 0:l.id)}),t.jsx("td",{className:s.table_body_del,onClick:d,children:t.jsx(F,{name:"TrashIcon",width:20,height:20})})]})}function zo({column:e}){const{stockTemporaryData:n}=z(),[o,c]=b.useState([]);return b.useEffect(()=>{c(n)},[n]),t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(r=>t.jsx("td",{className:s.table_head_col,children:r.title},r.id))})}),t.jsx("tbody",{className:s.table_body,children:o==null?void 0:o.map(r=>t.jsx(Mo,{item:r,column:e},r==null?void 0:r.id))})]})}function wo({clearTable:e,setData:n}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:n,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:o=>e(o),children:"Отмена"})]})}function Io(){const e=b.useRef(null),[n,o]=b.useState(!1),[c,r]=b.useState(0),[a,f]=b.useState(0),d=g=>{e.current&&(o(!0),r(g.pageX-e.current.offsetLeft),f(e.current.scrollLeft))},l=()=>{o(!1)},p=()=>{o(!1)},_=g=>{if(!n||!e.current)return;g.preventDefault();const W=(g.pageX-e.current.offsetLeft-c)*2;e.current.scrollLeft=a-W},{settingsParams:m,stockIkpuStatus:h,stockTemporaryData:i,openModalCategory:u,setStockTemporaryData:N,setCheckedProducts:j,nameProduct:P}=z(),[I,w]=b.useState([]);b.useEffect(()=>{const g=m.filter(M=>M.checked&&M.title!="Подкатегория");w(()=>[...g])},[m]);const D=g=>{g.preventDefault(),i.forEach(M=>{S(M)})};async function S(g){var M;try{const W=X.get("multi-store"),x={nameRu:(M=g.name)==null?void 0:M.ru,oldPrice:g.oldPrice,price:g.price};await Q.patch(`nomenclatures/${g.id}`,x),N([]),j([])}catch(W){console.log(`Ошибка произошла при попытке добавить ${g==null?void 0:g.crmNameProduct} на сервер`,W)}}const y=g=>{g.preventDefault(),N([]),j([])};return t.jsxs("div",{className:s.formWrapper,children:[u&&t.jsx(st,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:d,onMouseLeave:l,onMouseUp:p,onMouseMove:_,children:[h&&t.jsx(vo,{}),t.jsx(zo,{column:I})]}),t.jsx(wo,{clearTable:y,setData:D})]})}async function ct(e,n,o,c,r){try{if(e==="По тексту"){console.log("fetchStockProducts page",c,"perPage",r);const a=await Q.get(`nomenclatures?multiStoreId=${n}&name=${o}&page=${c}&perPage=${r}`);console.log("fetchStockProducts res",a);const f=await a.data.data,d=await a.data.pagination.total,l=await a.data.pagination.total_pages;return{data:f,totalElements:d,totalPages:l}}}catch(a){console.log("Ошибка при получении продуктов со склада",a)}}function $o(){const n=K().pathname,{stockPickedSearch:o,setStockPickedSearch:c,stockSearchParams:r,stockSearchText:a,setStockSearchText:f,setStockSearchResponse:d,stockTemporaryData:l,setTotalElementsStore:p,setTotalPagesStore:_,stockPage:m,perPage:h}=z(),[i,u]=b.useState("");b.useEffect(()=>{u(""),f("")},[n]),b.useEffect(()=>{(o=="По штрих-коду"||o=="По ИКПУ")&&(a.toString(),a.length<13&&c("По ТН ВЭД"),a.length==13&&c("По штрих-коду"),a.length>13&&c("По ИКПУ")),a.length>0&&u("")},[a]),b.useEffect(()=>{const P=document.querySelector(`input[name="search"][value="${o}"]`);P&&(P.checked=!0)},[o]);const N=P=>{c(P.currentTarget.value)},j=async P=>{P.preventDefault();const I=X.get("access_token"),w=X.get("multi-store");if((!I||!w)&&await et(),a.length>0&&w){const{data:D,totalElements:S,totalPages:y}=await ct(o,w,a,m,h);console.log("totalElements",S,"totalPages",y),D.length==0&&u("ничего не найдено"),S&&y&&(p(S),_(y));const g=D.filter(M=>!l.some(W=>W.id===M.id));d(g)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.navStock,children:[t.jsxs("ul",{className:s.navStock_buttons,children:[t.jsx("li",{children:t.jsxs(E,{className:`${s.back} ${s.navStock_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(F,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(E,{to:"/addingProducts/settingsAddProducts",className:`${s.navStock_linkBtn} ${s.navStock_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(F,{name:"Cog8ToothIcon",className:s.navStock_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:s.stockForm,onSubmit:P=>j(P),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:a,type:o=="По штрих-коду"||o=="По ИКПУ"?"number":"text",className:s.stockForm_input,placeholder:o,onChange:P=>f(P.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.stockForm_btn,children:"Поиск"})]}),t.jsx("ul",{className:s.stockForm_list,children:r==null?void 0:r.map(P=>t.jsx("li",{children:t.jsxs("label",{className:s.stockForm_check,children:[t.jsx("input",{type:"radio",name:"search",value:P.title,onClick:I=>N(I)}),t.jsx("span",{className:s.stockForm_check_text,children:P.title})]})},P.id))})]}),t.jsx("span",{className:s.navStock_error,children:i})]})})}function Do({addSelectedProducts:e,setCancel:n}){const{setAddBlockStatus:o}=rt(),c=()=>{n(),o(!1)};return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(E,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>e(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:c,children:"Отмена"})]})}function Ao(){const{stockSearchResponse:e,setStockSearchResponse:n,stockCheckedProducts:o,setStockCheckedProducts:c,stockTemporaryData:r,setStockTemporaryData:a,totalElementsStore:f,setTotalElementsStore:d,totalPagesStore:l,setTotalPagesStore:p,stockSearchText:_,setStockSearchText:m,stockPickedSearch:h,stockPage:i,setStockPage:u,setPerPage:N,perPage:j}=z(),[P,I]=b.useState([]),[w,D]=b.useState([]),[S,y]=b.useState(!1),g=b.useRef([]),M=b.useRef(null);b.useEffect(()=>{I([...e]),console.log("stockSearchResponse",e)},[e]);const W=()=>{o&&a([...o,...r]),n([]),c([]),O()},x=(k,T)=>{if(k){D([...w,T]);const R=P.filter(B=>B.id==T)[0];c([...o,R])}else if(!k&&M.current){const R=w.filter(q=>q!=T);D([...R]);const B=o.filter(q=>q.id!=T);c([...B]),y(!1),M.current.checked=!1}M.current&&k&&w.length+1==P.length&&(y(!0),M.current.checked=!0,c([...P]))},L=k=>{if(y(k),k){g.current.forEach(R=>{R&&(R.checked=k)});const T=P.map(R=>R.id);D([...T]),c([...P])}else D([]),g.current.forEach(T=>{T&&(T.checked=k)}),c([])},v=async k=>{k.preventDefault();const T=i+1;u(T);const R=X.get("multi-store");if(R){const{data:B}=await ct(h,R,_,T,j),q=B.filter(C=>!r.some(G=>G.id===C.id));console.log("filteredSearchResponse",q),console.log("stockSearchResponse",e),console.log("stockSearchText",_),M.current&&(y(!1),M.current.checked=!1,n([...q,...e]))}},O=()=>{n([]),c([]),d(0),p(0),m(""),u(1),N(5)};return t.jsx("section",{className:s.foundProducts,onClick:O,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:k=>k.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",f]}),t.jsxs("span",{children:["Текущее количество - ",P.length]}),t.jsxs("span",{children:["Выбрано элементов - ",w.length]})]}),i<l&&l!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:k=>v(k),children:"добавить ещё..."}),P.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:k=>L(k.target.checked),ref:M}),t.jsx("span",{children:S?"Отключить все":"Выбрать все"})]}),t.jsx(Do,{addSelectedProducts:W,setCancel:O})]}),t.jsx("ul",{className:s.foundProducts_list,children:P==null?void 0:P.map((k,T)=>{var R;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:k==null?void 0:k.barcode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:k==null?void 0:k.mxik})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:k==null?void 0:k.brand})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:(R=k==null?void 0:k.name)==null?void 0:R.ru})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:k==null?void 0:k.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${S||w.includes(k.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:B=>x(B.target.checked,k.id),ref:B=>{g.current[T]=B}}),"Выбрать"]})]},k==null?void 0:k.id)})})]})})}function To(){const{searchResponse:e,searchText:n,TemporaryData:o,pickedSearch:c,setSearchText:r,setTemporaryData:a,setCheckedProducts:f,setSearchResponse:d,totalElementsStore:l,setTotalElementsStore:p,setTotalPagesStore:_,page:m,setPage:h,perPage:i,lang:u,errorMessage:N,setErrorMessage:j}=z(),[P,I]=b.useState([]),[w,D]=b.useState([]),S=b.useRef(null);b.useEffect(()=>{const x=setTimeout(()=>{j("")},1e3);return()=>{clearTimeout(x)}},[N]),b.useEffect(()=>{I([...e]);const x=w.filter(L=>e.some(v=>v.id===L));D(x),I([...e])},[e]);const y=async x=>{if(await ot(x)){const v={...x,crmNameProduct:x.subPositionName,crmAmount:0,crmArrivalPrice:0,crmSellingPrice:0};console.log("addSelectedProducts myItem",v),a([...o,v]),W()}else j("Этот продукт уже есть на складе")},g=async()=>{const x=m+1;h(x);const{data:L}=await Z(c,n,x,i,u),v=[];for(const O of L){const k=await Y(O.mxikCode,u);v.push({...O,id:U(),photos:k})}d([...e,...v])},M=()=>{const x=S.current;if(x){const L=x.scrollHeight-x.scrollTop===x.clientHeight;L&&g(),console.log("isAtBottom",L)}},W=()=>{d([]),f([]),p(0),_(0),r(""),h(0)};return t.jsx("section",{className:s.foundProducts,onClick:W,children:t.jsxs("div",{ref:S,className:s.foundProducts_modal,onScroll:M,onClick:x=>x.stopPropagation(),children:[t.jsx("div",{className:s.foundProducts_top,children:t.jsx("h2",{className:s.foundProducts_title,children:t.jsxs("span",{children:["Найдено совпадений - ",l]})})}),t.jsx("ul",{className:s.foundProducts_list,children:P==null?void 0:P.map(x=>{var L;return t.jsxs("li",{className:s.foundProducts_item,onClick:()=>y(x),children:[t.jsxs("h2",{className:s.foundProducts_item_mxik,children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:x==null?void 0:x.mxikCode}),t.jsx("span",{className:s.foundProducts_item_desc,children:x==null?void 0:x.subPositionName})]}),t.jsxs("div",{className:s.foundProducts_item_content,children:[t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Группа:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:(x==null?void 0:x.groupName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Класс:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:(x==null?void 0:x.className)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Позиция:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:(x==null?void 0:x.positionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Субпозиция:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:(x==null?void 0:x.subPositionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:x==null?void 0:x.internationalCode})]})]}),t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:(L=x==null?void 0:x.photos)!=null&&L[0]?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+x.photos[0]:"/noPhoto.jpg",width:50,height:50,alt:""})})]})]},x==null?void 0:x.id)})})]})})}function Ro(){const n=K().pathname,[o,c]=b.useState(!1);return t.jsxs("div",{className:`${s.leftMenu} ${o?s.leftMenu_active:""}`,children:[t.jsx("button",{className:s.leftMenu_btn,onClick:()=>c(!o),children:t.jsx(F,{name:"Bars3Icon"})}),t.jsxs("ul",{className:s.leftMenu_list,children:[t.jsxs("li",{className:`${s.leftMenu_li} ${n=="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(F,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${o?"":s.leftMenu_li_icon_active}`}),t.jsx(E,{to:"/addingProducts",className:`${s.leftMenu_link} ${o?s.leftMenu_link_active:""}`,children:"Добавить номенклатуру"}),t.jsx(F,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${o?s.leftMenu_linkArrow_active:""}`})]}),t.jsxs("li",{className:`${s.leftMenu_li} ${n!="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(F,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${o?"":s.leftMenu_li_icon_active}`}),t.jsx(E,{to:"/addingProducts/stockProducts",className:`${s.leftMenu_link} ${o?s.leftMenu_link_active:""}`,children:"Создать номенклатуру"}),t.jsx(F,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${o?s.leftMenu_linkArrow_active:""}`})]})]})]})}function Fo(){const n=K().pathname,{stockSearchResponse:o,errorModal:c,TemporaryData:r,stockTemporaryData:a,setTemporaryData:f,setCheckedProducts:d,searchResponse:l}=z();b.useEffect(()=>{p()},[]);const p=()=>{f([]),d([])};return t.jsxs("div",{className:s.addingProducts,children:[t.jsx(Ro,{}),n=="/addingProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx(Fs,{}),r.length>0&&l.length==0&&t.jsx(Vs,{}),l.length>0&&t.jsx(To,{}),c.status&&t.jsx(tt,{})]}),n=="/addingProducts/stockProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx($o,{}),o.length>0&&t.jsx(Ao,{}),a.length>0&&t.jsx(Io,{}),c.status&&t.jsx(tt,{})]}),n.startsWith("/addingProducts/settingsAddProducts")&&t.jsx(jo,{})]})}export{Fo as default};
