import{w as H,b as X,c as G,r as x,j as t,L as R,x as K,D as st,y as Z,a as at}from"./index-Dp8myGws.js";import{a as A,M as ot}from"./Modal-CZ1nayK5.js";import{C}from"./CustomIcon-C5uwy9ev.js";import"./XMarkIcon-CQlETKCo.js";const ct="_container_wmvvr_1",rt="_nav_wmvvr_8",lt="_nav_linkBtn_wmvvr_12",it="_nav_settingsIcon_wmvvr_16",_t="_nav_buttons_wmvvr_20",dt="_nav_buttons_link_wmvvr_25",ut="_nav_buttons_iconSetting_wmvvr_30",ft="_setting_wmvvr_1",mt="_nav_error_wmvvr_33",gt="_nav_form_wmvvr_40",pt="_nav_form_left_wmvvr_46",ht="_nav_form_input_wmvvr_56",bt="_nav_form_btn_wmvvr_61",vt="_nav_form_list_wmvvr_92",xt="_nav_form_check_wmvvr_97",kt="_nav_form_check_text_wmvvr_103",jt="_navStock_wmvvr_107",Pt="_navStock_linkBtn_wmvvr_110",wt="_navStock_settingsIcon_wmvvr_115",Nt="_navStock_buttons_wmvvr_119",yt="_navStock_buttons_link_wmvvr_124",St="_navStock_buttons_iconSetting_wmvvr_129",Mt="_navStock_error_wmvvr_132",$t="_stockForm_wmvvr_140",It="_stockForm_input_wmvvr_151",At="_stockForm_btn_wmvvr_157",Dt="_stockForm_list_wmvvr_188",Tt="_stockForm_check_wmvvr_193",Et="_stockForm_check_text_wmvvr_199",Wt="_formWrapper_wmvvr_203",Rt="_formWrapper_buttons_wmvvr_208",Lt="_formWrapper_btn_wmvvr_214",Bt="_formWrapper_btn_cancel_wmvvr_226",Ft="_formWrapper_btn_save_wmvvr_229",Ct="_found_wmvvr_233",zt="_table_wmvvr_257",qt="_table_head_wmvvr_262",Ht="_table_head_row_wmvvr_265",Ut="_table_head_col_wmvvr_271",Ot="_table_body_row_wmvvr_274",Xt="_table_body_col_wmvvr_278",Gt="_table_body_img_wmvvr_287",Kt="_table_body_icon_wmvvr_290",Qt="_table_body_name_wmvvr_294",Vt="_table_body_nameString_wmvvr_327",Zt="_table_body_amount_wmvvr_334",Jt="_table_body_catalog_wmvvr_342",Yt="_table_body_catalog_top_wmvvr_352",te="_table_body_catalog_icon_wmvvr_371",ee="_table_body_catalog_iconActive_wmvvr_374",se="_table_body_catalog_drop_wmvvr_377",oe="_table_body_catalog_dropActive_wmvvr_402",ne="_table_body_catalog_search_wmvvr_407",ae="_table_body_catalog_item_wmvvr_421",ce="_table_body_catalog_text_wmvvr_429",re="_table_body_del_wmvvr_435",le="_ikpuWrapper_wmvvr_455",ie="_ikpuWrapper_ikpuModalBlock_wmvvr_464",_e="_ikpuWrapper_content_wmvvr_474",de="_ikpuWrapper_buttons_wmvvr_479",ue="_ikpuWrapper_save_wmvvr_485",fe="_ikpuWrapper_delete_wmvvr_495",me="_ikpuWrapper_cancel_wmvvr_505",ge="_left_wmvvr_516",pe="_left_content_wmvvr_519",he="_left_content_item_wmvvr_524",be="_right_wmvvr_534",ve="_right_block_wmvvr_539",xe="_right_bottom_wmvvr_545",ke="_right_bottom_item_wmvvr_552",je="_right_bottom_item_img_wmvvr_562",Pe="_right_bottom_BaseItem_wmvvr_567",we="_right_bottom_BaseItem_img_wmvvr_578",Ne="_foundProducts_wmvvr_583",ye="_foundProducts_modal_wmvvr_592",Se="_foundProducts_top_wmvvr_616",Me="_foundProducts_title_wmvvr_630",$e="_foundProducts_more_wmvvr_638",Ie="_foundProducts_allActive_wmvvr_655",Ae="_foundProducts_buttons_wmvvr_661",De="_foundProducts_btn_wmvvr_667",Te="_foundProducts_btn_cancel_wmvvr_679",Ee="_foundProducts_btn_save_wmvvr_682",We="_foundProducts_list_wmvvr_685",Re="_foundProducts_item_wmvvr_689",Le="_foundProducts_item_photo_wmvvr_696",Be="_foundProducts_item_list_wmvvr_706",Fe="_foundProducts_item_title_wmvvr_718",Ce="_foundProducts_item_desc_wmvvr_721",ze="_foundProducts_item_btn_wmvvr_725",qe="_foundProducts_item_btn_active_wmvvr_739",He="_errorModal_wmvvr_744",Ue="_errorModal_block_wmvvr_753",Oe="_addingProducts_wmvvr_771",Xe="_leftMenu_wmvvr_775",Ge="_leftMenu_list_wmvvr_788",Ke="_leftMenu_li_wmvvr_788",Qe="_leftMenu_li_icon_wmvvr_828",Ve="_leftMenu_li_icon_active_wmvvr_832",Ze="_leftMenu_li_active_wmvvr_836",Je="_leftMenu_link_wmvvr_851",Ye="_leftMenu_link_active_wmvvr_866",ts="_leftMenu_linkArrow_wmvvr_870",es="_leftMenu_linkArrow_active_wmvvr_876",ss="_leftMenu_active_wmvvr_882",os="_miniInfo_content_wmvvr_894",ns="_miniInfo_imgBlock_wmvvr_902",as="_miniInfo_list_wmvvr_912",s={container:ct,nav:rt,nav_linkBtn:lt,nav_settingsIcon:it,nav_buttons:_t,nav_buttons_link:dt,nav_buttons_iconSetting:ut,setting:ft,nav_error:mt,nav_form:gt,nav_form_left:pt,nav_form_input:ht,nav_form_btn:bt,nav_form_list:vt,nav_form_check:xt,nav_form_check_text:kt,navStock:jt,navStock_linkBtn:Pt,navStock_settingsIcon:wt,navStock_buttons:Nt,navStock_buttons_link:yt,navStock_buttons_iconSetting:St,navStock_error:Mt,stockForm:$t,stockForm_input:It,stockForm_btn:At,stockForm_list:Dt,stockForm_check:Tt,stockForm_check_text:Et,formWrapper:Wt,formWrapper_buttons:Rt,formWrapper_btn:Lt,formWrapper_btn_cancel:Bt,formWrapper_btn_save:Ft,found:Ct,table:zt,table_head:qt,table_head_row:Ht,table_head_col:Ut,table_body_row:Ot,table_body_col:Xt,table_body_img:Gt,table_body_icon:Kt,table_body_name:Qt,table_body_nameString:Vt,table_body_amount:Zt,table_body_catalog:Jt,table_body_catalog_top:Yt,table_body_catalog_icon:te,table_body_catalog_iconActive:ee,table_body_catalog_drop:se,table_body_catalog_dropActive:oe,table_body_catalog_search:ne,table_body_catalog_item:ae,table_body_catalog_text:ce,table_body_del:re,ikpuWrapper:le,ikpuWrapper_ikpuModalBlock:ie,ikpuWrapper_content:_e,ikpuWrapper_buttons:de,ikpuWrapper_save:ue,ikpuWrapper_delete:fe,ikpuWrapper_cancel:me,left:ge,left_content:pe,left_content_item:he,right:be,right_block:ve,right_bottom:xe,right_bottom_item:ke,right_bottom_item_img:je,right_bottom_BaseItem:Pe,right_bottom_BaseItem_img:we,foundProducts:Ne,foundProducts_modal:ye,foundProducts_top:Se,foundProducts_title:Me,foundProducts_more:$e,foundProducts_allActive:Ie,foundProducts_buttons:Ae,foundProducts_btn:De,foundProducts_btn_cancel:Te,foundProducts_btn_save:Ee,foundProducts_list:We,foundProducts_item:Re,foundProducts_item_photo:Le,foundProducts_item_list:Be,foundProducts_item_title:Fe,foundProducts_item_desc:Ce,foundProducts_item_btn:ze,foundProducts_item_btn_active:qe,errorModal:He,errorModal_block:Ue,addingProducts:Oe,leftMenu:Xe,leftMenu_list:Ge,leftMenu_li:Ke,leftMenu_li_icon:Qe,leftMenu_li_icon_active:Ve,leftMenu_li_active:Ze,leftMenu_link:Je,leftMenu_link_active:Ye,leftMenu_linkArrow:ts,leftMenu_linkArrow_active:es,leftMenu_active:ss,miniInfo_content:os,miniInfo_imgBlock:ns,miniInfo_list:as};async function J(e,n,o,c,l){try{if(e==="По тексту"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search-subposition?search_text=${n}&page=${o}&size=${c}&lang=${l}`);console.log("По тексту res",a);const m=await a.data.data.content,d=await a.data.data.totalElements,r=await a.data.data.totalPages;return{data:m,totalElements:d,totalPages:r}}else if(e==="По штрих-коду"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?gtin=${n}&size=${c}&page=${o}&lang=${l}`),m=await a.data.data.content,d=await a.data.data.totalElements,r=await a.data.data.totalPages;return console.log("По штрих-коду res",a),{data:m,totalElements:d,totalPages:r}}else if(e==="По ИКПУ"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?mxikCode=${n}&size=${c}&page=${o}&lang=${l}`);console.log("По ИКПУ res",a);const m=await a.data.data.content,d=await a.data.data.totalElements,r=await a.data.data.totalPages;return{data:m,totalElements:d,totalPages:r}}else if(e==="Расширинный по тексту"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?text=${n}&size=${c}&page=${o}&lang=${l}`);console.log("Расширинный по тексту res",a);const m=await a.data.data.content,d=await a.data.data.totalElements,r=await a.data.data.totalPages;return{data:m,totalElements:d,totalPages:r}}else if(e==="По номеру рег. удостовирения"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/dv-cert-number?dvCertNumber=${n}&page=${o}&size=${c}&lang=${l}`);console.log("По номеру рег. удостовирения res",a);const m=await a.data.data.content,d=await a.data.data.totalElements,r=await a.data.data.totalPages;return{data:m,totalElements:d,totalPages:r}}else if(e==="По ТН ВЭД"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?tnvedCode=${n}&size=${c}&page=${o}&lang=${l}`);console.log("По ТН ВЭД res",a);const m=await a.data.data.content,d=await a.data.data.totalElements,r=await a.data.data.totalPages;return{data:m,totalElements:d,totalPages:r}}else if(e==="По бренду"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?brandName=${n}&size=${c}&page=${o}&lang=${l}`);console.log("По бренду res",a);const m=await a.data.data.content,d=await a.data.data.totalElements,r=await a.data.data.totalPages;return{data:m,totalElements:d,totalPages:r}}else if(e==="По MHH"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/mnn-name?mnn_name=${n}&page=${o}&size=${c}&lang=${l}`);console.log("По MHH res",a);const m=await a.data.data,d=await a.data.recordTotal,r=await d/c;return{data:m,totalElements:d,totalPages:r}}}catch(a){console.log(a)}}async function Y(e){var o;const n=X.get("multi-store");try{return(await G.post("nomenclatures/is-unique-name",{multiStoreId:Number(n),nameRu:(o=e.subPositionName)==null?void 0:o.toString()})).data.success}catch(c){return console.log("Ошибка произошла при проверки наличия продукта на складе по наименованию",c),!1}}async function tt(e,n){try{return(await H.get(`https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/mxik/picture-names?lang=${n}&mxik_code=${e}`)).data}catch(o){console.log("Ошибка при получении картинок к продукту",o)}}function cs(){var c,l;const{checkedProductsByCode:e}=A(),[n,o]=x.useState([]);return x.useEffect(()=>{o([...e])},[e]),console.log("localProduct",n),t.jsx("div",{className:s.miniInfo,children:n.length>0&&t.jsxs("div",{className:s.miniInfo_content,children:[t.jsx("div",{className:s.miniInfo_imgBlock,children:t.jsx("img",{src:(l=(c=n[0])==null?void 0:c.photos)!=null&&l.length?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+n[0].photos[0]:"/noPhoto.jpg",alt:""})}),t.jsxs("ul",{className:s.miniInfo_list,children:[t.jsxs("li",{children:[t.jsx("span",{children:"Штрихкод:"}),t.jsx("span",{children:n&&n[0].internationalCode||"-"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"ИКПУ:"}),t.jsx("span",{children:n&&n[0].mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Бренд:"}),t.jsx("span",{children:n&&n[0].brandName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Наименование:"}),t.jsx("span",{children:n&&n[0].subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Ед. Изм:"}),t.jsx("span",{children:n&&n[0].attributeName})]})]})]})})}const rs="_globalModal_1vfw9_1",ls="_globalModal_back_1vfw9_13",is="_globalModal_container_1vfw9_45",_s="_globalModal_left_1vfw9_54",ds="_globalModal_left_top_1vfw9_59",us="_globalModal_left_desc_1vfw9_64",fs="_globalModal_left_bottom_1vfw9_71",ms="_globalModal_left_bottom_link_1vfw9_76",gs="_globalModal_left_bottom_label_1vfw9_94",ps="_globalModal_right_1vfw9_109",hs="_globalModal_right_top_1vfw9_114",bs="_globalModal_right_top_desc_1vfw9_119",vs="_globalModal_right_bottom_1vfw9_134",xs="_globalModal_right_bottom_link_1vfw9_139",ks="_globalModal_right_bottom_label_1vfw9_157",F={globalModal:rs,globalModal_back:ls,globalModal_container:is,globalModal_left:_s,globalModal_left_top:ds,globalModal_left_desc:us,globalModal_left_bottom:fs,globalModal_left_bottom_link:ms,globalModal_left_bottom_label:gs,globalModal_right:ps,globalModal_right_top:hs,globalModal_right_top_desc:bs,globalModal_right_bottom:vs,globalModal_right_bottom_link:xs,globalModal_right_bottom_label:ks};function js(){const{programRemember:e,setProgramRemember:n}=A(),o=x.useRef(null);x.useEffect(()=>{console.log("globalRemember",e),o.current&&(console.log("checkboxRef.current",o.current.checked),o.current.checked=e)},[e,o]);const c=l=>{n(l),console.log("val",l)};return t.jsxs("div",{className:F.globalModal_left,children:[t.jsxs("div",{className:F.globalModal_left_top,children:[t.jsx(C,{name:"MapPinIcon",width:35,height:35}),t.jsx("p",{className:F.globalModal_left_desc,children:"Данный товар не найден в национальной базе товаров и услуг."})]}),t.jsxs("div",{className:F.globalModal_left_bottom,children:[t.jsx(R,{to:"#",className:F.globalModal_left_bottom_link,children:"Искать в программе"}),t.jsxs("label",{className:F.globalModal_left_bottom_label,children:[t.jsx("input",{type:"checkbox",className:F.globalModal_left_bottom_checkbox,ref:o,onChange:l=>c(l.target.checked)}),t.jsx("span",{children:"Запомнить это действие "})]})]})]})}function Ps(){const{globalRemember:e,setGlobalRemember:n}=A(),o=x.useRef(null);x.useEffect(()=>{console.log("globalRemember",e),o.current&&(console.log("checkboxRef.current",o.current.checked),o.current.checked=e)},[e,o]);const c=l=>{n(l),console.log("val",l)};return t.jsxs("div",{className:F.globalModal_right,children:[t.jsxs("div",{className:F.globalModal_right_top,children:[t.jsx(C,{name:"GlobeAltIcon",width:35,height:35}),t.jsxs("p",{className:F.globalModal_right_top_desc,children:[t.jsx("span",{children:"Ипользовать глобальный поиск"}),t.jsx("span",{children:"(В этом случаи, товару не будет присвоен ИКПУ)"})]})]}),t.jsxs("div",{className:F.globalModal_right_bottom,children:[t.jsx(R,{to:"#",className:F.globalModal_right_bottom_link,children:"Искать в программе"}),t.jsxs("label",{className:F.globalModal_right_bottom_label,children:[t.jsx("input",{type:"checkbox",ref:o,className:F.globalModal_right_bottom_checkbox,onChange:l=>c(l.target.checked)}),t.jsx("span",{children:"Запомнить это действие "})]})]})]})}function ws(){const{setGlobalModal:e}=A();return t.jsxs("div",{className:F.globalModal,children:[t.jsxs(R,{to:"#",className:F.globalModal_back,onClick:()=>e(!1),children:[t.jsx(C,{name:"ChevronLeftIcon",width:20,height:15}),t.jsx("span",{children:"Назад"})]}),t.jsxs("div",{className:F.globalModal_container,children:[t.jsx(js,{}),t.jsx(Ps,{})]})]})}function Ns(){const n=K().pathname,{pickedSearch:o,setPickedSearch:c,searchText:l,setSearchText:a,searchParams:m,TemporaryData:d,setTemporaryData:r,setSearchResponse:g,setTotalElementsStore:u,setTotalPagesStore:p,setCheckedProductsByCode:b,checkedProductsByCode:_,page:f,perPage:S,lang:v,globalModal:k,setGlobalModal:D}=A(),[M,P]=x.useState(""),[$,E]=x.useState([]);x.useEffect(()=>{E([..._])},[_]),x.useEffect(()=>{P(""),a("")},[n]),x.useEffect(()=>{(o=="По штрих-коду"||o=="По ИКПУ"||o=="По ТН ВЭД")&&(l.toString(),l.length<13&&c("По ТН ВЭД"),l.length==13&&c("По штрих-коду"),l.length>13&&c("По ИКПУ"))},[l]),x.useEffect(()=>{const y=document.querySelector(`input[name="search"][value="${o}"]`);y&&(y.checked=!0)},[o]);const h=y=>{c(y.currentTarget.value)},N=async y=>{if(y.preventDefault(),X.get("access_token")||await st(),l.length>0&&o!="По штрих-коду"&&o!="По ИКПУ"){console.log("1 СЦЕНАРИЙ по тексту");const{data:W,totalElements:i,totalPages:w}=await J(o,l,f,S,v);W.length==0&&P("ничего не найдено"),i&&w&&(u(i),p(w));const j=[];for(const I of W){const z=await Y(I),O=await tt(I.mxikCode,v);z&&j.push({...I,id:Z(),photos:O})}W.length==0?P("Ничего не найдено"):W.length>1&&j.length==0?P("Все найденые совпадения уже есть на складе"):W.length==1&&j.length==0?P("Этот продукт уже есть на складе"):W.length>0&&j.length>0&&j.filter(I=>d.some(z=>z.mxikCode===I.mxikCode))[0]&&P("Вы уже ввбрали это продукт");const T=j.filter(I=>!d.some(z=>z.mxikCode===I.mxikCode));g(T)}if(l.length>0&&o=="По штрих-коду"||o=="По ИКПУ"){console.log("2 СЦЕНАРИЙ по коду");const{data:W,totalElements:i,totalPages:w}=await J(o,l,f,S,v);i&&w&&(u(i),p(w));const j=[];for(const I of W){const z=await Y(I),O=await tt(I.mxikCode,v);z&&j.push({...I,id:Z(),photos:O})}if(W.length==0)D(!0);else if(W.length>1&&j.length==0)P("Все найденые совпадения уже есть на складе");else if(W.length==1&&j.length==0){P("Этот продукт уже есть на складе");return}else if(W.length>0&&j.length>0&&j.filter(I=>d.some(z=>z.mxikCode===I.mxikCode))[0]){P("Вы уже ввбрали это продукт");return}const T=j.filter(I=>!d.some(z=>z.mxikCode===I.mxikCode));b([...T]),r([...d,...T]),a("")}},B=y=>{console.log("value",y),/^[a-zA-Z]+$/.test(y)?(console.log("тексе"),o!="Расширинный по тексту"&&o!="По бренду"&&o!="По номеру рег. удостовирения"&&o!="По MHH"&&(c("По тексту"),P(""))):/^\d+$/.test(y)?(console.log("число"),y.length<=4?(c("По ТН ВЭД"),P(""),console.log("По ТН ВЭД")):y.length>4&&y.length<=13?(console.log("По штрих-коду"),P(""),c("По штрих-коду")):y.length>13&&y.length<=17?(c("По ИКПУ"),P(""),console.log("По ИКПУ")):y.length>17?(console.log("value",y),console.log("код ИКПУ не валидный"),P("код ИКПУ не валидный")):P("Введен невалидный символ")):o!="Расширинный по тексту"&&o!="По бренду"&&o!="По номеру рег. удостовирения"&&o!="По MHH"&&c("По тексту"),a(y)},q=y=>{y.key==="Backspace"&&(P(""),console.log("Backspace was pressed"))};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.nav,children:[k&&t.jsx(ws,{}),t.jsxs("form",{action:"",className:s.nav_form,onSubmit:y=>N(y),children:[t.jsxs("div",{className:s.nav_form_left,children:[t.jsxs("ul",{className:s.nav_buttons,children:[t.jsx("li",{children:t.jsxs(R,{className:`${s.back} ${s.nav_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(C,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(R,{to:"/addingProducts/settingsAddProducts",className:`${s.nav_linkBtn} ${s.nav_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(C,{name:"Cog8ToothIcon",className:s.nav_buttons_iconSetting})]})})]}),t.jsxs("fieldset",{children:[t.jsx("input",{value:l,type:"text",className:s.nav_form_input,placeholder:o,onKeyDown:q,onChange:y=>B(y.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.nav_form_btn,children:"Поиск"})]})]}),$.length>0&&d.length>0&&t.jsx(cs,{}),t.jsx("ul",{className:s.nav_form_list,children:m==null?void 0:m.map(y=>t.jsx("li",{children:t.jsxs("label",{className:s.nav_form_check,children:[t.jsx("input",{type:"radio",name:"search",value:y.title,onClick:U=>h(U)}),t.jsx("span",{className:s.nav_form_check_text,children:y.title})]})},y.id))})]}),t.jsx("span",{className:s.nav_error,children:M})]})})}function ys({setCancel:e,addSelectedProducts:n}){return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(R,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>n(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:e,children:"Отмена"})]})}function Ss(){const{searchResponse:e,checkedProducts:n,searchText:o,TemporaryData:c,pickedSearch:l,setSearchText:a,setTemporaryData:m,setCheckedProducts:d,setSearchResponse:r,totalElementsStore:g,setTotalElementsStore:u,totalPagesStore:p,setTotalPagesStore:b,page:_,setPage:f,perPage:S,lang:v}=A(),[k,D]=x.useState([]),[M,P]=x.useState([]),[$,E]=x.useState(!1),h=x.useRef([]),N=x.useRef(null);x.useEffect(()=>{D([...e]);const i=M.filter(w=>e.some(j=>j.id===w));P(i),D([...e])},[e]);const B=(i,w)=>{if(i){P([...M,w]);const j=k.filter(T=>T.id==w)[0];console.log("выбран newProduct",j,"checkedProducts",n,"allRef.current",N.current),d([...n,j])}else if(!i){const j=M.filter(I=>I!=w);P([...j]);const T=n.filter(I=>I.id!=w);console.log("не выбран newProducts",T),d([...T]),N.current&&(E(!1),N.current.checked=!1)}N.current&&i&&M.length+1==k.length&&(E(!0),N.current.checked=!0,d([...k]))},q=i=>{if(E(i),i){h.current.forEach(j=>{j&&(j.checked=i)});const w=k.map(j=>j.id);P([...w]),d([...k])}else P([]),h.current.forEach(w=>{w&&(w.checked=i)}),d([])},y=()=>{if(n){const i=n.map(w=>({...w,crmNameProduct:w.subPositionName,crmAmount:0,crmArrivalPrice:0,crmSellingPrice:0}));console.log("addSelectedProducts myItem",i),m([...c,...i]),W()}},U=async i=>{i.preventDefault();const w=_+1;f(w);const{data:j}=await J(l,o,w,S,v),T=[];for(const I of j){const z=await Y(I),O=await tt(I.mxikCode,v);z&&T.push({...I,id:Z(),photos:O})}N.current&&(E(!1),N.current.checked=!1,r([...T,...e]))},W=()=>{r([]),d([]),u(0),b(0),a(""),f(0)};return t.jsx("section",{className:s.foundProducts,onClick:W,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",g]}),t.jsxs("span",{children:["Текущее количество - ",k.length]}),t.jsxs("span",{children:["Выбрано элементов - ",M.length]})]}),_+1<p&&p!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:i=>U(i),children:"добавить ещё..."}),k.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:i=>q(i.target.checked),ref:N}),t.jsx("span",{children:$?"Отключить все":"Выбрать все"})]}),t.jsx(ys,{addSelectedProducts:y,setCancel:W})]}),t.jsx("ul",{className:s.foundProducts_list,children:k==null?void 0:k.map((i,w)=>{var j;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:(j=i==null?void 0:i.photos)!=null&&j[0]?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+i.photos[0]:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.internationalCode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.brandName})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${$||M.includes(i.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:T=>B(T.target.checked,i.id),ref:T=>{h.current[w]=T}}),"Выбрать"]})]},i==null?void 0:i.id)})})]})})}function Ms({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsx("div",{className:s.left_content,children:e.map(n=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:n.title}),t.jsx("p",{children:n.value})]},n.id))})})}function $s(){const{imagesSrc:e,setImagesSrc:n}=A(),[o,c]=x.useState(null),l=x.useRef([]),a=_=>{l.current.forEach(f=>{f&&f.getAttribute("id")==_&&f.click()})};function m(_,f){c(f)}function d(_){_.target.style.background="white"}function r(_){_.target.style.background="white"}function g(_){_.preventDefault(),_.target.style.background="lightgray"}function u(_,f){_.preventDefault(),_.target.style.background="white";const S=e.map(v=>v.id===f.id?{...v,order:(o==null?void 0:o.order)||v.order}:v.id===(o==null?void 0:o.id)?{...v,order:f.order}:v);n(S),c(null)}function p(_,f){return _.order>f.order?1:-1}const b=_=>{var S,v;const f=(v=(S=_==null?void 0:_.target)==null?void 0:S.files)==null?void 0:v[0];if(f&&(f==null?void 0:f.type)==="image/jpeg"||(f==null?void 0:f.type)==="image/png"||(f==null?void 0:f.type)==="image/webp"){const k=_.target.getAttribute("id"),D=[...e],M=D.find($=>$.id==k),P=D.findIndex($=>$.id==k);if(M){const $=new FileReader;$.onload=E=>{var h;(h=E.target)!=null&&h.result&&(M.src=URL.createObjectURL(f),D.splice(P,1,M),n([...D]))},$.readAsDataURL(f)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(p).map((_,f)=>{var S;return t.jsxs("div",{draggable:!0,onDragStart:v=>m(v,_),onDragLeave:v=>d(v),onDragEnd:v=>r(v),onDragOver:v=>g(v),onDrop:v=>u(v,_),className:f==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>a(_.id),children:[t.jsx("input",{id:_.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:b,ref:v=>{l.current[f]=v}}),t.jsx("img",{src:_.src=="/noPhoto.jpg"||((S=_.src)==null?void 0:S.toString().split(":")[0])=="blob"?_.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+_.src,width:f==0?150:50,height:f==0?150:50,alt:"",className:`${f==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},_.id)})})})})}function Is({addingImgToProduct:e,handleCancel:n}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(R,{to:"#",className:s.ikpuWrapper_save,onClick:o=>e(o),children:"Coхранить"}),t.jsx(R,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(R,{to:"#",onClick:o=>n(o),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const Q=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:3,title:"Группа:",value:""},{id:4,title:"Класс:",value:""},{id:5,title:"Позиция:",value:""},{id:6,title:"Субпозиция:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""},{id:9,title:"Описание:",value:""}];function As(){const{searchResponseItem:e,imagesSrc:n,setImagesSrc:o,setSearchResponseItem:c,setIkpuStatus:l}=A(),[a,m]=x.useState([]);x.useEffect(()=>{if(e){const g=Q==null?void 0:Q.map(u=>{let p;return u.title=="ИКПУ:"&&(p=e.mxikCode),u.title=="Штрих-код:"&&(p=e.internationalCode),u.title=="Группа:"&&(p=e.groupName),u.title=="Класс:"&&(p=e.className),u.title=="Позиция:"&&(p=e.positionName),u.title=="Субпозиция:"&&(p=e.subPositionName),u.title=="Наименование:"&&(p=e.className),u.title=="Бренд:"&&(p=e.brandName),u.title=="Описание:"&&(p=e.attributeName),{id:u.id,title:u.title,value:p}});m([...g])}},[e]),x.useEffect(()=>{if(e.photos){const g=n.map((u,p)=>{var b,_;return{id:u.id,order:u.order,src:(b=e==null?void 0:e.photos)!=null&&b[p]?(_=e==null?void 0:e.photos)==null?void 0:_[p]:"/noPhoto.jpg"}});g&&o(g)}},[]);const d=g=>{g.preventDefault();const u=n==null?void 0:n.map(p=>p.src);e.photos=u,c(e),l(!1)};function r(g){g.preventDefault();const u=n.map(p=>({id:p.id,order:p.order,src:p.src}));o(u),l(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:r,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(Ms,{staticList:a}),t.jsx($s,{})]}),t.jsx(Is,{addingImgToProduct:d,handleCancel:r})]})})})}function Ds({item:e}){const[n,o]=x.useState(0),{TemporaryData:c,setTemporaryData:l}=A(),a=m=>{const d=m.target.valueAsNumber;o(d);const r=c.find(g=>g.id==e.id);if(r){const g=c.findIndex(p=>p.id==e.id),u=[...c];u.splice(g,1,r),l(u)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function Ts({item:e}){const[n,o]=x.useState(0),{TemporaryData:c,setTemporaryData:l}=A(),a=m=>{const d=m.target.valueAsNumber;o(d);const r=c.find(g=>g.id==e.id);if(r){r.crmSellingPrice=d;const g=c.findIndex(p=>p.id==e.id),u=[...c];u.splice(g,1,r),l(u)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function Es({item:e}){const[n,o]=x.useState(0),{TemporaryData:c,setTemporaryData:l}=A(),a=m=>{const d=m.target.valueAsNumber;o(d);const r=c.find(g=>g.id==e.id);if(r){const g=c.findIndex(p=>p.id==e.id),u=[...c];u.splice(g,1,r),l(u)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,min:0,className:s.table_body_amount,onChange:a})})}function Ws({item:e,column:n}){const{ikpuStatus:o,setSearchResponseItem:c,setIkpuStatus:l,setTemporaryData:a,TemporaryData:m,setOpenModalCategory:d,setCurrentProduct:r}=A(),g=b=>{c(b),l(!o)},u=()=>{m&&a(m.filter(b=>b.id!==e.id))},p=b=>{b.preventDefault(),d(!0),r(e)};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${n.length}, 200px)`},children:[n==null?void 0:n.map(b=>{var _,f,S,v,k,D,M,P;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(b==null?void 0:b.title)=="Количество"&&t.jsx(Es,{item:e}),(b==null?void 0:b.title)=="Приходная цена"&&t.jsx(Ds,{item:e}),(b==null?void 0:b.title)=="Продажная цена"&&t.jsx(Ts,{item:e}),(b==null?void 0:b.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:e.subPositionName}),(b==null?void 0:b.title)=="Фото"?t.jsx("img",{src:((_=e.photos)==null?void 0:_[0])=="/noPhoto.jpg"?(f=e.photos)==null?void 0:f[0]:((S=e.photos)==null?void 0:S.length)==0?"/noPhoto.jpg":(k=(v=e.photos)==null?void 0:v[0])!=null&&k.startsWith("blob")?(D=e.photos)==null?void 0:D[0]:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+((M=e.photos)==null?void 0:M[0]),width:40,height:40,alt:"",className:s.table_body_img}):"",(b==null?void 0:b.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(b==null?void 0:b.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(b==null?void 0:b.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>g(e),children:t.jsx(C,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(b==null?void 0:b.title)=="Подкатегория"&&t.jsx(R,{to:"#",onClick:$=>p($),children:(P=e==null?void 0:e.crmCategory)!=null&&P.name.ru?e==null?void 0:e.crmCategory.name.ru:"Выбрать"}),(b==null?void 0:b.title)=="Штрих-код"&&(e==null?void 0:e.internationalCode)]},b==null?void 0:b.id)}),t.jsx("td",{className:s.table_body_del,onClick:u,children:t.jsx(C,{name:"TrashIcon",width:20,height:20})})]})}function Rs({column:e}){const{TemporaryData:n}=A();return t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(o=>t.jsx("td",{className:s.table_head_col,children:o.title},o.id))})}),t.jsx("tbody",{className:s.table_body,children:n==null?void 0:n.map(o=>t.jsx(Ws,{item:o,column:e},o==null?void 0:o.id))})]})}function Ls({clearTable:e,setData:n}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:n,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:o=>e(o),children:"Отмена"})]})}function Bs(){const e=x.useRef(null),[n,o]=x.useState(!1),[c,l]=x.useState(0),[a,m]=x.useState(0),d=h=>{e.current&&(o(!0),l(h.pageX-e.current.offsetLeft),m(e.current.scrollLeft))},r=()=>{o(!1)},g=()=>{o(!1)},u=h=>{if(!n||!e.current)return;h.preventDefault();const B=(h.pageX-e.current.offsetLeft-c)*2;e.current.scrollLeft=a-B},{settingsParams:p,ikpuStatus:b,TemporaryData:_,openModalCategory:f,setTemporaryData:S,setCheckedProducts:v,nameProduct:k}=A(),[D,M]=x.useState([]);x.useEffect(()=>{const h=p.filter(N=>N.checked);M(()=>[...h])},[p]);const P=async h=>{h.preventDefault();for(const N of _)await $(N)};async function $(h){var N,B,q;try{const y=X.get("multi-store"),U={multiStoreId:Number(y),categoryId:Number((N=h==null?void 0:h.crmCategory)==null?void 0:N.id),barcode:Number(h==null?void 0:h.internationalCode),nameUz:"string",nameUzc:"string",nameRu:k||((B=h==null?void 0:h.crmNameProduct)==null?void 0:B.toString()),mxik:(q=h==null?void 0:h.mxikCode)==null?void 0:q.toString(),brand:h.brandName??null,oldPrice:Number(h==null?void 0:h.crmArrivalPrice),price:Number(h==null?void 0:h.crmSellingPrice),oldPriceCourse:0,priceCourse:0,nds:0,discount:0};await G.post("nomenclatures",U),S([]),v([])}catch(y){console.log(`Ошибка произошла при попытке добавить ${h==null?void 0:h.crmNameProduct} на сервер`,y)}}const E=h=>{h.preventDefault(),S([]),v([])};return t.jsxs("div",{className:s.formWrapper,children:[f&&t.jsx(ot,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:d,onMouseLeave:r,onMouseUp:g,onMouseMove:u,children:[b&&t.jsx(As,{}),t.jsx(Rs,{column:D})]}),t.jsx(Ls,{clearTable:E,setData:P})]})}function et(){const{errorModal:e}=A();return t.jsx("div",{className:s.errorModal,children:t.jsx("div",{className:s.errorModal_block,children:t.jsx("p",{children:e==null?void 0:e.message})})})}const Fs="_layout_1pbgc_1",Cs="_layout_back_1pbgc_4",zs="_layout_title_1pbgc_14",qs="_layout_list_1pbgc_19",Hs="_layout_link_1pbgc_25",Us="_layout_link_active_1pbgc_34",Os="_form_list_1pbgc_38",Xs="_form_check_1pbgc_43",Gs="_navSetting_1pbgc_49",Ks="_found_1pbgc_53",Qs="_table_1pbgc_74",Vs="_table_head_1pbgc_78",Zs="_table_head_row_1pbgc_81",Js="_table_head_col_1pbgc_85",L={layout:Fs,layout_back:Cs,layout_title:zs,layout_list:qs,layout_link:Hs,layout_link_active:Us,form_list:Os,form_check:Xs,navSetting:Gs,found:Ks,table:Qs,table_head:Vs,table_head_row:Zs,table_head_col:Js};function Ys(){const e=x.useRef([]),{necessarilySettings:n,settingsParams:o,setSettingsParams:c}=A();x.useEffect(()=>{e.current.forEach((a,m)=>{a&&(a.checked=o[m].checked,n.forEach(d=>{a.value==d&&(a.checked=!0)}))})},[o]);const l=a=>{const m=o.map(d=>({id:d.id,title:d.title,checked:d.title==a.currentTarget.value?a.currentTarget.checked:d.checked}));c(m)};return t.jsx("nav",{className:L.navSetting,children:t.jsx("form",{action:"",className:L.form,children:t.jsx("ul",{className:L.form_list,children:o==null?void 0:o.map((a,m)=>t.jsx("li",{children:t.jsxs("label",{className:L.form_check,children:[t.jsx("input",{type:"checkbox",value:a.title,ref:d=>{e.current[m]=d},onChange:d=>l(d)}),t.jsx("span",{className:L.form_check_text,children:a.title})]})},a.id))})})})}function to(){const n=K().pathname,{settingsParams:o}=A(),[c,l]=x.useState([]);x.useEffect(()=>{const m=o.filter(d=>d.checked);l(()=>[...m])},[o]);const a=[{id:1,title:"отображения колонок",href:"/addingProducts/settingsAddProducts"}];return t.jsxs("div",{className:"container",children:[t.jsxs("nav",{className:L.layout,children:[t.jsx(R,{className:L.layout_back,to:"/addingProducts",children:"Закрыть"}),t.jsx("h2",{className:L.layout_title,children:"Настройки"}),t.jsx("ul",{className:L.layout_list,children:a.map(m=>t.jsx("li",{children:t.jsx(R,{to:m.href,className:`${L.layout_link} ${m.href==n?L.layout_link_active:""}`,children:m.title})},m.id))}),n=="/addingProducts/settingsAddProducts"&&t.jsx(Ys,{})]}),t.jsx("section",{className:L.found,children:t.jsxs("table",{className:L.table,children:[t.jsx("thead",{className:L.table_head,children:t.jsx("tr",{className:L.table_head_row,style:{gridTemplateColumns:`repeat(${c.length}, 200px)`},children:c==null?void 0:c.map(m=>t.jsx("td",{className:L.table_head_col,children:m.title},m.id))})}),t.jsx("tbody",{className:L.table_body,children:t.jsx("tr",{className:L.table_body_row,children:t.jsx("td",{className:L.table_body_col})})})]})})]})}function eo({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsxs("div",{className:s.left_content,children:[e.map(n=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:n.title}),t.jsx("p",{children:n.value})]},n.id)),t.jsx("span",{style:{fontSize:"14px"},children:"(нужны картинки с сервера при get, post, patch запрсе по name)"})]})})}function so(){const{stockImagesSrc:e,setStockImagesSrc:n}=A(),[o,c]=x.useState(null),l=x.useRef([]),a=_=>{l.current.forEach(f=>{f&&f.getAttribute("id")==_&&f.click()})};function m(_,f){c(f)}function d(_){_.target.style.background="white"}function r(_){_.target.style.background="white"}function g(_){_.preventDefault(),_.target.style.background="lightgray"}function u(_,f){_.preventDefault(),_.target.style.background="white";const S=e.map(v=>v.id===f.id?{...v,order:(o==null?void 0:o.order)||v.order}:v.id===(o==null?void 0:o.id)?{...v,order:f.order}:v);n(S),c(null)}function p(_,f){return _.order>f.order?1:-1}const b=_=>{var S,v;const f=(v=(S=_==null?void 0:_.target)==null?void 0:S.files)==null?void 0:v[0];if(f&&(f==null?void 0:f.type)==="image/jpeg"||(f==null?void 0:f.type)==="image/png"||(f==null?void 0:f.type)==="image/webp"){const k=_.target.getAttribute("id"),D=[...e],M=D.find($=>$.id==k),P=D.findIndex($=>$.id==k);if(M){const $=new FileReader;$.onload=E=>{var h;(h=E.target)!=null&&h.result&&(M.src=URL.createObjectURL(f),D.splice(P,1,M),n([...D]))},$.readAsDataURL(f)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(p).map((_,f)=>{var S;return t.jsxs("div",{draggable:!0,onDragStart:v=>m(v,_),onDragLeave:v=>d(v),onDragEnd:v=>r(v),onDragOver:v=>g(v),onDrop:v=>u(v,_),className:f==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>a(_.id),children:[t.jsx("input",{id:_.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:b,ref:v=>{l.current[f]=v}}),t.jsx("img",{src:_.src=="/noPhoto.jpg"||((S=_.src)==null?void 0:S.toString().split(":")[0])=="blob"?_.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+_.src,width:f==0?150:50,height:f==0?150:50,alt:"",className:`${f==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},_.id)})})})})}function oo({addingImgToProduct:e,handleCancel:n}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(R,{to:"#",className:s.ikpuWrapper_save,onClick:o=>e(o),children:"Coхранить"}),t.jsx(R,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(R,{to:"#",onClick:o=>n(o),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const V=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""}];function no(){const{searchResponseItem:e,stockImagesSrc:n,setStockImagesSrc:o,setSearchResponseItem:c,setStockIkpuStatus:l}=A(),[a,m]=x.useState([]);x.useEffect(()=>{if(e){const g=V==null?void 0:V.map(u=>{var b;let p;return u.title=="ИКПУ:"&&(p=e.mxik),u.title=="Штрих-код:"&&(p=e.barcode),u.title=="Группа:"&&(p=e.groupName),u.title=="Класс:"&&(p=e.className),u.title=="Позиция:"&&(p=e.positionName),u.title=="Субпозиция:"&&(p=e.subPositionName),u.title=="Наименование:"&&(p=(b=e.name)==null?void 0:b.ru),u.title=="Бренд:"&&(p=e.brand),u.title=="Описание:"&&(p=e.description),{id:u.id,title:u.title,value:p}});m([...g])}},[e]),x.useEffect(()=>{if(e.photos){const g=n.map((u,p)=>{var b,_;return{id:u.id,order:u.order,src:(b=e==null?void 0:e.photos)!=null&&b[p]?(_=e==null?void 0:e.photos)==null?void 0:_[p]:"/noPhoto.jpg"}});g&&o(g)}},[]);const d=g=>{g.preventDefault();const u=n==null?void 0:n.map(p=>p.src);e.photos=u,c(e),l(!1)};function r(g){g.preventDefault();const u=n.map(p=>({id:p.id,order:p.order,src:p.src}));o(u),l(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:r,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(eo,{staticList:a}),t.jsx(so,{})]}),t.jsx(oo,{addingImgToProduct:d,handleCancel:r})]})})})}function ao({item:e}){const[n,o]=x.useState(e.oldPrice),{stockTemporaryData:c,setStockTemporaryData:l}=A(),a=m=>{const d=m.target.value;o(Number(d));const r=c.filter(u=>u.id==e.id)[0],g=c.findIndex(u=>u.id==e.id);r&&(r.oldPrice=Number(d),c.splice(g,1,r),l([...c]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function co({item:e}){const[n,o]=x.useState(e.price),{stockTemporaryData:c,setStockTemporaryData:l}=A(),a=m=>{const d=m.target.value;o(Number(d));const r=c.filter(u=>u.id==e.id)[0],g=c.findIndex(u=>u.id==e.id);r.price&&(r.price=Number(d),c.splice(g,1,r),l([...c]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function ro({item:e}){const[n,o]=x.useState(0),{stockTemporaryData:c,setStockTemporaryData:l}=A(),a=m=>{const d=m.target.valueAsNumber;o(d);const r=c.find(g=>g.id==e.id);if(r){const g=c.findIndex(p=>p.id==e.id),u=[...c];u.splice(g,1,r),l(u)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,min:0,className:s.table_body_amount,onChange:a})})}function lo({item:e,column:n}){const{stockTemporaryData:o,setSearchResponseItem:c,setStockIkpuStatus:l,setStockTemporaryData:a}=A(),m=r=>{c(r),l(!0)},d=()=>{o&&a(o.filter(r=>r.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${n.length}, 200px)`},children:[n==null?void 0:n.map(r=>{var g;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(r==null?void 0:r.title)=="Количество"&&t.jsx(ro,{item:e}),(r==null?void 0:r.title)=="Приходная цена"&&t.jsx(ao,{item:e}),(r==null?void 0:r.title)=="Продажная цена"&&t.jsx(co,{item:e}),(r==null?void 0:r.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:(g=e==null?void 0:e.name)==null?void 0:g.ru}),(r==null?void 0:r.title)=="Фото"?t.jsx("img",{src:"/noPhoto.jpg",width:40,height:40,alt:"",className:s.table_body_img}):"",(r==null?void 0:r.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(r==null?void 0:r.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(r==null?void 0:r.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>m(e),children:t.jsx(C,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(r==null?void 0:r.title)=="Штрих-код"&&(e!=null&&e.barcode)?e==null?void 0:e.barcode:""]},r==null?void 0:r.id)}),t.jsx("td",{className:s.table_body_del,onClick:d,children:t.jsx(C,{name:"TrashIcon",width:20,height:20})})]})}function io({column:e}){const{stockTemporaryData:n}=A(),[o,c]=x.useState([]);return x.useEffect(()=>{c(n)},[n]),t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(l=>t.jsx("td",{className:s.table_head_col,children:l.title},l.id))})}),t.jsx("tbody",{className:s.table_body,children:o==null?void 0:o.map(l=>t.jsx(lo,{item:l,column:e},l==null?void 0:l.id))})]})}function _o({clearTable:e,setData:n}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:n,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:o=>e(o),children:"Отмена"})]})}function uo(){const e=x.useRef(null),[n,o]=x.useState(!1),[c,l]=x.useState(0),[a,m]=x.useState(0),d=h=>{e.current&&(o(!0),l(h.pageX-e.current.offsetLeft),m(e.current.scrollLeft))},r=()=>{o(!1)},g=()=>{o(!1)},u=h=>{if(!n||!e.current)return;h.preventDefault();const B=(h.pageX-e.current.offsetLeft-c)*2;e.current.scrollLeft=a-B},{settingsParams:p,stockIkpuStatus:b,stockTemporaryData:_,openModalCategory:f,setStockTemporaryData:S,setCheckedProducts:v,nameProduct:k}=A(),[D,M]=x.useState([]);x.useEffect(()=>{const h=p.filter(N=>N.checked&&N.title!="Подкатегория");M(()=>[...h])},[p]);const P=h=>{h.preventDefault(),_.forEach(N=>{$(N)})};async function $(h){var N;try{const B=X.get("multi-store"),q={nameRu:(N=h.name)==null?void 0:N.ru,oldPrice:h.oldPrice,price:h.price};await G.patch(`nomenclatures/${h.id}`,q),S([]),v([])}catch(B){console.log(`Ошибка произошла при попытке добавить ${h==null?void 0:h.crmNameProduct} на сервер`,B)}}const E=h=>{h.preventDefault(),S([]),v([])};return t.jsxs("div",{className:s.formWrapper,children:[f&&t.jsx(ot,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:d,onMouseLeave:r,onMouseUp:g,onMouseMove:u,children:[b&&t.jsx(no,{}),t.jsx(io,{column:D})]}),t.jsx(_o,{clearTable:E,setData:P})]})}async function nt(e,n,o,c,l){try{if(e==="По тексту"){console.log("fetchStockProducts page",c,"perPage",l);const a=await G.get(`nomenclatures?multiStoreId=${n}&name=${o}&page=${c}&perPage=${l}`);console.log("fetchStockProducts res",a);const m=await a.data.data,d=await a.data.pagination.total,r=await a.data.pagination.total_pages;return{data:m,totalElements:d,totalPages:r}}}catch(a){console.log("Ошибка при получении продуктов со склада",a)}}function fo(){const n=K().pathname,{stockPickedSearch:o,setStockPickedSearch:c,stockSearchParams:l,stockSearchText:a,setStockSearchText:m,setStockSearchResponse:d,stockTemporaryData:r,setTotalElementsStore:g,setTotalPagesStore:u,stockPage:p,perPage:b}=A(),[_,f]=x.useState("");x.useEffect(()=>{f(""),m("")},[n]),x.useEffect(()=>{(o=="По штрих-коду"||o=="По ИКПУ")&&(a.toString(),a.length<13&&c("По ТН ВЭД"),a.length==13&&c("По штрих-коду"),a.length>13&&c("По ИКПУ")),a.length>0&&f("")},[a]),x.useEffect(()=>{const k=document.querySelector(`input[name="search"][value="${o}"]`);k&&(k.checked=!0)},[o]);const S=k=>{c(k.currentTarget.value)},v=async k=>{k.preventDefault();const D=X.get("access_token"),M=X.get("multi-store");if((!D||!M)&&await st(),a.length>0&&M){const{data:P,totalElements:$,totalPages:E}=await nt(o,M,a,p,b);console.log("totalElements",$,"totalPages",E),P.length==0&&f("ничего не найдено"),$&&E&&(g($),u(E));const h=P.filter(N=>!r.some(B=>B.id===N.id));d(h)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.navStock,children:[t.jsxs("ul",{className:s.navStock_buttons,children:[t.jsx("li",{children:t.jsxs(R,{className:`${s.back} ${s.navStock_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(C,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(R,{to:"/addingProducts/settingsAddProducts",className:`${s.navStock_linkBtn} ${s.navStock_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(C,{name:"Cog8ToothIcon",className:s.navStock_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:s.stockForm,onSubmit:k=>v(k),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:a,type:o=="По штрих-коду"||o=="По ИКПУ"?"number":"text",className:s.stockForm_input,placeholder:o,onChange:k=>m(k.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.stockForm_btn,children:"Поиск"})]}),t.jsx("ul",{className:s.stockForm_list,children:l==null?void 0:l.map(k=>t.jsx("li",{children:t.jsxs("label",{className:s.stockForm_check,children:[t.jsx("input",{type:"radio",name:"search",value:k.title,onClick:D=>S(D)}),t.jsx("span",{className:s.stockForm_check_text,children:k.title})]})},k.id))})]}),t.jsx("span",{className:s.navStock_error,children:_})]})})}function mo({addSelectedProducts:e,setCancel:n}){const{setAddBlockStatus:o}=at(),c=()=>{n(),o(!1)};return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(R,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>e(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:c,children:"Отмена"})]})}function go(){const{stockSearchResponse:e,setStockSearchResponse:n,stockCheckedProducts:o,setStockCheckedProducts:c,stockTemporaryData:l,setStockTemporaryData:a,totalElementsStore:m,setTotalElementsStore:d,totalPagesStore:r,setTotalPagesStore:g,stockSearchText:u,setStockSearchText:p,stockPickedSearch:b,stockPage:_,setStockPage:f,setPerPage:S,perPage:v}=A(),[k,D]=x.useState([]),[M,P]=x.useState([]),[$,E]=x.useState(!1),h=x.useRef([]),N=x.useRef(null);x.useEffect(()=>{D([...e]),console.log("stockSearchResponse",e)},[e]);const B=()=>{o&&a([...o,...l]),n([]),c([]),W()},q=(i,w)=>{if(i){P([...M,w]);const j=k.filter(T=>T.id==w)[0];c([...o,j])}else if(!i&&N.current){const j=M.filter(I=>I!=w);P([...j]);const T=o.filter(I=>I.id!=w);c([...T]),E(!1),N.current.checked=!1}N.current&&i&&M.length+1==k.length&&(E(!0),N.current.checked=!0,c([...k]))},y=i=>{if(E(i),i){h.current.forEach(j=>{j&&(j.checked=i)});const w=k.map(j=>j.id);P([...w]),c([...k])}else P([]),h.current.forEach(w=>{w&&(w.checked=i)}),c([])},U=async i=>{i.preventDefault();const w=_+1;f(w);const j=X.get("multi-store");if(j){const{data:T}=await nt(b,j,u,w,v),I=T.filter(z=>!l.some(O=>O.id===z.id));console.log("filteredSearchResponse",I),console.log("stockSearchResponse",e),console.log("stockSearchText",u),N.current&&(E(!1),N.current.checked=!1,n([...I,...e]))}},W=()=>{n([]),c([]),d(0),g(0),p(""),f(1),S(5)};return t.jsx("section",{className:s.foundProducts,onClick:W,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",m]}),t.jsxs("span",{children:["Текущее количество - ",k.length]}),t.jsxs("span",{children:["Выбрано элементов - ",M.length]})]}),_<r&&r!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:i=>U(i),children:"добавить ещё..."}),k.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:i=>y(i.target.checked),ref:N}),t.jsx("span",{children:$?"Отключить все":"Выбрать все"})]}),t.jsx(mo,{addSelectedProducts:B,setCancel:W})]}),t.jsx("ul",{className:s.foundProducts_list,children:k==null?void 0:k.map((i,w)=>{var j;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.barcode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.mxik})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.brand})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:(j=i==null?void 0:i.name)==null?void 0:j.ru})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${$||M.includes(i.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:T=>q(T.target.checked,i.id),ref:T=>{h.current[w]=T}}),"Выбрать"]})]},i==null?void 0:i.id)})})]})})}function xo(){const n=K().pathname,{searchResponse:o,stockSearchResponse:c,errorModal:l,TemporaryData:a,stockTemporaryData:m,setTemporaryData:d,setCheckedProducts:r}=A(),[g,u]=x.useState(!1);x.useEffect(()=>{p()},[]);const p=()=>{d([]),r([])};return t.jsxs("div",{className:s.addingProducts,children:[t.jsxs("div",{className:`${s.leftMenu} ${g?s.leftMenu_active:""}`,children:[t.jsx("button",{className:s.leftMenu_btn,onClick:()=>u(!g),children:t.jsx(C,{name:"Bars3Icon"})}),t.jsxs("ul",{className:s.leftMenu_list,children:[t.jsxs("li",{className:`${s.leftMenu_li} ${n=="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(C,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${g?"":s.leftMenu_li_icon_active}`}),t.jsx(R,{to:"/addingProducts",className:`${s.leftMenu_link} ${g?s.leftMenu_link_active:""}`,children:"Добавить номенклатуру"}),t.jsx(C,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${g?s.leftMenu_linkArrow_active:""}`})]}),t.jsxs("li",{className:`${s.leftMenu_li} ${n!="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(C,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${g?"":s.leftMenu_li_icon_active}`}),t.jsx(R,{to:"/addingProducts/stockProducts",className:`${s.leftMenu_link} ${g?s.leftMenu_link_active:""}`,children:"Создать номенклатуру"}),t.jsx(C,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${g?s.leftMenu_linkArrow_active:""}`})]})]})]}),n=="/addingProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx(Ns,{}),t.jsxs(t.Fragment,{children:[o.length>0&&t.jsx(Ss,{}),a.length>0&&t.jsx(Bs,{}),l.status&&t.jsx(et,{})]})]}),n=="/addingProducts/stockProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx(fo,{}),c.length>0&&t.jsx(go,{}),m.length>0&&t.jsx(uo,{}),l.status&&t.jsx(et,{})]}),n=="/addingProducts/settingsAddProducts"&&t.jsx(to,{})]})}export{xo as default};
