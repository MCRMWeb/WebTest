import{w as G,b as V,c as X,r as u,j as t,L as D,y as U,x as Q,D as ot,a as _t}from"./index-BvLd0ioI.js";import{a as C,C as it,D as dt,M as ut}from"./Modal-CWqwqvr5.js";import{C as R}from"./CustomIcon-BASPemvT.js";import"./XMarkIcon-hG-QNPRC.js";const ft="_container_1esx1_1",gt="_nav_1esx1_11",bt="_nav_linkBtn_1esx1_15",mt="_nav_settingsIcon_1esx1_19",pt="_nav_buttons_1esx1_23",ht="_nav_buttons_link_1esx1_28",xt="_nav_buttons_iconSetting_1esx1_33",kt="_setting_1esx1_1",jt="_nav_error_1esx1_36",yt="_nav_form_1esx1_43",Pt="_nav_form_left_1esx1_49",vt="_nav_form_input_1esx1_59",Nt="_nav_form_btn_1esx1_64",St="_nav_form_list_1esx1_95",Mt="_nav_form_check_1esx1_100",wt="_nav_form_check_text_1esx1_106",Ct="_navStock_1esx1_110",$t="_navStock_linkBtn_1esx1_113",It="_navStock_settingsIcon_1esx1_118",Et="_navStock_buttons_1esx1_122",At="_navStock_buttons_link_1esx1_127",Dt="_navStock_buttons_iconSetting_1esx1_132",Tt="_navStock_error_1esx1_135",Rt="_stockForm_1esx1_143",Bt="_stockForm_input_1esx1_154",Ft="_stockForm_btn_1esx1_160",Lt="_stockForm_list_1esx1_191",Wt="_stockForm_check_1esx1_196",zt="_stockForm_check_text_1esx1_202",Ht="_formWrapper_1esx1_206",qt="_formWrapper_buttons_1esx1_212",Ut="_formWrapper_btn_1esx1_218",Gt="_formWrapper_btn_cancel_1esx1_230",Ot="_formWrapper_btn_save_1esx1_233",Zt="_found_1esx1_237",Xt="_table_1esx1_261",Vt="_table_head_1esx1_266",Qt="_table_head_row_1esx1_269",Kt="_table_head_col_1esx1_275",Jt="_table_head_minCol_1esx1_278",Yt="_table_head_minCol_still_1esx1_289",te="_table_body_row_1esx1_293",ee="_table_body_row_focus_1esx1_299",se="_table_body_row_checked_1esx1_303",oe="_table_body_col_1esx1_307",ae="_table_body_minCol_1esx1_316",ne="_table_body_minCol_still_1esx1_327",ce="_table_body_img_1esx1_331",le="_table_body_icon_1esx1_335",re="_table_body_nameHover_1esx1_339",_e="_table_body_name_1esx1_339",ie="_table_body_name_focused_1esx1_380",de="_table_body_nameString_1esx1_383",ue="_table_body_amount_1esx1_392",fe="_table_body_amount_focused_1esx1_400",ge="_table_body_catalog_1esx1_403",be="_table_body_catalog_top_1esx1_413",me="_table_body_catalog_icon_1esx1_432",pe="_table_body_catalog_iconActive_1esx1_435",he="_table_body_catalog_drop_1esx1_438",xe="_table_body_catalog_dropActive_1esx1_463",ke="_table_body_catalog_search_1esx1_468",je="_table_body_catalog_item_1esx1_482",ye="_table_body_catalog_text_1esx1_490",Pe="_table_body_buttons_1esx1_496",ve="_table_body_del_1esx1_501",Ne="_table_body_generation_1esx1_501",Se="_table_body_barcodeSave_1esx1_501",Me="_table_body_still_1esx1_501",we="_table_body_category_1esx1_516",Ce="_table_body_category_btn_1esx1_521",$e="_table_body_category_span_1esx1_536",Ie="_table_body_qr_1esx1_551",Ee="_table_body_barcode_1esx1_501",Ae="_table_body_barcode_focused_1esx1_568",De="_table_body_error_1esx1_571",Te="_table_body_unit_1esx1_579",Re="_table_body_unit_dropdown_1esx1_582",Be="_table_body_minCol_check_1esx1_587",Fe="_ikpuWrapper_1esx1_598",Le="_ikpuWrapper_ikpuModalBlock_1esx1_607",We="_ikpuWrapper_content_1esx1_617",ze="_ikpuWrapper_buttons_1esx1_623",He="_ikpuWrapper_save_1esx1_629",qe="_ikpuWrapper_delete_1esx1_639",Ue="_ikpuWrapper_cancel_1esx1_649",Ge="_left_1esx1_660",Oe="_left_content_1esx1_663",Ze="_left_content_item_1esx1_668",Xe="_right_1esx1_678",Ve="_right_block_1esx1_682",Qe="_right_bottom_1esx1_688",Ke="_right_bottom_item_1esx1_696",Je="_right_bottom_item_img_1esx1_706",Ye="_right_bottom_BaseItem_1esx1_711",ts="_right_bottom_BaseItem_img_1esx1_722",es="_foundProducts_1esx1_727",ss="_foundProducts_modal_1esx1_735",os="_foundProducts_top_1esx1_760",as="_foundProducts_top_buttons_1esx1_774",ns="_foundProducts_top_add_1esx1_779",cs="_foundProducts_top_close_1esx1_796",ls="_foundProducts_item_1esx1_800",rs="_foundProducts_item_mxik_1esx1_808",_s="_foundProducts_item_content_1esx1_833",is="_foundProducts_item_photo_1esx1_838",ds="_foundProducts_item_list_1esx1_851",us="_foundProducts_item_list_box_1esx1_857",fs="_foundProducts_item_title_1esx1_879",gs="_foundProducts_item_myIcon_1esx1_883",bs="_foundProducts_item_desc_1esx1_890",ms="_foundProducts_item_btn_1esx1_894",ps="_foundProducts_item_btn_active_1esx1_908",hs="_foundProducts_title_1esx1_912",xs="_foundProducts_more_1esx1_920",ks="_foundProducts_allActive_1esx1_937",js="_foundProducts_buttons_1esx1_943",ys="_foundProducts_btn_1esx1_949",Ps="_foundProducts_btn_cancel_1esx1_961",vs="_foundProducts_btn_save_1esx1_964",Ns="_foundProducts_list_1esx1_967",Ss="_errorModal_1esx1_972",Ms="_errorModal_block_1esx1_981",ws="_addingProducts_1esx1_999",Cs="_leftMenu_1esx1_1003",$s="_leftMenu_list_1esx1_1016",Is="_leftMenu_li_1esx1_1016",Es="_leftMenu_li_icon_1esx1_1056",As="_leftMenu_li_icon_active_1esx1_1060",Ds="_leftMenu_li_active_1esx1_1064",Ts="_leftMenu_link_1esx1_1079",Rs="_leftMenu_link_active_1esx1_1094",Bs="_leftMenu_linkArrow_1esx1_1098",Fs="_leftMenu_linkArrow_active_1esx1_1104",Ls="_leftMenu_active_1esx1_1110",Ws="_miniInfo_content_1esx1_1122",zs="_miniInfo_imgBlock_1esx1_1130",Hs="_miniInfo_list_1esx1_1140",s={container:ft,nav:gt,nav_linkBtn:bt,nav_settingsIcon:mt,nav_buttons:pt,nav_buttons_link:ht,nav_buttons_iconSetting:xt,setting:kt,nav_error:jt,nav_form:yt,nav_form_left:Pt,nav_form_input:vt,nav_form_btn:Nt,nav_form_list:St,nav_form_check:Mt,nav_form_check_text:wt,navStock:Ct,navStock_linkBtn:$t,navStock_settingsIcon:It,navStock_buttons:Et,navStock_buttons_link:At,navStock_buttons_iconSetting:Dt,navStock_error:Tt,stockForm:Rt,stockForm_input:Bt,stockForm_btn:Ft,stockForm_list:Lt,stockForm_check:Wt,stockForm_check_text:zt,formWrapper:Ht,formWrapper_buttons:qt,formWrapper_btn:Ut,formWrapper_btn_cancel:Gt,formWrapper_btn_save:Ot,found:Zt,table:Xt,table_head:Vt,table_head_row:Qt,table_head_col:Kt,table_head_minCol:Jt,table_head_minCol_still:Yt,table_body_row:te,table_body_row_focus:ee,table_body_row_checked:se,table_body_col:oe,table_body_minCol:ae,table_body_minCol_still:ne,table_body_img:ce,table_body_icon:le,table_body_nameHover:re,table_body_name:_e,table_body_name_focused:ie,table_body_nameString:de,table_body_amount:ue,table_body_amount_focused:fe,table_body_catalog:ge,table_body_catalog_top:be,table_body_catalog_icon:me,table_body_catalog_iconActive:pe,table_body_catalog_drop:he,table_body_catalog_dropActive:xe,table_body_catalog_search:ke,table_body_catalog_item:je,table_body_catalog_text:ye,table_body_buttons:Pe,table_body_del:ve,table_body_generation:Ne,table_body_barcodeSave:Se,table_body_still:Me,table_body_category:we,table_body_category_btn:Ce,table_body_category_span:$e,table_body_qr:Ie,table_body_barcode:Ee,table_body_barcode_focused:Ae,table_body_error:De,table_body_unit:Te,table_body_unit_dropdown:Re,table_body_minCol_check:Be,ikpuWrapper:Fe,ikpuWrapper_ikpuModalBlock:Le,ikpuWrapper_content:We,ikpuWrapper_buttons:ze,ikpuWrapper_save:He,ikpuWrapper_delete:qe,ikpuWrapper_cancel:Ue,left:Ge,left_content:Oe,left_content_item:Ze,right:Xe,right_block:Ve,right_bottom:Qe,right_bottom_item:Ke,right_bottom_item_img:Je,right_bottom_BaseItem:Ye,right_bottom_BaseItem_img:ts,foundProducts:es,foundProducts_modal:ss,foundProducts_top:os,foundProducts_top_buttons:as,foundProducts_top_add:ns,foundProducts_top_close:cs,foundProducts_item:ls,foundProducts_item_mxik:rs,foundProducts_item_content:_s,foundProducts_item_photo:is,foundProducts_item_list:ds,foundProducts_item_list_box:us,foundProducts_item_title:fs,foundProducts_item_myIcon:gs,foundProducts_item_desc:bs,foundProducts_item_btn:ms,foundProducts_item_btn_active:ps,foundProducts_title:hs,foundProducts_more:xs,foundProducts_allActive:ks,foundProducts_buttons:js,foundProducts_btn:ys,foundProducts_btn_cancel:Ps,foundProducts_btn_save:vs,foundProducts_list:Ns,errorModal:Ss,errorModal_block:Ms,addingProducts:ws,leftMenu:Cs,leftMenu_list:$s,leftMenu_li:Is,leftMenu_li_icon:Es,leftMenu_li_icon_active:As,leftMenu_li_active:Ds,leftMenu_link:Ts,leftMenu_link_active:Rs,leftMenu_linkArrow:Bs,leftMenu_linkArrow_active:Fs,leftMenu_active:Ls,miniInfo_content:Ws,miniInfo_imgBlock:zs,miniInfo_list:Hs};async function tt(e,o,a,c,_){try{if(e==="По тексту"){const n=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search-subposition?search_text=${o}&page=${a}&size=${c}&lang=${_}`);console.log("По тексту res",n);const f=await n.data.data.content,d=await n.data.data.totalElements,i=await n.data.data.totalPages;return{data:f,totalElements:d,totalPages:i}}else if(e==="По штрих-коду"){const n=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?gtin=${o}&size=${c}&page=${a}&lang=${_}`),f=await n.data.data.content,d=await n.data.data.totalElements,i=await n.data.data.totalPages;return console.log("По штрих-коду res",n),{data:f,totalElements:d,totalPages:i}}else if(e==="По ИКПУ"){const n=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?mxikCode=${o}&size=${c}&page=${a}&lang=${_}`);console.log("По ИКПУ res",n);const f=await n.data.data.content,d=await n.data.data.totalElements,i=await n.data.data.totalPages;return{data:f,totalElements:d,totalPages:i}}else if(e==="Расширинный по тексту"){const n=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?text=${o}&size=${c}&page=${a}&lang=${_}`);console.log("Расширинный по тексту res",n);const f=await n.data.data.content,d=await n.data.data.totalElements,i=await n.data.data.totalPages;return{data:f,totalElements:d,totalPages:i}}else if(e==="По номеру рег. удостовирения"){const n=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/dv-cert-number?dvCertNumber=${o}&page=${a}&size=${c}&lang=${_}`);console.log("По номеру рег. удостовирения res",n);const f=await n.data.data.content,d=await n.data.data.totalElements,i=await n.data.data.totalPages;return{data:f,totalElements:d,totalPages:i}}else if(e==="По ТН ВЭД"){const n=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?tnvedCode=${o}&size=${c}&page=${a}&lang=${_}`);console.log("По ТН ВЭД res",n);const f=await n.data.data.content,d=await n.data.data.totalElements,i=await n.data.data.totalPages;return{data:f,totalElements:d,totalPages:i}}else if(e==="По бренду"){const n=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?brandName=${o}&size=${c}&page=${a}&lang=${_}`);console.log("По бренду res",n);const f=await n.data.data.content,d=await n.data.data.totalElements,i=await n.data.data.totalPages;return{data:f,totalElements:d,totalPages:i}}else if(e==="По MHH"){const n=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/mnn-name?mnn_name=${o}&page=${a}&size=${c}&lang=${_}`);console.log("По MHH res",n);const f=await n.data.data,d=await n.data.recordTotal,i=await d/c;return{data:f,totalElements:d,totalPages:i}}}catch(n){console.log(n)}}async function at(e){var a;const o=V.get("multi-store");try{return(await X.post("nomenclatures/is-unique-name",{multiStoreId:Number(o),nameRu:(a=e.subPositionName)==null?void 0:a.toString()})).data.success}catch(c){return console.log("Ошибка произошла при проверки наличия продукта на складе по наименованию",c),!1}}async function et(e,o){try{return(await G.get(`https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/mxik/picture-names?lang=${o}&mxik_code=${e}`)).data}catch(a){console.log("Ошибка при получении картинок к продукту",a)}}function qs(){var c,_;const{checkedProductsByCode:e}=C(),[o,a]=u.useState([]);return u.useEffect(()=>{a([...e])},[e]),console.log("localProduct",o),t.jsx("div",{className:s.miniInfo,children:o.length>0&&t.jsxs("div",{className:s.miniInfo_content,children:[t.jsx("div",{className:s.miniInfo_imgBlock,children:t.jsx("img",{src:(_=(c=o[0])==null?void 0:c.photos)!=null&&_.length?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+o[0].photos[0]:"/noPhoto.jpg",alt:""})}),t.jsxs("ul",{className:s.miniInfo_list,children:[t.jsxs("li",{children:[t.jsx("span",{children:"Штрихкод:"}),t.jsx("span",{children:o&&o[0].internationalCode||"-"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"ИКПУ:"}),t.jsx("span",{children:o&&o[0].mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Бренд:"}),t.jsx("span",{children:o&&o[0].brandName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Наименование:"}),t.jsx("span",{children:o&&o[0].subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Ед. Изм:"}),t.jsx("span",{children:o&&o[0].attributeName})]})]})]})})}const Us="_globalModal_15wz1_1",Gs="_globalModal_back_15wz1_13",Os="_globalModal_container_15wz1_45",Zs="_globalModal_left_15wz1_54",Xs="_globalModal_left_top_15wz1_59",Vs="_globalModal_left_desc_15wz1_64",Qs="_globalModal_left_bottom_15wz1_71",Ks="_globalModal_left_bottom_link_15wz1_76",Js="_globalModal_left_bottom_label_15wz1_94",Ys="_globalModal_right_15wz1_109",to="_globalModal_right_top_15wz1_114",eo="_globalModal_right_top_desc_15wz1_119",so="_globalModal_right_bottom_15wz1_134",oo="_globalModal_right_bottom_link_15wz1_139",ao="_globalModal_right_bottom_label_15wz1_157",no="_globalModal_confirm_15wz1_172",co="_globalModal_confirm_info_15wz1_184",lo="_globalModal_confirm_desc_15wz1_191",ro="_globalModal_confirm_buttons_15wz1_207",_o="_globalModal_confirm_btn_15wz1_216",T={globalModal:Us,globalModal_back:Gs,globalModal_container:Os,globalModal_left:Zs,globalModal_left_top:Xs,globalModal_left_desc:Vs,globalModal_left_bottom:Qs,globalModal_left_bottom_link:Ks,globalModal_left_bottom_label:Js,globalModal_right:Ys,globalModal_right_top:to,globalModal_right_top_desc:eo,globalModal_right_bottom:so,globalModal_right_bottom_link:oo,globalModal_right_bottom_label:ao,globalModal_confirm:no,globalModal_confirm_info:co,globalModal_confirm_desc:lo,globalModal_confirm_buttons:ro,globalModal_confirm_btn:_o};function nt({staticText:e,method:o,setModalOpen:a}){const{globalRemember:c,setGlobalRemember:_,programRemember:n,setProgramRemember:f}=C();console.log("staticText",e,"method",o);const d=i=>{o=="program"?(_(i===!0?!1:c),f(i)):o=="global"&&(f(i===!0?!1:n),_(i)),a(!1)};return t.jsx("div",{className:T.globalModal_confirm,children:t.jsxs("div",{className:T.globalModal_confirm_info,children:[e==null?void 0:e.map(i=>t.jsx("p",{className:T.globalModal_confirm_desc,children:i.title},i.id)),t.jsxs("div",{className:T.globalModal_confirm_buttons,children:[t.jsx("button",{className:T.globalModal_confirm_btn,onClick:()=>d(!1),children:"Отменить"}),t.jsx("button",{className:T.globalModal_confirm_btn,onClick:()=>d(!0),children:"Применить"})]})]})})}const io=[{id:U(),title:"Данная настройка позволяет автоматически производить поиск товара в ручном режиме в национальной базе товаров и услуг PУз"},{id:U(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function uo(){const{programRemember:e,searchText:o,setGlobalModal:a,setErrorMessage:c}=C(),_=u.useRef(null),[n,f]=u.useState(!1);u.useEffect(()=>{console.log("globalRemember",e),_.current&&(console.log("checkboxRef.current",_.current.checked),_.current.checked=e)},[e,_]);const d=()=>{f(!0)},i=()=>{c(`по штрихкоду ${o} ничего не найдено, попробуйте найти по названию`),a(!1)};return t.jsxs("div",{className:T.globalModal_left,children:[n&&t.jsx(nt,{staticText:io,method:"program",setModalOpen:f}),t.jsxs("div",{className:T.globalModal_left_top,children:[t.jsx(R,{name:"MapPinIcon",width:35,height:35}),t.jsx("p",{className:T.globalModal_left_desc,children:"Данный товар не найден в национальной базе товаров и услуг."})]}),t.jsxs("div",{className:T.globalModal_left_bottom,children:[t.jsx(D,{to:"#",className:T.globalModal_left_bottom_link,onClick:i,children:"Искать в программе"}),t.jsxs("div",{className:T.globalModal_left_bottom_label,onClick:d,children:[t.jsx("input",{type:"checkbox",className:T.globalModal_left_bottom_checkbox,ref:_}),t.jsx("span",{children:"Запомнить это действие "})]})]})]})}async function ct(e){try{console.log("getGlobalProduct barcode",e);const o=await G.get(`https://api.barcodelookup.com/v3/products?barcode=${e}&formatted=y&key=7yd26itc9ov4fdwfymvp888cyuepbl`);console.log("getGlobalProduct res",o)}catch(o){console.log("Ошибкра при поиске продукта в глобальной базе",o)}}const fo=[{id:U(),title:"Данная настройка позволяет автоматически производить поиск в глобальной базе, в случаи если в национальной базе товары не были найдены"},{id:U(),title:"Внимание! В случаи глобального поиска, ИКПУ не будет присвоен."},{id:U(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function go(){const{searchText:e,globalRemember:o,setGlobalModal:a}=C(),c=u.useRef(null),[_,n]=u.useState(!1);u.useEffect(()=>{console.log("globalRemember",o),c.current&&(console.log("checkboxRef.current",c.current.checked),c.current.checked=o)},[o,c]),u.useEffect(()=>{console.log("globalRemember",o),c.current&&(console.log("checkboxRef.current",c.current.checked),c.current.checked=o)},[o,c]);const f=async h=>{const b=await ct(h);console.log("handleGlobalSearch data",b)},d=()=>{f(e),a(!1)},i=()=>{n(!0)};return t.jsxs("div",{className:T.globalModal_right,children:[_&&t.jsx(nt,{staticText:fo,method:"global",setModalOpen:n}),t.jsxs("div",{className:T.globalModal_right_top,children:[t.jsx(R,{name:"GlobeAltIcon",width:35,height:35}),t.jsxs("p",{className:T.globalModal_right_top_desc,children:[t.jsx("span",{children:"Ипользовать глобальный поиск"}),t.jsx("span",{children:"(В этом случаи, товару не будет присвоен ИКПУ)"})]})]}),t.jsxs("div",{className:T.globalModal_right_bottom,children:[t.jsx(D,{to:"#",className:T.globalModal_right_bottom_link,onClick:d,children:"Искать глобально"}),t.jsxs("div",{className:T.globalModal_right_bottom_label,onClick:i,children:[t.jsx("input",{type:"checkbox",ref:c,className:T.globalModal_right_bottom_checkbox}),t.jsx("span",{children:"Запомнить это действие"})]})]})]})}function bo(){const{setGlobalModal:e,setSearchText:o}=C(),a=()=>{o(""),e(!1)};return t.jsxs("div",{className:T.globalModal,children:[t.jsxs(D,{to:"#",className:T.globalModal_back,onClick:a,children:[t.jsx(R,{name:"ChevronLeftIcon",width:20,height:15}),t.jsx("span",{children:"Назад"})]}),t.jsxs("div",{className:T.globalModal_container,children:[t.jsx(uo,{}),t.jsx(go,{})]})]})}function mo(){const o=Q().pathname,{pickedSearch:a,setPickedSearch:c,searchText:_,setSearchText:n,searchParams:f,TemporaryData:d,setTemporaryData:i,setSearchResponse:h,setTotalElementsStore:b,setTotalPagesStore:p,setCheckedProductsByCode:g,checkedProductsByCode:l,setPage:r,page:k,perPage:m,lang:j,globalModal:y,setGlobalModal:M,globalRemember:I,programRemember:x,errorMessage:N,setErrorMessage:S}=C(),[B,L]=u.useState([]);u.useEffect(()=>{L([...l])},[l]),u.useEffect(()=>{S(""),n("")},[o]),u.useEffect(()=>{(a=="По штрих-коду"||a=="По ИКПУ"||a=="По ТН ВЭД")&&(_.toString(),_.length<13&&c("По ТН ВЭД"),_.length==13&&c("По штрих-коду"),_.length>13&&c("По ИКПУ"))},[_]),u.useEffect(()=>{const w=document.querySelector(`input[name="search"][value="${a}"]`);w&&(w.checked=!0)},[a]);const O=w=>{c(w.currentTarget.value)},P=async w=>{if(w.preventDefault(),h([]),r(0),V.get("access_token")||await ot(),_.length>0&&a!="По штрих-коду"&&a!="По ИКПУ"){console.log("1 СЦЕНАРИЙ по тексту");const{data:E,totalElements:F,totalPages:W}=await tt(a,_.trim(),0,m,j);if(E.length==0){S("ничего не найдено");return}F&&W&&(b(F),p(W));const z=[];for(const Z of E){const H=await et(Z.mxikCode,j);z.push({...Z,id:U(),photos:H,createdByHand:!1})}h(z)}if(_.length>0&&a=="По штрих-коду"||a=="По ИКПУ"){const{data:E,totalElements:F,totalPages:W}=await tt(a,_.trim(),k,m,j);E.length==0&&S("ничего не найдено"),F&&W&&(b(F),p(W));const z=[];for(const H of E){const K=await at(H),rt=await et(H.mxikCode,j);K&&z.push({...H,id:U(),photos:rt,createdByHand:!1})}if(E.length==0)if(I===!0){const H=await ct(_);console.log("navAddProduct fetchData",H)}else x===!0?(console.log("programRemember === true что дальше? (NavAddProduct 207)",x),S(`по данному кду "${_}" ничего не найдено, попробуйте найти по названию`)):M(!0);else if(E.length==1&&z.length==0){S("Этот продукт уже есть на складе");return}else if(E.length>0&&z.length>0&&z.filter(H=>d.some(K=>K.mxikCode===H.mxikCode))[0]){S("Вы уже ввбрали это продукт");return}const Z=z.filter(H=>!d.some(K=>K.mxikCode===H.mxikCode));g([...Z]),i([...Z,...d])}},q=w=>{w!=_&&S(""),/^[a-zA-Z]+$/.test(w)?(console.log("тексе"),a!="Расширинный по тексту"&&a!="По бренду"&&a!="По номеру рег. удостовирения"&&a!="По MHH"&&(c("По тексту"),S(""))):/^\d+$/.test(w)?(console.log("число"),w.length<=4?(c("По ТН ВЭД"),S(""),console.log("По ТН ВЭД")):w.length>4&&w.length<=13?(console.log("По штрих-коду"),S(""),c("По штрих-коду")):w.length>13&&w.length<=17?(c("По ИКПУ"),S(""),console.log("По ИКПУ")):w.length>17?(console.log("value",w),console.log("код ИКПУ не валидный"),S("код ИКПУ не валидный")):S("Введен невалидный символ")):a!="Расширинный по тексту"&&a!="По бренду"&&a!="По номеру рег. удостовирения"&&a!="По MHH"&&c("По тексту"),n(w)};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.nav,children:[y&&t.jsx(bo,{}),t.jsxs("form",{action:"",className:s.nav_form,onSubmit:w=>P(w),children:[t.jsxs("div",{className:s.nav_form_left,children:[t.jsxs("ul",{className:s.nav_buttons,children:[t.jsx("li",{children:t.jsxs(D,{className:`${s.back} ${s.nav_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(R,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(D,{to:"/addingProducts/settingsAddProducts",className:`${s.nav_linkBtn} ${s.nav_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(R,{name:"Cog8ToothIcon",className:s.nav_buttons_iconSetting})]})})]}),t.jsxs("fieldset",{children:[t.jsx("input",{value:_,type:"text",className:s.nav_form_input,placeholder:a,onChange:w=>q(w.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.nav_form_btn,children:"Поиск"})]})]}),B.length>0&&d.length>0&&t.jsx(qs,{}),t.jsx("ul",{className:s.nav_form_list,children:f==null?void 0:f.map(w=>t.jsx("li",{children:t.jsxs("label",{className:s.nav_form_check,children:[t.jsx("input",{type:"radio",name:"search",value:w.title,onClick:v=>O(v)}),t.jsx("span",{className:s.nav_form_check_text,children:w.title})]})},w.id))})]}),t.jsx("span",{className:s.nav_error,children:N})]})})}function po({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsx("div",{className:s.left_content,children:e.map(o=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:o.title}),t.jsx("p",{children:o.value})]},o.id))})})}function ho(){const{imagesSrc:e,setImagesSrc:o}=C(),[a,c]=u.useState(null),_=u.useRef([]),n=l=>{_.current.forEach(r=>{r&&r.getAttribute("id")==l&&r.click()})};function f(l,r){c(r)}function d(l){l.target.style.background="white"}function i(l){l.target.style.background="white"}function h(l){l.preventDefault(),l.target.style.background="lightgray"}function b(l,r){l.preventDefault(),l.target.style.background="white";const k=e.map(m=>m.id===r.id?{...m,order:(a==null?void 0:a.order)||m.order}:m.id===(a==null?void 0:a.id)?{...m,order:r.order}:m);o(k),c(null)}function p(l,r){return l.order>r.order?1:-1}const g=l=>{var k,m;const r=(m=(k=l==null?void 0:l.target)==null?void 0:k.files)==null?void 0:m[0];if(r&&(r==null?void 0:r.type)==="image/jpeg"||(r==null?void 0:r.type)==="image/png"||(r==null?void 0:r.type)==="image/webp"){const j=l.target.getAttribute("id"),y=[...e],M=y.find(x=>x.id==j),I=y.findIndex(x=>x.id==j);if(M){const x=new FileReader;x.onload=N=>{var S;(S=N.target)!=null&&S.result&&(M.src=URL.createObjectURL(r),y.splice(I,1,M),o([...y]))},x.readAsDataURL(r)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(p).map((l,r)=>{var k;return t.jsxs("div",{draggable:!0,onDragStart:m=>f(m,l),onDragLeave:m=>d(m),onDragEnd:m=>i(m),onDragOver:m=>h(m),onDrop:m=>b(m,l),className:r==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>n(l.id),children:[t.jsx("input",{id:l.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:g,ref:m=>{_.current[r]=m}}),t.jsx("img",{src:l.src=="/noPhoto.jpg"||((k=l.src)==null?void 0:k.toString().split(":")[0])=="blob"?l.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+l.src,width:r==0?150:50,height:r==0?150:50,alt:"",className:`${r==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},l.id)})})})})}function xo({addingImgToProduct:e,handleCancel:o}){const{ikpuStatus:a}=C();return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(D,{to:"#",className:s.ikpuWrapper_save,onClick:c=>e(c),children:"Coхранить"}),a.type==="info photo"&&t.jsx(D,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(D,{to:"#",onClick:c=>o(c),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const J=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:3,title:"Группа:",value:""},{id:4,title:"Класс:",value:""},{id:5,title:"Позиция:",value:""},{id:6,title:"Субпозиция:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""},{id:9,title:"Описание:",value:""}];function ko(){const{searchResponseItem:e,imagesSrc:o,setImagesSrc:a,setSearchResponseItem:c,setIkpuStatus:_,ikpuStatus:n}=C(),[f,d]=u.useState([]);u.useEffect(()=>{if(e){const b=J==null?void 0:J.map(p=>{let g;return p.title=="ИКПУ:"&&(g=e.mxikCode),p.title=="Штрих-код:"&&(g=e.internationalCode),p.title=="Группа:"&&(g=e.groupName),p.title=="Класс:"&&(g=e.className),p.title=="Позиция:"&&(g=e.positionName),p.title=="Субпозиция:"&&(g=e.subPositionName),p.title=="Наименование:"&&(g=e.className),p.title=="Бренд:"&&(g=e.brandName),p.title=="Описание:"&&(g=e.attributeName),{id:p.id,title:p.title,value:g}});d([...b])}},[e]),u.useEffect(()=>{if(e.photos){const b=o.map((p,g)=>{var l,r;return{id:p.id,order:p.order,src:(l=e==null?void 0:e.photos)!=null&&l[g]?(r=e==null?void 0:e.photos)==null?void 0:r[g]:"/noPhoto.jpg"}});b&&a(b)}},[]);const i=b=>{b.preventDefault();const p=o==null?void 0:o.map(g=>g.src);e.photos=p,c(e),_({status:!1,type:""})};function h(b){b.preventDefault();const p=o.map(g=>({id:g.id,order:g.order,src:g.src}));a(p),_({status:!1,type:""})}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:h,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:b=>b.stopPropagation(),style:{width:n.type==="info photo"?"700px":"250px",minHeight:n.type==="info photo"?"500px":"400px"},children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[n.type==="info photo"&&t.jsx(po,{staticList:f}),t.jsx(ho,{})]}),t.jsx(xo,{addingImgToProduct:i,handleCancel:h})]})})})}function jo({item:e}){const{TemporaryData:o,setTemporaryData:a}=C(),[c,_]=u.useState(e.crmArrivalPrice??"0"),[n,f]=u.useState(""),[d,i]=u.useState(!1),h=l=>{if(/^[a-zA-Z]+$/.test(l))f("Введите число");else if(/^\d+$/.test(l))if(l.length==2&&l[0]=="0"){const r=l[1];_(r),f(""),b(r)}else f(""),_(l),b(l);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(l)?f("Введите число"):l==""&&(b("0"),f(""),_("0"))},b=l=>{o.forEach(r=>{r.id==e.id&&(r.crmArrivalPrice=Number(l))}),a([...o])},p=()=>{i(!0)},g=()=>{i(!1)};return t.jsxs("div",{children:[t.jsx("span",{className:s.table_body_error,children:n}),t.jsx("input",{type:"text",value:c,onFocus:p,onBlur:g,className:`${s.table_body_amount} ${d?s.table_body_amount_focused:""}`,onChange:l=>h(l.target.value)})]})}function yo({item:e}){const{TemporaryData:o,setTemporaryData:a}=C(),[c,_]=u.useState(e.crmSellingPrice??"0"),[n,f]=u.useState(""),[d,i]=u.useState(!1),h=l=>{if(/^[a-zA-Z]+$/.test(l))f("Введите число");else if(/^\d+$/.test(l))if(l.length==2&&l[0]=="0"){const r=l[1];_(r),f(""),b(r)}else f(""),_(l),b(l);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(l)?f("Введите число"):l==""&&(b("0"),f(""),_("0"))},b=l=>{o.forEach(r=>{r.id==e.id&&(r.crmSellingPrice=Number(l))}),a([...o])},p=()=>{i(!0)},g=()=>{i(!1)};return t.jsxs("div",{children:[t.jsx("span",{className:s.table_body_error,children:n}),t.jsx("input",{type:"text",value:c,onFocus:p,onBlur:g,className:`${s.table_body_amount} ${d?s.table_body_amount_focused:""}`,onChange:l=>h(l.target.value)})]})}function Po({item:e}){const{TemporaryData:o,setTemporaryData:a}=C(),[c,_]=u.useState(e.crmAmount??"0"),[n,f]=u.useState(""),[d,i]=u.useState(!1),h=l=>{if(/^[a-zA-Z]+$/.test(l))f("Введите число");else if(/^\d+$/.test(l))if(l.length==2&&l[0]=="0"){const r=l[1];_(r),f(""),b(r)}else f(""),_(l),b(l);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(l)?f("Введите число"):l==""&&(b("0"),f(""),_("0"))},b=l=>{o.forEach(r=>{r.id==e.id&&(r.crmAmount=Number(l))}),a([...o])},p=()=>{i(!0)},g=()=>{i(!1)};return t.jsxs("div",{children:[t.jsx("span",{className:s.table_body_error,children:n}),t.jsx("input",{onFocus:p,onBlur:g,type:"text",value:c,className:`${s.table_body_amount} ${d?s.table_body_amount_focused:""}`,onChange:l=>h(l.target.value)})]})}function vo({item:e}){const{TemporaryData:o,setTemporaryData:a}=C(),[c,_]=u.useState(e.crmNameProduct??""),[n,f]=u.useState(!1),[d,i]=u.useState(""),[h,b]=u.useState(!1);u.useEffect(()=>{g(c)},[c]);const p=j=>{_(j),i("")},g=j=>{o.forEach(y=>{y.id==e.id&&(y.crmNameProduct=j)}),a([...o])},l=()=>{console.log("hover"),f(!0)},r=()=>{console.log("hover"),f(!1)},k=()=>{b(!0)},m=()=>{b(!1)};return e.createdByHand===!0?t.jsxs("div",{className:s.table_body_nameBlock,children:[t.jsx("span",{className:s.table_body_error,children:d}),t.jsx("textarea",{onChange:j=>p(j.target.value),value:`${c}`,onFocus:k,onBlur:m,className:`${s.table_body_name} ${h?s.table_body_name_focused:""}`,placeholder:e!=null&&e.subPositionName?e==null?void 0:e.subPositionName:e.crmNameProduct?e.crmNameProduct:"Добавьте наименование",children:c})]}):t.jsxs("div",{className:s.table_body_nameBlock,children:[n&&t.jsx("span",{className:s.table_body_nameHover,children:e.subPositionName}),t.jsx("span",{onMouseEnter:l,onMouseLeave:r,className:s.table_body_nameString,children:e.subPositionName})]})}const No=(e=0,o=9)=>Math.floor(Math.random()*(o+1-e)+e).toString();function st(e=13){let o="";for(let a=1;a<=e;a++){const c=No();o+=c}return o}function So({i:e,item:o}){const{TemporaryData:a,setTemporaryData:c}=C(),[_,n]=u.useState(""),[f,d]=u.useState(""),[i,h]=u.useState(!1),b=u.useRef(null);u.useEffect(()=>{var m;b!=null&&b.current&&e==0&&((m=b==null?void 0:b.current)==null||m.focus())},[b]);const p=m=>{/^[a-zA-Z]+$/.test(m)?d("Введите число"):/^\d+$/.test(m)?(d(""),n(m)):/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(m)?d("Введите число"):m==""&&(d(""),n(m))},g=()=>{const j=13-_.split("").length,y=j>0?st(j):st(),M=j>0?_+y:y;n(M)},l=()=>{if(_.length==13)a.forEach(m=>{m.id==o.id&&(m.internationalCode=_)}),c([...a]);else{const m=13-_.length;d(`Еще ${m} символов`)}},r=()=>{h(!0)},k=()=>{h(!1)};return t.jsxs("div",{children:[t.jsx("span",{className:s.table_body_error,children:f}),t.jsx("input",{type:"text",onChange:m=>p(m.target.value),maxLength:13,value:_,ref:b,onFocus:r,onBlur:k,className:`${s.table_body_barcode} ${i?s.table_body_barcode_focused:""}`}),t.jsxs("div",{className:s.table_body_buttons,children:[t.jsx("button",{className:s.table_body_generation,onClick:g,children:"Генерировать"}),t.jsx("button",{className:s.table_body_barcodeSave,onClick:l,children:"Сохранить"})]})]})}function Mo({item:e}){const{TemporaryData:o,setTemporaryData:a}=C(),[c,_]=u.useState(e.crmQR??!1);u.useEffect(()=>{n(c)},[c]);const n=f=>{o.forEach(d=>{d.id==e.id&&(d.crmQR=f)}),a([...o])};return t.jsxs("div",{className:s.table_body_qr,onClick:()=>_(!c),children:[c&&t.jsx(R,{name:"PlusIcon"}),!c&&t.jsx(R,{name:"MinusIcon"}),t.jsx(it,{status:c,width:50})]})}const wo="_modalCategory_5j9ek_1",Co="_modalCategory_block_5j9ek_10",$o="_modalCategory_nav_5j9ek_16",Io="_modalCategory_nav_title_5j9ek_23",Eo="_modalCategory_nav_close_5j9ek_29",Ao="_modalCategory_content_5j9ek_32",Do="_modalCategory_content_message_5j9ek_39",To="_modalCategory_content_link_5j9ek_47",Ro="_modalCategory_content_link_active_5j9ek_76",Bo="_modalCategory_content_item_5j9ek_86",Fo="_modalCategory_content_block_5j9ek_108",Lo="_modalCategory_content_block_title_5j9ek_112",Wo="_settings_5j9ek_120",zo="_settings_title_5j9ek_123",Ho="_settings_content_5j9ek_128",qo="_settings_content_top_5j9ek_131",Uo="_settings_content_buttons_5j9ek_134",Go="_settings_content_btn_5j9ek_144",Oo="_settings_content_btn_cancel_5j9ek_156",Zo="_settings_content_btn_save_5j9ek_159",Xo="_settings_tools_5j9ek_162",Vo="_settings_tools_link_5j9ek_167",Qo="_settings_tools_link_active_5j9ek_182",$={modalCategory:wo,modalCategory_block:Co,modalCategory_nav:$o,modalCategory_nav_title:Io,modalCategory_nav_close:Eo,modalCategory_content:Ao,modalCategory_content_message:Do,modalCategory_content_link:To,modalCategory_content_link_active:Ro,modalCategory_content_item:Bo,modalCategory_content_block:Fo,modalCategory_content_block_title:Lo,settings:Wo,settings_title:zo,settings_content:Ho,settings_content_top:qo,settings_content_buttons:Uo,settings_content_btn:Go,settings_content_btn_cancel:Oo,settings_content_btn_save:Zo,settings_tools:Xo,settings_tools_link:Vo,settings_tools_link_active:Qo};function Ko({setCancel:e}){return t.jsxs("div",{className:$.modalCategory_nav,children:[t.jsx("h2",{className:$.modalCategory_nav_title,children:"Котегория"}),t.jsx("button",{className:$.modalCategory_nav_close,onClick:e,children:t.jsx(R,{width:24,height:24,name:"XMarkIcon"})})]})}async function Jo(e,o){try{return await X.get(`categories?page=${e}&perPage=${o}`)}catch(a){console.log("Ошибка при получении супер категорий при добавлении продукта на склад",a)}}function Yo({superId:e,setSuperId:o,setCategoryId:a}){const[c,_]=u.useState(1),[n,f]=u.useState(1),[d]=u.useState(10),[i,h]=u.useState([]);u.useEffect(()=>{b(c,d)},[]);async function b(l,r){var y,M;const k=await Jo(l,r),m=await((y=k==null?void 0:k.data)==null?void 0:y.pagination),j=await((M=k==null?void 0:k.data)==null?void 0:M.data);f(m.total_pages),h([...i,...j])}const p=l=>{l.preventDefault();const r=c+1;_(r),b(r,d),console.log("addPage",r)},g=l=>{a(0),o(l)};return t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Суперкотегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[i==null?void 0:i.map(l=>t.jsxs(D,{to:"#",className:`${$.modalCategory_content_link} ${l.id==e?$.modalCategory_content_link_active:""} `,onClick:r=>g(l.id),children:[l.name.ru,t.jsx(R,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},l.id)),c<n&&t.jsx(D,{to:"#",className:$.modalCategory_content_link,onClick:l=>p(l),children:"Ещё..."})]})]})}async function ta(e,o,a){try{return await X.get(`categories?parentId=${a}&page=${e}&perPage=${o}`)}catch(c){console.log("Ошибка при получении категорий при добавлении продукта на склад",c)}}function ea({superId:e,categoryId:o,setCategoryId:a,setSubId:c}){const[_,n]=u.useState([]),[f,d]=u.useState(1),[i,h]=u.useState(1),[b]=u.useState(10);u.useEffect(()=>{n([]),d(1),e!==0&&p(1,10)},[e]);async function p(r,k){var M,I;const m=await ta(r,k,e),j=await((M=m==null?void 0:m.data)==null?void 0:M.pagination),y=await((I=m==null?void 0:m.data)==null?void 0:I.data);h(j.total_pages),n(x=>[...x,...y])}const g=r=>{r.preventDefault();const k=f+1;d(k),p(k,b)},l=r=>{c(0),a(r)};return _.length>0&&t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Котегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[_==null?void 0:_.map(r=>t.jsxs(D,{to:"#",className:`${$.modalCategory_content_link} ${r.id==o?$.modalCategory_content_link_active:""} `,onClick:k=>l(r.id),children:[r.name.ru,t.jsx(R,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},r.id)),f<i&&t.jsx(D,{to:"#",className:$.modalCategory_content_link,onClick:r=>g(r),children:"Ещё..."})]})]})}async function sa(e,o,a){try{return await X.get(`categories?parentId=${a}&page=${e}&perPage=${o}`)}catch(c){console.log("Ошибка при получении субкатегорий при добавлении продукта на склад",c)}}function oa({categoryId:e,subId:o,setSubId:a,setPickedCategory:c}){const[_,n]=u.useState([]),[f,d]=u.useState(1),[i,h]=u.useState(1),[b]=u.useState(10);u.useEffect(()=>{n([]),d(1),e!==0&&p(1,10)},[e]);async function p(r,k){var M,I;const m=await sa(r,k,e),j=await((M=m==null?void 0:m.data)==null?void 0:M.pagination),y=await((I=m==null?void 0:m.data)==null?void 0:I.data);h(j.total_pages),n(x=>[...x,...y])}const g=r=>{r.preventDefault();const k=f+1;d(k),p(k,b)},l=(r,k)=>{r.preventDefault(),a(k.id),c(k)};return _.length>0&&t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Подкотегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[_==null?void 0:_.map(r=>t.jsxs(D,{to:"#",className:`${$.modalCategory_content_link} ${r.id==o?$.modalCategory_content_link_active:""} `,onClick:k=>l(k,r),children:[r.name.ru,t.jsx(R,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},r.id)),f<i&&t.jsx(D,{to:"#",className:$.modalCategory_content_link,onClick:r=>g(r),children:"Ещё..."})]})]})}function aa({setPickedSubCategoryToProduct:e,setCancel:o}){return t.jsxs("div",{className:$.settings_content_buttons,children:[t.jsx(D,{to:"#",className:`${$.settings_content_btn} ${$.settings_content_btn_save}`,onClick:a=>e(a),children:"Сохранить"}),t.jsx("button",{className:`${$.settings_content_btn} ${$.settings_content_btn_cancel}`,onClick:o,children:"Отмена"})]})}function na({item:e,setModalStatus:o}){const{TemporaryData:a,setTemporaryData:c}=C(),[_,n]=u.useState(""),[f,d]=u.useState(!1),[i,h]=u.useState(0),[b,p]=u.useState(0),[g,l]=u.useState(0),[r,k]=u.useState({});u.useEffect(()=>{console.log("pickedCategory",r)},[r]);function m(y){if(y.preventDefault(),i===0){d(!0),n("Выберите Суперкотегорию");return}else if(b===0){d(!0),n("Выберите Категорию");return}else if(g===0){d(!0),n("Выберите Подкотегорию");return}else a.forEach(M=>{M.id===e.id&&(M.crmCategory=r)}),c([...a]),j()}const j=()=>{h(0),p(0),l(0),n(""),d(!1),k({}),o(!1)};return t.jsx("div",{className:$.modalCategory,onClick:j,children:t.jsxs("div",{className:$.modalCategory_block,onClick:y=>y.stopPropagation(),children:[t.jsx(Ko,{setCancel:j}),t.jsx("p",{className:$.modalCategory_content_message,children:_||""}),t.jsxs("div",{className:$.modalCategory_content,children:[t.jsx(Yo,{superId:i,setSuperId:h,setCategoryId:p}),t.jsx(ea,{superId:i,categoryId:b,setCategoryId:p,setSubId:l}),t.jsx(oa,{categoryId:b,subId:g,setSubId:l,setPickedCategory:k}),t.jsx(aa,{setPickedSubCategoryToProduct:m,setCancel:j})]})]})})}function ca({item:e}){var i,h,b;const[o,a]=u.useState(!1),[c,_]=u.useState(!1),n=()=>{a(!0)},f=()=>{console.log("hover"),_(!0)},d=()=>{console.log("hover"),_(!1)};return t.jsxs("div",{className:s.table_body_category,children:[o&&t.jsx(na,{item:e,setModalStatus:a}),c&&t.jsx("span",{className:s.table_body_nameHover,children:(i=e==null?void 0:e.crmCategory)!=null&&i.name.ru?e==null?void 0:e.crmCategory.name.ru:""}),t.jsx("span",{className:s.table_body_category_span,onMouseEnter:f,onMouseLeave:d,children:(h=e==null?void 0:e.crmCategory)!=null&&h.name.ru?e==null?void 0:e.crmCategory.name.ru:""}),t.jsx("button",{onClick:n,className:s.table_body_category_btn,children:t.jsx("span",{children:(b=e==null?void 0:e.crmCategory)!=null&&b.name.ru?"Изменить":"Выбрать"})})]})}const la=[{id:U(),title:"шт.",isActive:!0,navIcon:""},{id:U(),title:"лт.",isActive:!0,navIcon:""},{id:U(),title:"кг.",isActive:!0,navIcon:""}];function ra({item:e}){const[o,a]=u.useState(!1),[c,_]=u.useState([...la]),{TemporaryData:n,setTemporaryData:f}=C(),[d,i]=u.useState("шт.");u.useEffect(()=>{h()},[d]);const h=()=>{n.forEach(b=>{if(b.id==e.id){const p=[{code:0,mxikCode:e.mxikCode,nameLat:"",nameRu:d,nameUz:"",packageType:""}];b.packageNames=p}}),f([...n]),a(!1)};return t.jsx("div",{className:s.table_body_unit,children:t.jsx(dt,{className:s.table_body_unit_dropdown,width:"100px",openBlock:o,setOpenBlock:a,versionList:c,setVersionList:_,currentVersion:d,setCurrentVersion:i})})}function _a({i:e,item:o,column:a}){const{ikpuStatus:c,setSearchResponseItem:_,setIkpuStatus:n,setTemporaryData:f,TemporaryData:d}=C();u.useEffect(()=>{e==0&&(d.forEach(g=>{g.id==o.id?g.crmBlockFocused=!0:g.crmBlockFocused=!1}),f([...d]))},[]);const i=u.useRef(null);u.useEffect(()=>{i.current&&(o.crmCheckbox===!0?(console.log("item.crmCheckbox true",o.crmCheckbox),i.current.checked=!0):(console.log("item.crmCheckbox false",o.crmCheckbox),i.current.checked=!1))},[i,o.crmCheckbox]);const h=g=>{const l=g;d.forEach(r=>{r.id===o.id&&(r.crmCheckbox=g)}),f([...d]),console.log("checed",l)},b=(g,l)=>{l==="info photo"?(_(g),n({status:!c.status,type:"info photo"})):l==="photo"&&(_(g),n({status:!c.status,type:"photo"}))},p=()=>{d.forEach(g=>{g.id==o.id?g.crmBlockFocused=!0:g.crmBlockFocused=!1}),f([...d])};return t.jsxs("tr",{"data-id":o==null?void 0:o.id,className:`${s.table_body_row} ${o.crmBlockFocused?s.table_body_row_focus:""}  ${o.crmCheckbox?s.table_body_row_checked:""}`,style:{gridTemplateColumns:`110px repeat(${a.length}, 200px) 110px`},onClick:p,children:[t.jsx("td",{className:`${s.table_body_col} ${s.table_body_minCol_check}`,children:t.jsx("label",{children:t.jsx("input",{type:"checkbox",ref:i,onChange:g=>h(g.target.checked)})})}),a==null?void 0:a.map(g=>{var l,r,k,m,j,y,M,I;return t.jsxs("td",{"data-id":o==null?void 0:o.id,className:s.table_body_col,children:[(g==null?void 0:g.title)=="Количество"&&t.jsx(Po,{item:o}),(g==null?void 0:g.title)=="Приходная цена"&&t.jsx(jo,{item:o}),(g==null?void 0:g.title)=="Продажная цена"&&t.jsx(yo,{item:o}),(g==null?void 0:g.title)=="Наименование"&&t.jsx(vo,{item:o}),(g==null?void 0:g.title)=="Фото"?t.jsx("img",{onClick:()=>b(o,"photo"),src:((l=o.photos)==null?void 0:l[0])=="/noPhoto.jpg"?(r=o.photos)==null?void 0:r[0]:((k=o.photos)==null?void 0:k.length)==0?"/noPhoto.jpg":(j=(m=o.photos)==null?void 0:m[0])!=null&&j.startsWith("blob")?(y=o.photos)==null?void 0:y[0]:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+((M=o.photos)==null?void 0:M[0]),width:40,height:40,alt:"",className:s.table_body_img}):"",(g==null?void 0:g.title)=="QR Код"&&t.jsx(Mo,{item:o}),(g==null?void 0:g.title)=="Ед.измерения"&&(o.createdByHand===!0?t.jsx(ra,{item:o}):((I=o==null?void 0:o.packageNames)==null?void 0:I[0].nameRu)??"-"),(g==null?void 0:g.title)=="ИКПУ"&&(o==null?void 0:o.mxikCode),(g==null?void 0:g.title)=="Подкатегория"&&t.jsx(ca,{item:o}),(g==null?void 0:g.title)=="Штрих-код"&&(o!=null&&o.internationalCode?o==null?void 0:o.internationalCode:t.jsx(So,{item:o,i:e}))]},g==null?void 0:g.id)}),t.jsx("td",{className:`${s.table_body_minCol} ${s.table_body_minCol_still}`,children:t.jsx("span",{onClick:()=>b(o,"info photo"),className:s.table_body_still,children:t.jsx(R,{name:"EllipsisHorizontalIcon",className:s.table_body_icon})})})]})}function ia({column:e}){const{TemporaryData:o,setTemporaryData:a}=C(),c=u.useRef(null);u.useEffect(()=>{o.some(n=>n.crmCheckbox===!1)?c.current&&(c.current.checked=!1):c.current&&(c.current.checked=!0)},[o]);const _=n=>{o.forEach(f=>{f.crmCheckbox=n}),a([...o])};return console.log("перерисовался",o),t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsxs("tr",{className:s.table_head_row,style:{gridTemplateColumns:`110px repeat(${e.length}, 200px) 110px`},children:[t.jsx("td",{className:`${s.table_head_minCol} ${s.table_head_minCol_check}`,children:t.jsx("input",{ref:c,type:"checkbox",onChange:n=>_(n.target.checked)})}),e==null?void 0:e.map(n=>t.jsx("td",{className:s.table_head_col,children:n.title},n.id)),t.jsx("td",{className:`${s.table_head_minCol} ${s.table_head_minCol_still}`,children:"Ещё"})]})}),t.jsx("tbody",{className:s.table_body,children:o==null?void 0:o.map((n,f)=>t.jsx(_a,{item:n,column:e,i:f},n==null?void 0:n.id))})]})}function da({clearTable:e,setData:o}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:o,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:a=>e(a),children:"Отмена"})]})}function ua(){const e=u.useRef(null),[o,a]=u.useState(!1),[c,_]=u.useState(0),[n,f]=u.useState(0),d=x=>{e.current&&(a(!0),_(x.pageX-e.current.offsetLeft),f(e.current.scrollLeft))},i=()=>{a(!1)},h=()=>{a(!1)},b=x=>{if(!o||!e.current)return;x.preventDefault();const S=(x.pageX-e.current.offsetLeft-c)*2;e.current.scrollLeft=n-S},{settingsParams:p,ikpuStatus:g,TemporaryData:l,setTemporaryData:r,setCheckedProducts:k}=C(),[m,j]=u.useState([]);u.useEffect(()=>{const x=p.filter(N=>N.checked);j(()=>[...x])},[p]);const y=async x=>{x.preventDefault();for(const N of l)await M(N)};async function M(x){var N,S,B;try{const L=V.get("multi-store"),O={multiStoreId:Number(L),categoryId:Number((N=x==null?void 0:x.crmCategory)==null?void 0:N.id),barcode:Number(x==null?void 0:x.internationalCode),nameUz:"string",nameUzc:"string",nameRu:x.subPositionName?x.subPositionName:(S=x==null?void 0:x.crmNameProduct)==null?void 0:S.toString(),mxik:(B=x==null?void 0:x.mxikCode)==null?void 0:B.toString(),brand:x.brandName??null,oldPrice:Number(x==null?void 0:x.crmArrivalPrice),price:Number(x==null?void 0:x.crmSellingPrice),oldPriceCourse:0,priceCourse:0,nds:0,discount:0};await X.post("nomenclatures",O),r([]),k([])}catch(L){console.log(`Ошибка произошла при попытке добавить ${x==null?void 0:x.crmNameProduct} на сервер`,L)}}const I=x=>{x.preventDefault(),r([]),k([])};return t.jsxs("div",{className:s.formWrapper,children:[t.jsxs("div",{className:s.found,ref:e,onMouseDown:d,onMouseLeave:i,onMouseUp:h,onMouseMove:b,children:[g.status===!0&&t.jsx(ko,{}),t.jsx(ia,{column:m})]}),t.jsx(da,{clearTable:I,setData:y})]})}const fa="_layout_1k6jw_1",ga="_layout_back_1k6jw_4",ba="_layout_title_1k6jw_14",ma="_layout_list_1k6jw_19",pa="_layout_link_1k6jw_25",ha="_layout_link_active_1k6jw_35",xa="_form_list_1k6jw_39",ka="_form_check_1k6jw_44",ja="_navSetting_1k6jw_54",ya="_found_1k6jw_58",Pa="_table_1k6jw_79",va="_table_head_1k6jw_83",Na="_table_head_row_1k6jw_86",Sa="_table_head_col_1k6jw_90",Ma="_addSettings_list_1k6jw_94",wa="_addSettings_li_1k6jw_94",A={layout:fa,layout_back:ga,layout_title:ba,layout_list:ma,layout_link:pa,layout_link_active:ha,form_list:xa,form_check:ka,navSetting:ja,found:ya,table:Pa,table_head:va,table_head_row:Na,table_head_col:Sa,addSettings_list:Ma,addSettings_li:wa},Ca=[{id:1,title:"отображения колонок",href:"/addingProducts/settingsAddProducts"},{id:2,title:"настройки",href:"/addingProducts/settingsAddProducts/settings"}];function $a(){const o=Q().pathname;return t.jsxs("nav",{className:A.layout,children:[t.jsx(D,{className:A.layout_back,to:"/addingProducts",children:"Закрыть"}),t.jsx("h2",{className:A.layout_title,children:"Настройки"}),t.jsx("ul",{className:A.layout_list,children:Ca.map(a=>t.jsx("li",{children:t.jsx(D,{to:a.href,className:`${A.layout_link} ${a.href==o?A.layout_link_active:""}`,children:a.title})},a.id))})]})}function Ia(){const e=u.useRef([]),{necessarilySettings:o,settingsParams:a,setSettingsParams:c}=C();u.useEffect(()=>{e.current.forEach((n,f)=>{n&&(n.checked=a[f].checked,o.forEach(d=>{n.value==d&&(n.checked=!0)}))})},[a]);const _=n=>{const f=a.map(d=>({id:d.id,title:d.title,checked:d.title==n.currentTarget.value?n.currentTarget.checked:d.checked}));c(f)};return t.jsx("nav",{className:A.navSetting,children:t.jsx("form",{action:"",className:A.form,children:t.jsx("ul",{className:A.form_list,children:a==null?void 0:a.map((n,f)=>t.jsx("li",{children:t.jsxs("label",{className:A.form_check,children:[t.jsx("input",{type:"checkbox",value:n.title,ref:d=>{e.current[f]=d},onChange:d=>_(d)}),t.jsx("span",{className:A.form_check_text,children:n.title})]})},n.id))})})})}function Ea(){const{globalRemember:e,setGlobalRemember:o,programRemember:a,setProgramRemember:c}=C(),_=n=>{console.log("val",n),n==="program"?c(!a):n==="global"&&o(!e)};return t.jsx("div",{className:A.addSettings,children:t.jsx("div",{className:"container",children:t.jsxs("ul",{className:A.addSettings_list,children:[t.jsxs("li",{className:A.addSettings_li,onClick:()=>_("program"),children:[t.jsx("span",{className:A.addSettings_span,children:"Отменить выбор программного поиска"}),t.jsx("input",{type:"checkbox",className:A.addSettings_input,checked:a,readOnly:!0})]}),t.jsxs("li",{className:A.addSettings_li,onClick:()=>_("global"),children:[t.jsx("span",{className:A.addSettings_span,children:"Отменить выбор глобального поиска"}),t.jsx("input",{type:"checkbox",className:A.addSettings_input,checked:e,readOnly:!0})]})]})})})}function Aa(){const{settingsParams:e}=C(),a=Q().pathname,[c,_]=u.useState([]);return u.useEffect(()=>{const n=e.filter(f=>f.checked);_(()=>[...n])},[e]),t.jsxs("div",{className:"container",children:[t.jsx($a,{}),a=="/addingProducts/settingsAddProducts"&&t.jsx(Ia,{}),a=="/addingProducts/settingsAddProducts/settings"&&t.jsx(Ea,{}),t.jsx("section",{className:A.found,children:t.jsxs("table",{className:A.table,children:[t.jsx("thead",{className:A.table_head,children:t.jsx("tr",{className:A.table_head_row,style:{gridTemplateColumns:`repeat(${c.length}, 200px)`},children:c==null?void 0:c.map(n=>t.jsx("td",{className:A.table_head_col,children:n.title},n.id))})}),t.jsx("tbody",{className:A.table_body,children:t.jsx("tr",{className:A.table_body_row,children:t.jsx("td",{className:A.table_body_col})})})]})})]})}function Da({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsxs("div",{className:s.left_content,children:[e.map(o=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:o.title}),t.jsx("p",{children:o.value})]},o.id)),t.jsx("span",{style:{fontSize:"14px"},children:"(нужны картинки с сервера при get, post, patch запрсе по name)"})]})})}function Ta(){const{stockImagesSrc:e,setStockImagesSrc:o}=C(),[a,c]=u.useState(null),_=u.useRef([]),n=l=>{_.current.forEach(r=>{r&&r.getAttribute("id")==l&&r.click()})};function f(l,r){c(r)}function d(l){l.target.style.background="white"}function i(l){l.target.style.background="white"}function h(l){l.preventDefault(),l.target.style.background="lightgray"}function b(l,r){l.preventDefault(),l.target.style.background="white";const k=e.map(m=>m.id===r.id?{...m,order:(a==null?void 0:a.order)||m.order}:m.id===(a==null?void 0:a.id)?{...m,order:r.order}:m);o(k),c(null)}function p(l,r){return l.order>r.order?1:-1}const g=l=>{var k,m;const r=(m=(k=l==null?void 0:l.target)==null?void 0:k.files)==null?void 0:m[0];if(r&&(r==null?void 0:r.type)==="image/jpeg"||(r==null?void 0:r.type)==="image/png"||(r==null?void 0:r.type)==="image/webp"){const j=l.target.getAttribute("id"),y=[...e],M=y.find(x=>x.id==j),I=y.findIndex(x=>x.id==j);if(M){const x=new FileReader;x.onload=N=>{var S;(S=N.target)!=null&&S.result&&(M.src=URL.createObjectURL(r),y.splice(I,1,M),o([...y]))},x.readAsDataURL(r)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(p).map((l,r)=>{var k;return t.jsxs("div",{draggable:!0,onDragStart:m=>f(m,l),onDragLeave:m=>d(m),onDragEnd:m=>i(m),onDragOver:m=>h(m),onDrop:m=>b(m,l),className:r==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>n(l.id),children:[t.jsx("input",{id:l.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:g,ref:m=>{_.current[r]=m}}),t.jsx("img",{src:l.src=="/noPhoto.jpg"||((k=l.src)==null?void 0:k.toString().split(":")[0])=="blob"?l.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+l.src,width:r==0?150:50,height:r==0?150:50,alt:"",className:`${r==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},l.id)})})})})}function Ra({addingImgToProduct:e,handleCancel:o}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(D,{to:"#",className:s.ikpuWrapper_save,onClick:a=>e(a),children:"Coхранить"}),t.jsx(D,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(D,{to:"#",onClick:a=>o(a),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const Y=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""}];function Ba(){const{searchResponseItem:e,stockImagesSrc:o,setStockImagesSrc:a,setSearchResponseItem:c,setStockIkpuStatus:_}=C(),[n,f]=u.useState([]);u.useEffect(()=>{if(e){const h=Y==null?void 0:Y.map(b=>{var g;let p;return b.title=="ИКПУ:"&&(p=e.mxik),b.title=="Штрих-код:"&&(p=e.barcode),b.title=="Группа:"&&(p=e.groupName),b.title=="Класс:"&&(p=e.className),b.title=="Позиция:"&&(p=e.positionName),b.title=="Субпозиция:"&&(p=e.subPositionName),b.title=="Наименование:"&&(p=(g=e.name)==null?void 0:g.ru),b.title=="Бренд:"&&(p=e.brand),b.title=="Описание:"&&(p=e.description),{id:b.id,title:b.title,value:p}});f([...h])}},[e]),u.useEffect(()=>{if(e.photos){const h=o.map((b,p)=>{var g,l;return{id:b.id,order:b.order,src:(g=e==null?void 0:e.photos)!=null&&g[p]?(l=e==null?void 0:e.photos)==null?void 0:l[p]:"/noPhoto.jpg"}});h&&a(h)}},[]);const d=h=>{h.preventDefault();const b=o==null?void 0:o.map(p=>p.src);e.photos=b,c(e),_(!1)};function i(h){h.preventDefault();const b=o.map(p=>({id:p.id,order:p.order,src:p.src}));a(b),_(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:i,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:h=>h.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(Da,{staticList:n}),t.jsx(Ta,{})]}),t.jsx(Ra,{addingImgToProduct:d,handleCancel:i})]})})})}function Fa({item:e}){const[o,a]=u.useState(e.oldPrice),{stockTemporaryData:c,setStockTemporaryData:_}=C(),n=f=>{const d=f.target.value;a(Number(d));const i=c.filter(b=>b.id==e.id)[0],h=c.findIndex(b=>b.id==e.id);i&&(i.oldPrice=Number(d),c.splice(h,1,i),_([...c]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:o,className:s.table_body_amount,min:0,onChange:n})})}function La({item:e}){const[o,a]=u.useState(e.price),{stockTemporaryData:c,setStockTemporaryData:_}=C(),n=f=>{const d=f.target.value;a(Number(d));const i=c.filter(b=>b.id==e.id)[0],h=c.findIndex(b=>b.id==e.id);i.price&&(i.price=Number(d),c.splice(h,1,i),_([...c]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:o,className:s.table_body_amount,min:0,onChange:n})})}function Wa({item:e}){const[o,a]=u.useState(0),{stockTemporaryData:c,setStockTemporaryData:_}=C(),n=f=>{const d=f.target.valueAsNumber;a(d);const i=c.find(h=>h.id==e.id);if(i){const h=c.findIndex(p=>p.id==e.id),b=[...c];b.splice(h,1,i),_(b)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:o,min:0,className:s.table_body_amount,onChange:n})})}function za({item:e,column:o}){const{stockTemporaryData:a,setSearchResponseItem:c,setStockIkpuStatus:_,setStockTemporaryData:n}=C(),f=i=>{c(i),_(!0)},d=()=>{a&&n(a.filter(i=>i.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${o.length}, 200px)`},children:[o==null?void 0:o.map(i=>{var h;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(i==null?void 0:i.title)=="Количество"&&t.jsx(Wa,{item:e}),(i==null?void 0:i.title)=="Приходная цена"&&t.jsx(Fa,{item:e}),(i==null?void 0:i.title)=="Продажная цена"&&t.jsx(La,{item:e}),(i==null?void 0:i.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:(h=e==null?void 0:e.name)==null?void 0:h.ru}),(i==null?void 0:i.title)=="Фото"?t.jsx("img",{src:"/noPhoto.jpg",width:40,height:40,alt:"",className:s.table_body_img}):"",(i==null?void 0:i.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(i==null?void 0:i.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(i==null?void 0:i.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>f(e),children:t.jsx(R,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(i==null?void 0:i.title)=="Штрих-код"&&(e!=null&&e.barcode)?e==null?void 0:e.barcode:""]},i==null?void 0:i.id)}),t.jsx("td",{className:s.table_body_del,onClick:d,children:t.jsx(R,{name:"TrashIcon",width:20,height:20})})]})}function Ha({column:e}){const{stockTemporaryData:o}=C(),[a,c]=u.useState([]);return u.useEffect(()=>{c(o)},[o]),t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(_=>t.jsx("td",{className:s.table_head_col,children:_.title},_.id))})}),t.jsx("tbody",{className:s.table_body,children:a==null?void 0:a.map(_=>t.jsx(za,{item:_,column:e},_==null?void 0:_.id))})]})}function qa({clearTable:e,setData:o}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:o,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:a=>e(a),children:"Отмена"})]})}function Ua(){const e=u.useRef(null),[o,a]=u.useState(!1),[c,_]=u.useState(0),[n,f]=u.useState(0),d=N=>{e.current&&(a(!0),_(N.pageX-e.current.offsetLeft),f(e.current.scrollLeft))},i=()=>{a(!1)},h=()=>{a(!1)},b=N=>{if(!o||!e.current)return;N.preventDefault();const B=(N.pageX-e.current.offsetLeft-c)*2;e.current.scrollLeft=n-B},{settingsParams:p,stockIkpuStatus:g,stockTemporaryData:l,openModalCategory:r,setStockTemporaryData:k,setCheckedProducts:m}=C(),[j,y]=u.useState([]);u.useEffect(()=>{const N=p.filter(S=>S.checked&&S.title!="Подкатегория");y(()=>[...N])},[p]);const M=N=>{N.preventDefault(),l.forEach(S=>{I(S)})};async function I(N){var S;try{const B={nameRu:(S=N.name)==null?void 0:S.ru,oldPrice:N.oldPrice,price:N.price};await X.patch(`nomenclatures/${N.id}`,B),k([]),m([])}catch(B){console.log(`Ошибка произошла при попытке добавить ${N==null?void 0:N.crmNameProduct} на сервер`,B)}}const x=N=>{N.preventDefault(),k([]),m([])};return t.jsxs("div",{className:s.formWrapper,children:[r&&t.jsx(ut,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:d,onMouseLeave:i,onMouseUp:h,onMouseMove:b,children:[g&&t.jsx(Ba,{}),t.jsx(Ha,{column:j})]}),t.jsx(qa,{clearTable:x,setData:M})]})}async function lt(e,o,a,c,_){try{if(e==="По тексту"){console.log("fetchStockProducts page",c,"perPage",_);const n=await X.get(`nomenclatures?multiStoreId=${o}&name=${a}&page=${c}&perPage=${_}`);console.log("fetchStockProducts res",n);const f=await n.data.data,d=await n.data.pagination.total,i=await n.data.pagination.total_pages;return{data:f,totalElements:d,totalPages:i}}}catch(n){console.log("Ошибка при получении продуктов со склада",n)}}function Ga(){const o=Q().pathname,{stockPickedSearch:a,setStockPickedSearch:c,stockSearchParams:_,stockSearchText:n,setStockSearchText:f,setStockSearchResponse:d,stockTemporaryData:i,setTotalElementsStore:h,setTotalPagesStore:b,stockPage:p,perPage:g,setStockPage:l}=C(),[r,k]=u.useState("");u.useEffect(()=>{k(""),f("")},[o]),u.useEffect(()=>{(a=="По штрих-коду"||a=="По ИКПУ")&&(n.toString(),n.length<13&&c("По ТН ВЭД"),n.length==13&&c("По штрих-коду"),n.length>13&&c("По ИКПУ")),n.length>0&&k("")},[n]),u.useEffect(()=>{const y=document.querySelector(`input[name="search"][value="${a}"]`);y&&(y.checked=!0)},[a]);const m=y=>{c(y.currentTarget.value)},j=async y=>{y.preventDefault(),d([]),l(1);const M=V.get("access_token"),I=V.get("multi-store");if((!M||!I)&&await ot(),n.length>0&&I){const{data:x,totalElements:N,totalPages:S}=await lt(a,I,n,p,g);console.log("totalElements",N,"totalPages",S),x.length==0&&k("ничего не найдено"),N&&S&&(h(N),b(S));const B=x.filter(L=>!i.some(O=>O.id===L.id));d(B)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.navStock,children:[t.jsxs("ul",{className:s.navStock_buttons,children:[t.jsx("li",{children:t.jsxs(D,{className:`${s.back} ${s.navStock_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(R,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(D,{to:"/addingProducts/settingsAddProducts",className:`${s.navStock_linkBtn} ${s.navStock_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(R,{name:"Cog8ToothIcon",className:s.navStock_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:s.stockForm,onSubmit:y=>j(y),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:n,type:a=="По штрих-коду"||a=="По ИКПУ"?"number":"text",className:s.stockForm_input,placeholder:a,onChange:y=>f(y.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.stockForm_btn,children:"Поиск"})]}),t.jsx("ul",{className:s.stockForm_list,children:_==null?void 0:_.map(y=>t.jsx("li",{children:t.jsxs("label",{className:s.stockForm_check,children:[t.jsx("input",{type:"radio",name:"search",value:y.title,onClick:M=>m(M)}),t.jsx("span",{className:s.stockForm_check_text,children:y.title})]})},y.id))})]}),t.jsx("span",{className:s.navStock_error,children:r})]})})}function Oa({addSelectedProducts:e,setCancel:o}){const{setAddBlockStatus:a}=_t(),c=()=>{o(),a(!1)};return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(D,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>e(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:c,children:"Отмена"})]})}function Za(){const{stockSearchResponse:e,setStockSearchResponse:o,stockCheckedProducts:a,setStockCheckedProducts:c,stockTemporaryData:_,setStockTemporaryData:n,totalElementsStore:f,setTotalElementsStore:d,totalPagesStore:i,setTotalPagesStore:h,stockSearchText:b,setStockSearchText:p,stockPickedSearch:g,stockPage:l,setStockPage:r,setPerPage:k,perPage:m}=C(),[j,y]=u.useState([]),[M,I]=u.useState([]),[x,N]=u.useState(!1),S=u.useRef([]),B=u.useRef(null);u.useEffect(()=>{y([...e]),console.log("stockSearchResponse",e)},[e]);const L=()=>{a&&n([...a,..._]),o([]),c([]),w()},O=(v,E)=>{if(v){I([...M,E]);const F=j.filter(W=>W.id==E)[0];c([...a,F])}else if(!v&&B.current){const F=M.filter(z=>z!=E);I([...F]);const W=a.filter(z=>z.id!=E);c([...W]),N(!1),B.current.checked=!1}B.current&&v&&M.length+1==j.length&&(N(!0),B.current.checked=!0,c([...j]))},P=v=>{if(N(v),v){S.current.forEach(F=>{F&&(F.checked=v)});const E=j.map(F=>F.id);I([...E]),c([...j])}else I([]),S.current.forEach(E=>{E&&(E.checked=v)}),c([])},q=async v=>{v.preventDefault();const E=l+1;r(E);const F=V.get("multi-store");if(F){const{data:W}=await lt(g,F,b,E,m),z=W.filter(Z=>!_.some(H=>H.id===Z.id));console.log("filteredSearchResponse",z),console.log("stockSearchResponse",e),console.log("stockSearchText",b),B.current&&(N(!1),B.current.checked=!1,o([...z,...e]))}},w=()=>{o([]),c([]),d(0),h(0),p(""),r(1),k(5)};return t.jsx("section",{className:s.foundProducts,onClick:w,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:v=>v.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",f]}),t.jsxs("span",{children:["Текущее количество - ",j.length]}),t.jsxs("span",{children:["Выбрано элементов - ",M.length]})]}),l<i&&i!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:v=>q(v),children:"добавить ещё..."}),j.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:v=>P(v.target.checked),ref:B}),t.jsx("span",{children:x?"Отключить все":"Выбрать все"})]}),t.jsx(Oa,{addSelectedProducts:L,setCancel:w})]}),t.jsx("ul",{className:s.foundProducts_list,children:j==null?void 0:j.map((v,E)=>{var F;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:v==null?void 0:v.barcode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:v==null?void 0:v.mxik})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:v==null?void 0:v.brand})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:(F=v==null?void 0:v.name)==null?void 0:F.ru})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:v==null?void 0:v.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${x||M.includes(v.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:W=>O(W.target.checked,v.id),ref:W=>{S.current[E]=W}}),"Выбрать"]})]},v==null?void 0:v.id)})})]})})}async function Xa(e){try{const o=await G.get(`https://tasnif.soliq.uz/api/cl-api/integration-mxik/get/history/${e}`);return console.log("res ",o),await o.data.data.packageNames}catch(o){console.log("",o)}}function Va(){const{searchResponse:e,searchText:o,TemporaryData:a,pickedSearch:c,setSearchText:_,setTemporaryData:n,setCheckedProducts:f,setSearchResponse:d,totalElementsStore:i,setTotalElementsStore:h,setTotalPagesStore:b,page:p,setPage:g,perPage:l,lang:r,errorMessage:k,setErrorMessage:m}=C(),[j,y]=u.useState([]),[M,I]=u.useState([]),x=u.useRef(null);u.useEffect(()=>{const P=setTimeout(()=>{m("")},1e3);return()=>{clearTimeout(P)}},[k]),u.useEffect(()=>{y([...e]);const P=M.filter(q=>e.some(w=>w.id===q));I(P),y([...e])},[e]);const N=async P=>{if(await at(P))if(a.some(v=>v.mxikCode===P.mxikCode))m("Этот продукт уже выбран"),L();else{const v=await Xa(P.mxikCode),E={...P,crmNameProduct:P.subPositionName,crmAmount:0,crmArrivalPrice:0,crmSellingPrice:0,packageNames:v??null,crmCheckbox:!1};n([E,...a]),L()}else m("Этот продукт уже есть на складе"),L()},S=async()=>{const P=p+1;g(P);const{data:q}=await tt(c,o,P,l,r),w=[];for(const v of q){const E=await et(v.mxikCode,r);w.push({...v,id:U(),photos:E})}d([...e,...w])},B=()=>{const P=x.current;P&&P.scrollHeight-P.scrollTop===P.clientHeight&&S()},L=()=>{d([]),f([]),h(0),b(0),_(""),g(0)},O=()=>{const P={attributeName:null,brandName:null,classCode:"",className:"",commonUnitCode:null,commonUnitName:null,crmAmount:0,crmArrivalPrice:0,crmNameProduct:"",crmSellingPrice:0,groupCode:"",groupName:"",id:U(),internationalCode:null,mxikCode:"",myProduct:0,packages:null,photos:["/noPhoto.jpg"],positionCode:"",positionName:"",subPositionName:"",unitCode:null,unitName:null,units:[],createdByHand:!0};n([P,...a]),L()};return t.jsx("section",{className:s.foundProducts,onClick:L,children:t.jsxs("div",{ref:x,className:s.foundProducts_modal,onScroll:B,onClick:P=>P.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsx("h2",{className:s.foundProducts_title,children:t.jsxs("span",{children:["Найдено совпадений - ",i]})}),t.jsxs("div",{className:s.foundProducts_top_buttons,children:[t.jsxs("button",{className:s.foundProducts_top_add,onClick:O,children:[t.jsx(R,{name:"PlusCircleIcon"}),"Добавить в ручную"]}),t.jsx("button",{className:s.foundProducts_top_close,onClick:L,children:t.jsx(R,{name:"XMarkIcon"})})]})]}),t.jsx("ul",{className:s.foundProducts_list,children:j==null?void 0:j.map(P=>{var q;return t.jsxs("li",{className:s.foundProducts_item,onClick:()=>N(P),children:[t.jsxs("h2",{className:s.foundProducts_item_mxik,children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:P==null?void 0:P.mxikCode}),t.jsx("span",{className:s.foundProducts_item_desc,children:P==null?void 0:P.subPositionName})]}),t.jsxs("div",{className:s.foundProducts_item_content,children:[t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Группа:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:(P==null?void 0:P.groupName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Класс:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:(P==null?void 0:P.className)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Позиция:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:(P==null?void 0:P.positionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Субпозиция:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:(P==null?void 0:P.subPositionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:s.foundProducts_item_list_box,children:[t.jsx("span",{className:s.foundProducts_item_myIcon}),t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"})]}),t.jsx("span",{className:s.foundProducts_item_desc,children:(P==null?void 0:P.internationalCode)??"-"})]})]}),t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:(q=P==null?void 0:P.photos)!=null&&q[0]?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+P.photos[0]:"/noPhoto.jpg",width:50,height:50,alt:""})})]})]},P==null?void 0:P.id)})})]})})}function Qa(){const o=Q().pathname,[a,c]=u.useState(!1);return t.jsxs("div",{className:`${s.leftMenu} ${a?s.leftMenu_active:""}`,children:[t.jsx("button",{className:s.leftMenu_btn,onClick:()=>c(!a),children:t.jsx(R,{name:"Bars3Icon"})}),t.jsxs("ul",{className:s.leftMenu_list,children:[t.jsxs("li",{className:`${s.leftMenu_li} ${o=="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(R,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${a?"":s.leftMenu_li_icon_active}`}),t.jsx(D,{to:"/addingProducts",className:`${s.leftMenu_link} ${a?s.leftMenu_link_active:""}`,children:"Добавить номенклатуру"}),t.jsx(R,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${a?s.leftMenu_linkArrow_active:""}`})]}),t.jsxs("li",{className:`${s.leftMenu_li} ${o!="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(R,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${a?"":s.leftMenu_li_icon_active}`}),t.jsx(D,{to:"/addingProducts/stockProducts",className:`${s.leftMenu_link} ${a?s.leftMenu_link_active:""}`,children:"Создать номенклатуру"}),t.jsx(R,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${a?s.leftMenu_linkArrow_active:""}`})]})]})]})}function en(){const o=Q().pathname,{stockSearchResponse:a,TemporaryData:c,stockTemporaryData:_,setTemporaryData:n,setCheckedProducts:f,searchResponse:d}=C();u.useEffect(()=>{i()},[]);const i=()=>{n([]),f([])};return t.jsxs("div",{className:s.addingProducts,children:[t.jsx(Qa,{}),o=="/addingProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx(mo,{}),c.length>0&&d.length==0&&t.jsx(ua,{}),d.length>0&&t.jsx(Va,{})]}),o=="/addingProducts/stockProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx(Ga,{}),a.length>0&&t.jsx(Za,{}),_.length>0&&t.jsx(Ua,{})]}),o.startsWith("/addingProducts/settingsAddProducts")&&t.jsx(Aa,{})]})}export{en as default};
