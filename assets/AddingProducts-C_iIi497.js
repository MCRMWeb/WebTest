import{w as L,v as U,q as H,y as O,r as k,j as t,L as B,D as V,x as Y,a as nt}from"./index-jbLHaAhC.js";import{a as T,M as Z}from"./Modal-SLmSfi0Q.js";import{C as q}from"./CustomIcon-Dk3_npyW.js";import"./XMarkIcon-DIHbEiNZ.js";const at="_container_os3eg_1",ct="_nav_os3eg_5",rt="_nav_linkBtn_os3eg_8",lt="_nav_settingsIcon_os3eg_13",it="_nav_buttons_os3eg_17",dt="_nav_buttons_link_os3eg_22",_t="_nav_buttons_iconSetting_os3eg_27",ut="_setting_os3eg_1",gt="_nav_error_os3eg_30",pt="_navStock_os3eg_38",ft="_navStock_linkBtn_os3eg_41",mt="_navStock_settingsIcon_os3eg_46",bt="_navStock_buttons_os3eg_50",ht="_navStock_buttons_link_os3eg_55",xt="_navStock_buttons_iconSetting_os3eg_60",kt="_navStock_error_os3eg_63",jt="_form_os3eg_71",Pt="_form_input_os3eg_82",vt="_form_btn_os3eg_87",yt="_form_list_os3eg_118",Nt="_form_check_os3eg_123",St="_form_check_text_os3eg_129",wt="_stockForm_os3eg_133",$t="_stockForm_input_os3eg_144",It="_stockForm_btn_os3eg_150",Dt="_stockForm_list_os3eg_181",Tt="_stockForm_check_os3eg_186",At="_stockForm_check_text_os3eg_192",Wt="_formWrapper_os3eg_196",Et="_formWrapper_buttons_os3eg_201",Bt="_formWrapper_btn_os3eg_207",Mt="_formWrapper_btn_cancel_os3eg_219",Rt="_formWrapper_btn_save_os3eg_222",Ft="_found_os3eg_226",Lt="_table_os3eg_250",zt="_table_head_os3eg_255",qt="_table_head_row_os3eg_258",Ut="_table_head_col_os3eg_264",Ct="_table_body_row_os3eg_267",Ht="_table_body_col_os3eg_271",Ot="_table_body_img_os3eg_280",Xt="_table_body_icon_os3eg_283",Kt="_table_body_name_os3eg_287",Qt="_table_body_nameString_os3eg_320",Gt="_table_body_amount_os3eg_327",Jt="_table_body_catalog_os3eg_335",Vt="_table_body_catalog_top_os3eg_345",Yt="_table_body_catalog_icon_os3eg_364",Zt="_table_body_catalog_iconActive_os3eg_367",te="_table_body_catalog_drop_os3eg_370",ee="_table_body_catalog_dropActive_os3eg_395",se="_table_body_catalog_search_os3eg_400",oe="_table_body_catalog_item_os3eg_414",ne="_table_body_catalog_text_os3eg_422",ae="_table_body_del_os3eg_428",ce="_ikpuWrapper_os3eg_448",re="_ikpuWrapper_ikpuModalBlock_os3eg_457",le="_ikpuWrapper_content_os3eg_467",ie="_ikpuWrapper_buttons_os3eg_472",de="_ikpuWrapper_save_os3eg_478",_e="_ikpuWrapper_delete_os3eg_488",ue="_ikpuWrapper_cancel_os3eg_498",ge="_left_os3eg_509",pe="_left_content_os3eg_512",fe="_left_content_item_os3eg_517",me="_right_os3eg_527",be="_right_block_os3eg_532",he="_right_bottom_os3eg_538",xe="_right_bottom_item_os3eg_545",ke="_right_bottom_item_img_os3eg_555",je="_right_bottom_BaseItem_os3eg_560",Pe="_right_bottom_BaseItem_img_os3eg_571",ve="_foundProducts_os3eg_576",ye="_foundProducts_modal_os3eg_585",Ne="_foundProducts_top_os3eg_609",Se="_foundProducts_title_os3eg_623",we="_foundProducts_more_os3eg_631",$e="_foundProducts_allActive_os3eg_648",Ie="_foundProducts_buttons_os3eg_654",De="_foundProducts_btn_os3eg_660",Te="_foundProducts_btn_cancel_os3eg_672",Ae="_foundProducts_btn_save_os3eg_675",We="_foundProducts_list_os3eg_678",Ee="_foundProducts_item_os3eg_682",Be="_foundProducts_item_photo_os3eg_689",Me="_foundProducts_item_list_os3eg_699",Re="_foundProducts_item_title_os3eg_711",Fe="_foundProducts_item_desc_os3eg_714",Le="_foundProducts_item_btn_os3eg_718",ze="_foundProducts_item_btn_active_os3eg_732",qe="_errorModal_os3eg_737",Ue="_errorModal_block_os3eg_746",Ce="_addingProductsButton_os3eg_764",He="_addingProductsButton_btn_os3eg_771",Oe="_addingProductsButton_btn_active_os3eg_802",s={container:at,nav:ct,nav_linkBtn:rt,nav_settingsIcon:lt,nav_buttons:it,nav_buttons_link:dt,nav_buttons_iconSetting:_t,setting:ut,nav_error:gt,navStock:pt,navStock_linkBtn:ft,navStock_settingsIcon:mt,navStock_buttons:bt,navStock_buttons_link:ht,navStock_buttons_iconSetting:xt,navStock_error:kt,form:jt,form_input:Pt,form_btn:vt,form_list:yt,form_check:Nt,form_check_text:St,stockForm:wt,stockForm_input:$t,stockForm_btn:It,stockForm_list:Dt,stockForm_check:Tt,stockForm_check_text:At,formWrapper:Wt,formWrapper_buttons:Et,formWrapper_btn:Bt,formWrapper_btn_cancel:Mt,formWrapper_btn_save:Rt,found:Ft,table:Lt,table_head:zt,table_head_row:qt,table_head_col:Ut,table_body_row:Ct,table_body_col:Ht,table_body_img:Ot,table_body_icon:Xt,table_body_name:Kt,table_body_nameString:Qt,table_body_amount:Gt,table_body_catalog:Jt,table_body_catalog_top:Vt,table_body_catalog_icon:Yt,table_body_catalog_iconActive:Zt,table_body_catalog_drop:te,table_body_catalog_dropActive:ee,table_body_catalog_search:se,table_body_catalog_item:oe,table_body_catalog_text:ne,table_body_del:ae,ikpuWrapper:ce,ikpuWrapper_ikpuModalBlock:re,ikpuWrapper_content:le,ikpuWrapper_buttons:ie,ikpuWrapper_save:de,ikpuWrapper_delete:_e,ikpuWrapper_cancel:ue,left:ge,left_content:pe,left_content_item:fe,right:me,right_block:be,right_bottom:he,right_bottom_item:xe,right_bottom_item_img:ke,right_bottom_BaseItem:je,right_bottom_BaseItem_img:Pe,foundProducts:ve,foundProducts_modal:ye,foundProducts_top:Ne,foundProducts_title:Se,foundProducts_more:we,foundProducts_allActive:$e,foundProducts_buttons:Ie,foundProducts_btn:De,foundProducts_btn_cancel:Te,foundProducts_btn_save:Ae,foundProducts_list:We,foundProducts_item:Ee,foundProducts_item_photo:Be,foundProducts_item_list:Me,foundProducts_item_title:Re,foundProducts_item_desc:Fe,foundProducts_item_btn:Le,foundProducts_item_btn_active:ze,errorModal:qe,errorModal_block:Ue,addingProductsButton:Ce,addingProductsButton_btn:He,addingProductsButton_btn_active:Oe};async function tt(e,a,o,r,g){try{if(e==="По тексту"){const n=await L.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search-subposition?search_text=${a}&page=${o}&size=${r}&lang=${g}`);console.log("По тексту res",n);const p=await n.data.data.content,u=await n.data.data.totalElements,b=await n.data.data.totalPages;return{data:p,totalElements:u,totalPages:b}}else if(e==="По штрих-коду"){const n=await L.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?gtin=${a}&size=${r}&page=${o}&lang=${g}`),p=await n.data.data.content,u=await n.data.data.totalElements,b=await n.data.data.totalPages;return console.log("По штрих-коду res",n),{data:p,totalElements:u,totalPages:b}}else if(e==="По ИКПУ"){const n=await L.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?mxikCode=${a}&size=${r}&page=${o}&lang=${g}`);console.log("По ИКПУ res",n);const p=await n.data.data.content,u=await n.data.data.totalElements,b=await n.data.data.totalPages;return{data:p,totalElements:u,totalPages:b}}else if(e==="Расширинный по тексту"){const n=await L.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?text=${a}&size=${r}&page=${o}&lang=${g}`);console.log("Расширинный по тексту res",n);const p=await n.data.data.content,u=await n.data.data.totalElements,b=await n.data.data.totalPages;return{data:p,totalElements:u,totalPages:b}}else if(e==="По номеру рег. удостовирения"){const n=await L.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/dv-cert-number?dvCertNumber=${a}&page=${o}&size=${r}&lang=${g}`);console.log("По номеру рег. удостовирения res",n);const p=await n.data.data.content,u=await n.data.data.totalElements,b=await n.data.data.totalPages;return{data:p,totalElements:u,totalPages:b}}else if(e==="По ТН ВЭД"){const n=await L.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?tnvedCode=${a}&size=${r}&page=${o}&lang=${g}`);console.log("По ТН ВЭД res",n);const p=await n.data.data.content,u=await n.data.data.totalElements,b=await n.data.data.totalPages;return{data:p,totalElements:u,totalPages:b}}else if(e==="По бренду"){const n=await L.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?brandName=${a}&size=${r}&page=${o}&lang=${g}`);console.log("По бренду res",n);const p=await n.data.data.content,u=await n.data.data.totalElements,b=await n.data.data.totalPages;return{data:p,totalElements:u,totalPages:b}}else if(e==="По MHH"){const n=await L.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/mnn-name?mnn_name=${a}&page=${o}&size=${r}&lang=${g}`);console.log("По MHH res",n);const p=await n.data.data,u=await n.data.recordTotal,b=await u/r;return{data:p,totalElements:u,totalPages:b}}}catch(n){console.log(n)}}async function et(e){var o;const a=U.get("multi-store");try{return(await H.post("nomenclatures/is-unique-name",{multiStoreId:Number(a),nameRu:(o=e.subPositionName)==null?void 0:o.toString()})).data.success}catch(r){return console.log("Ошибка произошла при проверки наличия продукта на складе по наименованию",r),!1}}async function st(e,a){try{return(await L.get(`https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/mxik/picture-names?lang=${a}&mxik_code=${e}`)).data}catch(o){console.log("Ошибка при получении картинок к продукту",o)}}function Xe(){const a=O().pathname,{pickedSearch:o,setPickedSearch:r,searchText:g,setSearchText:n,searchParams:p,TemporaryData:u,setSearchResponse:b,setTotalElementsStore:h,setTotalPagesStore:d,page:f,perPage:c,lang:l}=T(),[_,v]=k.useState("");k.useEffect(()=>{v(""),n("")},[a]),k.useEffect(()=>{(o=="По штрих-коду"||o=="По ИКПУ"||o=="По ТН ВЭД")&&(g.toString(),g.length<13&&r("По ТН ВЭД"),g.length==13&&r("По штрих-коду"),g.length>13&&r("По ИКПУ")),g.length>0&&v("")},[g]),k.useEffect(()=>{const P=document.querySelector(`input[name="search"][value="${o}"]`);P&&(P.checked=!0)},[o]);const x=P=>{r(P.currentTarget.value)},j=async P=>{if(P.preventDefault(),U.get("access_token")||await V(),g.length>0){const{data:I,totalElements:w,totalPages:D}=await tt(o,g,f,c,l);I.length==0&&v("ничего не найдено"),w&&D&&(h(w),d(D));const m=[];for(const A of I){const R=await et(A),F=await st(A.mxikCode,l);R&&m.push({...A,id:Y(),photos:F})}I.length>0&&m.length==0&&v("Все найденые совпадения уже есть на складе");const y=m.filter(A=>!u.some(R=>R.mxikCode===A.mxikCode));b(y)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.nav,children:[t.jsxs("ul",{className:s.nav_buttons,children:[t.jsx("li",{children:t.jsxs(B,{className:`${s.back} ${s.nav_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(q,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(B,{to:"/addingProducts/settingsAddProducts",className:`${s.nav_linkBtn} ${s.nav_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(q,{name:"Cog8ToothIcon",className:s.nav_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:s.form,onSubmit:P=>j(P),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:g,type:o=="По штрих-коду"||o=="По ИКПУ"||o=="По ТН ВЭД"?"number":"text",className:s.form_input,placeholder:o,onChange:P=>n(P.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.form_btn,children:"Поиск"})]}),t.jsx("ul",{className:s.form_list,children:p==null?void 0:p.map(P=>t.jsx("li",{children:t.jsxs("label",{className:s.form_check,children:[t.jsx("input",{type:"radio",name:"search",value:P.title,onClick:N=>x(N)}),t.jsx("span",{className:s.form_check_text,children:P.title})]})},P.id))})]}),t.jsx("span",{className:s.nav_error,children:_})]})})}function Ke({setCancel:e,addSelectedProducts:a}){return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(B,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>a(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:e,children:"Отмена"})]})}function Qe(){const{searchResponse:e,checkedProducts:a,searchText:o,TemporaryData:r,pickedSearch:g,setSearchText:n,setTemporaryData:p,setCheckedProducts:u,setSearchResponse:b,totalElementsStore:h,setTotalElementsStore:d,totalPagesStore:f,setTotalPagesStore:c,page:l,setPage:_,perPage:v,lang:x}=T(),[j,P]=k.useState([]),[N,I]=k.useState([]),[w,D]=k.useState(!1),m=k.useRef([]),y=k.useRef(null);k.useEffect(()=>{P([...e]);const i=N.filter(S=>e.some($=>$.id===S));I(i),P([...e])},[e]);const A=(i,S)=>{if(i){I([...N,S]);const $=j.filter(W=>W.id==S)[0];u([...a,$])}else if(!i&&y.current){const $=N.filter(M=>M!=S);I([...$]);const W=a.filter(M=>M.id!=S);u([...W]),D(!1),y.current.checked=!1}y.current&&i&&N.length+1==j.length&&(D(!0),y.current.checked=!0,u([...j]))},R=i=>{if(D(i),i){m.current.forEach($=>{$&&($.checked=i)});const S=j.map($=>$.id);I([...S]),u([...j])}else I([]),m.current.forEach(S=>{S&&(S.checked=i)}),u([])},F=()=>{if(a){const i=a.map(S=>({...S,crmNameProduct:S.subPositionName,crmAmount:0,crmArrivalPrice:0,crmSellingPrice:0}));p([...r,...i]),z()}},C=async i=>{i.preventDefault();const S=l+1;_(S);const{data:$}=await tt(g,o,S,v,x),W=[];for(const M of $){const X=await et(M),K=await st(M.mxikCode,x);X&&W.push({...M,id:Y(),photos:K})}y.current&&(D(!1),y.current.checked=!1,b([...W,...e]))},z=()=>{b([]),u([]),d(0),c(0),n(""),_(0)};return t.jsx("section",{className:s.foundProducts,onClick:z,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",h]}),t.jsxs("span",{children:["Текущее количество - ",j.length]}),t.jsxs("span",{children:["Выбрано элементов - ",N.length]})]}),l+1<f&&f!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:i=>C(i),children:"добавить ещё..."}),j.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:i=>R(i.target.checked),ref:y}),t.jsx("span",{children:w?"Отключить все":"Выбрать все"})]}),t.jsx(Ke,{addSelectedProducts:F,setCancel:z})]}),t.jsx("ul",{className:s.foundProducts_list,children:j==null?void 0:j.map((i,S)=>{var $;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:($=i==null?void 0:i.photos)!=null&&$[0]?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+i.photos[0]:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.internationalCode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.brandName})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${w||N.includes(i.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:W=>A(W.target.checked,i.id),ref:W=>{m.current[S]=W}}),"Выбрать"]})]},i==null?void 0:i.id)})})]})})}function Ge({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsx("div",{className:s.left_content,children:e.map(a=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:a.title}),t.jsx("p",{children:a.value})]},a.id))})})}function Je(){const{imagesSrc:e,setImagesSrc:a}=T(),[o,r]=k.useState(null),g=k.useRef([]),n=l=>{g.current.forEach(_=>{_&&_.getAttribute("id")==l&&_.click()})};function p(l,_){r(_)}function u(l){l.target.style.background="white"}function b(l){l.target.style.background="white"}function h(l){l.preventDefault(),l.target.style.background="lightgray"}function d(l,_){l.preventDefault(),l.target.style.background="white";const v=e.map(x=>x.id===_.id?{...x,order:(o==null?void 0:o.order)||x.order}:x.id===(o==null?void 0:o.id)?{...x,order:_.order}:x);a(v),r(null)}function f(l,_){return l.order>_.order?1:-1}const c=l=>{var v,x;const _=(x=(v=l==null?void 0:l.target)==null?void 0:v.files)==null?void 0:x[0];if(_&&(_==null?void 0:_.type)==="image/jpeg"||(_==null?void 0:_.type)==="image/png"||(_==null?void 0:_.type)==="image/webp"){const j=l.target.getAttribute("id"),P=[...e],N=P.find(w=>w.id==j),I=P.findIndex(w=>w.id==j);if(N){const w=new FileReader;w.onload=D=>{var m;(m=D.target)!=null&&m.result&&(N.src=URL.createObjectURL(_),P.splice(I,1,N),a([...P]))},w.readAsDataURL(_)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(f).map((l,_)=>{var v;return t.jsxs("div",{draggable:!0,onDragStart:x=>p(x,l),onDragLeave:x=>u(x),onDragEnd:x=>b(x),onDragOver:x=>h(x),onDrop:x=>d(x,l),className:_==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>n(l.id),children:[t.jsx("input",{id:l.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:c,ref:x=>{g.current[_]=x}}),t.jsx("img",{src:l.src=="/noPhoto.jpg"||((v=l.src)==null?void 0:v.toString().split(":")[0])=="blob"?l.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+l.src,width:_==0?150:50,height:_==0?150:50,alt:"",className:`${_==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},l.id)})})})})}function Ve({addingImgToProduct:e,handleCancel:a}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(B,{to:"#",className:s.ikpuWrapper_save,onClick:o=>e(o),children:"Coхранить"}),t.jsx(B,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(B,{to:"#",onClick:o=>a(o),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const Q=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:3,title:"Группа:",value:""},{id:4,title:"Класс:",value:""},{id:5,title:"Позиция:",value:""},{id:6,title:"Субпозиция:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""},{id:9,title:"Описание:",value:""}];function Ye(){const{searchResponseItem:e,imagesSrc:a,setImagesSrc:o,setSearchResponseItem:r,setIkpuStatus:g}=T(),[n,p]=k.useState([]);k.useEffect(()=>{if(e){const h=Q==null?void 0:Q.map(d=>{let f;return d.title=="ИКПУ:"&&(f=e.mxikCode),d.title=="Штрих-код:"&&(f=e.internationalCode),d.title=="Группа:"&&(f=e.groupName),d.title=="Класс:"&&(f=e.className),d.title=="Позиция:"&&(f=e.positionName),d.title=="Субпозиция:"&&(f=e.subPositionName),d.title=="Наименование:"&&(f=e.className),d.title=="Бренд:"&&(f=e.brandName),d.title=="Описание:"&&(f=e.attributeName),{id:d.id,title:d.title,value:f}});p([...h])}},[e]),k.useEffect(()=>{if(e.photos){const h=a.map((d,f)=>{var c,l;return{id:d.id,order:d.order,src:(c=e==null?void 0:e.photos)!=null&&c[f]?(l=e==null?void 0:e.photos)==null?void 0:l[f]:"/noPhoto.jpg"}});h&&o(h)}},[]);const u=h=>{h.preventDefault();const d=a==null?void 0:a.map(f=>f.src);e.photos=d,r(e),g(!1)};function b(h){h.preventDefault();const d=a.map(f=>({id:f.id,order:f.order,src:f.src}));o(d),g(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:b,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:h=>h.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(Ge,{staticList:n}),t.jsx(Je,{})]}),t.jsx(Ve,{addingImgToProduct:u,handleCancel:b})]})})})}function Ze({item:e}){const[a,o]=k.useState(0),{TemporaryData:r,setTemporaryData:g}=T(),n=p=>{const u=p.target.valueAsNumber;o(u);const b=r.find(h=>h.id==e.id);if(b){const h=r.findIndex(f=>f.id==e.id),d=[...r];d.splice(h,1,b),g(d)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:a,className:s.table_body_amount,min:0,onChange:n})})}function ts({item:e}){const[a,o]=k.useState(0),{TemporaryData:r,setTemporaryData:g}=T(),n=p=>{const u=p.target.valueAsNumber;o(u);const b=r.find(h=>h.id==e.id);if(b){b.crmSellingPrice=u;const h=r.findIndex(f=>f.id==e.id),d=[...r];d.splice(h,1,b),g(d)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:a,className:s.table_body_amount,min:0,onChange:n})})}function es({item:e}){const[a,o]=k.useState(0),{TemporaryData:r,setTemporaryData:g}=T(),n=p=>{const u=p.target.valueAsNumber;o(u);const b=r.find(h=>h.id==e.id);if(b){const h=r.findIndex(f=>f.id==e.id),d=[...r];d.splice(h,1,b),g(d)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:a,min:0,className:s.table_body_amount,onChange:n})})}function ss({item:e,column:a}){const{ikpuStatus:o,setSearchResponseItem:r,setIkpuStatus:g,setTemporaryData:n,TemporaryData:p,setOpenModalCategory:u,setCurrentProduct:b}=T(),h=c=>{r(c),g(!o)},d=()=>{p&&n(p.filter(c=>c.id!==e.id))},f=c=>{c.preventDefault(),u(!0),b(e)};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${a.length}, 200px)`},children:[a==null?void 0:a.map(c=>{var l,_,v,x,j,P,N;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(c==null?void 0:c.title)=="Количество"&&t.jsx(es,{item:e}),(c==null?void 0:c.title)=="Приходная цена"&&t.jsx(Ze,{item:e}),(c==null?void 0:c.title)=="Продажная цена"&&t.jsx(ts,{item:e}),(c==null?void 0:c.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:e.subPositionName}),(c==null?void 0:c.title)=="Фото"?t.jsx("img",{src:((l=e.photos)==null?void 0:l[0])=="/noPhoto.jpg"?(_=e.photos)==null?void 0:_[0]:(x=(v=e.photos)==null?void 0:v[0])!=null&&x.startsWith("blob")?(j=e.photos)==null?void 0:j[0]:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+((P=e.photos)==null?void 0:P[0]),width:40,height:40,alt:"",className:s.table_body_img}):"",(c==null?void 0:c.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(c==null?void 0:c.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(c==null?void 0:c.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>h(e),children:t.jsx(q,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(c==null?void 0:c.title)=="Подкатегория"&&t.jsx(B,{to:"#",onClick:I=>f(I),children:(N=e==null?void 0:e.crmCategory)!=null&&N.name.ru?e==null?void 0:e.crmCategory.name.ru:"Выбрать"}),(c==null?void 0:c.title)=="Штрих-код"&&(e==null?void 0:e.internationalCode)]},c==null?void 0:c.id)}),t.jsx("td",{className:s.table_body_del,onClick:d,children:t.jsx(q,{name:"TrashIcon",width:20,height:20})})]})}function os({column:e}){const{TemporaryData:a}=T();return t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(o=>t.jsx("td",{className:s.table_head_col,children:o.title},o.id))})}),t.jsx("tbody",{className:s.table_body,children:a==null?void 0:a.map(o=>t.jsx(ss,{item:o,column:e},o==null?void 0:o.mxikCode))})]})}function ns({clearTable:e,setData:a}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:a,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:o=>e(o),children:"Отмена"})]})}function as(){const e=k.useRef(null),[a,o]=k.useState(!1),[r,g]=k.useState(0),[n,p]=k.useState(0),u=m=>{e.current&&(o(!0),g(m.pageX-e.current.offsetLeft),p(e.current.scrollLeft))},b=()=>{o(!1)},h=()=>{o(!1)},d=m=>{if(!a||!e.current)return;m.preventDefault();const A=(m.pageX-e.current.offsetLeft-r)*2;e.current.scrollLeft=n-A},{settingsParams:f,ikpuStatus:c,TemporaryData:l,openModalCategory:_,setTemporaryData:v,setCheckedProducts:x,nameProduct:j}=T(),[P,N]=k.useState([]);k.useEffect(()=>{const m=f.filter(y=>y.checked);N(()=>[...m])},[f]);const I=async m=>{m.preventDefault();for(const y of l)await w(y)};async function w(m){var y,A,R;try{const F=U.get("multi-store"),C={multiStoreId:Number(F),categoryId:Number((y=m==null?void 0:m.crmCategory)==null?void 0:y.id),barcode:Number(m==null?void 0:m.internationalCode),nameUz:"string",nameUzc:"string",nameRu:j||((A=m==null?void 0:m.crmNameProduct)==null?void 0:A.toString()),mxik:(R=m==null?void 0:m.mxikCode)==null?void 0:R.toString(),brand:m.brandName??null,oldPrice:Number(m==null?void 0:m.crmArrivalPrice),price:Number(m==null?void 0:m.crmSellingPrice),oldPriceCourse:0,priceCourse:0,nds:0,discount:0},z=await H.post("nomenclatures",C);v([]),x([])}catch(F){console.log(`Ошибка произошла при попытке добавить ${m==null?void 0:m.crmNameProduct} на сервер`,F)}}const D=m=>{m.preventDefault(),v([]),x([])};return t.jsxs("div",{className:s.formWrapper,children:[_&&t.jsx(Z,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:u,onMouseLeave:b,onMouseUp:h,onMouseMove:d,children:[c&&t.jsx(Ye,{}),t.jsx(os,{column:P})]}),t.jsx(ns,{clearTable:D,setData:I})]})}function J(){const{errorModal:e}=T();return t.jsx("div",{className:s.errorModal,children:t.jsx("div",{className:s.errorModal_block,children:t.jsx("p",{children:e==null?void 0:e.message})})})}const cs="_layout_1pbgc_1",rs="_layout_back_1pbgc_4",ls="_layout_title_1pbgc_14",is="_layout_list_1pbgc_19",ds="_layout_link_1pbgc_25",_s="_layout_link_active_1pbgc_34",us="_form_list_1pbgc_38",gs="_form_check_1pbgc_43",ps="_navSetting_1pbgc_49",fs="_found_1pbgc_53",ms="_table_1pbgc_74",bs="_table_head_1pbgc_78",hs="_table_head_row_1pbgc_81",xs="_table_head_col_1pbgc_85",E={layout:cs,layout_back:rs,layout_title:ls,layout_list:is,layout_link:ds,layout_link_active:_s,form_list:us,form_check:gs,navSetting:ps,found:fs,table:ms,table_head:bs,table_head_row:hs,table_head_col:xs};function ks(){const e=k.useRef([]),{necessarilySettings:a,settingsParams:o,setSettingsParams:r}=T();k.useEffect(()=>{e.current.forEach((n,p)=>{n&&(n.checked=o[p].checked,a.forEach(u=>{n.value==u&&(n.checked=!0)}))})},[o]);const g=n=>{const p=o.map(u=>({id:u.id,title:u.title,checked:u.title==n.currentTarget.value?n.currentTarget.checked:u.checked}));r(p)};return t.jsx("nav",{className:E.navSetting,children:t.jsx("form",{action:"",className:E.form,children:t.jsx("ul",{className:E.form_list,children:o==null?void 0:o.map((n,p)=>t.jsx("li",{children:t.jsxs("label",{className:E.form_check,children:[t.jsx("input",{type:"checkbox",value:n.title,ref:u=>{e.current[p]=u},onChange:u=>g(u)}),t.jsx("span",{className:E.form_check_text,children:n.title})]})},n.id))})})})}function js(){const a=O().pathname,{settingsParams:o}=T(),[r,g]=k.useState([]);k.useEffect(()=>{const p=o.filter(u=>u.checked);g(()=>[...p])},[o]);const n=[{id:1,title:"отображения колонок",href:"/addingProducts/settingsAddProducts"}];return t.jsxs("div",{className:"container",children:[t.jsxs("nav",{className:E.layout,children:[t.jsx(B,{className:E.layout_back,to:"/addingProducts",children:"Закрыть"}),t.jsx("h2",{className:E.layout_title,children:"Настройки"}),t.jsx("ul",{className:E.layout_list,children:n.map(p=>t.jsx("li",{children:t.jsx(B,{to:p.href,className:`${E.layout_link} ${p.href==a?E.layout_link_active:""}`,children:p.title})},p.id))}),a=="/addingProducts/settingsAddProducts"&&t.jsx(ks,{})]}),t.jsx("section",{className:E.found,children:t.jsxs("table",{className:E.table,children:[t.jsx("thead",{className:E.table_head,children:t.jsx("tr",{className:E.table_head_row,style:{gridTemplateColumns:`repeat(${r.length}, 200px)`},children:r==null?void 0:r.map(p=>t.jsx("td",{className:E.table_head_col,children:p.title},p.id))})}),t.jsx("tbody",{className:E.table_body,children:t.jsx("tr",{className:E.table_body_row,children:t.jsx("td",{className:E.table_body_col})})})]})})]})}function Ps({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsxs("div",{className:s.left_content,children:[e.map(a=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:a.title}),t.jsx("p",{children:a.value})]},a.id)),t.jsx("span",{style:{fontSize:"14px"},children:"(нужны картинки с сервера при get, post, patch запрсе по name)"})]})})}function vs(){const{stockImagesSrc:e,setStockImagesSrc:a}=T(),[o,r]=k.useState(null),g=k.useRef([]),n=l=>{g.current.forEach(_=>{_&&_.getAttribute("id")==l&&_.click()})};function p(l,_){r(_)}function u(l){l.target.style.background="white"}function b(l){l.target.style.background="white"}function h(l){l.preventDefault(),l.target.style.background="lightgray"}function d(l,_){l.preventDefault(),l.target.style.background="white";const v=e.map(x=>x.id===_.id?{...x,order:(o==null?void 0:o.order)||x.order}:x.id===(o==null?void 0:o.id)?{...x,order:_.order}:x);a(v),r(null)}function f(l,_){return l.order>_.order?1:-1}const c=l=>{var v,x;const _=(x=(v=l==null?void 0:l.target)==null?void 0:v.files)==null?void 0:x[0];if(_&&(_==null?void 0:_.type)==="image/jpeg"||(_==null?void 0:_.type)==="image/png"||(_==null?void 0:_.type)==="image/webp"){const j=l.target.getAttribute("id"),P=[...e],N=P.find(w=>w.id==j),I=P.findIndex(w=>w.id==j);if(N){const w=new FileReader;w.onload=D=>{var m;(m=D.target)!=null&&m.result&&(N.src=URL.createObjectURL(_),P.splice(I,1,N),a([...P]))},w.readAsDataURL(_)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(f).map((l,_)=>{var v;return t.jsxs("div",{draggable:!0,onDragStart:x=>p(x,l),onDragLeave:x=>u(x),onDragEnd:x=>b(x),onDragOver:x=>h(x),onDrop:x=>d(x,l),className:_==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>n(l.id),children:[t.jsx("input",{id:l.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:c,ref:x=>{g.current[_]=x}}),t.jsx("img",{src:l.src=="/noPhoto.jpg"||((v=l.src)==null?void 0:v.toString().split(":")[0])=="blob"?l.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+l.src,width:_==0?150:50,height:_==0?150:50,alt:"",className:`${_==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},l.id)})})})})}function ys({addingImgToProduct:e,handleCancel:a}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(B,{to:"#",className:s.ikpuWrapper_save,onClick:o=>e(o),children:"Coхранить"}),t.jsx(B,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(B,{to:"#",onClick:o=>a(o),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const G=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""}];function Ns(){const{searchResponseItem:e,stockImagesSrc:a,setStockImagesSrc:o,setSearchResponseItem:r,setStockIkpuStatus:g}=T(),[n,p]=k.useState([]);k.useEffect(()=>{if(e){const h=G==null?void 0:G.map(d=>{var c;let f;return d.title=="ИКПУ:"&&(f=e.mxik),d.title=="Штрих-код:"&&(f=e.barcode),d.title=="Группа:"&&(f=e.groupName),d.title=="Класс:"&&(f=e.className),d.title=="Позиция:"&&(f=e.positionName),d.title=="Субпозиция:"&&(f=e.subPositionName),d.title=="Наименование:"&&(f=(c=e.name)==null?void 0:c.ru),d.title=="Бренд:"&&(f=e.brand),d.title=="Описание:"&&(f=e.description),{id:d.id,title:d.title,value:f}});p([...h])}},[e]),k.useEffect(()=>{if(e.photos){const h=a.map((d,f)=>{var c,l;return{id:d.id,order:d.order,src:(c=e==null?void 0:e.photos)!=null&&c[f]?(l=e==null?void 0:e.photos)==null?void 0:l[f]:"/noPhoto.jpg"}});h&&o(h)}},[]);const u=h=>{h.preventDefault();const d=a==null?void 0:a.map(f=>f.src);e.photos=d,r(e),g(!1)};function b(h){h.preventDefault();const d=a.map(f=>({id:f.id,order:f.order,src:f.src}));o(d),g(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:b,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:h=>h.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(Ps,{staticList:n}),t.jsx(vs,{})]}),t.jsx(ys,{addingImgToProduct:u,handleCancel:b})]})})})}function Ss({item:e}){const[a,o]=k.useState(e.oldPrice),{stockTemporaryData:r,setStockTemporaryData:g}=T(),n=p=>{const u=p.target.value;o(Number(u));const b=r.filter(d=>d.id==e.id)[0],h=r.findIndex(d=>d.id==e.id);b&&(b.oldPrice=Number(u),r.splice(h,1,b),g([...r]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:a,className:s.table_body_amount,min:0,onChange:n})})}function ws({item:e}){const[a,o]=k.useState(e.price),{stockTemporaryData:r,setStockTemporaryData:g}=T(),n=p=>{const u=p.target.value;o(Number(u));const b=r.filter(d=>d.id==e.id)[0],h=r.findIndex(d=>d.id==e.id);b.price&&(b.price=Number(u),r.splice(h,1,b),g([...r]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:a,className:s.table_body_amount,min:0,onChange:n})})}function $s({item:e}){const[a,o]=k.useState(0),{stockTemporaryData:r,setStockTemporaryData:g}=T(),n=p=>{const u=p.target.valueAsNumber;o(u);const b=r.find(h=>h.id==e.id);if(b){const h=r.findIndex(f=>f.id==e.id),d=[...r];d.splice(h,1,b),g(d)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:a,min:0,className:s.table_body_amount,onChange:n})})}function Is({item:e,column:a}){const{stockTemporaryData:o,setSearchResponseItem:r,searchResponseItem:g,setStockIkpuStatus:n,setStockTemporaryData:p,setOpenModalCategory:u,setCurrentProduct:b,setImagesSrc:h}=T(),d=c=>{r(c),n(!0)},f=()=>{o&&p(o.filter(c=>c.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${a.length}, 200px)`},children:[a==null?void 0:a.map(c=>{var l;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(c==null?void 0:c.title)=="Количество"&&t.jsx($s,{item:e}),(c==null?void 0:c.title)=="Приходная цена"&&t.jsx(Ss,{item:e}),(c==null?void 0:c.title)=="Продажная цена"&&t.jsx(ws,{item:e}),(c==null?void 0:c.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:(l=e==null?void 0:e.name)==null?void 0:l.ru}),(c==null?void 0:c.title)=="Фото"?t.jsx("img",{src:"/noPhoto.jpg",width:40,height:40,alt:"",className:s.table_body_img}):"",(c==null?void 0:c.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(c==null?void 0:c.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(c==null?void 0:c.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>d(e),children:t.jsx(q,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(c==null?void 0:c.title)=="Штрих-код"&&(e!=null&&e.barcode)?e==null?void 0:e.barcode:""]},c==null?void 0:c.id)}),t.jsx("td",{className:s.table_body_del,onClick:f,children:t.jsx(q,{name:"TrashIcon",width:20,height:20})})]})}function Ds({column:e}){const{stockTemporaryData:a}=T(),[o,r]=k.useState([]);return k.useEffect(()=>{r(a)},[a]),t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(g=>t.jsx("td",{className:s.table_head_col,children:g.title},g.id))})}),t.jsx("tbody",{className:s.table_body,children:o==null?void 0:o.map(g=>t.jsx(Is,{item:g,column:e},g==null?void 0:g.id))})]})}function Ts({clearTable:e,setData:a}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:a,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:o=>e(o),children:"Отмена"})]})}function As(){const e=k.useRef(null),[a,o]=k.useState(!1),[r,g]=k.useState(0),[n,p]=k.useState(0),u=m=>{e.current&&(o(!0),g(m.pageX-e.current.offsetLeft),p(e.current.scrollLeft))},b=()=>{o(!1)},h=()=>{o(!1)},d=m=>{if(!a||!e.current)return;m.preventDefault();const A=(m.pageX-e.current.offsetLeft-r)*2;e.current.scrollLeft=n-A},{settingsParams:f,stockIkpuStatus:c,stockTemporaryData:l,openModalCategory:_,setStockTemporaryData:v,setCheckedProducts:x,nameProduct:j}=T(),[P,N]=k.useState([]);k.useEffect(()=>{const m=f.filter(y=>y.checked&&y.title!="Подкатегория");N(()=>[...m])},[f]);const I=m=>{m.preventDefault(),l.forEach(y=>{w(y)})};async function w(m){var y;try{const A=U.get("multi-store"),R={nameRu:(y=m.name)==null?void 0:y.ru,oldPrice:m.oldPrice,price:m.price};await H.patch(`nomenclatures/${m.id}`,R),v([]),x([])}catch(A){console.log(`Ошибка произошла при попытке добавить ${m==null?void 0:m.crmNameProduct} на сервер`,A)}}const D=m=>{m.preventDefault(),v([]),x([])};return t.jsxs("div",{className:s.formWrapper,children:[_&&t.jsx(Z,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:u,onMouseLeave:b,onMouseUp:h,onMouseMove:d,children:[c&&t.jsx(Ns,{}),t.jsx(Ds,{column:P})]}),t.jsx(Ts,{clearTable:D,setData:I})]})}async function ot(e,a,o,r,g){try{if(e==="По тексту"){console.log("fetchStockProducts page",r,"perPage",g);const n=await H.get(`nomenclatures?multiStoreId=${a}&name=${o}&page=${r}&perPage=${g}`);console.log("fetchStockProducts res",n);const p=await n.data.data,u=await n.data.pagination.total,b=await n.data.pagination.total_pages;return{data:p,totalElements:u,totalPages:b}}}catch(n){console.log("Ошибка при получении продуктов со склада",n)}}function Ws(){const a=O().pathname,{stockPickedSearch:o,setStockPickedSearch:r,stockSearchParams:g,stockSearchText:n,setStockSearchText:p,setStockSearchResponse:u,stockTemporaryData:b,setTotalElementsStore:h,setTotalPagesStore:d,stockPage:f,perPage:c}=T(),[l,_]=k.useState("");k.useEffect(()=>{_(""),p("")},[a]),k.useEffect(()=>{(o=="По штрих-коду"||o=="По ИКПУ")&&(n.toString(),n.length<13&&r("По ТН ВЭД"),n.length==13&&r("По штрих-коду"),n.length>13&&r("По ИКПУ")),n.length>0&&_("")},[n]),k.useEffect(()=>{const j=document.querySelector(`input[name="search"][value="${o}"]`);j&&(j.checked=!0)},[o]);const v=j=>{r(j.currentTarget.value)},x=async j=>{j.preventDefault();const P=U.get("access_token"),N=U.get("multi-store");if((!P||!N)&&await V(),n.length>0&&N){const{data:I,totalElements:w,totalPages:D}=await ot(o,N,n,f,c);console.log("totalElements",w,"totalPages",D),I.length==0&&_("ничего не найдено"),w&&D&&(h(w),d(D));const m=I.filter(y=>!b.some(A=>A.id===y.id));u(m)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.navStock,children:[t.jsxs("ul",{className:s.navStock_buttons,children:[t.jsx("li",{children:t.jsxs(B,{className:`${s.back} ${s.navStock_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(q,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(B,{to:"/addingProducts/settingsAddProducts",className:`${s.navStock_linkBtn} ${s.navStock_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(q,{name:"Cog8ToothIcon",className:s.navStock_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:s.stockForm,onSubmit:j=>x(j),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:n,type:o=="По штрих-коду"||o=="По ИКПУ"?"number":"text",className:s.stockForm_input,placeholder:o,onChange:j=>p(j.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.stockForm_btn,children:"Поиск"})]}),t.jsx("ul",{className:s.stockForm_list,children:g==null?void 0:g.map(j=>t.jsx("li",{children:t.jsxs("label",{className:s.stockForm_check,children:[t.jsx("input",{type:"radio",name:"search",value:j.title,onClick:P=>v(P)}),t.jsx("span",{className:s.stockForm_check_text,children:j.title})]})},j.id))})]}),t.jsx("span",{className:s.navStock_error,children:l})]})})}function Es({addSelectedProducts:e,setCancel:a}){const{setAddBlockStatus:o}=nt(),r=()=>{a(),o(!1)};return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(B,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>e(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:r,children:"Отмена"})]})}function Bs(){const{stockSearchResponse:e,setStockSearchResponse:a,stockCheckedProducts:o,setStockCheckedProducts:r,stockTemporaryData:g,setStockTemporaryData:n,totalElementsStore:p,setTotalElementsStore:u,totalPagesStore:b,setTotalPagesStore:h,stockSearchText:d,setStockSearchText:f,stockPickedSearch:c,stockPage:l,setStockPage:_,setPerPage:v,perPage:x}=T(),[j,P]=k.useState([]),[N,I]=k.useState([]),[w,D]=k.useState(!1),m=k.useRef([]),y=k.useRef(null);k.useEffect(()=>{P([...e]),console.log("stockSearchResponse",e)},[e]);const A=()=>{o&&n([...o,...g]),a([]),r([]),z()},R=(i,S)=>{if(i){I([...N,S]);const $=j.filter(W=>W.id==S)[0];r([...o,$])}else if(!i&&y.current){const $=N.filter(M=>M!=S);I([...$]);const W=o.filter(M=>M.id!=S);r([...W]),D(!1),y.current.checked=!1}y.current&&i&&N.length+1==j.length&&(D(!0),y.current.checked=!0,r([...j]))},F=i=>{if(D(i),i){m.current.forEach($=>{$&&($.checked=i)});const S=j.map($=>$.id);I([...S]),r([...j])}else I([]),m.current.forEach(S=>{S&&(S.checked=i)}),r([])},C=async i=>{i.preventDefault();const S=l+1;_(S);const $=U.get("multi-store");if($){const{data:W}=await ot(c,$,d,S,x),M=W.filter(X=>!g.some(K=>K.id===X.id));console.log("filteredSearchResponse",M),console.log("stockSearchResponse",e),console.log("stockSearchText",d),y.current&&(D(!1),y.current.checked=!1,a([...M,...e]))}},z=()=>{a([]),r([]),u(0),h(0),f(""),_(1),v(5)};return t.jsx("section",{className:s.foundProducts,onClick:z,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",p]}),t.jsxs("span",{children:["Текущее количество - ",j.length]}),t.jsxs("span",{children:["Выбрано элементов - ",N.length]})]}),l<b&&b!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:i=>C(i),children:"добавить ещё..."}),j.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:i=>F(i.target.checked),ref:y}),t.jsx("span",{children:w?"Отключить все":"Выбрать все"})]}),t.jsx(Es,{addSelectedProducts:A,setCancel:z})]}),t.jsx("ul",{className:s.foundProducts_list,children:j==null?void 0:j.map((i,S)=>{var $;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.barcode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.mxik})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.brand})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:($=i==null?void 0:i.name)==null?void 0:$.ru})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:i==null?void 0:i.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${w||N.includes(i.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:W=>R(W.target.checked,i.id),ref:W=>{m.current[S]=W}}),"Выбрать"]})]},i==null?void 0:i.id)})})]})})}function zs(){const a=O().pathname,{searchResponse:o,stockSearchResponse:r,checkedProducts:g,errorModal:n,searchText:p,TemporaryData:u,stockTemporaryData:b,setTemporaryData:h,setCheckedProducts:d}=T();k.useEffect(()=>{f()},[]);const f=()=>{h([]),d([])};return t.jsxs(t.Fragment,{children:[a=="/addingProducts"&&t.jsxs("div",{className:`container ${s.container}`,children:[t.jsx(Xe,{}),t.jsxs("div",{className:s.addingProductsButton,children:[t.jsx(B,{to:"/addingProducts",className:`${s.addingProductsButton_btn} ${s.addingProductsButton_btn_active}`,children:"Гос. база"}),t.jsx(B,{to:"/addingProducts/stockProducts",className:s.addingProductsButton_btn,children:"Склад"})]}),o.length>0&&t.jsx(Qe,{}),u.length>0&&t.jsx(as,{}),n.status&&t.jsx(J,{})]}),a=="/addingProducts/stockProducts"&&t.jsxs("div",{className:`container ${s.container}`,children:[t.jsx(Ws,{}),t.jsxs("div",{className:s.addingProductsButton,children:[t.jsx(B,{to:"/addingProducts",className:s.addingProductsButton_btn,children:"Гос. база"}),t.jsx(B,{to:"/addingProducts/stockProducts",className:`${s.addingProductsButton_btn} ${s.addingProductsButton_btn_active}`,children:"Склад"})]}),r.length>0&&t.jsx(Bs,{}),b.length>0&&t.jsx(As,{}),n.status&&t.jsx(J,{})]}),a=="/addingProducts/settingsAddProducts"&&t.jsx(js,{})]})}export{zs as default};
