import{w as O,b as V,c as X,r as f,j as t,L as D,y as U,x as Q,D as st,a as it}from"./index-Ch0w1gqK.js";import{a as w,C as _t,D as dt,M as ut}from"./Modal-DnT9dUFH.js";import{C as R}from"./CustomIcon-DSx6vhij.js";import"./XMarkIcon-DjrrFDlF.js";const gt="_container_vugj8_1",mt="_nav_vugj8_11",ft="_nav_linkBtn_vugj8_15",bt="_nav_settingsIcon_vugj8_19",pt="_nav_buttons_vugj8_23",ht="_nav_buttons_link_vugj8_28",jt="_nav_buttons_iconSetting_vugj8_33",xt="_setting_vugj8_1",kt="_nav_error_vugj8_36",vt="_nav_form_vugj8_43",yt="_nav_form_left_vugj8_49",Pt="_nav_form_input_vugj8_59",Nt="_nav_form_btn_vugj8_64",St="_nav_form_list_vugj8_95",Mt="_nav_form_check_vugj8_100",wt="_nav_form_check_text_vugj8_106",Ct="_navStock_vugj8_110",$t="_navStock_linkBtn_vugj8_113",It="_navStock_settingsIcon_vugj8_118",At="_navStock_buttons_vugj8_122",Et="_navStock_buttons_link_vugj8_127",Dt="_navStock_buttons_iconSetting_vugj8_132",Tt="_navStock_error_vugj8_135",Rt="_stockForm_vugj8_143",Lt="_stockForm_input_vugj8_154",Wt="_stockForm_btn_vugj8_160",zt="_stockForm_list_vugj8_191",Bt="_stockForm_check_vugj8_196",Ft="_stockForm_check_text_vugj8_202",Ht="_formWrapper_vugj8_206",qt="_formWrapper_buttons_vugj8_212",Ut="_formWrapper_btn_vugj8_218",Gt="_formWrapper_btn_cancel_vugj8_230",Ot="_formWrapper_btn_save_vugj8_233",Zt="_found_vugj8_237",Xt="_table_vugj8_261",Vt="_table_head_vugj8_266",Qt="_table_head_row_vugj8_269",Kt="_table_head_col_vugj8_274",Jt="_table_head_minCol_vugj8_277",Yt="_table_body_row_vugj8_283",te="_table_body_col_vugj8_288",ee="_table_body_minCol_vugj8_297",oe="_table_body_img_vugj8_303",se="_table_body_icon_vugj8_307",ae="_table_body_nameHover_vugj8_311",ne="_table_body_name_vugj8_311",ce="_table_body_nameString_vugj8_352",le="_table_body_amount_vugj8_361",re="_table_body_catalog_vugj8_369",ie="_table_body_catalog_top_vugj8_379",_e="_table_body_catalog_icon_vugj8_398",de="_table_body_catalog_iconActive_vugj8_401",ue="_table_body_catalog_drop_vugj8_404",ge="_table_body_catalog_dropActive_vugj8_429",me="_table_body_catalog_search_vugj8_434",fe="_table_body_catalog_item_vugj8_448",be="_table_body_catalog_text_vugj8_456",pe="_table_body_buttons_vugj8_462",he="_table_body_del_vugj8_467",je="_table_body_generation_vugj8_467",xe="_table_body_barcodeSave_vugj8_467",ke="_table_body_still_vugj8_467",ve="_table_body_category_vugj8_482",ye="_table_body_category_btn_vugj8_487",Pe="_table_body_category_span_vugj8_502",Ne="_table_body_qr_vugj8_517",Se="_table_body_barcode_vugj8_467",Me="_table_body_error_vugj8_534",we="_table_body_unit_vugj8_542",Ce="_table_body_unit_dropdown_vugj8_545",$e="_ikpuWrapper_vugj8_551",Ie="_ikpuWrapper_ikpuModalBlock_vugj8_560",Ae="_ikpuWrapper_content_vugj8_570",Ee="_ikpuWrapper_buttons_vugj8_576",De="_ikpuWrapper_save_vugj8_582",Te="_ikpuWrapper_delete_vugj8_592",Re="_ikpuWrapper_cancel_vugj8_602",Le="_left_vugj8_613",We="_left_content_vugj8_616",ze="_left_content_item_vugj8_621",Be="_right_vugj8_631",Fe="_right_block_vugj8_635",He="_right_bottom_vugj8_641",qe="_right_bottom_item_vugj8_649",Ue="_right_bottom_item_img_vugj8_659",Ge="_right_bottom_BaseItem_vugj8_664",Oe="_right_bottom_BaseItem_img_vugj8_675",Ze="_foundProducts_vugj8_680",Xe="_foundProducts_modal_vugj8_688",Ve="_foundProducts_top_vugj8_713",Qe="_foundProducts_top_buttons_vugj8_727",Ke="_foundProducts_top_add_vugj8_732",Je="_foundProducts_top_close_vugj8_749",Ye="_foundProducts_item_vugj8_753",to="_foundProducts_item_mxik_vugj8_761",eo="_foundProducts_item_content_vugj8_786",oo="_foundProducts_item_photo_vugj8_791",so="_foundProducts_item_list_vugj8_804",ao="_foundProducts_item_list_box_vugj8_810",no="_foundProducts_item_title_vugj8_832",co="_foundProducts_item_myIcon_vugj8_836",lo="_foundProducts_item_desc_vugj8_843",ro="_foundProducts_item_btn_vugj8_847",io="_foundProducts_item_btn_active_vugj8_861",_o="_foundProducts_title_vugj8_865",uo="_foundProducts_more_vugj8_873",go="_foundProducts_allActive_vugj8_890",mo="_foundProducts_buttons_vugj8_896",fo="_foundProducts_btn_vugj8_902",bo="_foundProducts_btn_cancel_vugj8_914",po="_foundProducts_btn_save_vugj8_917",ho="_foundProducts_list_vugj8_920",jo="_errorModal_vugj8_925",xo="_errorModal_block_vugj8_934",ko="_addingProducts_vugj8_952",vo="_leftMenu_vugj8_956",yo="_leftMenu_list_vugj8_969",Po="_leftMenu_li_vugj8_969",No="_leftMenu_li_icon_vugj8_1009",So="_leftMenu_li_icon_active_vugj8_1013",Mo="_leftMenu_li_active_vugj8_1017",wo="_leftMenu_link_vugj8_1032",Co="_leftMenu_link_active_vugj8_1047",$o="_leftMenu_linkArrow_vugj8_1051",Io="_leftMenu_linkArrow_active_vugj8_1057",Ao="_leftMenu_active_vugj8_1063",Eo="_miniInfo_content_vugj8_1075",Do="_miniInfo_imgBlock_vugj8_1083",To="_miniInfo_list_vugj8_1093",o={container:gt,nav:mt,nav_linkBtn:ft,nav_settingsIcon:bt,nav_buttons:pt,nav_buttons_link:ht,nav_buttons_iconSetting:jt,setting:xt,nav_error:kt,nav_form:vt,nav_form_left:yt,nav_form_input:Pt,nav_form_btn:Nt,nav_form_list:St,nav_form_check:Mt,nav_form_check_text:wt,navStock:Ct,navStock_linkBtn:$t,navStock_settingsIcon:It,navStock_buttons:At,navStock_buttons_link:Et,navStock_buttons_iconSetting:Dt,navStock_error:Tt,stockForm:Rt,stockForm_input:Lt,stockForm_btn:Wt,stockForm_list:zt,stockForm_check:Bt,stockForm_check_text:Ft,formWrapper:Ht,formWrapper_buttons:qt,formWrapper_btn:Ut,formWrapper_btn_cancel:Gt,formWrapper_btn_save:Ot,found:Zt,table:Xt,table_head:Vt,table_head_row:Qt,table_head_col:Kt,table_head_minCol:Jt,table_body_row:Yt,table_body_col:te,table_body_minCol:ee,table_body_img:oe,table_body_icon:se,table_body_nameHover:ae,table_body_name:ne,table_body_nameString:ce,table_body_amount:le,table_body_catalog:re,table_body_catalog_top:ie,table_body_catalog_icon:_e,table_body_catalog_iconActive:de,table_body_catalog_drop:ue,table_body_catalog_dropActive:ge,table_body_catalog_search:me,table_body_catalog_item:fe,table_body_catalog_text:be,table_body_buttons:pe,table_body_del:he,table_body_generation:je,table_body_barcodeSave:xe,table_body_still:ke,table_body_category:ve,table_body_category_btn:ye,table_body_category_span:Pe,table_body_qr:Ne,table_body_barcode:Se,table_body_error:Me,table_body_unit:we,table_body_unit_dropdown:Ce,ikpuWrapper:$e,ikpuWrapper_ikpuModalBlock:Ie,ikpuWrapper_content:Ae,ikpuWrapper_buttons:Ee,ikpuWrapper_save:De,ikpuWrapper_delete:Te,ikpuWrapper_cancel:Re,left:Le,left_content:We,left_content_item:ze,right:Be,right_block:Fe,right_bottom:He,right_bottom_item:qe,right_bottom_item_img:Ue,right_bottom_BaseItem:Ge,right_bottom_BaseItem_img:Oe,foundProducts:Ze,foundProducts_modal:Xe,foundProducts_top:Ve,foundProducts_top_buttons:Qe,foundProducts_top_add:Ke,foundProducts_top_close:Je,foundProducts_item:Ye,foundProducts_item_mxik:to,foundProducts_item_content:eo,foundProducts_item_photo:oo,foundProducts_item_list:so,foundProducts_item_list_box:ao,foundProducts_item_title:no,foundProducts_item_myIcon:co,foundProducts_item_desc:lo,foundProducts_item_btn:ro,foundProducts_item_btn_active:io,foundProducts_title:_o,foundProducts_more:uo,foundProducts_allActive:go,foundProducts_buttons:mo,foundProducts_btn:fo,foundProducts_btn_cancel:bo,foundProducts_btn_save:po,foundProducts_list:ho,errorModal:jo,errorModal_block:xo,addingProducts:ko,leftMenu:vo,leftMenu_list:yo,leftMenu_li:Po,leftMenu_li_icon:No,leftMenu_li_icon_active:So,leftMenu_li_active:Mo,leftMenu_link:wo,leftMenu_link_active:Co,leftMenu_linkArrow:$o,leftMenu_linkArrow_active:Io,leftMenu_active:Ao,miniInfo_content:Eo,miniInfo_imgBlock:Do,miniInfo_list:To};async function tt(e,a,s,n,i){try{if(e==="По тексту"){const c=await O.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search-subposition?search_text=${a}&page=${s}&size=${n}&lang=${i}`);console.log("По тексту res",c);const g=await c.data.data.content,m=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:g,totalElements:m,totalPages:r}}else if(e==="По штрих-коду"){const c=await O.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?gtin=${a}&size=${n}&page=${s}&lang=${i}`),g=await c.data.data.content,m=await c.data.data.totalElements,r=await c.data.data.totalPages;return console.log("По штрих-коду res",c),{data:g,totalElements:m,totalPages:r}}else if(e==="По ИКПУ"){const c=await O.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?mxikCode=${a}&size=${n}&page=${s}&lang=${i}`);console.log("По ИКПУ res",c);const g=await c.data.data.content,m=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:g,totalElements:m,totalPages:r}}else if(e==="Расширинный по тексту"){const c=await O.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?text=${a}&size=${n}&page=${s}&lang=${i}`);console.log("Расширинный по тексту res",c);const g=await c.data.data.content,m=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:g,totalElements:m,totalPages:r}}else if(e==="По номеру рег. удостовирения"){const c=await O.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/dv-cert-number?dvCertNumber=${a}&page=${s}&size=${n}&lang=${i}`);console.log("По номеру рег. удостовирения res",c);const g=await c.data.data.content,m=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:g,totalElements:m,totalPages:r}}else if(e==="По ТН ВЭД"){const c=await O.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?tnvedCode=${a}&size=${n}&page=${s}&lang=${i}`);console.log("По ТН ВЭД res",c);const g=await c.data.data.content,m=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:g,totalElements:m,totalPages:r}}else if(e==="По бренду"){const c=await O.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?brandName=${a}&size=${n}&page=${s}&lang=${i}`);console.log("По бренду res",c);const g=await c.data.data.content,m=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:g,totalElements:m,totalPages:r}}else if(e==="По MHH"){const c=await O.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/mnn-name?mnn_name=${a}&page=${s}&size=${n}&lang=${i}`);console.log("По MHH res",c);const g=await c.data.data,m=await c.data.recordTotal,r=await m/n;return{data:g,totalElements:m,totalPages:r}}}catch(c){console.log(c)}}async function at(e){var s;const a=V.get("multi-store");try{return(await X.post("nomenclatures/is-unique-name",{multiStoreId:Number(a),nameRu:(s=e.subPositionName)==null?void 0:s.toString()})).data.success}catch(n){return console.log("Ошибка произошла при проверки наличия продукта на складе по наименованию",n),!1}}async function et(e,a){try{return(await O.get(`https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/mxik/picture-names?lang=${a}&mxik_code=${e}`)).data}catch(s){console.log("Ошибка при получении картинок к продукту",s)}}function Ro(){var n,i;const{checkedProductsByCode:e}=w(),[a,s]=f.useState([]);return f.useEffect(()=>{s([...e])},[e]),console.log("localProduct",a),t.jsx("div",{className:o.miniInfo,children:a.length>0&&t.jsxs("div",{className:o.miniInfo_content,children:[t.jsx("div",{className:o.miniInfo_imgBlock,children:t.jsx("img",{src:(i=(n=a[0])==null?void 0:n.photos)!=null&&i.length?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+a[0].photos[0]:"/noPhoto.jpg",alt:""})}),t.jsxs("ul",{className:o.miniInfo_list,children:[t.jsxs("li",{children:[t.jsx("span",{children:"Штрихкод:"}),t.jsx("span",{children:a&&a[0].internationalCode||"-"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"ИКПУ:"}),t.jsx("span",{children:a&&a[0].mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Бренд:"}),t.jsx("span",{children:a&&a[0].brandName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Наименование:"}),t.jsx("span",{children:a&&a[0].subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Ед. Изм:"}),t.jsx("span",{children:a&&a[0].attributeName})]})]})]})})}const Lo="_globalModal_15wz1_1",Wo="_globalModal_back_15wz1_13",zo="_globalModal_container_15wz1_45",Bo="_globalModal_left_15wz1_54",Fo="_globalModal_left_top_15wz1_59",Ho="_globalModal_left_desc_15wz1_64",qo="_globalModal_left_bottom_15wz1_71",Uo="_globalModal_left_bottom_link_15wz1_76",Go="_globalModal_left_bottom_label_15wz1_94",Oo="_globalModal_right_15wz1_109",Zo="_globalModal_right_top_15wz1_114",Xo="_globalModal_right_top_desc_15wz1_119",Vo="_globalModal_right_bottom_15wz1_134",Qo="_globalModal_right_bottom_link_15wz1_139",Ko="_globalModal_right_bottom_label_15wz1_157",Jo="_globalModal_confirm_15wz1_172",Yo="_globalModal_confirm_info_15wz1_184",ts="_globalModal_confirm_desc_15wz1_191",es="_globalModal_confirm_buttons_15wz1_207",os="_globalModal_confirm_btn_15wz1_216",L={globalModal:Lo,globalModal_back:Wo,globalModal_container:zo,globalModal_left:Bo,globalModal_left_top:Fo,globalModal_left_desc:Ho,globalModal_left_bottom:qo,globalModal_left_bottom_link:Uo,globalModal_left_bottom_label:Go,globalModal_right:Oo,globalModal_right_top:Zo,globalModal_right_top_desc:Xo,globalModal_right_bottom:Vo,globalModal_right_bottom_link:Qo,globalModal_right_bottom_label:Ko,globalModal_confirm:Jo,globalModal_confirm_info:Yo,globalModal_confirm_desc:ts,globalModal_confirm_buttons:es,globalModal_confirm_btn:os};function nt({staticText:e,method:a,setModalOpen:s}){const{globalRemember:n,setGlobalRemember:i,programRemember:c,setProgramRemember:g}=w();console.log("staticText",e,"method",a);const m=r=>{a=="program"?(i(r===!0?!1:n),g(r)):a=="global"&&(g(r===!0?!1:c),i(r)),s(!1)};return t.jsx("div",{className:L.globalModal_confirm,children:t.jsxs("div",{className:L.globalModal_confirm_info,children:[e==null?void 0:e.map(r=>t.jsx("p",{className:L.globalModal_confirm_desc,children:r.title},r.id)),t.jsxs("div",{className:L.globalModal_confirm_buttons,children:[t.jsx("button",{className:L.globalModal_confirm_btn,onClick:()=>m(!1),children:"Отменить"}),t.jsx("button",{className:L.globalModal_confirm_btn,onClick:()=>m(!0),children:"Применить"})]})]})})}const ss=[{id:U(),title:"Данная настройка позволяет автоматически производить поиск товара в ручном режиме в национальной базе товаров и услуг PУз"},{id:U(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function as(){const{programRemember:e,searchText:a,setGlobalModal:s,setErrorMessage:n}=w(),i=f.useRef(null),[c,g]=f.useState(!1);f.useEffect(()=>{console.log("globalRemember",e),i.current&&(console.log("checkboxRef.current",i.current.checked),i.current.checked=e)},[e,i]);const m=()=>{g(!0)},r=()=>{n(`по штрихкоду ${a} ничего не найдено, попробуйте найти по названию`),s(!1)};return t.jsxs("div",{className:L.globalModal_left,children:[c&&t.jsx(nt,{staticText:ss,method:"program",setModalOpen:g}),t.jsxs("div",{className:L.globalModal_left_top,children:[t.jsx(R,{name:"MapPinIcon",width:35,height:35}),t.jsx("p",{className:L.globalModal_left_desc,children:"Данный товар не найден в национальной базе товаров и услуг."})]}),t.jsxs("div",{className:L.globalModal_left_bottom,children:[t.jsx(D,{to:"#",className:L.globalModal_left_bottom_link,onClick:r,children:"Искать в программе"}),t.jsxs("div",{className:L.globalModal_left_bottom_label,onClick:m,children:[t.jsx("input",{type:"checkbox",className:L.globalModal_left_bottom_checkbox,ref:i}),t.jsx("span",{children:"Запомнить это действие "})]})]})]})}async function ct(e){try{console.log("getGlobalProduct barcode",e);const a=await O.get(`https://api.barcodelookup.com/v3/products?barcode=${e}&formatted=y&key=7yd26itc9ov4fdwfymvp888cyuepbl`);console.log("getGlobalProduct res",a)}catch(a){console.log("Ошибкра при поиске продукта в глобальной базе",a)}}const ns=[{id:U(),title:"Данная настройка позволяет автоматически производить поиск в глобальной базе, в случаи если в национальной базе товары не были найдены"},{id:U(),title:"Внимание! В случаи глобального поиска, ИКПУ не будет присвоен."},{id:U(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function cs(){const{searchText:e,globalRemember:a,setGlobalModal:s}=w(),n=f.useRef(null),[i,c]=f.useState(!1);f.useEffect(()=>{console.log("globalRemember",a),n.current&&(console.log("checkboxRef.current",n.current.checked),n.current.checked=a)},[a,n]),f.useEffect(()=>{console.log("globalRemember",a),n.current&&(console.log("checkboxRef.current",n.current.checked),n.current.checked=a)},[a,n]);const g=async l=>{const _=await ct(l);console.log("handleGlobalSearch data",_)},m=()=>{g(e),s(!1)},r=()=>{c(!0)};return t.jsxs("div",{className:L.globalModal_right,children:[i&&t.jsx(nt,{staticText:ns,method:"global",setModalOpen:c}),t.jsxs("div",{className:L.globalModal_right_top,children:[t.jsx(R,{name:"GlobeAltIcon",width:35,height:35}),t.jsxs("p",{className:L.globalModal_right_top_desc,children:[t.jsx("span",{children:"Ипользовать глобальный поиск"}),t.jsx("span",{children:"(В этом случаи, товару не будет присвоен ИКПУ)"})]})]}),t.jsxs("div",{className:L.globalModal_right_bottom,children:[t.jsx(D,{to:"#",className:L.globalModal_right_bottom_link,onClick:m,children:"Искать глобально"}),t.jsxs("div",{className:L.globalModal_right_bottom_label,onClick:r,children:[t.jsx("input",{type:"checkbox",ref:n,className:L.globalModal_right_bottom_checkbox}),t.jsx("span",{children:"Запомнить это действие"})]})]})]})}function ls(){const{setGlobalModal:e,setSearchText:a}=w(),s=()=>{a(""),e(!1)};return t.jsxs("div",{className:L.globalModal,children:[t.jsxs(D,{to:"#",className:L.globalModal_back,onClick:s,children:[t.jsx(R,{name:"ChevronLeftIcon",width:20,height:15}),t.jsx("span",{children:"Назад"})]}),t.jsxs("div",{className:L.globalModal_container,children:[t.jsx(as,{}),t.jsx(cs,{})]})]})}function rs(){const a=Q().pathname,{pickedSearch:s,setPickedSearch:n,searchText:i,setSearchText:c,searchParams:g,TemporaryData:m,setTemporaryData:r,setSearchResponse:l,setTotalElementsStore:_,setTotalPagesStore:b,setCheckedProductsByCode:x,checkedProductsByCode:u,setPage:d,page:j,perPage:p,lang:N,globalModal:y,setGlobalModal:S,globalRemember:E,programRemember:C,errorMessage:h,setErrorMessage:P}=w(),[T,z]=f.useState([]);f.useEffect(()=>{z([...u])},[u]),f.useEffect(()=>{P(""),c("")},[a]),f.useEffect(()=>{(s=="По штрих-коду"||s=="По ИКПУ"||s=="По ТН ВЭД")&&(i.toString(),i.length<13&&n("По ТН ВЭД"),i.length==13&&n("По штрих-коду"),i.length>13&&n("По ИКПУ"))},[i]),f.useEffect(()=>{const M=document.querySelector(`input[name="search"][value="${s}"]`);M&&(M.checked=!0)},[s]);const G=M=>{n(M.currentTarget.value)},k=async M=>{if(M.preventDefault(),l([]),d(0),V.get("access_token")||await st(),i.length>0&&s!="По штрих-коду"&&s!="По ИКПУ"){console.log("1 СЦЕНАРИЙ по тексту"),console.log(222,"searchText",i);const{data:I,totalElements:W,totalPages:B}=await tt(s,i,0,p,N);if(console.log(3333,"data",I),I.length==0){P("ничего не найдено");return}W&&B&&(_(W),b(B));const F=[];for(const Z of I){const q=await et(Z.mxikCode,N);F.push({...Z,id:U(),photos:q,createdByHand:!1})}l(F)}if(i.length>0&&s=="По штрих-коду"||s=="По ИКПУ"){console.log("2 СЦЕНАРИЙ по коду");const{data:I,totalElements:W,totalPages:B}=await tt(s,i,j,p,N);I.length==0&&P("ничего не найдено"),W&&B&&(_(W),b(B));const F=[];for(const q of I){const K=await at(q),rt=await et(q.mxikCode,N);K&&F.push({...q,id:U(),photos:rt,createdByHand:!1})}if(I.length==0)if(E===!0){const q=await ct(i);console.log("navAddProduct fetchData",q)}else C===!0?(console.log("programRemember === true что дальше? (NavAddProduct 207)",C),P(`по штрихкоду ${i} ничего не найдено, попробуйте найти по названию`)):S(!0);else if(I.length==1&&F.length==0){P("Этот продукт уже есть на складе");return}else if(I.length>0&&F.length>0&&F.filter(q=>m.some(K=>K.mxikCode===q.mxikCode))[0]){P("Вы уже ввбрали это продукт");return}const Z=F.filter(q=>!m.some(K=>K.mxikCode===q.mxikCode));x([...Z]),r([...m,...Z])}},H=M=>{M!=i&&P(""),console.log("value",M),/^[a-zA-Z]+$/.test(M)?(console.log("тексе"),s!="Расширинный по тексту"&&s!="По бренду"&&s!="По номеру рег. удостовирения"&&s!="По MHH"&&(n("По тексту"),P(""))):/^\d+$/.test(M)?(console.log("число"),M.length<=4?(n("По ТН ВЭД"),P(""),console.log("По ТН ВЭД")):M.length>4&&M.length<=13?(console.log("По штрих-коду"),P(""),n("По штрих-коду")):M.length>13&&M.length<=17?(n("По ИКПУ"),P(""),console.log("По ИКПУ")):M.length>17?(console.log("value",M),console.log("код ИКПУ не валидный"),P("код ИКПУ не валидный")):P("Введен невалидный символ")):s!="Расширинный по тексту"&&s!="По бренду"&&s!="По номеру рег. удостовирения"&&s!="По MHH"&&n("По тексту"),c(M)};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:o.nav,children:[y&&t.jsx(ls,{}),t.jsxs("form",{action:"",className:o.nav_form,onSubmit:M=>k(M),children:[t.jsxs("div",{className:o.nav_form_left,children:[t.jsxs("ul",{className:o.nav_buttons,children:[t.jsx("li",{children:t.jsxs(D,{className:`${o.back} ${o.nav_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(R,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(D,{to:"/addingProducts/settingsAddProducts",className:`${o.nav_linkBtn} ${o.nav_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(R,{name:"Cog8ToothIcon",className:o.nav_buttons_iconSetting})]})})]}),t.jsxs("fieldset",{children:[t.jsx("input",{value:i,type:"text",className:o.nav_form_input,placeholder:s,onChange:M=>H(M.currentTarget.value)}),t.jsx("button",{type:"submit",className:o.nav_form_btn,children:"Поиск"})]})]}),T.length>0&&m.length>0&&t.jsx(Ro,{}),t.jsx("ul",{className:o.nav_form_list,children:g==null?void 0:g.map(M=>t.jsx("li",{children:t.jsxs("label",{className:o.nav_form_check,children:[t.jsx("input",{type:"radio",name:"search",value:M.title,onClick:v=>G(v)}),t.jsx("span",{className:o.nav_form_check_text,children:M.title})]})},M.id))})]}),t.jsx("span",{className:o.nav_error,children:h})]})})}function is({staticList:e}){return t.jsx("div",{className:o.left,children:t.jsx("div",{className:o.left_content,children:e.map(a=>t.jsxs("div",{className:o.left_content_item,children:[t.jsx("h3",{children:a.title}),t.jsx("p",{children:a.value})]},a.id))})})}function _s(){const{imagesSrc:e,setImagesSrc:a}=w(),[s,n]=f.useState(null),i=f.useRef([]),c=u=>{i.current.forEach(d=>{d&&d.getAttribute("id")==u&&d.click()})};function g(u,d){n(d)}function m(u){u.target.style.background="white"}function r(u){u.target.style.background="white"}function l(u){u.preventDefault(),u.target.style.background="lightgray"}function _(u,d){u.preventDefault(),u.target.style.background="white";const j=e.map(p=>p.id===d.id?{...p,order:(s==null?void 0:s.order)||p.order}:p.id===(s==null?void 0:s.id)?{...p,order:d.order}:p);a(j),n(null)}function b(u,d){return u.order>d.order?1:-1}const x=u=>{var j,p;const d=(p=(j=u==null?void 0:u.target)==null?void 0:j.files)==null?void 0:p[0];if(d&&(d==null?void 0:d.type)==="image/jpeg"||(d==null?void 0:d.type)==="image/png"||(d==null?void 0:d.type)==="image/webp"){const N=u.target.getAttribute("id"),y=[...e],S=y.find(C=>C.id==N),E=y.findIndex(C=>C.id==N);if(S){const C=new FileReader;C.onload=h=>{var P;(P=h.target)!=null&&P.result&&(S.src=URL.createObjectURL(d),y.splice(E,1,S),a([...y]))},C.readAsDataURL(d)}}};return t.jsx("div",{className:o.right,children:t.jsx("div",{className:o.right_block,children:t.jsx("div",{className:o.right_bottom,children:e.sort(b).map((u,d)=>{var j;return t.jsxs("div",{draggable:!0,onDragStart:p=>g(p,u),onDragLeave:p=>m(p),onDragEnd:p=>r(p),onDragOver:p=>l(p),onDrop:p=>_(p,u),className:d==0?o.right_bottom_BaseItem:o.right_bottom_item,onDoubleClick:()=>c(u.id),children:[t.jsx("input",{id:u.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:x,ref:p=>{i.current[d]=p}}),t.jsx("img",{src:u.src=="/noPhoto.jpg"||((j=u.src)==null?void 0:j.toString().split(":")[0])=="blob"?u.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+u.src,width:d==0?150:50,height:d==0?150:50,alt:"",className:`${d==0?o.right_bottom_baseImg:o.right_bottom_img}`})]},u.id)})})})})}function ds({addingImgToProduct:e,handleCancel:a}){const{ikpuStatus:s}=w();return t.jsxs("div",{className:o.ikpuWrapper_buttons,children:[t.jsx(D,{to:"#",className:o.ikpuWrapper_save,onClick:n=>e(n),children:"Coхранить"}),s.type==="info photo"&&t.jsx(D,{to:"#",className:o.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(D,{to:"#",onClick:n=>a(n),className:o.ikpuWrapper_cancel,children:"Отмена"})]})}const J=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:3,title:"Группа:",value:""},{id:4,title:"Класс:",value:""},{id:5,title:"Позиция:",value:""},{id:6,title:"Субпозиция:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""},{id:9,title:"Описание:",value:""}];function us(){const{searchResponseItem:e,imagesSrc:a,setImagesSrc:s,setSearchResponseItem:n,setIkpuStatus:i,ikpuStatus:c}=w(),[g,m]=f.useState([]);f.useEffect(()=>{if(e){const _=J==null?void 0:J.map(b=>{let x;return b.title=="ИКПУ:"&&(x=e.mxikCode),b.title=="Штрих-код:"&&(x=e.internationalCode),b.title=="Группа:"&&(x=e.groupName),b.title=="Класс:"&&(x=e.className),b.title=="Позиция:"&&(x=e.positionName),b.title=="Субпозиция:"&&(x=e.subPositionName),b.title=="Наименование:"&&(x=e.className),b.title=="Бренд:"&&(x=e.brandName),b.title=="Описание:"&&(x=e.attributeName),{id:b.id,title:b.title,value:x}});m([..._])}},[e]),f.useEffect(()=>{if(e.photos){const _=a.map((b,x)=>{var u,d;return{id:b.id,order:b.order,src:(u=e==null?void 0:e.photos)!=null&&u[x]?(d=e==null?void 0:e.photos)==null?void 0:d[x]:"/noPhoto.jpg"}});_&&s(_)}},[]);const r=_=>{_.preventDefault();const b=a==null?void 0:a.map(x=>x.src);e.photos=b,n(e),i({status:!1,type:""})};function l(_){_.preventDefault();const b=a.map(x=>({id:x.id,order:x.order,src:x.src}));s(b),i({status:!1,type:""})}return t.jsx(t.Fragment,{children:t.jsx("div",{className:o.ikpuWrapper,onClick:l,children:t.jsxs("div",{className:o.ikpuWrapper_ikpuModalBlock,onClick:_=>_.stopPropagation(),style:{width:c.type==="info photo"?"700px":"250px",minHeight:c.type==="info photo"?"500px":"400px"},children:[t.jsxs("div",{className:o.ikpuWrapper_content,children:[c.type==="info photo"&&t.jsx(is,{staticList:g}),t.jsx(_s,{})]}),t.jsx(ds,{addingImgToProduct:r,handleCancel:l})]})})})}function gs({item:e}){const{TemporaryData:a,setTemporaryData:s}=w(),[n,i]=f.useState(e.crmArrivalPrice??"0"),[c,g]=f.useState(""),m=l=>{if(/^[a-zA-Z]+$/.test(l))g("Введите число");else if(/^\d+$/.test(l))if(l.length==2&&l[0]=="0"){const _=l[1];i(_),g(""),r(_)}else g(""),i(l),r(l);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(l)?g("Введите число"):l==""&&(r("0"),g(""),i("0"))},r=l=>{a.forEach(_=>{_.id==e.id&&(_.crmArrivalPrice=Number(l))}),s(a)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",value:n,className:o.table_body_amount,onChange:l=>m(l.target.value)})]})}function ms({item:e}){const{TemporaryData:a,setTemporaryData:s}=w(),[n,i]=f.useState(e.crmSellingPrice??"0"),[c,g]=f.useState(""),m=l=>{if(/^[a-zA-Z]+$/.test(l))g("Введите число");else if(/^\d+$/.test(l))if(l.length==2&&l[0]=="0"){const _=l[1];i(_),g(""),r(_)}else g(""),i(l),r(l);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(l)?g("Введите число"):l==""&&(r("0"),g(""),i("0"))},r=l=>{a.forEach(_=>{_.id==e.id&&(_.crmSellingPrice=Number(l))}),s(a)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",value:n,className:o.table_body_amount,onChange:l=>m(l.target.value)})]})}function fs({item:e}){const{TemporaryData:a,setTemporaryData:s}=w(),[n,i]=f.useState(e.crmAmount??"0"),[c,g]=f.useState(""),m=l=>{if(/^[a-zA-Z]+$/.test(l))g("Введите число");else if(/^\d+$/.test(l))if(l.length==2&&l[0]=="0"){const _=l[1];i(_),g(""),r(_)}else g(""),i(l),r(l);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(l)?g("Введите число"):l==""&&(r("0"),g(""),i("0"))},r=l=>{a.forEach(_=>{_.id==e.id&&(_.crmAmount=Number(l))}),s(a)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",value:n,className:o.table_body_amount,onChange:l=>m(l.target.value)})]})}function bs({item:e}){const{TemporaryData:a,setTemporaryData:s}=w(),[n,i]=f.useState(e.crmNameProduct??""),[c,g]=f.useState(!1),[m,r]=f.useState("");f.useEffect(()=>{_(n)},[n]);const l=u=>{i(u),r("")},_=u=>{a.forEach(d=>{d.id==e.id&&(d.crmNameProduct=u)}),s(a)},b=()=>{console.log("hover"),g(!0)},x=()=>{console.log("hover"),g(!1)};return e.createdByHand===!0?t.jsxs("div",{className:o.table_body_nameBlock,children:[t.jsx("span",{className:o.table_body_error,children:m}),t.jsx("textarea",{onChange:u=>l(u.target.value),value:`${n}`,className:o.table_body_name,placeholder:e!=null&&e.subPositionName?e==null?void 0:e.subPositionName:e.crmNameProduct?e.crmNameProduct:"Добавьте наименование",children:n})]}):t.jsxs("div",{className:o.table_body_nameBlock,children:[c&&t.jsx("span",{className:o.table_body_nameHover,children:e.subPositionName}),t.jsx("span",{onMouseEnter:b,onMouseLeave:x,className:o.table_body_nameString,children:e.subPositionName})]})}const ps=(e=0,a=9)=>Math.floor(Math.random()*(a+1-e)+e).toString();function ot(e=13){let a="";for(let s=1;s<=e;s++){const n=ps();a+=n}return a}function hs({item:e}){const{TemporaryData:a,setTemporaryData:s}=w(),[n,i]=f.useState(""),[c,g]=f.useState(""),m=_=>{/^[a-zA-Z]+$/.test(_)?g("Введите число"):/^\d+$/.test(_)?(g(""),i(_)):/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(_)?g("Введите число"):_==""&&(g(""),i(_))},r=()=>{const b=13-n.split("").length,x=b>0?ot(b):ot(),u=b>0?n+x:x;i(u)},l=()=>{if(n.length==13)a.forEach(_=>{_.id==e.id&&(_.internationalCode=n)}),s(a);else{const _=13-n.length;g(`Еще ${_} символов`)}};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",className:o.table_body_barcode,onChange:_=>m(_.target.value),maxLength:13,value:n}),t.jsxs("div",{className:o.table_body_buttons,children:[t.jsx("button",{className:o.table_body_generation,onClick:r,children:"Генерировать"}),t.jsx("button",{className:o.table_body_barcodeSave,onClick:l,children:"Сохранить"})]})]})}function js({item:e}){const{TemporaryData:a,setTemporaryData:s}=w(),[n,i]=f.useState(e.crmQR??!1);f.useEffect(()=>{c(n)},[n]);const c=g=>{a.forEach(m=>{m.id==e.id&&(m.crmQR=g)}),s(a)};return t.jsxs("div",{className:o.table_body_qr,onClick:()=>i(!n),children:[n&&t.jsx(R,{name:"PlusIcon"}),!n&&t.jsx(R,{name:"MinusIcon"}),t.jsx(_t,{status:n,width:50})]})}const xs="_modalCategory_5j9ek_1",ks="_modalCategory_block_5j9ek_10",vs="_modalCategory_nav_5j9ek_16",ys="_modalCategory_nav_title_5j9ek_23",Ps="_modalCategory_nav_close_5j9ek_29",Ns="_modalCategory_content_5j9ek_32",Ss="_modalCategory_content_message_5j9ek_39",Ms="_modalCategory_content_link_5j9ek_47",ws="_modalCategory_content_link_active_5j9ek_76",Cs="_modalCategory_content_item_5j9ek_86",$s="_modalCategory_content_block_5j9ek_108",Is="_modalCategory_content_block_title_5j9ek_112",As="_settings_5j9ek_120",Es="_settings_title_5j9ek_123",Ds="_settings_content_5j9ek_128",Ts="_settings_content_top_5j9ek_131",Rs="_settings_content_buttons_5j9ek_134",Ls="_settings_content_btn_5j9ek_144",Ws="_settings_content_btn_cancel_5j9ek_156",zs="_settings_content_btn_save_5j9ek_159",Bs="_settings_tools_5j9ek_162",Fs="_settings_tools_link_5j9ek_167",Hs="_settings_tools_link_active_5j9ek_182",$={modalCategory:xs,modalCategory_block:ks,modalCategory_nav:vs,modalCategory_nav_title:ys,modalCategory_nav_close:Ps,modalCategory_content:Ns,modalCategory_content_message:Ss,modalCategory_content_link:Ms,modalCategory_content_link_active:ws,modalCategory_content_item:Cs,modalCategory_content_block:$s,modalCategory_content_block_title:Is,settings:As,settings_title:Es,settings_content:Ds,settings_content_top:Ts,settings_content_buttons:Rs,settings_content_btn:Ls,settings_content_btn_cancel:Ws,settings_content_btn_save:zs,settings_tools:Bs,settings_tools_link:Fs,settings_tools_link_active:Hs};function qs({setCancel:e}){return t.jsxs("div",{className:$.modalCategory_nav,children:[t.jsx("h2",{className:$.modalCategory_nav_title,children:"Котегория"}),t.jsx("button",{className:$.modalCategory_nav_close,onClick:e,children:t.jsx(R,{width:24,height:24,name:"XMarkIcon"})})]})}async function Us(e,a){try{return await X.get(`categories?page=${e}&perPage=${a}`)}catch(s){console.log("Ошибка при получении супер категорий при добавлении продукта на склад",s)}}function Gs({superId:e,setSuperId:a,setCategoryId:s}){const[n,i]=f.useState(1),[c,g]=f.useState(1),[m]=f.useState(10),[r,l]=f.useState([]);f.useEffect(()=>{_(n,m)},[]);async function _(u,d){var y,S;const j=await Us(u,d),p=await((y=j==null?void 0:j.data)==null?void 0:y.pagination),N=await((S=j==null?void 0:j.data)==null?void 0:S.data);g(p.total_pages),l([...r,...N])}const b=u=>{u.preventDefault();const d=n+1;i(d),_(d,m),console.log("addPage",d)},x=u=>{s(0),a(u)};return t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Суперкотегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[r==null?void 0:r.map(u=>t.jsxs(D,{to:"#",className:`${$.modalCategory_content_link} ${u.id==e?$.modalCategory_content_link_active:""} `,onClick:d=>x(u.id),children:[u.name.ru,t.jsx(R,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},u.id)),n<c&&t.jsx(D,{to:"#",className:$.modalCategory_content_link,onClick:u=>b(u),children:"Ещё..."})]})]})}async function Os(e,a,s){try{return await X.get(`categories?parentId=${s}&page=${e}&perPage=${a}`)}catch(n){console.log("Ошибка при получении категорий при добавлении продукта на склад",n)}}function Zs({superId:e,categoryId:a,setCategoryId:s,setSubId:n}){const[i,c]=f.useState([]),[g,m]=f.useState(1),[r,l]=f.useState(1),[_]=f.useState(10);f.useEffect(()=>{c([]),m(1),e!==0&&b(1,10)},[e]);async function b(d,j){var S,E;const p=await Os(d,j,e),N=await((S=p==null?void 0:p.data)==null?void 0:S.pagination),y=await((E=p==null?void 0:p.data)==null?void 0:E.data);l(N.total_pages),c(C=>[...C,...y])}const x=d=>{d.preventDefault();const j=g+1;m(j),b(j,_)},u=d=>{n(0),s(d)};return i.length>0&&t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Котегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[i==null?void 0:i.map(d=>t.jsxs(D,{to:"#",className:`${$.modalCategory_content_link} ${d.id==a?$.modalCategory_content_link_active:""} `,onClick:j=>u(d.id),children:[d.name.ru,t.jsx(R,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},d.id)),g<r&&t.jsx(D,{to:"#",className:$.modalCategory_content_link,onClick:d=>x(d),children:"Ещё..."})]})]})}async function Xs(e,a,s){try{return await X.get(`categories?parentId=${s}&page=${e}&perPage=${a}`)}catch(n){console.log("Ошибка при получении субкатегорий при добавлении продукта на склад",n)}}function Vs({categoryId:e,subId:a,setSubId:s,setPickedCategory:n}){const[i,c]=f.useState([]),[g,m]=f.useState(1),[r,l]=f.useState(1),[_]=f.useState(10);f.useEffect(()=>{c([]),m(1),e!==0&&b(1,10)},[e]);async function b(d,j){var S,E;const p=await Xs(d,j,e),N=await((S=p==null?void 0:p.data)==null?void 0:S.pagination),y=await((E=p==null?void 0:p.data)==null?void 0:E.data);l(N.total_pages),c(C=>[...C,...y])}const x=d=>{d.preventDefault();const j=g+1;m(j),b(j,_)},u=(d,j)=>{d.preventDefault(),s(j.id),n(j)};return i.length>0&&t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Подкотегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[i==null?void 0:i.map(d=>t.jsxs(D,{to:"#",className:`${$.modalCategory_content_link} ${d.id==a?$.modalCategory_content_link_active:""} `,onClick:j=>u(j,d),children:[d.name.ru,t.jsx(R,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},d.id)),g<r&&t.jsx(D,{to:"#",className:$.modalCategory_content_link,onClick:d=>x(d),children:"Ещё..."})]})]})}function Qs({setPickedSubCategoryToProduct:e,setCancel:a}){return t.jsxs("div",{className:$.settings_content_buttons,children:[t.jsx(D,{to:"#",className:`${$.settings_content_btn} ${$.settings_content_btn_save}`,onClick:s=>e(s),children:"Сохранить"}),t.jsx("button",{className:`${$.settings_content_btn} ${$.settings_content_btn_cancel}`,onClick:a,children:"Отмена"})]})}function Ks({item:e,setModalStatus:a}){const{TemporaryData:s,setTemporaryData:n}=w(),[i,c]=f.useState(""),[g,m]=f.useState(!1),[r,l]=f.useState(0),[_,b]=f.useState(0),[x,u]=f.useState(0),[d,j]=f.useState({});f.useEffect(()=>{console.log("pickedCategory",d)},[d]);function p(y){if(y.preventDefault(),r===0){m(!0),c("Выберите Суперкотегорию");return}else if(_===0){m(!0),c("Выберите Категорию");return}else if(x===0){m(!0),c("Выберите Подкотегорию");return}else s.forEach(S=>{S.id===e.id&&(S.crmCategory=d)}),n([...s]),N()}const N=()=>{l(0),b(0),u(0),c(""),m(!1),j({}),a(!1)};return t.jsx("div",{className:$.modalCategory,onClick:N,children:t.jsxs("div",{className:$.modalCategory_block,onClick:y=>y.stopPropagation(),children:[t.jsx(qs,{setCancel:N}),t.jsx("p",{className:$.modalCategory_content_message,children:i||""}),t.jsxs("div",{className:$.modalCategory_content,children:[t.jsx(Gs,{superId:r,setSuperId:l,setCategoryId:b}),t.jsx(Zs,{superId:r,categoryId:_,setCategoryId:b,setSubId:u}),t.jsx(Vs,{categoryId:_,subId:x,setSubId:u,setPickedCategory:j}),t.jsx(Qs,{setPickedSubCategoryToProduct:p,setCancel:N})]})]})})}function Js({item:e}){var r,l,_;const[a,s]=f.useState(!1),[n,i]=f.useState(!1),c=()=>{s(!0)},g=()=>{console.log("hover"),i(!0)},m=()=>{console.log("hover"),i(!1)};return t.jsxs("div",{className:o.table_body_category,children:[a&&t.jsx(Ks,{item:e,setModalStatus:s}),n&&t.jsx("span",{className:o.table_body_nameHover,children:(r=e==null?void 0:e.crmCategory)!=null&&r.name.ru?e==null?void 0:e.crmCategory.name.ru:""}),t.jsx("span",{className:o.table_body_category_span,onMouseEnter:g,onMouseLeave:m,children:(l=e==null?void 0:e.crmCategory)!=null&&l.name.ru?e==null?void 0:e.crmCategory.name.ru:""}),t.jsx("button",{onClick:c,className:o.table_body_category_btn,children:t.jsx("span",{children:(_=e==null?void 0:e.crmCategory)!=null&&_.name.ru?"Изменить":"Выбрать"})})]})}const Ys=[{id:U(),title:"шт.",isActive:!0,navIcon:""},{id:U(),title:"лт.",isActive:!0,navIcon:""},{id:U(),title:"кг.",isActive:!0,navIcon:""}];function ta({item:e}){const[a,s]=f.useState(!1),[n,i]=f.useState([...Ys]),{TemporaryData:c,setTemporaryData:g}=w(),[m,r]=f.useState("шт.");f.useEffect(()=>{l()},[m]);const l=()=>{c.forEach(_=>{if(_.id==e.id){const b=[{code:0,mxikCode:e.mxikCode,nameLat:"",nameRu:m,nameUz:"",packageType:""}];_.packageNames=b}}),g(c),s(!1)};return t.jsx("div",{className:o.table_body_unit,children:t.jsx(dt,{className:o.table_body_unit_dropdown,width:"100px",openBlock:a,setOpenBlock:s,versionList:n,setVersionList:i,currentVersion:m,setCurrentVersion:r})})}function ea({item:e,column:a}){const{ikpuStatus:s,setSearchResponseItem:n,setIkpuStatus:i,setTemporaryData:c,TemporaryData:g}=w(),m=(l,_)=>{_==="info photo"?(n(l),i({status:!s.status,type:"info photo"})):_==="photo"&&(n(l),i({status:!s.status,type:"photo"}))},r=()=>{g&&c(g.filter(l=>l.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:o.table_body_row,style:{gridTemplateColumns:`repeat(${a.length}, 200px) 110px 110px`},children:[a==null?void 0:a.map(l=>{var _,b,x,u,d,j,p,N;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:o.table_body_col,children:[(l==null?void 0:l.title)=="Количество"&&t.jsx(fs,{item:e}),(l==null?void 0:l.title)=="Приходная цена"&&t.jsx(gs,{item:e}),(l==null?void 0:l.title)=="Продажная цена"&&t.jsx(ms,{item:e}),(l==null?void 0:l.title)=="Наименование"&&t.jsx(bs,{item:e}),(l==null?void 0:l.title)=="Фото"?t.jsx("img",{onClick:()=>m(e,"photo"),src:((_=e.photos)==null?void 0:_[0])=="/noPhoto.jpg"?(b=e.photos)==null?void 0:b[0]:((x=e.photos)==null?void 0:x.length)==0?"/noPhoto.jpg":(d=(u=e.photos)==null?void 0:u[0])!=null&&d.startsWith("blob")?(j=e.photos)==null?void 0:j[0]:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+((p=e.photos)==null?void 0:p[0]),width:40,height:40,alt:"",className:o.table_body_img}):"",(l==null?void 0:l.title)=="QR Код"&&t.jsx(js,{item:e}),(l==null?void 0:l.title)=="Ед.измерения"&&(e.createdByHand===!0?t.jsx(ta,{item:e}):((N=e==null?void 0:e.packageNames)==null?void 0:N[0].nameRu)??"-"),(l==null?void 0:l.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(l==null?void 0:l.title)=="Подкатегория"&&t.jsx(Js,{item:e}),(l==null?void 0:l.title)=="Штрих-код"&&(e!=null&&e.internationalCode?e==null?void 0:e.internationalCode:t.jsx(hs,{item:e}))]},l==null?void 0:l.id)}),t.jsx("td",{className:`${o.table_body_minCol} ${o.table_body_minCol_still}`,children:t.jsx("span",{onClick:()=>m(e,"info photo"),className:o.table_body_still,children:t.jsx(R,{name:"EllipsisHorizontalIcon",className:o.table_body_icon})})}),t.jsx("td",{className:`${o.table_body_minCol} ${o.table_body_minCol_cancel}`,children:t.jsx("span",{className:o.table_body_del,onClick:r,children:t.jsx(R,{name:"TrashIcon",width:20,height:20})})})]})}function oa({column:e}){const{TemporaryData:a}=w();return t.jsxs("table",{className:o.table,children:[t.jsx("thead",{className:o.table_head,children:t.jsxs("tr",{className:o.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px) 110px 110px`},children:[e==null?void 0:e.map(s=>t.jsx("td",{className:o.table_head_col,children:s.title},s.id)),t.jsx("td",{className:`${o.table_head_minCol} ${o.table_head_minCol_still}`,children:"Ещё"}),t.jsx("td",{className:`${o.table_head_minCol} ${o.table_head_minCol_cancel}`,children:"Отменить"})]})}),t.jsx("tbody",{className:o.table_body,children:a==null?void 0:a.map(s=>t.jsx(ea,{item:s,column:e},s==null?void 0:s.id))})]})}function sa({clearTable:e,setData:a}){return t.jsxs("div",{className:o.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${o.formWrapper_btn} ${o.formWrapper_btn_save}`,onClick:a,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${o.formWrapper_btn} ${o.formWrapper_btn_cancel}`,onClick:s=>e(s),children:"Отмена"})]})}function aa(){const e=f.useRef(null),[a,s]=f.useState(!1),[n,i]=f.useState(0),[c,g]=f.useState(0),m=h=>{e.current&&(s(!0),i(h.pageX-e.current.offsetLeft),g(e.current.scrollLeft))},r=()=>{s(!1)},l=()=>{s(!1)},_=h=>{if(!a||!e.current)return;h.preventDefault();const T=(h.pageX-e.current.offsetLeft-n)*2;e.current.scrollLeft=c-T},{settingsParams:b,ikpuStatus:x,TemporaryData:u,openModalCategory:d,setTemporaryData:j,setCheckedProducts:p}=w(),[N,y]=f.useState([]);f.useEffect(()=>{const h=b.filter(P=>P.checked);y(()=>[...h])},[b]);const S=async h=>{h.preventDefault();for(const P of u)await E(P)};async function E(h){var P,T,z;try{const G=V.get("multi-store"),k={multiStoreId:Number(G),categoryId:Number((P=h==null?void 0:h.crmCategory)==null?void 0:P.id),barcode:Number(h==null?void 0:h.internationalCode),nameUz:"string",nameUzc:"string",nameRu:h.subPositionName?h.subPositionName:(T=h==null?void 0:h.crmNameProduct)==null?void 0:T.toString(),mxik:(z=h==null?void 0:h.mxikCode)==null?void 0:z.toString(),brand:h.brandName??null,oldPrice:Number(h==null?void 0:h.crmArrivalPrice),price:Number(h==null?void 0:h.crmSellingPrice),oldPriceCourse:0,priceCourse:0,nds:0,discount:0};await X.post("nomenclatures",k),j([]),p([])}catch(G){console.log(`Ошибка произошла при попытке добавить ${h==null?void 0:h.crmNameProduct} на сервер`,G)}}const C=h=>{h.preventDefault(),j([]),p([])};return t.jsxs("div",{className:o.formWrapper,children:[t.jsxs("div",{className:o.found,ref:e,onMouseDown:m,onMouseLeave:r,onMouseUp:l,onMouseMove:_,children:[x.status===!0&&t.jsx(us,{}),t.jsx(oa,{column:N})]}),t.jsx(sa,{clearTable:C,setData:S})]})}const na="_layout_5my6h_1",ca="_layout_back_5my6h_4",la="_layout_title_5my6h_14",ra="_layout_list_5my6h_19",ia="_layout_link_5my6h_25",_a="_layout_link_active_5my6h_35",da="_form_list_5my6h_39",ua="_form_check_5my6h_44",ga="_navSetting_5my6h_51",ma="_found_5my6h_55",fa="_table_5my6h_76",ba="_table_head_5my6h_80",pa="_table_head_row_5my6h_83",ha="_table_head_col_5my6h_87",ja="_addSettings_list_5my6h_91",xa="_addSettings_li_5my6h_91",A={layout:na,layout_back:ca,layout_title:la,layout_list:ra,layout_link:ia,layout_link_active:_a,form_list:da,form_check:ua,navSetting:ga,found:ma,table:fa,table_head:ba,table_head_row:pa,table_head_col:ha,addSettings_list:ja,addSettings_li:xa},ka=[{id:1,title:"отображения колонок",href:"/addingProducts/settingsAddProducts"},{id:2,title:"настройки",href:"/addingProducts/settingsAddProducts/settings"}];function va(){const a=Q().pathname;return t.jsxs("nav",{className:A.layout,children:[t.jsx(D,{className:A.layout_back,to:"/addingProducts",children:"Закрыть"}),t.jsx("h2",{className:A.layout_title,children:"Настройки"}),t.jsx("ul",{className:A.layout_list,children:ka.map(s=>t.jsx("li",{children:t.jsx(D,{to:s.href,className:`${A.layout_link} ${s.href==a?A.layout_link_active:""}`,children:s.title})},s.id))})]})}function ya(){const e=f.useRef([]),{necessarilySettings:a,settingsParams:s,setSettingsParams:n}=w();f.useEffect(()=>{e.current.forEach((c,g)=>{c&&(c.checked=s[g].checked,a.forEach(m=>{c.value==m&&(c.checked=!0)}))})},[s]);const i=c=>{const g=s.map(m=>({id:m.id,title:m.title,checked:m.title==c.currentTarget.value?c.currentTarget.checked:m.checked}));n(g)};return t.jsx("nav",{className:A.navSetting,children:t.jsx("form",{action:"",className:A.form,children:t.jsx("ul",{className:A.form_list,children:s==null?void 0:s.map((c,g)=>t.jsx("li",{children:t.jsxs("label",{className:A.form_check,children:[t.jsx("input",{type:"checkbox",value:c.title,ref:m=>{e.current[g]=m},onChange:m=>i(m)}),t.jsx("span",{className:A.form_check_text,children:c.title})]})},c.id))})})})}function Pa(){const{globalRemember:e,setGlobalRemember:a,programRemember:s,setProgramRemember:n}=w(),i=c=>{console.log("val",c),c==="program"?n(!s):c==="global"&&a(!e)};return t.jsx("div",{className:A.addSettings,children:t.jsx("div",{className:"container",children:t.jsxs("ul",{className:A.addSettings_list,children:[t.jsxs("li",{className:A.addSettings_li,onClick:()=>i("program"),children:[t.jsx("span",{className:A.addSettings_span,children:"Отменить выбор программного поиска"}),t.jsx("input",{type:"checkbox",className:A.addSettings_input,checked:s,readOnly:!0})]}),t.jsxs("li",{className:A.addSettings_li,onClick:()=>i("global"),children:[t.jsx("span",{className:A.addSettings_span,children:"Отменить выбор глобального поиска"}),t.jsx("input",{type:"checkbox",className:A.addSettings_input,checked:e,readOnly:!0})]})]})})})}function Na(){const{settingsParams:e}=w(),s=Q().pathname,[n,i]=f.useState([]);return f.useEffect(()=>{const c=e.filter(g=>g.checked);i(()=>[...c])},[e]),t.jsxs("div",{className:"container",children:[t.jsx(va,{}),s=="/addingProducts/settingsAddProducts"&&t.jsx(ya,{}),s=="/addingProducts/settingsAddProducts/settings"&&t.jsx(Pa,{}),t.jsx("section",{className:A.found,children:t.jsxs("table",{className:A.table,children:[t.jsx("thead",{className:A.table_head,children:t.jsx("tr",{className:A.table_head_row,style:{gridTemplateColumns:`repeat(${n.length}, 200px)`},children:n==null?void 0:n.map(c=>t.jsx("td",{className:A.table_head_col,children:c.title},c.id))})}),t.jsx("tbody",{className:A.table_body,children:t.jsx("tr",{className:A.table_body_row,children:t.jsx("td",{className:A.table_body_col})})})]})})]})}function Sa({staticList:e}){return t.jsx("div",{className:o.left,children:t.jsxs("div",{className:o.left_content,children:[e.map(a=>t.jsxs("div",{className:o.left_content_item,children:[t.jsx("h3",{children:a.title}),t.jsx("p",{children:a.value})]},a.id)),t.jsx("span",{style:{fontSize:"14px"},children:"(нужны картинки с сервера при get, post, patch запрсе по name)"})]})})}function Ma(){const{stockImagesSrc:e,setStockImagesSrc:a}=w(),[s,n]=f.useState(null),i=f.useRef([]),c=u=>{i.current.forEach(d=>{d&&d.getAttribute("id")==u&&d.click()})};function g(u,d){n(d)}function m(u){u.target.style.background="white"}function r(u){u.target.style.background="white"}function l(u){u.preventDefault(),u.target.style.background="lightgray"}function _(u,d){u.preventDefault(),u.target.style.background="white";const j=e.map(p=>p.id===d.id?{...p,order:(s==null?void 0:s.order)||p.order}:p.id===(s==null?void 0:s.id)?{...p,order:d.order}:p);a(j),n(null)}function b(u,d){return u.order>d.order?1:-1}const x=u=>{var j,p;const d=(p=(j=u==null?void 0:u.target)==null?void 0:j.files)==null?void 0:p[0];if(d&&(d==null?void 0:d.type)==="image/jpeg"||(d==null?void 0:d.type)==="image/png"||(d==null?void 0:d.type)==="image/webp"){const N=u.target.getAttribute("id"),y=[...e],S=y.find(C=>C.id==N),E=y.findIndex(C=>C.id==N);if(S){const C=new FileReader;C.onload=h=>{var P;(P=h.target)!=null&&P.result&&(S.src=URL.createObjectURL(d),y.splice(E,1,S),a([...y]))},C.readAsDataURL(d)}}};return t.jsx("div",{className:o.right,children:t.jsx("div",{className:o.right_block,children:t.jsx("div",{className:o.right_bottom,children:e.sort(b).map((u,d)=>{var j;return t.jsxs("div",{draggable:!0,onDragStart:p=>g(p,u),onDragLeave:p=>m(p),onDragEnd:p=>r(p),onDragOver:p=>l(p),onDrop:p=>_(p,u),className:d==0?o.right_bottom_BaseItem:o.right_bottom_item,onDoubleClick:()=>c(u.id),children:[t.jsx("input",{id:u.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:x,ref:p=>{i.current[d]=p}}),t.jsx("img",{src:u.src=="/noPhoto.jpg"||((j=u.src)==null?void 0:j.toString().split(":")[0])=="blob"?u.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+u.src,width:d==0?150:50,height:d==0?150:50,alt:"",className:`${d==0?o.right_bottom_baseImg:o.right_bottom_img}`})]},u.id)})})})})}function wa({addingImgToProduct:e,handleCancel:a}){return t.jsxs("div",{className:o.ikpuWrapper_buttons,children:[t.jsx(D,{to:"#",className:o.ikpuWrapper_save,onClick:s=>e(s),children:"Coхранить"}),t.jsx(D,{to:"#",className:o.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(D,{to:"#",onClick:s=>a(s),className:o.ikpuWrapper_cancel,children:"Отмена"})]})}const Y=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""}];function Ca(){const{searchResponseItem:e,stockImagesSrc:a,setStockImagesSrc:s,setSearchResponseItem:n,setStockIkpuStatus:i}=w(),[c,g]=f.useState([]);f.useEffect(()=>{if(e){const l=Y==null?void 0:Y.map(_=>{var x;let b;return _.title=="ИКПУ:"&&(b=e.mxik),_.title=="Штрих-код:"&&(b=e.barcode),_.title=="Группа:"&&(b=e.groupName),_.title=="Класс:"&&(b=e.className),_.title=="Позиция:"&&(b=e.positionName),_.title=="Субпозиция:"&&(b=e.subPositionName),_.title=="Наименование:"&&(b=(x=e.name)==null?void 0:x.ru),_.title=="Бренд:"&&(b=e.brand),_.title=="Описание:"&&(b=e.description),{id:_.id,title:_.title,value:b}});g([...l])}},[e]),f.useEffect(()=>{if(e.photos){const l=a.map((_,b)=>{var x,u;return{id:_.id,order:_.order,src:(x=e==null?void 0:e.photos)!=null&&x[b]?(u=e==null?void 0:e.photos)==null?void 0:u[b]:"/noPhoto.jpg"}});l&&s(l)}},[]);const m=l=>{l.preventDefault();const _=a==null?void 0:a.map(b=>b.src);e.photos=_,n(e),i(!1)};function r(l){l.preventDefault();const _=a.map(b=>({id:b.id,order:b.order,src:b.src}));s(_),i(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:o.ikpuWrapper,onClick:r,children:t.jsxs("div",{className:o.ikpuWrapper_ikpuModalBlock,onClick:l=>l.stopPropagation(),children:[t.jsxs("div",{className:o.ikpuWrapper_content,children:[t.jsx(Sa,{staticList:c}),t.jsx(Ma,{})]}),t.jsx(wa,{addingImgToProduct:m,handleCancel:r})]})})})}function $a({item:e}){const[a,s]=f.useState(e.oldPrice),{stockTemporaryData:n,setStockTemporaryData:i}=w(),c=g=>{const m=g.target.value;s(Number(m));const r=n.filter(_=>_.id==e.id)[0],l=n.findIndex(_=>_.id==e.id);r&&(r.oldPrice=Number(m),n.splice(l,1,r),i([...n]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:a,className:o.table_body_amount,min:0,onChange:c})})}function Ia({item:e}){const[a,s]=f.useState(e.price),{stockTemporaryData:n,setStockTemporaryData:i}=w(),c=g=>{const m=g.target.value;s(Number(m));const r=n.filter(_=>_.id==e.id)[0],l=n.findIndex(_=>_.id==e.id);r.price&&(r.price=Number(m),n.splice(l,1,r),i([...n]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:a,className:o.table_body_amount,min:0,onChange:c})})}function Aa({item:e}){const[a,s]=f.useState(0),{stockTemporaryData:n,setStockTemporaryData:i}=w(),c=g=>{const m=g.target.valueAsNumber;s(m);const r=n.find(l=>l.id==e.id);if(r){const l=n.findIndex(b=>b.id==e.id),_=[...n];_.splice(l,1,r),i(_)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:a,min:0,className:o.table_body_amount,onChange:c})})}function Ea({item:e,column:a}){const{stockTemporaryData:s,setSearchResponseItem:n,setStockIkpuStatus:i,setStockTemporaryData:c}=w(),g=r=>{n(r),i(!0)},m=()=>{s&&c(s.filter(r=>r.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:o.table_head_row,style:{gridTemplateColumns:`repeat(${a.length}, 200px)`},children:[a==null?void 0:a.map(r=>{var l;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:o.table_body_col,children:[(r==null?void 0:r.title)=="Количество"&&t.jsx(Aa,{item:e}),(r==null?void 0:r.title)=="Приходная цена"&&t.jsx($a,{item:e}),(r==null?void 0:r.title)=="Продажная цена"&&t.jsx(Ia,{item:e}),(r==null?void 0:r.title)=="Наименование"&&t.jsx("span",{className:o.table_body_nameString,children:(l=e==null?void 0:e.name)==null?void 0:l.ru}),(r==null?void 0:r.title)=="Фото"?t.jsx("img",{src:"/noPhoto.jpg",width:40,height:40,alt:"",className:o.table_body_img}):"",(r==null?void 0:r.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(r==null?void 0:r.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(r==null?void 0:r.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>g(e),children:t.jsx(R,{name:"FolderOpenIcon",className:o.table_body_icon})}):"",(r==null?void 0:r.title)=="Штрих-код"&&(e!=null&&e.barcode)?e==null?void 0:e.barcode:""]},r==null?void 0:r.id)}),t.jsx("td",{className:o.table_body_del,onClick:m,children:t.jsx(R,{name:"TrashIcon",width:20,height:20})})]})}function Da({column:e}){const{stockTemporaryData:a}=w(),[s,n]=f.useState([]);return f.useEffect(()=>{n(a)},[a]),t.jsxs("table",{className:o.table,children:[t.jsx("thead",{className:o.table_head,children:t.jsx("tr",{className:o.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(i=>t.jsx("td",{className:o.table_head_col,children:i.title},i.id))})}),t.jsx("tbody",{className:o.table_body,children:s==null?void 0:s.map(i=>t.jsx(Ea,{item:i,column:e},i==null?void 0:i.id))})]})}function Ta({clearTable:e,setData:a}){return t.jsxs("div",{className:o.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${o.formWrapper_btn} ${o.formWrapper_btn_save}`,onClick:a,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${o.formWrapper_btn} ${o.formWrapper_btn_cancel}`,onClick:s=>e(s),children:"Отмена"})]})}function Ra(){const e=f.useRef(null),[a,s]=f.useState(!1),[n,i]=f.useState(0),[c,g]=f.useState(0),m=h=>{e.current&&(s(!0),i(h.pageX-e.current.offsetLeft),g(e.current.scrollLeft))},r=()=>{s(!1)},l=()=>{s(!1)},_=h=>{if(!a||!e.current)return;h.preventDefault();const T=(h.pageX-e.current.offsetLeft-n)*2;e.current.scrollLeft=c-T},{settingsParams:b,stockIkpuStatus:x,stockTemporaryData:u,openModalCategory:d,setStockTemporaryData:j,setCheckedProducts:p}=w(),[N,y]=f.useState([]);f.useEffect(()=>{const h=b.filter(P=>P.checked&&P.title!="Подкатегория");y(()=>[...h])},[b]);const S=h=>{h.preventDefault(),u.forEach(P=>{E(P)})};async function E(h){var P;try{const T={nameRu:(P=h.name)==null?void 0:P.ru,oldPrice:h.oldPrice,price:h.price};await X.patch(`nomenclatures/${h.id}`,T),j([]),p([])}catch(T){console.log(`Ошибка произошла при попытке добавить ${h==null?void 0:h.crmNameProduct} на сервер`,T)}}const C=h=>{h.preventDefault(),j([]),p([])};return t.jsxs("div",{className:o.formWrapper,children:[d&&t.jsx(ut,{}),t.jsxs("div",{className:o.found,ref:e,onMouseDown:m,onMouseLeave:r,onMouseUp:l,onMouseMove:_,children:[x&&t.jsx(Ca,{}),t.jsx(Da,{column:N})]}),t.jsx(Ta,{clearTable:C,setData:S})]})}async function lt(e,a,s,n,i){try{if(e==="По тексту"){console.log("fetchStockProducts page",n,"perPage",i);const c=await X.get(`nomenclatures?multiStoreId=${a}&name=${s}&page=${n}&perPage=${i}`);console.log("fetchStockProducts res",c);const g=await c.data.data,m=await c.data.pagination.total,r=await c.data.pagination.total_pages;return{data:g,totalElements:m,totalPages:r}}}catch(c){console.log("Ошибка при получении продуктов со склада",c)}}function La(){const a=Q().pathname,{stockPickedSearch:s,setStockPickedSearch:n,stockSearchParams:i,stockSearchText:c,setStockSearchText:g,setStockSearchResponse:m,stockTemporaryData:r,setTotalElementsStore:l,setTotalPagesStore:_,stockPage:b,perPage:x,setStockPage:u}=w(),[d,j]=f.useState("");f.useEffect(()=>{j(""),g("")},[a]),f.useEffect(()=>{(s=="По штрих-коду"||s=="По ИКПУ")&&(c.toString(),c.length<13&&n("По ТН ВЭД"),c.length==13&&n("По штрих-коду"),c.length>13&&n("По ИКПУ")),c.length>0&&j("")},[c]),f.useEffect(()=>{const y=document.querySelector(`input[name="search"][value="${s}"]`);y&&(y.checked=!0)},[s]);const p=y=>{n(y.currentTarget.value)},N=async y=>{y.preventDefault(),m([]),u(1);const S=V.get("access_token"),E=V.get("multi-store");if((!S||!E)&&await st(),c.length>0&&E){const{data:C,totalElements:h,totalPages:P}=await lt(s,E,c,b,x);console.log("totalElements",h,"totalPages",P),C.length==0&&j("ничего не найдено"),h&&P&&(l(h),_(P));const T=C.filter(z=>!r.some(G=>G.id===z.id));m(T)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:o.navStock,children:[t.jsxs("ul",{className:o.navStock_buttons,children:[t.jsx("li",{children:t.jsxs(D,{className:`${o.back} ${o.navStock_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(R,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(D,{to:"/addingProducts/settingsAddProducts",className:`${o.navStock_linkBtn} ${o.navStock_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(R,{name:"Cog8ToothIcon",className:o.navStock_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:o.stockForm,onSubmit:y=>N(y),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:c,type:s=="По штрих-коду"||s=="По ИКПУ"?"number":"text",className:o.stockForm_input,placeholder:s,onChange:y=>g(y.currentTarget.value)}),t.jsx("button",{type:"submit",className:o.stockForm_btn,children:"Поиск"})]}),t.jsx("ul",{className:o.stockForm_list,children:i==null?void 0:i.map(y=>t.jsx("li",{children:t.jsxs("label",{className:o.stockForm_check,children:[t.jsx("input",{type:"radio",name:"search",value:y.title,onClick:S=>p(S)}),t.jsx("span",{className:o.stockForm_check_text,children:y.title})]})},y.id))})]}),t.jsx("span",{className:o.navStock_error,children:d})]})})}function Wa({addSelectedProducts:e,setCancel:a}){const{setAddBlockStatus:s}=it(),n=()=>{a(),s(!1)};return t.jsxs("div",{className:o.foundProducts_buttons,children:[t.jsx(D,{to:"#",className:`${o.foundProducts_btn} ${o.foundProducts_btn_save}`,onClick:()=>e(),children:"Сохранить"}),t.jsx("button",{className:`${o.foundProducts_btn} ${o.foundProducts_btn_cancel}`,onClick:n,children:"Отмена"})]})}function za(){const{stockSearchResponse:e,setStockSearchResponse:a,stockCheckedProducts:s,setStockCheckedProducts:n,stockTemporaryData:i,setStockTemporaryData:c,totalElementsStore:g,setTotalElementsStore:m,totalPagesStore:r,setTotalPagesStore:l,stockSearchText:_,setStockSearchText:b,stockPickedSearch:x,stockPage:u,setStockPage:d,setPerPage:j,perPage:p}=w(),[N,y]=f.useState([]),[S,E]=f.useState([]),[C,h]=f.useState(!1),P=f.useRef([]),T=f.useRef(null);f.useEffect(()=>{y([...e]),console.log("stockSearchResponse",e)},[e]);const z=()=>{s&&c([...s,...i]),a([]),n([]),M()},G=(v,I)=>{if(v){E([...S,I]);const W=N.filter(B=>B.id==I)[0];n([...s,W])}else if(!v&&T.current){const W=S.filter(F=>F!=I);E([...W]);const B=s.filter(F=>F.id!=I);n([...B]),h(!1),T.current.checked=!1}T.current&&v&&S.length+1==N.length&&(h(!0),T.current.checked=!0,n([...N]))},k=v=>{if(h(v),v){P.current.forEach(W=>{W&&(W.checked=v)});const I=N.map(W=>W.id);E([...I]),n([...N])}else E([]),P.current.forEach(I=>{I&&(I.checked=v)}),n([])},H=async v=>{v.preventDefault();const I=u+1;d(I);const W=V.get("multi-store");if(W){const{data:B}=await lt(x,W,_,I,p),F=B.filter(Z=>!i.some(q=>q.id===Z.id));console.log("filteredSearchResponse",F),console.log("stockSearchResponse",e),console.log("stockSearchText",_),T.current&&(h(!1),T.current.checked=!1,a([...F,...e]))}},M=()=>{a([]),n([]),m(0),l(0),b(""),d(1),j(5)};return t.jsx("section",{className:o.foundProducts,onClick:M,children:t.jsxs("div",{className:o.foundProducts_modal,onClick:v=>v.stopPropagation(),children:[t.jsxs("div",{className:o.foundProducts_top,children:[t.jsxs("h2",{className:o.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",g]}),t.jsxs("span",{children:["Текущее количество - ",N.length]}),t.jsxs("span",{children:["Выбрано элементов - ",S.length]})]}),u<r&&r!=1&&t.jsx("span",{className:o.foundProducts_more,onClick:v=>H(v),children:"добавить ещё..."}),N.length>1&&t.jsxs("label",{className:o.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:v=>k(v.target.checked),ref:T}),t.jsx("span",{children:C?"Отключить все":"Выбрать все"})]}),t.jsx(Wa,{addSelectedProducts:z,setCancel:M})]}),t.jsx("ul",{className:o.foundProducts_list,children:N==null?void 0:N.map((v,I)=>{var W;return t.jsxs("li",{className:o.foundProducts_item,children:[t.jsx("span",{className:o.foundProducts_item_photo,children:t.jsx("img",{src:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:o.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:v==null?void 0:v.barcode})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:v==null?void 0:v.mxik})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:v==null?void 0:v.brand})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:(W=v==null?void 0:v.name)==null?void 0:W.ru})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:v==null?void 0:v.attributeName})]})]}),t.jsxs("label",{className:`
                ${o.foundProducts_item_btn}
                ${C||S.includes(v.id)?o.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:B=>G(B.target.checked,v.id),ref:B=>{P.current[I]=B}}),"Выбрать"]})]},v==null?void 0:v.id)})})]})})}async function Ba(e){try{const a=await O.get(`https://tasnif.soliq.uz/api/cl-api/integration-mxik/get/history/${e}`);return console.log("res ",a),await a.data.data.packageNames}catch(a){console.log("",a)}}function Fa(){const{searchResponse:e,searchText:a,TemporaryData:s,pickedSearch:n,setSearchText:i,setTemporaryData:c,setCheckedProducts:g,setSearchResponse:m,totalElementsStore:r,setTotalElementsStore:l,setTotalPagesStore:_,page:b,setPage:x,perPage:u,lang:d,errorMessage:j,setErrorMessage:p}=w(),[N,y]=f.useState([]),[S,E]=f.useState([]),C=f.useRef(null);f.useEffect(()=>{const k=setTimeout(()=>{p("")},1e3);return()=>{clearTimeout(k)}},[j]),f.useEffect(()=>{y([...e]);const k=S.filter(H=>e.some(M=>M.id===H));E(k),y([...e])},[e]);const h=async k=>{if(await at(k))if(s.some(v=>v.mxikCode===k.mxikCode))p("Этот продукт уже выбран"),z();else{const v=await Ba(k.mxikCode);console.log("fetchPackageNames packageNames",v);const I={...k,crmNameProduct:k.subPositionName,crmAmount:0,crmArrivalPrice:0,crmSellingPrice:0,packageNames:v??null};console.log("addSelectedProducts myItem",I),c([I,...s]),z()}else p("Этот продукт уже есть на складе"),z()},P=async()=>{const k=b+1;x(k);const{data:H}=await tt(n,a,k,u,d),M=[];for(const v of H){const I=await et(v.mxikCode,d);M.push({...v,id:U(),photos:I})}m([...e,...M])},T=()=>{const k=C.current;if(k){const H=k.scrollHeight-k.scrollTop===k.clientHeight;H&&P(),console.log("isAtBottom",H)}},z=()=>{m([]),g([]),l(0),_(0),i(""),x(0)},G=()=>{const k={attributeName:null,brandName:null,classCode:"",className:"",commonUnitCode:null,commonUnitName:null,crmAmount:0,crmArrivalPrice:0,crmNameProduct:"",crmSellingPrice:0,groupCode:"",groupName:"",id:U(),internationalCode:null,mxikCode:"",myProduct:0,packages:null,photos:["/noPhoto.jpg"],positionCode:"",positionName:"",subPositionName:"",unitCode:null,unitName:null,units:[],createdByHand:!0};console.log("addNewLine TemporaryData",s),c([k,...s]),z()};return t.jsx("section",{className:o.foundProducts,onClick:z,children:t.jsxs("div",{ref:C,className:o.foundProducts_modal,onScroll:T,onClick:k=>k.stopPropagation(),children:[t.jsxs("div",{className:o.foundProducts_top,children:[t.jsx("h2",{className:o.foundProducts_title,children:t.jsxs("span",{children:["Найдено совпадений - ",r]})}),t.jsxs("div",{className:o.foundProducts_top_buttons,children:[t.jsxs("button",{className:o.foundProducts_top_add,onClick:G,children:[t.jsx(R,{name:"PlusCircleIcon"}),"Добавить в ручную"]}),t.jsx("button",{className:o.foundProducts_top_close,onClick:z,children:t.jsx(R,{name:"XMarkIcon"})})]})]}),t.jsx("ul",{className:o.foundProducts_list,children:N==null?void 0:N.map(k=>{var H;return t.jsxs("li",{className:o.foundProducts_item,onClick:()=>h(k),children:[t.jsxs("h2",{className:o.foundProducts_item_mxik,children:[t.jsx("span",{className:o.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:k==null?void 0:k.mxikCode}),t.jsx("span",{className:o.foundProducts_item_desc,children:k==null?void 0:k.subPositionName})]}),t.jsxs("div",{className:o.foundProducts_item_content,children:[t.jsxs("ul",{className:o.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Группа:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(k==null?void 0:k.groupName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Класс:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(k==null?void 0:k.className)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Позиция:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(k==null?void 0:k.positionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Субпозиция:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(k==null?void 0:k.subPositionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Штрихкод:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(k==null?void 0:k.internationalCode)??"-"})]})]}),t.jsx("span",{className:o.foundProducts_item_photo,children:t.jsx("img",{src:(H=k==null?void 0:k.photos)!=null&&H[0]?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+k.photos[0]:"/noPhoto.jpg",width:50,height:50,alt:""})})]})]},k==null?void 0:k.id)})})]})})}function Ha(){const a=Q().pathname,[s,n]=f.useState(!1);return t.jsxs("div",{className:`${o.leftMenu} ${s?o.leftMenu_active:""}`,children:[t.jsx("button",{className:o.leftMenu_btn,onClick:()=>n(!s),children:t.jsx(R,{name:"Bars3Icon"})}),t.jsxs("ul",{className:o.leftMenu_list,children:[t.jsxs("li",{className:`${o.leftMenu_li} ${a=="/addingProducts"?o.leftMenu_li_active:""}`,children:[t.jsx(R,{name:"ShoppingCartIcon",className:`${o.leftMenu_li_icon} ${s?"":o.leftMenu_li_icon_active}`}),t.jsx(D,{to:"/addingProducts",className:`${o.leftMenu_link} ${s?o.leftMenu_link_active:""}`,children:"Добавить номенклатуру"}),t.jsx(R,{name:"ChevronRightIcon",className:`${o.leftMenu_linkArrow} ${s?o.leftMenu_linkArrow_active:""}`})]}),t.jsxs("li",{className:`${o.leftMenu_li} ${a!="/addingProducts"?o.leftMenu_li_active:""}`,children:[t.jsx(R,{name:"ShoppingCartIcon",className:`${o.leftMenu_li_icon} ${s?"":o.leftMenu_li_icon_active}`}),t.jsx(D,{to:"/addingProducts/stockProducts",className:`${o.leftMenu_link} ${s?o.leftMenu_link_active:""}`,children:"Создать номенклатуру"}),t.jsx(R,{name:"ChevronRightIcon",className:`${o.leftMenu_linkArrow} ${s?o.leftMenu_linkArrow_active:""}`})]})]})]})}function Za(){const a=Q().pathname,{stockSearchResponse:s,TemporaryData:n,stockTemporaryData:i,setTemporaryData:c,setCheckedProducts:g,searchResponse:m}=w();f.useEffect(()=>{r()},[]);const r=()=>{c([]),g([])};return t.jsxs("div",{className:o.addingProducts,children:[t.jsx(Ha,{}),a=="/addingProducts"&&t.jsxs("div",{className:o.container,children:[t.jsx(rs,{}),n.length>0&&m.length==0&&t.jsx(aa,{}),m.length>0&&t.jsx(Fa,{})]}),a=="/addingProducts/stockProducts"&&t.jsxs("div",{className:o.container,children:[t.jsx(La,{}),s.length>0&&t.jsx(za,{}),i.length>0&&t.jsx(Ra,{})]}),a.startsWith("/addingProducts/settingsAddProducts")&&t.jsx(Na,{})]})}export{Za as default};
