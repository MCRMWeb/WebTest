import{w as H,b as K,c as Q,r as h,j as t,L,y as G,x as V,D as nt,a as it}from"./index-Cv-XqJyV.js";import{a as I,M as at}from"./Modal-DytDxak8.js";import{C as F}from"./CustomIcon-gPSonnYz.js";import"./XMarkIcon-tDdZoeW2.js";const dt="_container_m1k21_1",_t="_nav_m1k21_8",ut="_nav_linkBtn_m1k21_12",ft="_nav_settingsIcon_m1k21_16",mt="_nav_buttons_m1k21_20",gt="_nav_buttons_link_m1k21_25",pt="_nav_buttons_iconSetting_m1k21_30",bt="_setting_m1k21_1",ht="_nav_error_m1k21_33",kt="_nav_form_m1k21_40",xt="_nav_form_left_m1k21_46",jt="_nav_form_input_m1k21_56",vt="_nav_form_btn_m1k21_61",Pt="_nav_form_list_m1k21_92",Nt="_nav_form_check_m1k21_97",yt="_nav_form_check_text_m1k21_103",St="_navStock_m1k21_107",Mt="_navStock_linkBtn_m1k21_110",wt="_navStock_settingsIcon_m1k21_115",$t="_navStock_buttons_m1k21_119",It="_navStock_buttons_link_m1k21_124",At="_navStock_buttons_iconSetting_m1k21_129",Dt="_navStock_error_m1k21_132",Rt="_stockForm_m1k21_140",Tt="_stockForm_input_m1k21_151",Et="_stockForm_btn_m1k21_157",Wt="_stockForm_list_m1k21_188",Lt="_stockForm_check_m1k21_193",zt="_stockForm_check_text_m1k21_199",Ct="_formWrapper_m1k21_203",Ft="_formWrapper_buttons_m1k21_208",Bt="_formWrapper_btn_m1k21_214",qt="_formWrapper_btn_cancel_m1k21_226",Ht="_formWrapper_btn_save_m1k21_229",Ut="_found_m1k21_233",Ot="_table_m1k21_257",Gt="_table_head_m1k21_262",Xt="_table_head_row_m1k21_265",Kt="_table_head_col_m1k21_271",Qt="_table_body_row_m1k21_274",Vt="_table_body_col_m1k21_278",Zt="_table_body_img_m1k21_287",Jt="_table_body_icon_m1k21_290",Yt="_table_body_name_m1k21_294",te="_table_body_nameString_m1k21_327",ee="_table_body_amount_m1k21_334",se="_table_body_catalog_m1k21_342",oe="_table_body_catalog_top_m1k21_352",ne="_table_body_catalog_icon_m1k21_371",ae="_table_body_catalog_iconActive_m1k21_374",ce="_table_body_catalog_drop_m1k21_377",le="_table_body_catalog_dropActive_m1k21_402",re="_table_body_catalog_search_m1k21_407",ie="_table_body_catalog_item_m1k21_421",de="_table_body_catalog_text_m1k21_429",_e="_table_body_del_m1k21_435",ue="_ikpuWrapper_m1k21_455",fe="_ikpuWrapper_ikpuModalBlock_m1k21_464",me="_ikpuWrapper_content_m1k21_474",ge="_ikpuWrapper_buttons_m1k21_479",pe="_ikpuWrapper_save_m1k21_485",be="_ikpuWrapper_delete_m1k21_495",he="_ikpuWrapper_cancel_m1k21_505",ke="_left_m1k21_516",xe="_left_content_m1k21_519",je="_left_content_item_m1k21_524",ve="_right_m1k21_534",Pe="_right_block_m1k21_539",Ne="_right_bottom_m1k21_545",ye="_right_bottom_item_m1k21_552",Se="_right_bottom_item_img_m1k21_562",Me="_right_bottom_BaseItem_m1k21_567",we="_right_bottom_BaseItem_img_m1k21_578",$e="_foundProducts_m1k21_583",Ie="_foundProducts_modal_m1k21_592",Ae="_foundProducts_top_m1k21_616",De="_foundProducts_title_m1k21_630",Re="_foundProducts_more_m1k21_638",Te="_foundProducts_allActive_m1k21_655",Ee="_foundProducts_buttons_m1k21_661",We="_foundProducts_btn_m1k21_667",Le="_foundProducts_btn_cancel_m1k21_679",ze="_foundProducts_btn_save_m1k21_682",Ce="_foundProducts_list_m1k21_685",Fe="_foundProducts_item_m1k21_689",Be="_foundProducts_item_photo_m1k21_696",qe="_foundProducts_item_list_m1k21_706",He="_foundProducts_item_title_m1k21_718",Ue="_foundProducts_item_desc_m1k21_721",Oe="_foundProducts_item_btn_m1k21_725",Ge="_foundProducts_item_btn_active_m1k21_739",Xe="_errorModal_m1k21_744",Ke="_errorModal_block_m1k21_753",Qe="_addingProducts_m1k21_771",Ve="_leftMenu_m1k21_775",Ze="_leftMenu_list_m1k21_788",Je="_leftMenu_li_m1k21_788",Ye="_leftMenu_li_icon_m1k21_828",ts="_leftMenu_li_icon_active_m1k21_832",es="_leftMenu_li_active_m1k21_836",ss="_leftMenu_link_m1k21_851",os="_leftMenu_link_active_m1k21_866",ns="_leftMenu_linkArrow_m1k21_870",as="_leftMenu_linkArrow_active_m1k21_876",cs="_leftMenu_active_m1k21_882",ls="_miniInfo_content_m1k21_894",rs="_miniInfo_imgBlock_m1k21_902",is="_miniInfo_list_m1k21_912",s={container:dt,nav:_t,nav_linkBtn:ut,nav_settingsIcon:ft,nav_buttons:mt,nav_buttons_link:gt,nav_buttons_iconSetting:pt,setting:bt,nav_error:ht,nav_form:kt,nav_form_left:xt,nav_form_input:jt,nav_form_btn:vt,nav_form_list:Pt,nav_form_check:Nt,nav_form_check_text:yt,navStock:St,navStock_linkBtn:Mt,navStock_settingsIcon:wt,navStock_buttons:$t,navStock_buttons_link:It,navStock_buttons_iconSetting:At,navStock_error:Dt,stockForm:Rt,stockForm_input:Tt,stockForm_btn:Et,stockForm_list:Wt,stockForm_check:Lt,stockForm_check_text:zt,formWrapper:Ct,formWrapper_buttons:Ft,formWrapper_btn:Bt,formWrapper_btn_cancel:qt,formWrapper_btn_save:Ht,found:Ut,table:Ot,table_head:Gt,table_head_row:Xt,table_head_col:Kt,table_body_row:Qt,table_body_col:Vt,table_body_img:Zt,table_body_icon:Jt,table_body_name:Yt,table_body_nameString:te,table_body_amount:ee,table_body_catalog:se,table_body_catalog_top:oe,table_body_catalog_icon:ne,table_body_catalog_iconActive:ae,table_body_catalog_drop:ce,table_body_catalog_dropActive:le,table_body_catalog_search:re,table_body_catalog_item:ie,table_body_catalog_text:de,table_body_del:_e,ikpuWrapper:ue,ikpuWrapper_ikpuModalBlock:fe,ikpuWrapper_content:me,ikpuWrapper_buttons:ge,ikpuWrapper_save:pe,ikpuWrapper_delete:be,ikpuWrapper_cancel:he,left:ke,left_content:xe,left_content_item:je,right:ve,right_block:Pe,right_bottom:Ne,right_bottom_item:ye,right_bottom_item_img:Se,right_bottom_BaseItem:Me,right_bottom_BaseItem_img:we,foundProducts:$e,foundProducts_modal:Ie,foundProducts_top:Ae,foundProducts_title:De,foundProducts_more:Re,foundProducts_allActive:Te,foundProducts_buttons:Ee,foundProducts_btn:We,foundProducts_btn_cancel:Le,foundProducts_btn_save:ze,foundProducts_list:Ce,foundProducts_item:Fe,foundProducts_item_photo:Be,foundProducts_item_list:qe,foundProducts_item_title:He,foundProducts_item_desc:Ue,foundProducts_item_btn:Oe,foundProducts_item_btn_active:Ge,errorModal:Xe,errorModal_block:Ke,addingProducts:Qe,leftMenu:Ve,leftMenu_list:Ze,leftMenu_li:Je,leftMenu_li_icon:Ye,leftMenu_li_icon_active:ts,leftMenu_li_active:es,leftMenu_link:ss,leftMenu_link_active:os,leftMenu_linkArrow:ns,leftMenu_linkArrow_active:as,leftMenu_active:cs,miniInfo_content:ls,miniInfo_imgBlock:rs,miniInfo_list:is};async function tt(e,n,o,l,d){try{if(e==="По тексту"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search-subposition?search_text=${n}&page=${o}&size=${l}&lang=${d}`);console.log("По тексту res",a);const r=await a.data.data.content,i=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:r,totalElements:i,totalPages:c}}else if(e==="По штрих-коду"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?gtin=${n}&size=${l}&page=${o}&lang=${d}`),r=await a.data.data.content,i=await a.data.data.totalElements,c=await a.data.data.totalPages;return console.log("По штрих-коду res",a),{data:r,totalElements:i,totalPages:c}}else if(e==="По ИКПУ"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?mxikCode=${n}&size=${l}&page=${o}&lang=${d}`);console.log("По ИКПУ res",a);const r=await a.data.data.content,i=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:r,totalElements:i,totalPages:c}}else if(e==="Расширинный по тексту"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?text=${n}&size=${l}&page=${o}&lang=${d}`);console.log("Расширинный по тексту res",a);const r=await a.data.data.content,i=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:r,totalElements:i,totalPages:c}}else if(e==="По номеру рег. удостовирения"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/dv-cert-number?dvCertNumber=${n}&page=${o}&size=${l}&lang=${d}`);console.log("По номеру рег. удостовирения res",a);const r=await a.data.data.content,i=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:r,totalElements:i,totalPages:c}}else if(e==="По ТН ВЭД"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?tnvedCode=${n}&size=${l}&page=${o}&lang=${d}`);console.log("По ТН ВЭД res",a);const r=await a.data.data.content,i=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:r,totalElements:i,totalPages:c}}else if(e==="По бренду"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?brandName=${n}&size=${l}&page=${o}&lang=${d}`);console.log("По бренду res",a);const r=await a.data.data.content,i=await a.data.data.totalElements,c=await a.data.data.totalPages;return{data:r,totalElements:i,totalPages:c}}else if(e==="По MHH"){const a=await H.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/mnn-name?mnn_name=${n}&page=${o}&size=${l}&lang=${d}`);console.log("По MHH res",a);const r=await a.data.data,i=await a.data.recordTotal,c=await i/l;return{data:r,totalElements:i,totalPages:c}}}catch(a){console.log(a)}}async function et(e){var o;const n=K.get("multi-store");try{return(await Q.post("nomenclatures/is-unique-name",{multiStoreId:Number(n),nameRu:(o=e.subPositionName)==null?void 0:o.toString()})).data.success}catch(l){return console.log("Ошибка произошла при проверки наличия продукта на складе по наименованию",l),!1}}async function st(e,n){try{return(await H.get(`https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/mxik/picture-names?lang=${n}&mxik_code=${e}`)).data}catch(o){console.log("Ошибка при получении картинок к продукту",o)}}function ds(){var l,d;const{checkedProductsByCode:e}=I(),[n,o]=h.useState([]);return h.useEffect(()=>{o([...e])},[e]),console.log("localProduct",n),t.jsx("div",{className:s.miniInfo,children:n.length>0&&t.jsxs("div",{className:s.miniInfo_content,children:[t.jsx("div",{className:s.miniInfo_imgBlock,children:t.jsx("img",{src:(d=(l=n[0])==null?void 0:l.photos)!=null&&d.length?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+n[0].photos[0]:"/noPhoto.jpg",alt:""})}),t.jsxs("ul",{className:s.miniInfo_list,children:[t.jsxs("li",{children:[t.jsx("span",{children:"Штрихкод:"}),t.jsx("span",{children:n&&n[0].internationalCode||"-"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"ИКПУ:"}),t.jsx("span",{children:n&&n[0].mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Бренд:"}),t.jsx("span",{children:n&&n[0].brandName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Наименование:"}),t.jsx("span",{children:n&&n[0].subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Ед. Изм:"}),t.jsx("span",{children:n&&n[0].attributeName})]})]})]})})}const _s="_globalModal_15wz1_1",us="_globalModal_back_15wz1_13",fs="_globalModal_container_15wz1_45",ms="_globalModal_left_15wz1_54",gs="_globalModal_left_top_15wz1_59",ps="_globalModal_left_desc_15wz1_64",bs="_globalModal_left_bottom_15wz1_71",hs="_globalModal_left_bottom_link_15wz1_76",ks="_globalModal_left_bottom_label_15wz1_94",xs="_globalModal_right_15wz1_109",js="_globalModal_right_top_15wz1_114",vs="_globalModal_right_top_desc_15wz1_119",Ps="_globalModal_right_bottom_15wz1_134",Ns="_globalModal_right_bottom_link_15wz1_139",ys="_globalModal_right_bottom_label_15wz1_157",Ss="_globalModal_confirm_15wz1_172",Ms="_globalModal_confirm_info_15wz1_184",ws="_globalModal_confirm_desc_15wz1_191",$s="_globalModal_confirm_buttons_15wz1_207",Is="_globalModal_confirm_btn_15wz1_216",E={globalModal:_s,globalModal_back:us,globalModal_container:fs,globalModal_left:ms,globalModal_left_top:gs,globalModal_left_desc:ps,globalModal_left_bottom:bs,globalModal_left_bottom_link:hs,globalModal_left_bottom_label:ks,globalModal_right:xs,globalModal_right_top:js,globalModal_right_top_desc:vs,globalModal_right_bottom:Ps,globalModal_right_bottom_link:Ns,globalModal_right_bottom_label:ys,globalModal_confirm:Ss,globalModal_confirm_info:Ms,globalModal_confirm_desc:ws,globalModal_confirm_buttons:$s,globalModal_confirm_btn:Is};function ct({staticText:e,method:n,setModalOpen:o}){const{globalRemember:l,setGlobalRemember:d,programRemember:a,setProgramRemember:r}=I();console.log("staticText",e,"method",n);const i=c=>{n=="program"?(d(c===!0?!1:l),r(c)):n=="global"&&(r(c===!0?!1:a),d(c)),o(!1)};return t.jsx("div",{className:E.globalModal_confirm,children:t.jsxs("div",{className:E.globalModal_confirm_info,children:[e==null?void 0:e.map(c=>t.jsx("p",{className:E.globalModal_confirm_desc,children:c.title},c.id)),t.jsxs("div",{className:E.globalModal_confirm_buttons,children:[t.jsx("button",{className:E.globalModal_confirm_btn,onClick:()=>i(!1),children:"Отменить"}),t.jsx("button",{className:E.globalModal_confirm_btn,onClick:()=>i(!0),children:"Применить"})]})]})})}const As=[{id:G(),title:"Данная настройка позволяет автоматически производить поиск товара в ручном режиме в национальной базе товаров и услуг PУз"},{id:G(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function Ds(){const{confirmModal:e,confirmModalChecked:n,programRemember:o,setProgramRemember:l,setConfirmModal:d}=I(),a=h.useRef(null),[r,i]=h.useState(!1);h.useEffect(()=>{console.log("globalRemember",o),a.current&&(console.log("checkboxRef.current",a.current.checked),a.current.checked=o)},[o,a]);const c=()=>{i(!0)};return t.jsxs("div",{className:E.globalModal_left,children:[r&&t.jsx(ct,{staticText:As,method:"program",setModalOpen:i}),t.jsxs("div",{className:E.globalModal_left_top,children:[t.jsx(F,{name:"MapPinIcon",width:35,height:35}),t.jsx("p",{className:E.globalModal_left_desc,children:"Данный товар не найден в национальной базе товаров и услуг."})]}),t.jsxs("div",{className:E.globalModal_left_bottom,children:[t.jsx(L,{to:"#",className:E.globalModal_left_bottom_link,children:"Искать в программе"}),t.jsxs("div",{className:E.globalModal_left_bottom_label,onClick:c,children:[t.jsx("input",{type:"checkbox",className:E.globalModal_left_bottom_checkbox,ref:a}),t.jsx("span",{children:"Запомнить это действие "})]})]})]})}async function lt(e){try{console.log("getGlobalProduct barcode",e);const n=await H.get(`https://api.upcitemdb.com/prod/trial/lookup?upc=${e}`);console.log("getGlobalProduct res",n)}catch(n){console.log("Ошибкра при поиске продукта в глобальной базе",n)}}const Rs=[{id:G(),title:"Данная настройка позволяет автоматически производить поиск в глобальной базе, в случаи если в национальной базе товары не были найдены"},{id:G(),title:"Внимание! В случаи глобального поиска, ИКПУ не будет присвоен."},{id:G(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function Ts(){const{searchText:e,confirmModal:n,confirmModalChecked:o,globalRemember:l,setGlobalRemember:d,setConfirmModal:a}=I(),r=h.useRef(null),[i,c]=h.useState(!1);h.useEffect(()=>{console.log("globalRemember",l),r.current&&(console.log("checkboxRef.current",r.current.checked),r.current.checked=l)},[l,r]),h.useEffect(()=>{console.log("globalRemember",l),r.current&&(console.log("checkboxRef.current",r.current.checked),r.current.checked=l)},[l,r]);const g=async k=>{const _=await lt(k);console.log("handleGlobalSearch data",_)},f=()=>{l==!1&&g(e)},p=()=>{c(!0)};return t.jsxs("div",{className:E.globalModal_right,children:[i&&t.jsx(ct,{staticText:Rs,method:"global",setModalOpen:c}),t.jsxs("div",{className:E.globalModal_right_top,children:[t.jsx(F,{name:"GlobeAltIcon",width:35,height:35}),t.jsxs("p",{className:E.globalModal_right_top_desc,children:[t.jsx("span",{children:"Ипользовать глобальный поиск"}),t.jsx("span",{children:"(В этом случаи, товару не будет присвоен ИКПУ)"})]})]}),t.jsxs("div",{className:E.globalModal_right_bottom,children:[t.jsx(L,{to:"#",className:E.globalModal_right_bottom_link,onClick:f,children:"Искать глобально"}),t.jsxs("div",{className:E.globalModal_right_bottom_label,onClick:p,children:[t.jsx("input",{type:"checkbox",ref:r,className:E.globalModal_right_bottom_checkbox}),t.jsx("span",{children:"Запомнить это действие"})]})]})]})}function Es(){const{setGlobalModal:e,setSearchText:n}=I(),o=()=>{n(""),e(!1)};return t.jsxs("div",{className:E.globalModal,children:[t.jsxs(L,{to:"#",className:E.globalModal_back,onClick:o,children:[t.jsx(F,{name:"ChevronLeftIcon",width:20,height:15}),t.jsx("span",{children:"Назад"})]}),t.jsxs("div",{className:E.globalModal_container,children:[t.jsx(Ds,{}),t.jsx(Ts,{})]})]})}function Ws(){const n=V().pathname,{pickedSearch:o,setPickedSearch:l,searchText:d,setSearchText:a,searchParams:r,TemporaryData:i,setTemporaryData:c,setSearchResponse:g,setTotalElementsStore:f,setTotalPagesStore:p,setCheckedProductsByCode:k,checkedProductsByCode:_,page:m,perPage:M,lang:x,globalModal:j,setGlobalModal:R,globalRemember:w,programRemember:A}=I(),[$,P]=h.useState(""),[b,N]=h.useState([]);h.useEffect(()=>{N([..._])},[_]),h.useEffect(()=>{P(""),a("")},[n]),h.useEffect(()=>{(o=="По штрих-коду"||o=="По ИКПУ"||o=="По ТН ВЭД")&&(d.toString(),d.length<13&&l("По ТН ВЭД"),d.length==13&&l("По штрих-коду"),d.length>13&&l("По ИКПУ"))},[d]),h.useEffect(()=>{const S=document.querySelector(`input[name="search"][value="${o}"]`);S&&(S.checked=!0)},[o]);const C=S=>{l(S.currentTarget.value)},q=async S=>{if(S.preventDefault(),K.get("access_token")||await nt(),d.length>0&&o!="По штрих-коду"&&o!="По ИКПУ"){console.log("1 СЦЕНАРИЙ по тексту");const{data:v,totalElements:y,totalPages:T}=await tt(o,d,m,M,x);v.length==0&&P("ничего не найдено"),y&&T&&(f(y),p(T));const D=[];for(const W of v){const B=await et(W),Z=await st(W.mxikCode,x);B&&D.push({...W,id:G(),photos:Z})}v.length==0?P("Ничего не найдено"):v.length>1&&D.length==0?P("Все найденые совпадения уже есть на складе"):v.length==1&&D.length==0?P("Этот продукт уже есть на складе"):v.length>0&&D.length>0&&D.filter(W=>i.some(B=>B.mxikCode===W.mxikCode))[0]&&P("Вы уже ввбрали это продукт");const O=D.filter(W=>!i.some(B=>B.mxikCode===W.mxikCode));g(O)}if(d.length>0&&o=="По штрих-коду"||o=="По ИКПУ"){console.log("2 СЦЕНАРИЙ по коду");const{data:v,totalElements:y,totalPages:T}=await tt(o,d,m,M,x);y&&T&&(f(y),p(T));const D=[];for(const W of v){const B=await et(W),Z=await st(W.mxikCode,x);B&&D.push({...W,id:G(),photos:Z})}if(v.length==0)if(w===!0){const W=await lt(d);console.log("navAddProduct fetchData",W)}else A===!0?console.log("programRemember === true что дальше? (NavAddProduct 207)",A):R(!0);else if(v.length>1&&D.length==0)P("Все найденые совпадения уже есть на складе");else if(v.length==1&&D.length==0){P("Этот продукт уже есть на складе");return}else if(v.length>0&&D.length>0&&D.filter(W=>i.some(B=>B.mxikCode===W.mxikCode))[0]){P("Вы уже ввбрали это продукт");return}const O=D.filter(W=>!i.some(B=>B.mxikCode===W.mxikCode));k([...O]),c([...i,...O])}},U=S=>{console.log("value",S),/^[a-zA-Z]+$/.test(S)?(console.log("тексе"),o!="Расширинный по тексту"&&o!="По бренду"&&o!="По номеру рег. удостовирения"&&o!="По MHH"&&(l("По тексту"),P(""))):/^\d+$/.test(S)?(console.log("число"),S.length<=4?(l("По ТН ВЭД"),P(""),console.log("По ТН ВЭД")):S.length>4&&S.length<=13?(console.log("По штрих-коду"),P(""),l("По штрих-коду")):S.length>13&&S.length<=17?(l("По ИКПУ"),P(""),console.log("По ИКПУ")):S.length>17?(console.log("value",S),console.log("код ИКПУ не валидный"),P("код ИКПУ не валидный")):P("Введен невалидный символ")):o!="Расширинный по тексту"&&o!="По бренду"&&o!="По номеру рег. удостовирения"&&o!="По MHH"&&l("По тексту"),a(S)},X=S=>{S.key==="Backspace"&&(P(""),console.log("Backspace was pressed"))};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.nav,children:[j&&A===!1&&w===!1&&t.jsx(Es,{}),t.jsxs("form",{action:"",className:s.nav_form,onSubmit:S=>q(S),children:[t.jsxs("div",{className:s.nav_form_left,children:[t.jsxs("ul",{className:s.nav_buttons,children:[t.jsx("li",{children:t.jsxs(L,{className:`${s.back} ${s.nav_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(F,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(L,{to:"/addingProducts/settingsAddProducts",className:`${s.nav_linkBtn} ${s.nav_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(F,{name:"Cog8ToothIcon",className:s.nav_buttons_iconSetting})]})})]}),t.jsxs("fieldset",{children:[t.jsx("input",{value:d,type:"text",className:s.nav_form_input,placeholder:o,onKeyDown:X,onChange:S=>U(S.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.nav_form_btn,children:"Поиск"})]})]}),b.length>0&&i.length>0&&t.jsx(ds,{}),t.jsx("ul",{className:s.nav_form_list,children:r==null?void 0:r.map(S=>t.jsx("li",{children:t.jsxs("label",{className:s.nav_form_check,children:[t.jsx("input",{type:"radio",name:"search",value:S.title,onClick:u=>C(u)}),t.jsx("span",{className:s.nav_form_check_text,children:S.title})]})},S.id))})]}),t.jsx("span",{className:s.nav_error,children:$})]})})}function Ls({setCancel:e,addSelectedProducts:n}){return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(L,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>n(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:e,children:"Отмена"})]})}function zs(){const{searchResponse:e,checkedProducts:n,searchText:o,TemporaryData:l,pickedSearch:d,setSearchText:a,setTemporaryData:r,setCheckedProducts:i,setSearchResponse:c,totalElementsStore:g,setTotalElementsStore:f,totalPagesStore:p,setTotalPagesStore:k,page:_,setPage:m,perPage:M,lang:x}=I(),[j,R]=h.useState([]),[w,A]=h.useState([]),[$,P]=h.useState(!1),b=h.useRef([]),N=h.useRef(null);h.useEffect(()=>{R([...e]);const u=w.filter(v=>e.some(y=>y.id===v));A(u),R([...e])},[e]);const C=(u,v)=>{if(u){A([...w,v]);const y=j.filter(T=>T.id==v)[0];console.log("выбран newProduct",y,"checkedProducts",n,"allRef.current",N.current),i([...n,y])}else if(!u){const y=w.filter(D=>D!=v);A([...y]);const T=n.filter(D=>D.id!=v);console.log("не выбран newProducts",T),i([...T]),N.current&&(P(!1),N.current.checked=!1)}N.current&&u&&w.length+1==j.length&&(P(!0),N.current.checked=!0,i([...j]))},q=u=>{if(P(u),u){b.current.forEach(y=>{y&&(y.checked=u)});const v=j.map(y=>y.id);A([...v]),i([...j])}else A([]),b.current.forEach(v=>{v&&(v.checked=u)}),i([])},U=()=>{if(n){const u=n.map(v=>({...v,crmNameProduct:v.subPositionName,crmAmount:0,crmArrivalPrice:0,crmSellingPrice:0}));console.log("addSelectedProducts myItem",u),r([...l,...u]),S()}},X=async u=>{u.preventDefault();const v=_+1;m(v);const{data:y}=await tt(d,o,v,M,x),T=[];for(const D of y){const O=await et(D),W=await st(D.mxikCode,x);O&&T.push({...D,id:G(),photos:W})}N.current&&(P(!1),N.current.checked=!1,c([...T,...e]))},S=()=>{c([]),i([]),f(0),k(0),a(""),m(0)};return t.jsx("section",{className:s.foundProducts,onClick:S,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:u=>u.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",g]}),t.jsxs("span",{children:["Текущее количество - ",j.length]}),t.jsxs("span",{children:["Выбрано элементов - ",w.length]})]}),_+1<p&&p!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:u=>X(u),children:"добавить ещё..."}),j.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:u=>q(u.target.checked),ref:N}),t.jsx("span",{children:$?"Отключить все":"Выбрать все"})]}),t.jsx(Ls,{addSelectedProducts:U,setCancel:S})]}),t.jsx("ul",{className:s.foundProducts_list,children:j==null?void 0:j.map((u,v)=>{var y;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:(y=u==null?void 0:u.photos)!=null&&y[0]?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+u.photos[0]:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:u==null?void 0:u.internationalCode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:u==null?void 0:u.mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:u==null?void 0:u.brandName})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:u==null?void 0:u.subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:u==null?void 0:u.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${$||w.includes(u.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:T=>C(T.target.checked,u.id),ref:T=>{b.current[v]=T}}),"Выбрать"]})]},u==null?void 0:u.id)})})]})})}function Cs({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsx("div",{className:s.left_content,children:e.map(n=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:n.title}),t.jsx("p",{children:n.value})]},n.id))})})}function Fs(){const{imagesSrc:e,setImagesSrc:n}=I(),[o,l]=h.useState(null),d=h.useRef([]),a=_=>{d.current.forEach(m=>{m&&m.getAttribute("id")==_&&m.click()})};function r(_,m){l(m)}function i(_){_.target.style.background="white"}function c(_){_.target.style.background="white"}function g(_){_.preventDefault(),_.target.style.background="lightgray"}function f(_,m){_.preventDefault(),_.target.style.background="white";const M=e.map(x=>x.id===m.id?{...x,order:(o==null?void 0:o.order)||x.order}:x.id===(o==null?void 0:o.id)?{...x,order:m.order}:x);n(M),l(null)}function p(_,m){return _.order>m.order?1:-1}const k=_=>{var M,x;const m=(x=(M=_==null?void 0:_.target)==null?void 0:M.files)==null?void 0:x[0];if(m&&(m==null?void 0:m.type)==="image/jpeg"||(m==null?void 0:m.type)==="image/png"||(m==null?void 0:m.type)==="image/webp"){const j=_.target.getAttribute("id"),R=[...e],w=R.find($=>$.id==j),A=R.findIndex($=>$.id==j);if(w){const $=new FileReader;$.onload=P=>{var b;(b=P.target)!=null&&b.result&&(w.src=URL.createObjectURL(m),R.splice(A,1,w),n([...R]))},$.readAsDataURL(m)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(p).map((_,m)=>{var M;return t.jsxs("div",{draggable:!0,onDragStart:x=>r(x,_),onDragLeave:x=>i(x),onDragEnd:x=>c(x),onDragOver:x=>g(x),onDrop:x=>f(x,_),className:m==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>a(_.id),children:[t.jsx("input",{id:_.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:k,ref:x=>{d.current[m]=x}}),t.jsx("img",{src:_.src=="/noPhoto.jpg"||((M=_.src)==null?void 0:M.toString().split(":")[0])=="blob"?_.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+_.src,width:m==0?150:50,height:m==0?150:50,alt:"",className:`${m==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},_.id)})})})})}function Bs({addingImgToProduct:e,handleCancel:n}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(L,{to:"#",className:s.ikpuWrapper_save,onClick:o=>e(o),children:"Coхранить"}),t.jsx(L,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(L,{to:"#",onClick:o=>n(o),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const J=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:3,title:"Группа:",value:""},{id:4,title:"Класс:",value:""},{id:5,title:"Позиция:",value:""},{id:6,title:"Субпозиция:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""},{id:9,title:"Описание:",value:""}];function qs(){const{searchResponseItem:e,imagesSrc:n,setImagesSrc:o,setSearchResponseItem:l,setIkpuStatus:d}=I(),[a,r]=h.useState([]);h.useEffect(()=>{if(e){const g=J==null?void 0:J.map(f=>{let p;return f.title=="ИКПУ:"&&(p=e.mxikCode),f.title=="Штрих-код:"&&(p=e.internationalCode),f.title=="Группа:"&&(p=e.groupName),f.title=="Класс:"&&(p=e.className),f.title=="Позиция:"&&(p=e.positionName),f.title=="Субпозиция:"&&(p=e.subPositionName),f.title=="Наименование:"&&(p=e.className),f.title=="Бренд:"&&(p=e.brandName),f.title=="Описание:"&&(p=e.attributeName),{id:f.id,title:f.title,value:p}});r([...g])}},[e]),h.useEffect(()=>{if(e.photos){const g=n.map((f,p)=>{var k,_;return{id:f.id,order:f.order,src:(k=e==null?void 0:e.photos)!=null&&k[p]?(_=e==null?void 0:e.photos)==null?void 0:_[p]:"/noPhoto.jpg"}});g&&o(g)}},[]);const i=g=>{g.preventDefault();const f=n==null?void 0:n.map(p=>p.src);e.photos=f,l(e),d(!1)};function c(g){g.preventDefault();const f=n.map(p=>({id:p.id,order:p.order,src:p.src}));o(f),d(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:c,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(Cs,{staticList:a}),t.jsx(Fs,{})]}),t.jsx(Bs,{addingImgToProduct:i,handleCancel:c})]})})})}function Hs({item:e}){const[n,o]=h.useState(0),{TemporaryData:l,setTemporaryData:d}=I(),a=r=>{const i=r.target.valueAsNumber;o(i);const c=l.find(g=>g.id==e.id);if(c){const g=l.findIndex(p=>p.id==e.id),f=[...l];f.splice(g,1,c),d(f)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function Us({item:e}){const[n,o]=h.useState(0),{TemporaryData:l,setTemporaryData:d}=I(),a=r=>{const i=r.target.valueAsNumber;o(i);const c=l.find(g=>g.id==e.id);if(c){c.crmSellingPrice=i;const g=l.findIndex(p=>p.id==e.id),f=[...l];f.splice(g,1,c),d(f)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function Os({item:e}){const[n,o]=h.useState(0),{TemporaryData:l,setTemporaryData:d}=I(),a=r=>{const i=r.target.valueAsNumber;o(i);const c=l.find(g=>g.id==e.id);if(c){const g=l.findIndex(p=>p.id==e.id),f=[...l];f.splice(g,1,c),d(f)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,min:0,className:s.table_body_amount,onChange:a})})}function Gs({item:e,column:n}){const{ikpuStatus:o,setSearchResponseItem:l,setIkpuStatus:d,setTemporaryData:a,TemporaryData:r,setOpenModalCategory:i,setCurrentProduct:c}=I(),g=k=>{l(k),d(!o)},f=()=>{r&&a(r.filter(k=>k.id!==e.id))},p=k=>{k.preventDefault(),i(!0),c(e)};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${n.length}, 200px)`},children:[n==null?void 0:n.map(k=>{var _,m,M,x,j,R,w,A;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(k==null?void 0:k.title)=="Количество"&&t.jsx(Os,{item:e}),(k==null?void 0:k.title)=="Приходная цена"&&t.jsx(Hs,{item:e}),(k==null?void 0:k.title)=="Продажная цена"&&t.jsx(Us,{item:e}),(k==null?void 0:k.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:e.subPositionName}),(k==null?void 0:k.title)=="Фото"?t.jsx("img",{src:((_=e.photos)==null?void 0:_[0])=="/noPhoto.jpg"?(m=e.photos)==null?void 0:m[0]:((M=e.photos)==null?void 0:M.length)==0?"/noPhoto.jpg":(j=(x=e.photos)==null?void 0:x[0])!=null&&j.startsWith("blob")?(R=e.photos)==null?void 0:R[0]:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+((w=e.photos)==null?void 0:w[0]),width:40,height:40,alt:"",className:s.table_body_img}):"",(k==null?void 0:k.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(k==null?void 0:k.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(k==null?void 0:k.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>g(e),children:t.jsx(F,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(k==null?void 0:k.title)=="Подкатегория"&&t.jsx(L,{to:"#",onClick:$=>p($),children:(A=e==null?void 0:e.crmCategory)!=null&&A.name.ru?e==null?void 0:e.crmCategory.name.ru:"Выбрать"}),(k==null?void 0:k.title)=="Штрих-код"&&(e==null?void 0:e.internationalCode)]},k==null?void 0:k.id)}),t.jsx("td",{className:s.table_body_del,onClick:f,children:t.jsx(F,{name:"TrashIcon",width:20,height:20})})]})}function Xs({column:e}){const{TemporaryData:n}=I();return t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(o=>t.jsx("td",{className:s.table_head_col,children:o.title},o.id))})}),t.jsx("tbody",{className:s.table_body,children:n==null?void 0:n.map(o=>t.jsx(Gs,{item:o,column:e},o==null?void 0:o.id))})]})}function Ks({clearTable:e,setData:n}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:n,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:o=>e(o),children:"Отмена"})]})}function Qs(){const e=h.useRef(null),[n,o]=h.useState(!1),[l,d]=h.useState(0),[a,r]=h.useState(0),i=b=>{e.current&&(o(!0),d(b.pageX-e.current.offsetLeft),r(e.current.scrollLeft))},c=()=>{o(!1)},g=()=>{o(!1)},f=b=>{if(!n||!e.current)return;b.preventDefault();const C=(b.pageX-e.current.offsetLeft-l)*2;e.current.scrollLeft=a-C},{settingsParams:p,ikpuStatus:k,TemporaryData:_,openModalCategory:m,setTemporaryData:M,setCheckedProducts:x,nameProduct:j}=I(),[R,w]=h.useState([]);h.useEffect(()=>{const b=p.filter(N=>N.checked);w(()=>[...b])},[p]);const A=async b=>{b.preventDefault();for(const N of _)await $(N)};async function $(b){var N,C,q;try{const U=K.get("multi-store"),X={multiStoreId:Number(U),categoryId:Number((N=b==null?void 0:b.crmCategory)==null?void 0:N.id),barcode:Number(b==null?void 0:b.internationalCode),nameUz:"string",nameUzc:"string",nameRu:j||((C=b==null?void 0:b.crmNameProduct)==null?void 0:C.toString()),mxik:(q=b==null?void 0:b.mxikCode)==null?void 0:q.toString(),brand:b.brandName??null,oldPrice:Number(b==null?void 0:b.crmArrivalPrice),price:Number(b==null?void 0:b.crmSellingPrice),oldPriceCourse:0,priceCourse:0,nds:0,discount:0};await Q.post("nomenclatures",X),M([]),x([])}catch(U){console.log(`Ошибка произошла при попытке добавить ${b==null?void 0:b.crmNameProduct} на сервер`,U)}}const P=b=>{b.preventDefault(),M([]),x([])};return t.jsxs("div",{className:s.formWrapper,children:[m&&t.jsx(at,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:i,onMouseLeave:c,onMouseUp:g,onMouseMove:f,children:[k&&t.jsx(qs,{}),t.jsx(Xs,{column:R})]}),t.jsx(Ks,{clearTable:P,setData:A})]})}function ot(){const{errorModal:e}=I();return t.jsx("div",{className:s.errorModal,children:t.jsx("div",{className:s.errorModal_block,children:t.jsx("p",{children:e==null?void 0:e.message})})})}const Vs="_layout_1pbgc_1",Zs="_layout_back_1pbgc_4",Js="_layout_title_1pbgc_14",Ys="_layout_list_1pbgc_19",to="_layout_link_1pbgc_25",eo="_layout_link_active_1pbgc_34",so="_form_list_1pbgc_38",oo="_form_check_1pbgc_43",no="_navSetting_1pbgc_49",ao="_found_1pbgc_53",co="_table_1pbgc_74",lo="_table_head_1pbgc_78",ro="_table_head_row_1pbgc_81",io="_table_head_col_1pbgc_85",z={layout:Vs,layout_back:Zs,layout_title:Js,layout_list:Ys,layout_link:to,layout_link_active:eo,form_list:so,form_check:oo,navSetting:no,found:ao,table:co,table_head:lo,table_head_row:ro,table_head_col:io};function _o(){const e=h.useRef([]),{necessarilySettings:n,settingsParams:o,setSettingsParams:l}=I();h.useEffect(()=>{e.current.forEach((a,r)=>{a&&(a.checked=o[r].checked,n.forEach(i=>{a.value==i&&(a.checked=!0)}))})},[o]);const d=a=>{const r=o.map(i=>({id:i.id,title:i.title,checked:i.title==a.currentTarget.value?a.currentTarget.checked:i.checked}));l(r)};return t.jsx("nav",{className:z.navSetting,children:t.jsx("form",{action:"",className:z.form,children:t.jsx("ul",{className:z.form_list,children:o==null?void 0:o.map((a,r)=>t.jsx("li",{children:t.jsxs("label",{className:z.form_check,children:[t.jsx("input",{type:"checkbox",value:a.title,ref:i=>{e.current[r]=i},onChange:i=>d(i)}),t.jsx("span",{className:z.form_check_text,children:a.title})]})},a.id))})})})}function uo(){const n=V().pathname,{settingsParams:o}=I(),[l,d]=h.useState([]);h.useEffect(()=>{const r=o.filter(i=>i.checked);d(()=>[...r])},[o]);const a=[{id:1,title:"отображения колонок",href:"/addingProducts/settingsAddProducts"}];return t.jsxs("div",{className:"container",children:[t.jsxs("nav",{className:z.layout,children:[t.jsx(L,{className:z.layout_back,to:"/addingProducts",children:"Закрыть"}),t.jsx("h2",{className:z.layout_title,children:"Настройки"}),t.jsx("ul",{className:z.layout_list,children:a.map(r=>t.jsx("li",{children:t.jsx(L,{to:r.href,className:`${z.layout_link} ${r.href==n?z.layout_link_active:""}`,children:r.title})},r.id))}),n=="/addingProducts/settingsAddProducts"&&t.jsx(_o,{})]}),t.jsx("section",{className:z.found,children:t.jsxs("table",{className:z.table,children:[t.jsx("thead",{className:z.table_head,children:t.jsx("tr",{className:z.table_head_row,style:{gridTemplateColumns:`repeat(${l.length}, 200px)`},children:l==null?void 0:l.map(r=>t.jsx("td",{className:z.table_head_col,children:r.title},r.id))})}),t.jsx("tbody",{className:z.table_body,children:t.jsx("tr",{className:z.table_body_row,children:t.jsx("td",{className:z.table_body_col})})})]})})]})}function fo({staticList:e}){return t.jsx("div",{className:s.left,children:t.jsxs("div",{className:s.left_content,children:[e.map(n=>t.jsxs("div",{className:s.left_content_item,children:[t.jsx("h3",{children:n.title}),t.jsx("p",{children:n.value})]},n.id)),t.jsx("span",{style:{fontSize:"14px"},children:"(нужны картинки с сервера при get, post, patch запрсе по name)"})]})})}function mo(){const{stockImagesSrc:e,setStockImagesSrc:n}=I(),[o,l]=h.useState(null),d=h.useRef([]),a=_=>{d.current.forEach(m=>{m&&m.getAttribute("id")==_&&m.click()})};function r(_,m){l(m)}function i(_){_.target.style.background="white"}function c(_){_.target.style.background="white"}function g(_){_.preventDefault(),_.target.style.background="lightgray"}function f(_,m){_.preventDefault(),_.target.style.background="white";const M=e.map(x=>x.id===m.id?{...x,order:(o==null?void 0:o.order)||x.order}:x.id===(o==null?void 0:o.id)?{...x,order:m.order}:x);n(M),l(null)}function p(_,m){return _.order>m.order?1:-1}const k=_=>{var M,x;const m=(x=(M=_==null?void 0:_.target)==null?void 0:M.files)==null?void 0:x[0];if(m&&(m==null?void 0:m.type)==="image/jpeg"||(m==null?void 0:m.type)==="image/png"||(m==null?void 0:m.type)==="image/webp"){const j=_.target.getAttribute("id"),R=[...e],w=R.find($=>$.id==j),A=R.findIndex($=>$.id==j);if(w){const $=new FileReader;$.onload=P=>{var b;(b=P.target)!=null&&b.result&&(w.src=URL.createObjectURL(m),R.splice(A,1,w),n([...R]))},$.readAsDataURL(m)}}};return t.jsx("div",{className:s.right,children:t.jsx("div",{className:s.right_block,children:t.jsx("div",{className:s.right_bottom,children:e.sort(p).map((_,m)=>{var M;return t.jsxs("div",{draggable:!0,onDragStart:x=>r(x,_),onDragLeave:x=>i(x),onDragEnd:x=>c(x),onDragOver:x=>g(x),onDrop:x=>f(x,_),className:m==0?s.right_bottom_BaseItem:s.right_bottom_item,onDoubleClick:()=>a(_.id),children:[t.jsx("input",{id:_.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:k,ref:x=>{d.current[m]=x}}),t.jsx("img",{src:_.src=="/noPhoto.jpg"||((M=_.src)==null?void 0:M.toString().split(":")[0])=="blob"?_.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+_.src,width:m==0?150:50,height:m==0?150:50,alt:"",className:`${m==0?s.right_bottom_baseImg:s.right_bottom_img}`})]},_.id)})})})})}function go({addingImgToProduct:e,handleCancel:n}){return t.jsxs("div",{className:s.ikpuWrapper_buttons,children:[t.jsx(L,{to:"#",className:s.ikpuWrapper_save,onClick:o=>e(o),children:"Coхранить"}),t.jsx(L,{to:"#",className:s.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(L,{to:"#",onClick:o=>n(o),className:s.ikpuWrapper_cancel,children:"Отмена"})]})}const Y=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""}];function po(){const{searchResponseItem:e,stockImagesSrc:n,setStockImagesSrc:o,setSearchResponseItem:l,setStockIkpuStatus:d}=I(),[a,r]=h.useState([]);h.useEffect(()=>{if(e){const g=Y==null?void 0:Y.map(f=>{var k;let p;return f.title=="ИКПУ:"&&(p=e.mxik),f.title=="Штрих-код:"&&(p=e.barcode),f.title=="Группа:"&&(p=e.groupName),f.title=="Класс:"&&(p=e.className),f.title=="Позиция:"&&(p=e.positionName),f.title=="Субпозиция:"&&(p=e.subPositionName),f.title=="Наименование:"&&(p=(k=e.name)==null?void 0:k.ru),f.title=="Бренд:"&&(p=e.brand),f.title=="Описание:"&&(p=e.description),{id:f.id,title:f.title,value:p}});r([...g])}},[e]),h.useEffect(()=>{if(e.photos){const g=n.map((f,p)=>{var k,_;return{id:f.id,order:f.order,src:(k=e==null?void 0:e.photos)!=null&&k[p]?(_=e==null?void 0:e.photos)==null?void 0:_[p]:"/noPhoto.jpg"}});g&&o(g)}},[]);const i=g=>{g.preventDefault();const f=n==null?void 0:n.map(p=>p.src);e.photos=f,l(e),d(!1)};function c(g){g.preventDefault();const f=n.map(p=>({id:p.id,order:p.order,src:p.src}));o(f),d(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:s.ikpuWrapper,onClick:c,children:t.jsxs("div",{className:s.ikpuWrapper_ikpuModalBlock,onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:s.ikpuWrapper_content,children:[t.jsx(fo,{staticList:a}),t.jsx(mo,{})]}),t.jsx(go,{addingImgToProduct:i,handleCancel:c})]})})})}function bo({item:e}){const[n,o]=h.useState(e.oldPrice),{stockTemporaryData:l,setStockTemporaryData:d}=I(),a=r=>{const i=r.target.value;o(Number(i));const c=l.filter(f=>f.id==e.id)[0],g=l.findIndex(f=>f.id==e.id);c&&(c.oldPrice=Number(i),l.splice(g,1,c),d([...l]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function ho({item:e}){const[n,o]=h.useState(e.price),{stockTemporaryData:l,setStockTemporaryData:d}=I(),a=r=>{const i=r.target.value;o(Number(i));const c=l.filter(f=>f.id==e.id)[0],g=l.findIndex(f=>f.id==e.id);c.price&&(c.price=Number(i),l.splice(g,1,c),d([...l]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:s.table_body_amount,min:0,onChange:a})})}function ko({item:e}){const[n,o]=h.useState(0),{stockTemporaryData:l,setStockTemporaryData:d}=I(),a=r=>{const i=r.target.valueAsNumber;o(i);const c=l.find(g=>g.id==e.id);if(c){const g=l.findIndex(p=>p.id==e.id),f=[...l];f.splice(g,1,c),d(f)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,min:0,className:s.table_body_amount,onChange:a})})}function xo({item:e,column:n}){const{stockTemporaryData:o,setSearchResponseItem:l,setStockIkpuStatus:d,setStockTemporaryData:a}=I(),r=c=>{l(c),d(!0)},i=()=>{o&&a(o.filter(c=>c.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:s.table_head_row,style:{gridTemplateColumns:`repeat(${n.length}, 200px)`},children:[n==null?void 0:n.map(c=>{var g;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:s.table_body_col,children:[(c==null?void 0:c.title)=="Количество"&&t.jsx(ko,{item:e}),(c==null?void 0:c.title)=="Приходная цена"&&t.jsx(bo,{item:e}),(c==null?void 0:c.title)=="Продажная цена"&&t.jsx(ho,{item:e}),(c==null?void 0:c.title)=="Наименование"&&t.jsx("span",{className:s.table_body_nameString,children:(g=e==null?void 0:e.name)==null?void 0:g.ru}),(c==null?void 0:c.title)=="Фото"?t.jsx("img",{src:"/noPhoto.jpg",width:40,height:40,alt:"",className:s.table_body_img}):"",(c==null?void 0:c.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(c==null?void 0:c.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(c==null?void 0:c.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>r(e),children:t.jsx(F,{name:"FolderOpenIcon",className:s.table_body_icon})}):"",(c==null?void 0:c.title)=="Штрих-код"&&(e!=null&&e.barcode)?e==null?void 0:e.barcode:""]},c==null?void 0:c.id)}),t.jsx("td",{className:s.table_body_del,onClick:i,children:t.jsx(F,{name:"TrashIcon",width:20,height:20})})]})}function jo({column:e}){const{stockTemporaryData:n}=I(),[o,l]=h.useState([]);return h.useEffect(()=>{l(n)},[n]),t.jsxs("table",{className:s.table,children:[t.jsx("thead",{className:s.table_head,children:t.jsx("tr",{className:s.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(d=>t.jsx("td",{className:s.table_head_col,children:d.title},d.id))})}),t.jsx("tbody",{className:s.table_body,children:o==null?void 0:o.map(d=>t.jsx(xo,{item:d,column:e},d==null?void 0:d.id))})]})}function vo({clearTable:e,setData:n}){return t.jsxs("div",{className:s.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${s.formWrapper_btn} ${s.formWrapper_btn_save}`,onClick:n,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${s.formWrapper_btn} ${s.formWrapper_btn_cancel}`,onClick:o=>e(o),children:"Отмена"})]})}function Po(){const e=h.useRef(null),[n,o]=h.useState(!1),[l,d]=h.useState(0),[a,r]=h.useState(0),i=b=>{e.current&&(o(!0),d(b.pageX-e.current.offsetLeft),r(e.current.scrollLeft))},c=()=>{o(!1)},g=()=>{o(!1)},f=b=>{if(!n||!e.current)return;b.preventDefault();const C=(b.pageX-e.current.offsetLeft-l)*2;e.current.scrollLeft=a-C},{settingsParams:p,stockIkpuStatus:k,stockTemporaryData:_,openModalCategory:m,setStockTemporaryData:M,setCheckedProducts:x,nameProduct:j}=I(),[R,w]=h.useState([]);h.useEffect(()=>{const b=p.filter(N=>N.checked&&N.title!="Подкатегория");w(()=>[...b])},[p]);const A=b=>{b.preventDefault(),_.forEach(N=>{$(N)})};async function $(b){var N;try{const C=K.get("multi-store"),q={nameRu:(N=b.name)==null?void 0:N.ru,oldPrice:b.oldPrice,price:b.price};await Q.patch(`nomenclatures/${b.id}`,q),M([]),x([])}catch(C){console.log(`Ошибка произошла при попытке добавить ${b==null?void 0:b.crmNameProduct} на сервер`,C)}}const P=b=>{b.preventDefault(),M([]),x([])};return t.jsxs("div",{className:s.formWrapper,children:[m&&t.jsx(at,{}),t.jsxs("div",{className:s.found,ref:e,onMouseDown:i,onMouseLeave:c,onMouseUp:g,onMouseMove:f,children:[k&&t.jsx(po,{}),t.jsx(jo,{column:R})]}),t.jsx(vo,{clearTable:P,setData:A})]})}async function rt(e,n,o,l,d){try{if(e==="По тексту"){console.log("fetchStockProducts page",l,"perPage",d);const a=await Q.get(`nomenclatures?multiStoreId=${n}&name=${o}&page=${l}&perPage=${d}`);console.log("fetchStockProducts res",a);const r=await a.data.data,i=await a.data.pagination.total,c=await a.data.pagination.total_pages;return{data:r,totalElements:i,totalPages:c}}}catch(a){console.log("Ошибка при получении продуктов со склада",a)}}function No(){const n=V().pathname,{stockPickedSearch:o,setStockPickedSearch:l,stockSearchParams:d,stockSearchText:a,setStockSearchText:r,setStockSearchResponse:i,stockTemporaryData:c,setTotalElementsStore:g,setTotalPagesStore:f,stockPage:p,perPage:k}=I(),[_,m]=h.useState("");h.useEffect(()=>{m(""),r("")},[n]),h.useEffect(()=>{(o=="По штрих-коду"||o=="По ИКПУ")&&(a.toString(),a.length<13&&l("По ТН ВЭД"),a.length==13&&l("По штрих-коду"),a.length>13&&l("По ИКПУ")),a.length>0&&m("")},[a]),h.useEffect(()=>{const j=document.querySelector(`input[name="search"][value="${o}"]`);j&&(j.checked=!0)},[o]);const M=j=>{l(j.currentTarget.value)},x=async j=>{j.preventDefault();const R=K.get("access_token"),w=K.get("multi-store");if((!R||!w)&&await nt(),a.length>0&&w){const{data:A,totalElements:$,totalPages:P}=await rt(o,w,a,p,k);console.log("totalElements",$,"totalPages",P),A.length==0&&m("ничего не найдено"),$&&P&&(g($),f(P));const b=A.filter(N=>!c.some(C=>C.id===N.id));i(b)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:s.navStock,children:[t.jsxs("ul",{className:s.navStock_buttons,children:[t.jsx("li",{children:t.jsxs(L,{className:`${s.back} ${s.navStock_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(F,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(L,{to:"/addingProducts/settingsAddProducts",className:`${s.navStock_linkBtn} ${s.navStock_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(F,{name:"Cog8ToothIcon",className:s.navStock_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:s.stockForm,onSubmit:j=>x(j),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:a,type:o=="По штрих-коду"||o=="По ИКПУ"?"number":"text",className:s.stockForm_input,placeholder:o,onChange:j=>r(j.currentTarget.value)}),t.jsx("button",{type:"submit",className:s.stockForm_btn,children:"Поиск"})]}),t.jsx("ul",{className:s.stockForm_list,children:d==null?void 0:d.map(j=>t.jsx("li",{children:t.jsxs("label",{className:s.stockForm_check,children:[t.jsx("input",{type:"radio",name:"search",value:j.title,onClick:R=>M(R)}),t.jsx("span",{className:s.stockForm_check_text,children:j.title})]})},j.id))})]}),t.jsx("span",{className:s.navStock_error,children:_})]})})}function yo({addSelectedProducts:e,setCancel:n}){const{setAddBlockStatus:o}=it(),l=()=>{n(),o(!1)};return t.jsxs("div",{className:s.foundProducts_buttons,children:[t.jsx(L,{to:"#",className:`${s.foundProducts_btn} ${s.foundProducts_btn_save}`,onClick:()=>e(),children:"Сохранить"}),t.jsx("button",{className:`${s.foundProducts_btn} ${s.foundProducts_btn_cancel}`,onClick:l,children:"Отмена"})]})}function So(){const{stockSearchResponse:e,setStockSearchResponse:n,stockCheckedProducts:o,setStockCheckedProducts:l,stockTemporaryData:d,setStockTemporaryData:a,totalElementsStore:r,setTotalElementsStore:i,totalPagesStore:c,setTotalPagesStore:g,stockSearchText:f,setStockSearchText:p,stockPickedSearch:k,stockPage:_,setStockPage:m,setPerPage:M,perPage:x}=I(),[j,R]=h.useState([]),[w,A]=h.useState([]),[$,P]=h.useState(!1),b=h.useRef([]),N=h.useRef(null);h.useEffect(()=>{R([...e]),console.log("stockSearchResponse",e)},[e]);const C=()=>{o&&a([...o,...d]),n([]),l([]),S()},q=(u,v)=>{if(u){A([...w,v]);const y=j.filter(T=>T.id==v)[0];l([...o,y])}else if(!u&&N.current){const y=w.filter(D=>D!=v);A([...y]);const T=o.filter(D=>D.id!=v);l([...T]),P(!1),N.current.checked=!1}N.current&&u&&w.length+1==j.length&&(P(!0),N.current.checked=!0,l([...j]))},U=u=>{if(P(u),u){b.current.forEach(y=>{y&&(y.checked=u)});const v=j.map(y=>y.id);A([...v]),l([...j])}else A([]),b.current.forEach(v=>{v&&(v.checked=u)}),l([])},X=async u=>{u.preventDefault();const v=_+1;m(v);const y=K.get("multi-store");if(y){const{data:T}=await rt(k,y,f,v,x),D=T.filter(O=>!d.some(W=>W.id===O.id));console.log("filteredSearchResponse",D),console.log("stockSearchResponse",e),console.log("stockSearchText",f),N.current&&(P(!1),N.current.checked=!1,n([...D,...e]))}},S=()=>{n([]),l([]),i(0),g(0),p(""),m(1),M(5)};return t.jsx("section",{className:s.foundProducts,onClick:S,children:t.jsxs("div",{className:s.foundProducts_modal,onClick:u=>u.stopPropagation(),children:[t.jsxs("div",{className:s.foundProducts_top,children:[t.jsxs("h2",{className:s.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",r]}),t.jsxs("span",{children:["Текущее количество - ",j.length]}),t.jsxs("span",{children:["Выбрано элементов - ",w.length]})]}),_<c&&c!=1&&t.jsx("span",{className:s.foundProducts_more,onClick:u=>X(u),children:"добавить ещё..."}),j.length>1&&t.jsxs("label",{className:s.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:u=>U(u.target.checked),ref:N}),t.jsx("span",{children:$?"Отключить все":"Выбрать все"})]}),t.jsx(yo,{addSelectedProducts:C,setCancel:S})]}),t.jsx("ul",{className:s.foundProducts_list,children:j==null?void 0:j.map((u,v)=>{var y;return t.jsxs("li",{className:s.foundProducts_item,children:[t.jsx("span",{className:s.foundProducts_item_photo,children:t.jsx("img",{src:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:s.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:u==null?void 0:u.barcode})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:u==null?void 0:u.mxik})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:u==null?void 0:u.brand})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:(y=u==null?void 0:u.name)==null?void 0:y.ru})]}),t.jsxs("li",{children:[t.jsx("span",{className:s.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:s.foundProducts_item_desc,children:u==null?void 0:u.attributeName})]})]}),t.jsxs("label",{className:`
                ${s.foundProducts_item_btn}
                ${$||w.includes(u.id)?s.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:T=>q(T.target.checked,u.id),ref:T=>{b.current[v]=T}}),"Выбрать"]})]},u==null?void 0:u.id)})})]})})}function Ao(){const n=V().pathname,{searchResponse:o,stockSearchResponse:l,errorModal:d,TemporaryData:a,stockTemporaryData:r,setTemporaryData:i,setCheckedProducts:c}=I(),[g,f]=h.useState(!1);h.useEffect(()=>{p()},[]);const p=()=>{i([]),c([])};return t.jsxs("div",{className:s.addingProducts,children:[t.jsxs("div",{className:`${s.leftMenu} ${g?s.leftMenu_active:""}`,children:[t.jsx("button",{className:s.leftMenu_btn,onClick:()=>f(!g),children:t.jsx(F,{name:"Bars3Icon"})}),t.jsxs("ul",{className:s.leftMenu_list,children:[t.jsxs("li",{className:`${s.leftMenu_li} ${n=="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(F,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${g?"":s.leftMenu_li_icon_active}`}),t.jsx(L,{to:"/addingProducts",className:`${s.leftMenu_link} ${g?s.leftMenu_link_active:""}`,children:"Добавить номенклатуру"}),t.jsx(F,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${g?s.leftMenu_linkArrow_active:""}`})]}),t.jsxs("li",{className:`${s.leftMenu_li} ${n!="/addingProducts"?s.leftMenu_li_active:""}`,children:[t.jsx(F,{name:"ShoppingCartIcon",className:`${s.leftMenu_li_icon} ${g?"":s.leftMenu_li_icon_active}`}),t.jsx(L,{to:"/addingProducts/stockProducts",className:`${s.leftMenu_link} ${g?s.leftMenu_link_active:""}`,children:"Создать номенклатуру"}),t.jsx(F,{name:"ChevronRightIcon",className:`${s.leftMenu_linkArrow} ${g?s.leftMenu_linkArrow_active:""}`})]})]})]}),n=="/addingProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx(Ws,{}),t.jsxs(t.Fragment,{children:[o.length>0&&t.jsx(zs,{}),a.length>0&&t.jsx(Qs,{}),d.status&&t.jsx(ot,{})]})]}),n=="/addingProducts/stockProducts"&&t.jsxs("div",{className:s.container,children:[t.jsx(No,{}),l.length>0&&t.jsx(So,{}),r.length>0&&t.jsx(Po,{}),d.status&&t.jsx(ot,{})]}),n=="/addingProducts/settingsAddProducts"&&t.jsx(uo,{})]})}export{Ao as default};
