import{w as G,b as Q,c as X,r as b,j as t,L as D,y as O,x as V,D as st,a as _t}from"./index-DYxtvusx.js";import{a as w,C as it,M as dt}from"./Modal-BIR58sYf.js";import{C as R}from"./CustomIcon-B6T_3kn-.js";import"./XMarkIcon-D6stU_U1.js";const ut="_container_my8nj_1",mt="_nav_my8nj_11",gt="_nav_linkBtn_my8nj_15",ft="_nav_settingsIcon_my8nj_19",bt="_nav_buttons_my8nj_23",pt="_nav_buttons_link_my8nj_28",ht="_nav_buttons_iconSetting_my8nj_33",jt="_setting_my8nj_1",yt="_nav_error_my8nj_36",xt="_nav_form_my8nj_43",kt="_nav_form_left_my8nj_49",Pt="_nav_form_input_my8nj_59",Nt="_nav_form_btn_my8nj_64",vt="_nav_form_list_my8nj_95",St="_nav_form_check_my8nj_100",Mt="_nav_form_check_text_my8nj_106",wt="_navStock_my8nj_110",Ct="_navStock_linkBtn_my8nj_113",$t="_navStock_settingsIcon_my8nj_118",It="_navStock_buttons_my8nj_122",At="_navStock_buttons_link_my8nj_127",Et="_navStock_buttons_iconSetting_my8nj_132",Dt="_navStock_error_my8nj_135",Tt="_stockForm_my8nj_143",Rt="_stockForm_input_my8nj_154",Wt="_stockForm_btn_my8nj_160",Lt="_stockForm_list_my8nj_191",zt="_stockForm_check_my8nj_196",Bt="_stockForm_check_text_my8nj_202",Ft="_formWrapper_my8nj_206",Ht="_formWrapper_buttons_my8nj_212",qt="_formWrapper_btn_my8nj_218",Ut="_formWrapper_btn_cancel_my8nj_230",Gt="_formWrapper_btn_save_my8nj_233",Ot="_found_my8nj_237",Zt="_table_my8nj_261",Xt="_table_head_my8nj_266",Qt="_table_head_row_my8nj_269",Vt="_table_head_col_my8nj_274",Kt="_table_head_minCol_my8nj_277",Jt="_table_body_row_my8nj_283",Yt="_table_body_col_my8nj_288",te="_table_body_minCol_my8nj_297",ee="_table_body_img_my8nj_303",oe="_table_body_icon_my8nj_307",se="_table_body_nameHover_my8nj_311",ne="_table_body_name_my8nj_311",ae="_table_body_nameString_my8nj_352",ce="_table_body_amount_my8nj_361",le="_table_body_catalog_my8nj_369",re="_table_body_catalog_top_my8nj_379",_e="_table_body_catalog_icon_my8nj_398",ie="_table_body_catalog_iconActive_my8nj_401",de="_table_body_catalog_drop_my8nj_404",ue="_table_body_catalog_dropActive_my8nj_429",me="_table_body_catalog_search_my8nj_434",ge="_table_body_catalog_item_my8nj_448",fe="_table_body_catalog_text_my8nj_456",be="_table_body_buttons_my8nj_462",pe="_table_body_del_my8nj_467",he="_table_body_generation_my8nj_467",je="_table_body_barcodeSave_my8nj_467",ye="_table_body_still_my8nj_467",xe="_table_body_category_my8nj_482",ke="_table_body_category_btn_my8nj_487",Pe="_table_body_category_span_my8nj_502",Ne="_table_body_qr_my8nj_517",ve="_table_body_barcode_my8nj_467",Se="_table_body_error_my8nj_534",Me="_ikpuWrapper_my8nj_543",we="_ikpuWrapper_ikpuModalBlock_my8nj_552",Ce="_ikpuWrapper_content_my8nj_562",$e="_ikpuWrapper_buttons_my8nj_568",Ie="_ikpuWrapper_save_my8nj_574",Ae="_ikpuWrapper_delete_my8nj_584",Ee="_ikpuWrapper_cancel_my8nj_594",De="_left_my8nj_605",Te="_left_content_my8nj_608",Re="_left_content_item_my8nj_613",We="_right_my8nj_623",Le="_right_block_my8nj_627",ze="_right_bottom_my8nj_633",Be="_right_bottom_item_my8nj_641",Fe="_right_bottom_item_img_my8nj_651",He="_right_bottom_BaseItem_my8nj_656",qe="_right_bottom_BaseItem_img_my8nj_667",Ue="_foundProducts_my8nj_672",Ge="_foundProducts_modal_my8nj_680",Oe="_foundProducts_top_my8nj_705",Ze="_foundProducts_top_buttons_my8nj_719",Xe="_foundProducts_top_add_my8nj_724",Qe="_foundProducts_top_close_my8nj_741",Ve="_foundProducts_item_my8nj_745",Ke="_foundProducts_item_mxik_my8nj_753",Je="_foundProducts_item_content_my8nj_778",Ye="_foundProducts_item_photo_my8nj_783",to="_foundProducts_item_list_my8nj_796",eo="_foundProducts_item_list_box_my8nj_802",oo="_foundProducts_item_title_my8nj_824",so="_foundProducts_item_myIcon_my8nj_828",no="_foundProducts_item_desc_my8nj_835",ao="_foundProducts_item_btn_my8nj_839",co="_foundProducts_item_btn_active_my8nj_853",lo="_foundProducts_title_my8nj_857",ro="_foundProducts_more_my8nj_865",_o="_foundProducts_allActive_my8nj_882",io="_foundProducts_buttons_my8nj_888",uo="_foundProducts_btn_my8nj_894",mo="_foundProducts_btn_cancel_my8nj_906",go="_foundProducts_btn_save_my8nj_909",fo="_foundProducts_list_my8nj_912",bo="_errorModal_my8nj_917",po="_errorModal_block_my8nj_926",ho="_addingProducts_my8nj_944",jo="_leftMenu_my8nj_948",yo="_leftMenu_list_my8nj_961",xo="_leftMenu_li_my8nj_961",ko="_leftMenu_li_icon_my8nj_1001",Po="_leftMenu_li_icon_active_my8nj_1005",No="_leftMenu_li_active_my8nj_1009",vo="_leftMenu_link_my8nj_1024",So="_leftMenu_link_active_my8nj_1039",Mo="_leftMenu_linkArrow_my8nj_1043",wo="_leftMenu_linkArrow_active_my8nj_1049",Co="_leftMenu_active_my8nj_1055",$o="_miniInfo_content_my8nj_1067",Io="_miniInfo_imgBlock_my8nj_1075",Ao="_miniInfo_list_my8nj_1085",o={container:ut,nav:mt,nav_linkBtn:gt,nav_settingsIcon:ft,nav_buttons:bt,nav_buttons_link:pt,nav_buttons_iconSetting:ht,setting:jt,nav_error:yt,nav_form:xt,nav_form_left:kt,nav_form_input:Pt,nav_form_btn:Nt,nav_form_list:vt,nav_form_check:St,nav_form_check_text:Mt,navStock:wt,navStock_linkBtn:Ct,navStock_settingsIcon:$t,navStock_buttons:It,navStock_buttons_link:At,navStock_buttons_iconSetting:Et,navStock_error:Dt,stockForm:Tt,stockForm_input:Rt,stockForm_btn:Wt,stockForm_list:Lt,stockForm_check:zt,stockForm_check_text:Bt,formWrapper:Ft,formWrapper_buttons:Ht,formWrapper_btn:qt,formWrapper_btn_cancel:Ut,formWrapper_btn_save:Gt,found:Ot,table:Zt,table_head:Xt,table_head_row:Qt,table_head_col:Vt,table_head_minCol:Kt,table_body_row:Jt,table_body_col:Yt,table_body_minCol:te,table_body_img:ee,table_body_icon:oe,table_body_nameHover:se,table_body_name:ne,table_body_nameString:ae,table_body_amount:ce,table_body_catalog:le,table_body_catalog_top:re,table_body_catalog_icon:_e,table_body_catalog_iconActive:ie,table_body_catalog_drop:de,table_body_catalog_dropActive:ue,table_body_catalog_search:me,table_body_catalog_item:ge,table_body_catalog_text:fe,table_body_buttons:be,table_body_del:pe,table_body_generation:he,table_body_barcodeSave:je,table_body_still:ye,table_body_category:xe,table_body_category_btn:ke,table_body_category_span:Pe,table_body_qr:Ne,table_body_barcode:ve,table_body_error:Se,ikpuWrapper:Me,ikpuWrapper_ikpuModalBlock:we,ikpuWrapper_content:Ce,ikpuWrapper_buttons:$e,ikpuWrapper_save:Ie,ikpuWrapper_delete:Ae,ikpuWrapper_cancel:Ee,left:De,left_content:Te,left_content_item:Re,right:We,right_block:Le,right_bottom:ze,right_bottom_item:Be,right_bottom_item_img:Fe,right_bottom_BaseItem:He,right_bottom_BaseItem_img:qe,foundProducts:Ue,foundProducts_modal:Ge,foundProducts_top:Oe,foundProducts_top_buttons:Ze,foundProducts_top_add:Xe,foundProducts_top_close:Qe,foundProducts_item:Ve,foundProducts_item_mxik:Ke,foundProducts_item_content:Je,foundProducts_item_photo:Ye,foundProducts_item_list:to,foundProducts_item_list_box:eo,foundProducts_item_title:oo,foundProducts_item_myIcon:so,foundProducts_item_desc:no,foundProducts_item_btn:ao,foundProducts_item_btn_active:co,foundProducts_title:lo,foundProducts_more:ro,foundProducts_allActive:_o,foundProducts_buttons:io,foundProducts_btn:uo,foundProducts_btn_cancel:mo,foundProducts_btn_save:go,foundProducts_list:fo,errorModal:bo,errorModal_block:po,addingProducts:ho,leftMenu:jo,leftMenu_list:yo,leftMenu_li:xo,leftMenu_li_icon:ko,leftMenu_li_icon_active:Po,leftMenu_li_active:No,leftMenu_link:vo,leftMenu_link_active:So,leftMenu_linkArrow:Mo,leftMenu_linkArrow_active:wo,leftMenu_active:Co,miniInfo_content:$o,miniInfo_imgBlock:Io,miniInfo_list:Ao};async function tt(e,n,s,a,l){try{if(e==="По тексту"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search-subposition?search_text=${n}&page=${s}&size=${a}&lang=${l}`);console.log("По тексту res",c);const m=await c.data.data.content,g=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:m,totalElements:g,totalPages:r}}else if(e==="По штрих-коду"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?gtin=${n}&size=${a}&page=${s}&lang=${l}`),m=await c.data.data.content,g=await c.data.data.totalElements,r=await c.data.data.totalPages;return console.log("По штрих-коду res",c),{data:m,totalElements:g,totalPages:r}}else if(e==="По ИКПУ"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?mxikCode=${n}&size=${a}&page=${s}&lang=${l}`);console.log("По ИКПУ res",c);const m=await c.data.data.content,g=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:m,totalElements:g,totalPages:r}}else if(e==="Расширинный по тексту"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?text=${n}&size=${a}&page=${s}&lang=${l}`);console.log("Расширинный по тексту res",c);const m=await c.data.data.content,g=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:m,totalElements:g,totalPages:r}}else if(e==="По номеру рег. удостовирения"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/dv-cert-number?dvCertNumber=${n}&page=${s}&size=${a}&lang=${l}`);console.log("По номеру рег. удостовирения res",c);const m=await c.data.data.content,g=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:m,totalElements:g,totalPages:r}}else if(e==="По ТН ВЭД"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?tnvedCode=${n}&size=${a}&page=${s}&lang=${l}`);console.log("По ТН ВЭД res",c);const m=await c.data.data.content,g=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:m,totalElements:g,totalPages:r}}else if(e==="По бренду"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/by-params?brandName=${n}&size=${a}&page=${s}&lang=${l}`);console.log("По бренду res",c);const m=await c.data.data.content,g=await c.data.data.totalElements,r=await c.data.data.totalPages;return{data:m,totalElements:g,totalPages:r}}else if(e==="По MHH"){const c=await G.get(`https://tasnif.soliq.uz/api/cls-api/mxik/search/mnn-name?mnn_name=${n}&page=${s}&size=${a}&lang=${l}`);console.log("По MHH res",c);const m=await c.data.data,g=await c.data.recordTotal,r=await g/a;return{data:m,totalElements:g,totalPages:r}}}catch(c){console.log(c)}}async function nt(e){var s;const n=Q.get("multi-store");try{return(await X.post("nomenclatures/is-unique-name",{multiStoreId:Number(n),nameRu:(s=e.subPositionName)==null?void 0:s.toString()})).data.success}catch(a){return console.log("Ошибка произошла при проверки наличия продукта на складе по наименованию",a),!1}}async function et(e,n){try{return(await G.get(`https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/mxik/picture-names?lang=${n}&mxik_code=${e}`)).data}catch(s){console.log("Ошибка при получении картинок к продукту",s)}}function Eo(){var a,l;const{checkedProductsByCode:e}=w(),[n,s]=b.useState([]);return b.useEffect(()=>{s([...e])},[e]),console.log("localProduct",n),t.jsx("div",{className:o.miniInfo,children:n.length>0&&t.jsxs("div",{className:o.miniInfo_content,children:[t.jsx("div",{className:o.miniInfo_imgBlock,children:t.jsx("img",{src:(l=(a=n[0])==null?void 0:a.photos)!=null&&l.length?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+n[0].photos[0]:"/noPhoto.jpg",alt:""})}),t.jsxs("ul",{className:o.miniInfo_list,children:[t.jsxs("li",{children:[t.jsx("span",{children:"Штрихкод:"}),t.jsx("span",{children:n&&n[0].internationalCode||"-"})]}),t.jsxs("li",{children:[t.jsx("span",{children:"ИКПУ:"}),t.jsx("span",{children:n&&n[0].mxikCode})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Бренд:"}),t.jsx("span",{children:n&&n[0].brandName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Наименование:"}),t.jsx("span",{children:n&&n[0].subPositionName})]}),t.jsxs("li",{children:[t.jsx("span",{children:"Ед. Изм:"}),t.jsx("span",{children:n&&n[0].attributeName})]})]})]})})}const Do="_globalModal_15wz1_1",To="_globalModal_back_15wz1_13",Ro="_globalModal_container_15wz1_45",Wo="_globalModal_left_15wz1_54",Lo="_globalModal_left_top_15wz1_59",zo="_globalModal_left_desc_15wz1_64",Bo="_globalModal_left_bottom_15wz1_71",Fo="_globalModal_left_bottom_link_15wz1_76",Ho="_globalModal_left_bottom_label_15wz1_94",qo="_globalModal_right_15wz1_109",Uo="_globalModal_right_top_15wz1_114",Go="_globalModal_right_top_desc_15wz1_119",Oo="_globalModal_right_bottom_15wz1_134",Zo="_globalModal_right_bottom_link_15wz1_139",Xo="_globalModal_right_bottom_label_15wz1_157",Qo="_globalModal_confirm_15wz1_172",Vo="_globalModal_confirm_info_15wz1_184",Ko="_globalModal_confirm_desc_15wz1_191",Jo="_globalModal_confirm_buttons_15wz1_207",Yo="_globalModal_confirm_btn_15wz1_216",W={globalModal:Do,globalModal_back:To,globalModal_container:Ro,globalModal_left:Wo,globalModal_left_top:Lo,globalModal_left_desc:zo,globalModal_left_bottom:Bo,globalModal_left_bottom_link:Fo,globalModal_left_bottom_label:Ho,globalModal_right:qo,globalModal_right_top:Uo,globalModal_right_top_desc:Go,globalModal_right_bottom:Oo,globalModal_right_bottom_link:Zo,globalModal_right_bottom_label:Xo,globalModal_confirm:Qo,globalModal_confirm_info:Vo,globalModal_confirm_desc:Ko,globalModal_confirm_buttons:Jo,globalModal_confirm_btn:Yo};function at({staticText:e,method:n,setModalOpen:s}){const{globalRemember:a,setGlobalRemember:l,programRemember:c,setProgramRemember:m}=w();console.log("staticText",e,"method",n);const g=r=>{n=="program"?(l(r===!0?!1:a),m(r)):n=="global"&&(m(r===!0?!1:c),l(r)),s(!1)};return t.jsx("div",{className:W.globalModal_confirm,children:t.jsxs("div",{className:W.globalModal_confirm_info,children:[e==null?void 0:e.map(r=>t.jsx("p",{className:W.globalModal_confirm_desc,children:r.title},r.id)),t.jsxs("div",{className:W.globalModal_confirm_buttons,children:[t.jsx("button",{className:W.globalModal_confirm_btn,onClick:()=>g(!1),children:"Отменить"}),t.jsx("button",{className:W.globalModal_confirm_btn,onClick:()=>g(!0),children:"Применить"})]})]})})}const ts=[{id:O(),title:"Данная настройка позволяет автоматически производить поиск товара в ручном режиме в национальной базе товаров и услуг PУз"},{id:O(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function es(){const{programRemember:e,searchText:n,setGlobalModal:s,setErrorMessage:a}=w(),l=b.useRef(null),[c,m]=b.useState(!1);b.useEffect(()=>{console.log("globalRemember",e),l.current&&(console.log("checkboxRef.current",l.current.checked),l.current.checked=e)},[e,l]);const g=()=>{m(!0)},r=()=>{a(`по штрихкоду ${n} ничего не найдено, попробуйте найти по названию`),s(!1)};return t.jsxs("div",{className:W.globalModal_left,children:[c&&t.jsx(at,{staticText:ts,method:"program",setModalOpen:m}),t.jsxs("div",{className:W.globalModal_left_top,children:[t.jsx(R,{name:"MapPinIcon",width:35,height:35}),t.jsx("p",{className:W.globalModal_left_desc,children:"Данный товар не найден в национальной базе товаров и услуг."})]}),t.jsxs("div",{className:W.globalModal_left_bottom,children:[t.jsx(D,{to:"#",className:W.globalModal_left_bottom_link,onClick:r,children:"Искать в программе"}),t.jsxs("div",{className:W.globalModal_left_bottom_label,onClick:g,children:[t.jsx("input",{type:"checkbox",className:W.globalModal_left_bottom_checkbox,ref:l}),t.jsx("span",{children:"Запомнить это действие "})]})]})]})}async function ct(e){try{console.log("getGlobalProduct barcode",e);const n=await G.get(`https://api.barcodelookup.com/v3/products?barcode=${e}&formatted=y&key=7yd26itc9ov4fdwfymvp888cyuepbl`);console.log("getGlobalProduct res",n)}catch(n){console.log("Ошибкра при поиске продукта в глобальной базе",n)}}const os=[{id:O(),title:"Данная настройка позволяет автоматически производить поиск в глобальной базе, в случаи если в национальной базе товары не были найдены"},{id:O(),title:"Внимание! В случаи глобального поиска, ИКПУ не будет присвоен."},{id:O(),title:"Данный выбор возможно изменить в разделе “настройки”."}];function ss(){const{searchText:e,globalRemember:n,setGlobalModal:s}=w(),a=b.useRef(null),[l,c]=b.useState(!1);b.useEffect(()=>{console.log("globalRemember",n),a.current&&(console.log("checkboxRef.current",a.current.checked),a.current.checked=n)},[n,a]),b.useEffect(()=>{console.log("globalRemember",n),a.current&&(console.log("checkboxRef.current",a.current.checked),a.current.checked=n)},[n,a]);const m=async f=>{const u=await ct(f);console.log("handleGlobalSearch data",u)},g=()=>{m(e),s(!1)},r=()=>{c(!0)};return t.jsxs("div",{className:W.globalModal_right,children:[l&&t.jsx(at,{staticText:os,method:"global",setModalOpen:c}),t.jsxs("div",{className:W.globalModal_right_top,children:[t.jsx(R,{name:"GlobeAltIcon",width:35,height:35}),t.jsxs("p",{className:W.globalModal_right_top_desc,children:[t.jsx("span",{children:"Ипользовать глобальный поиск"}),t.jsx("span",{children:"(В этом случаи, товару не будет присвоен ИКПУ)"})]})]}),t.jsxs("div",{className:W.globalModal_right_bottom,children:[t.jsx(D,{to:"#",className:W.globalModal_right_bottom_link,onClick:g,children:"Искать глобально"}),t.jsxs("div",{className:W.globalModal_right_bottom_label,onClick:r,children:[t.jsx("input",{type:"checkbox",ref:a,className:W.globalModal_right_bottom_checkbox}),t.jsx("span",{children:"Запомнить это действие"})]})]})]})}function ns(){const{setGlobalModal:e,setSearchText:n}=w(),s=()=>{n(""),e(!1)};return t.jsxs("div",{className:W.globalModal,children:[t.jsxs(D,{to:"#",className:W.globalModal_back,onClick:s,children:[t.jsx(R,{name:"ChevronLeftIcon",width:20,height:15}),t.jsx("span",{children:"Назад"})]}),t.jsxs("div",{className:W.globalModal_container,children:[t.jsx(es,{}),t.jsx(ss,{})]})]})}function as(){const n=V().pathname,{pickedSearch:s,setPickedSearch:a,searchText:l,setSearchText:c,searchParams:m,TemporaryData:g,setTemporaryData:r,setSearchResponse:f,setTotalElementsStore:u,setTotalPagesStore:i,setCheckedProductsByCode:j,checkedProductsByCode:d,setPage:_,page:y,perPage:p,lang:v,globalModal:k,setGlobalModal:S,globalRemember:E,programRemember:C,errorMessage:h,setErrorMessage:N}=w(),[T,z]=b.useState([]);b.useEffect(()=>{z([...d])},[d]),b.useEffect(()=>{N(""),c("")},[n]),b.useEffect(()=>{(s=="По штрих-коду"||s=="По ИКПУ"||s=="По ТН ВЭД")&&(l.toString(),l.length<13&&a("По ТН ВЭД"),l.length==13&&a("По штрих-коду"),l.length>13&&a("По ИКПУ"))},[l]),b.useEffect(()=>{const M=document.querySelector(`input[name="search"][value="${s}"]`);M&&(M.checked=!0)},[s]);const U=M=>{a(M.currentTarget.value)},x=async M=>{if(M.preventDefault(),f([]),_(0),Q.get("access_token")||await st(),l.length>0&&s!="По штрих-коду"&&s!="По ИКПУ"){console.log("1 СЦЕНАРИЙ по тексту"),console.log(222,"searchText",l);const{data:I,totalElements:L,totalPages:B}=await tt(s,l,0,p,v);if(console.log(3333,"data",I),I.length==0){N("ничего не найдено");return}L&&B&&(u(L),i(B));const F=[];for(const Z of I){const q=await et(Z.mxikCode,v);F.push({...Z,id:O(),photos:q,createdByHand:!1})}f(F)}if(l.length>0&&s=="По штрих-коду"||s=="По ИКПУ"){console.log("2 СЦЕНАРИЙ по коду");const{data:I,totalElements:L,totalPages:B}=await tt(s,l,y,p,v);I.length==0&&N("ничего не найдено"),L&&B&&(u(L),i(B));const F=[];for(const q of I){const K=await nt(q),rt=await et(q.mxikCode,v);K&&F.push({...q,id:O(),photos:rt,createdByHand:!1})}if(I.length==0)if(E===!0){const q=await ct(l);console.log("navAddProduct fetchData",q)}else C===!0?(console.log("programRemember === true что дальше? (NavAddProduct 207)",C),N(`по штрихкоду ${l} ничего не найдено, попробуйте найти по названию`)):S(!0);else if(I.length==1&&F.length==0){N("Этот продукт уже есть на складе");return}else if(I.length>0&&F.length>0&&F.filter(q=>g.some(K=>K.mxikCode===q.mxikCode))[0]){N("Вы уже ввбрали это продукт");return}const Z=F.filter(q=>!g.some(K=>K.mxikCode===q.mxikCode));j([...Z]),r([...g,...Z])}},H=M=>{M!=l&&N(""),console.log("value",M),/^[a-zA-Z]+$/.test(M)?(console.log("тексе"),s!="Расширинный по тексту"&&s!="По бренду"&&s!="По номеру рег. удостовирения"&&s!="По MHH"&&(a("По тексту"),N(""))):/^\d+$/.test(M)?(console.log("число"),M.length<=4?(a("По ТН ВЭД"),N(""),console.log("По ТН ВЭД")):M.length>4&&M.length<=13?(console.log("По штрих-коду"),N(""),a("По штрих-коду")):M.length>13&&M.length<=17?(a("По ИКПУ"),N(""),console.log("По ИКПУ")):M.length>17?(console.log("value",M),console.log("код ИКПУ не валидный"),N("код ИКПУ не валидный")):N("Введен невалидный символ")):s!="Расширинный по тексту"&&s!="По бренду"&&s!="По номеру рег. удостовирения"&&s!="По MHH"&&a("По тексту"),c(M)};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:o.nav,children:[k&&t.jsx(ns,{}),t.jsxs("form",{action:"",className:o.nav_form,onSubmit:M=>x(M),children:[t.jsxs("div",{className:o.nav_form_left,children:[t.jsxs("ul",{className:o.nav_buttons,children:[t.jsx("li",{children:t.jsxs(D,{className:`${o.back} ${o.nav_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(R,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(D,{to:"/addingProducts/settingsAddProducts",className:`${o.nav_linkBtn} ${o.nav_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(R,{name:"Cog8ToothIcon",className:o.nav_buttons_iconSetting})]})})]}),t.jsxs("fieldset",{children:[t.jsx("input",{value:l,type:"text",className:o.nav_form_input,placeholder:s,onChange:M=>H(M.currentTarget.value)}),t.jsx("button",{type:"submit",className:o.nav_form_btn,children:"Поиск"})]})]}),T.length>0&&g.length>0&&t.jsx(Eo,{}),t.jsx("ul",{className:o.nav_form_list,children:m==null?void 0:m.map(M=>t.jsx("li",{children:t.jsxs("label",{className:o.nav_form_check,children:[t.jsx("input",{type:"radio",name:"search",value:M.title,onClick:P=>U(P)}),t.jsx("span",{className:o.nav_form_check_text,children:M.title})]})},M.id))})]}),t.jsx("span",{className:o.nav_error,children:h})]})})}function cs({staticList:e}){return t.jsx("div",{className:o.left,children:t.jsx("div",{className:o.left_content,children:e.map(n=>t.jsxs("div",{className:o.left_content_item,children:[t.jsx("h3",{children:n.title}),t.jsx("p",{children:n.value})]},n.id))})})}function ls(){const{imagesSrc:e,setImagesSrc:n}=w(),[s,a]=b.useState(null),l=b.useRef([]),c=d=>{l.current.forEach(_=>{_&&_.getAttribute("id")==d&&_.click()})};function m(d,_){a(_)}function g(d){d.target.style.background="white"}function r(d){d.target.style.background="white"}function f(d){d.preventDefault(),d.target.style.background="lightgray"}function u(d,_){d.preventDefault(),d.target.style.background="white";const y=e.map(p=>p.id===_.id?{...p,order:(s==null?void 0:s.order)||p.order}:p.id===(s==null?void 0:s.id)?{...p,order:_.order}:p);n(y),a(null)}function i(d,_){return d.order>_.order?1:-1}const j=d=>{var y,p;const _=(p=(y=d==null?void 0:d.target)==null?void 0:y.files)==null?void 0:p[0];if(_&&(_==null?void 0:_.type)==="image/jpeg"||(_==null?void 0:_.type)==="image/png"||(_==null?void 0:_.type)==="image/webp"){const v=d.target.getAttribute("id"),k=[...e],S=k.find(C=>C.id==v),E=k.findIndex(C=>C.id==v);if(S){const C=new FileReader;C.onload=h=>{var N;(N=h.target)!=null&&N.result&&(S.src=URL.createObjectURL(_),k.splice(E,1,S),n([...k]))},C.readAsDataURL(_)}}};return t.jsx("div",{className:o.right,children:t.jsx("div",{className:o.right_block,children:t.jsx("div",{className:o.right_bottom,children:e.sort(i).map((d,_)=>{var y;return t.jsxs("div",{draggable:!0,onDragStart:p=>m(p,d),onDragLeave:p=>g(p),onDragEnd:p=>r(p),onDragOver:p=>f(p),onDrop:p=>u(p,d),className:_==0?o.right_bottom_BaseItem:o.right_bottom_item,onDoubleClick:()=>c(d.id),children:[t.jsx("input",{id:d.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:j,ref:p=>{l.current[_]=p}}),t.jsx("img",{src:d.src=="/noPhoto.jpg"||((y=d.src)==null?void 0:y.toString().split(":")[0])=="blob"?d.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+d.src,width:_==0?150:50,height:_==0?150:50,alt:"",className:`${_==0?o.right_bottom_baseImg:o.right_bottom_img}`})]},d.id)})})})})}function rs({addingImgToProduct:e,handleCancel:n}){const{ikpuStatus:s}=w();return t.jsxs("div",{className:o.ikpuWrapper_buttons,children:[t.jsx(D,{to:"#",className:o.ikpuWrapper_save,onClick:a=>e(a),children:"Coхранить"}),s.type==="info photo"&&t.jsx(D,{to:"#",className:o.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(D,{to:"#",onClick:a=>n(a),className:o.ikpuWrapper_cancel,children:"Отмена"})]})}const J=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:3,title:"Группа:",value:""},{id:4,title:"Класс:",value:""},{id:5,title:"Позиция:",value:""},{id:6,title:"Субпозиция:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""},{id:9,title:"Описание:",value:""}];function _s(){const{searchResponseItem:e,imagesSrc:n,setImagesSrc:s,setSearchResponseItem:a,setIkpuStatus:l,ikpuStatus:c}=w(),[m,g]=b.useState([]);b.useEffect(()=>{if(e){const u=J==null?void 0:J.map(i=>{let j;return i.title=="ИКПУ:"&&(j=e.mxikCode),i.title=="Штрих-код:"&&(j=e.internationalCode),i.title=="Группа:"&&(j=e.groupName),i.title=="Класс:"&&(j=e.className),i.title=="Позиция:"&&(j=e.positionName),i.title=="Субпозиция:"&&(j=e.subPositionName),i.title=="Наименование:"&&(j=e.className),i.title=="Бренд:"&&(j=e.brandName),i.title=="Описание:"&&(j=e.attributeName),{id:i.id,title:i.title,value:j}});g([...u])}},[e]),b.useEffect(()=>{if(e.photos){const u=n.map((i,j)=>{var d,_;return{id:i.id,order:i.order,src:(d=e==null?void 0:e.photos)!=null&&d[j]?(_=e==null?void 0:e.photos)==null?void 0:_[j]:"/noPhoto.jpg"}});u&&s(u)}},[]);const r=u=>{u.preventDefault();const i=n==null?void 0:n.map(j=>j.src);e.photos=i,a(e),l({status:!1,type:""})};function f(u){u.preventDefault();const i=n.map(j=>({id:j.id,order:j.order,src:j.src}));s(i),l({status:!1,type:""})}return t.jsx(t.Fragment,{children:t.jsx("div",{className:o.ikpuWrapper,onClick:f,children:t.jsxs("div",{className:o.ikpuWrapper_ikpuModalBlock,onClick:u=>u.stopPropagation(),style:{width:c.type==="info photo"?"700px":"250px",minHeight:c.type==="info photo"?"500px":"400px"},children:[t.jsxs("div",{className:o.ikpuWrapper_content,children:[c.type==="info photo"&&t.jsx(cs,{staticList:m}),t.jsx(ls,{})]}),t.jsx(rs,{addingImgToProduct:r,handleCancel:f})]})})})}function is({item:e}){const{TemporaryData:n,setTemporaryData:s}=w(),[a,l]=b.useState(e.crmArrivalPrice??"0"),[c,m]=b.useState(""),g=f=>{if(/^[a-zA-Z]+$/.test(f))m("Введите число");else if(/^\d+$/.test(f))if(f.length==2&&f[0]=="0"){const u=f[1];l(u),m(""),r(u)}else m(""),l(f),r(f);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(f)?m("Введите число"):f==""&&(r("0"),m(""),l("0"))},r=f=>{n.forEach(u=>{u.id==e.id&&(u.crmArrivalPrice=Number(f))}),s(n)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",value:a,className:o.table_body_amount,onChange:f=>g(f.target.value)})]})}function ds({item:e}){const{TemporaryData:n,setTemporaryData:s}=w(),[a,l]=b.useState(e.crmSellingPrice??"0"),[c,m]=b.useState(""),g=f=>{if(/^[a-zA-Z]+$/.test(f))m("Введите число");else if(/^\d+$/.test(f))if(f.length==2&&f[0]=="0"){const u=f[1];l(u),m(""),r(u)}else m(""),l(f),r(f);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(f)?m("Введите число"):f==""&&(r("0"),m(""),l("0"))},r=f=>{n.forEach(u=>{u.id==e.id&&(u.crmSellingPrice=Number(f))}),s(n)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",value:a,className:o.table_body_amount,onChange:f=>g(f.target.value)})]})}function us({item:e}){const{TemporaryData:n,setTemporaryData:s}=w(),[a,l]=b.useState(e.crmAmount??"0"),[c,m]=b.useState(""),g=f=>{if(/^[a-zA-Z]+$/.test(f))m("Введите число");else if(/^\d+$/.test(f))if(f.length==2&&f[0]=="0"){const u=f[1];l(u),m(""),r(u)}else m(""),l(f),r(f);else/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(f)?m("Введите число"):f==""&&(r("0"),m(""),l("0"))},r=f=>{n.forEach(u=>{u.id==e.id&&(u.crmAmount=Number(f))}),s(n)};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",value:a,className:o.table_body_amount,onChange:f=>g(f.target.value)})]})}function ms({item:e}){const{TemporaryData:n,setTemporaryData:s}=w(),[a,l]=b.useState(e.crmNameProduct??""),[c,m]=b.useState(!1),[g,r]=b.useState("");b.useEffect(()=>{u(a)},[a]);const f=d=>{l(d),r("")},u=d=>{n.forEach(_=>{_.id==e.id&&(_.crmNameProduct=d)}),s(n)},i=()=>{console.log("hover"),m(!0)},j=()=>{console.log("hover"),m(!1)};return e.createdByHand===!0?t.jsxs("div",{className:o.table_body_nameBlock,children:[t.jsx("span",{className:o.table_body_error,children:g}),t.jsx("textarea",{onChange:d=>f(d.target.value),value:`${a}`,className:o.table_body_name,placeholder:e!=null&&e.subPositionName?e==null?void 0:e.subPositionName:e.crmNameProduct?e.crmNameProduct:"Добавьте наименование",children:a})]}):t.jsxs("div",{className:o.table_body_nameBlock,children:[c&&t.jsx("span",{className:o.table_body_nameHover,children:e.subPositionName}),t.jsx("span",{onMouseEnter:i,onMouseLeave:j,className:o.table_body_nameString,children:e.subPositionName})]})}const gs=(e=0,n=9)=>Math.floor(Math.random()*(n+1-e)+e).toString();function ot(e=13){let n="";for(let s=1;s<=e;s++){const a=gs();n+=a}return n}function fs({item:e}){const{TemporaryData:n,setTemporaryData:s}=w(),[a,l]=b.useState(""),[c,m]=b.useState(""),g=u=>{/^[a-zA-Z]+$/.test(u)?m("Введите число"):/^\d+$/.test(u)?(m(""),l(u)):/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]+$/.test(u)?m("Введите число"):u==""&&(m(""),l(u))},r=()=>{const i=13-a.split("").length,j=i>0?ot(i):ot(),d=i>0?a+j:j;l(d)},f=()=>{if(a.length==13)n.forEach(u=>{u.id==e.id&&(u.internationalCode=a)}),s(n);else{const u=13-a.length;m(`Еще ${u} символов`)}};return t.jsxs("div",{children:[t.jsx("span",{className:o.table_body_error,children:c}),t.jsx("input",{type:"text",className:o.table_body_barcode,onChange:u=>g(u.target.value),maxLength:13,value:a}),t.jsxs("div",{className:o.table_body_buttons,children:[t.jsx("button",{className:o.table_body_generation,onClick:r,children:"Генерировать"}),t.jsx("button",{className:o.table_body_barcodeSave,onClick:f,children:"Сохранить"})]})]})}function bs({item:e}){const{TemporaryData:n,setTemporaryData:s}=w(),[a,l]=b.useState(e.crmQR??!1);b.useEffect(()=>{c(a)},[a]);const c=m=>{n.forEach(g=>{g.id==e.id&&(g.crmQR=m)}),s(n)};return t.jsxs("div",{className:o.table_body_qr,onClick:()=>l(!a),children:[a&&t.jsx(R,{name:"PlusIcon"}),!a&&t.jsx(R,{name:"MinusIcon"}),t.jsx(it,{status:a,width:50})]})}const ps="_modalCategory_5j9ek_1",hs="_modalCategory_block_5j9ek_10",js="_modalCategory_nav_5j9ek_16",ys="_modalCategory_nav_title_5j9ek_23",xs="_modalCategory_nav_close_5j9ek_29",ks="_modalCategory_content_5j9ek_32",Ps="_modalCategory_content_message_5j9ek_39",Ns="_modalCategory_content_link_5j9ek_47",vs="_modalCategory_content_link_active_5j9ek_76",Ss="_modalCategory_content_item_5j9ek_86",Ms="_modalCategory_content_block_5j9ek_108",ws="_modalCategory_content_block_title_5j9ek_112",Cs="_settings_5j9ek_120",$s="_settings_title_5j9ek_123",Is="_settings_content_5j9ek_128",As="_settings_content_top_5j9ek_131",Es="_settings_content_buttons_5j9ek_134",Ds="_settings_content_btn_5j9ek_144",Ts="_settings_content_btn_cancel_5j9ek_156",Rs="_settings_content_btn_save_5j9ek_159",Ws="_settings_tools_5j9ek_162",Ls="_settings_tools_link_5j9ek_167",zs="_settings_tools_link_active_5j9ek_182",$={modalCategory:ps,modalCategory_block:hs,modalCategory_nav:js,modalCategory_nav_title:ys,modalCategory_nav_close:xs,modalCategory_content:ks,modalCategory_content_message:Ps,modalCategory_content_link:Ns,modalCategory_content_link_active:vs,modalCategory_content_item:Ss,modalCategory_content_block:Ms,modalCategory_content_block_title:ws,settings:Cs,settings_title:$s,settings_content:Is,settings_content_top:As,settings_content_buttons:Es,settings_content_btn:Ds,settings_content_btn_cancel:Ts,settings_content_btn_save:Rs,settings_tools:Ws,settings_tools_link:Ls,settings_tools_link_active:zs};function Bs({setCancel:e}){return t.jsxs("div",{className:$.modalCategory_nav,children:[t.jsx("h2",{className:$.modalCategory_nav_title,children:"Котегория"}),t.jsx("button",{className:$.modalCategory_nav_close,onClick:e,children:t.jsx(R,{width:24,height:24,name:"XMarkIcon"})})]})}async function Fs(e,n){try{return await X.get(`categories?page=${e}&perPage=${n}`)}catch(s){console.log("Ошибка при получении супер категорий при добавлении продукта на склад",s)}}function Hs({superId:e,setSuperId:n,setCategoryId:s}){const[a,l]=b.useState(1),[c,m]=b.useState(1),[g]=b.useState(10),[r,f]=b.useState([]);b.useEffect(()=>{u(a,g)},[]);async function u(d,_){var k,S;const y=await Fs(d,_),p=await((k=y==null?void 0:y.data)==null?void 0:k.pagination),v=await((S=y==null?void 0:y.data)==null?void 0:S.data);m(p.total_pages),f([...r,...v])}const i=d=>{d.preventDefault();const _=a+1;l(_),u(_,g),console.log("addPage",_)},j=d=>{s(0),n(d)};return t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Суперкотегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[r==null?void 0:r.map(d=>t.jsxs(D,{to:"#",className:`${$.modalCategory_content_link} ${d.id==e?$.modalCategory_content_link_active:""} `,onClick:_=>j(d.id),children:[d.name.ru,t.jsx(R,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},d.id)),a<c&&t.jsx(D,{to:"#",className:$.modalCategory_content_link,onClick:d=>i(d),children:"Ещё..."})]})]})}async function qs(e,n,s){try{return await X.get(`categories?parentId=${s}&page=${e}&perPage=${n}`)}catch(a){console.log("Ошибка при получении категорий при добавлении продукта на склад",a)}}function Us({superId:e,categoryId:n,setCategoryId:s,setSubId:a}){const[l,c]=b.useState([]),[m,g]=b.useState(1),[r,f]=b.useState(1),[u]=b.useState(10);b.useEffect(()=>{c([]),g(1),e!==0&&i(1,10)},[e]);async function i(_,y){var S,E;const p=await qs(_,y,e),v=await((S=p==null?void 0:p.data)==null?void 0:S.pagination),k=await((E=p==null?void 0:p.data)==null?void 0:E.data);f(v.total_pages),c(C=>[...C,...k])}const j=_=>{_.preventDefault();const y=m+1;g(y),i(y,u)},d=_=>{a(0),s(_)};return l.length>0&&t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Котегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[l==null?void 0:l.map(_=>t.jsxs(D,{to:"#",className:`${$.modalCategory_content_link} ${_.id==n?$.modalCategory_content_link_active:""} `,onClick:y=>d(_.id),children:[_.name.ru,t.jsx(R,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},_.id)),m<r&&t.jsx(D,{to:"#",className:$.modalCategory_content_link,onClick:_=>j(_),children:"Ещё..."})]})]})}async function Gs(e,n,s){try{return await X.get(`categories?parentId=${s}&page=${e}&perPage=${n}`)}catch(a){console.log("Ошибка при получении субкатегорий при добавлении продукта на склад",a)}}function Os({categoryId:e,subId:n,setSubId:s,setPickedCategory:a}){const[l,c]=b.useState([]),[m,g]=b.useState(1),[r,f]=b.useState(1),[u]=b.useState(10);b.useEffect(()=>{c([]),g(1),e!==0&&i(1,10)},[e]);async function i(_,y){var S,E;const p=await Gs(_,y,e),v=await((S=p==null?void 0:p.data)==null?void 0:S.pagination),k=await((E=p==null?void 0:p.data)==null?void 0:E.data);f(v.total_pages),c(C=>[...C,...k])}const j=_=>{_.preventDefault();const y=m+1;g(y),i(y,u)},d=(_,y)=>{_.preventDefault(),s(y.id),a(y)};return l.length>0&&t.jsxs("div",{className:$.modalCategory_content_block,children:[t.jsx("h2",{className:$.modalCategory_content_block_title,children:"Подкотегория"}),t.jsxs("div",{className:$.modalCategory_content_item,children:[l==null?void 0:l.map(_=>t.jsxs(D,{to:"#",className:`${$.modalCategory_content_link} ${_.id==n?$.modalCategory_content_link_active:""} `,onClick:y=>d(y,_),children:[_.name.ru,t.jsx(R,{name:"ChevronRightIcon",width:17,height:17,color:"rgba(113, 113, 113, 1)"})]},_.id)),m<r&&t.jsx(D,{to:"#",className:$.modalCategory_content_link,onClick:_=>j(_),children:"Ещё..."})]})]})}function Zs({setPickedSubCategoryToProduct:e,setCancel:n}){return t.jsxs("div",{className:$.settings_content_buttons,children:[t.jsx(D,{to:"#",className:`${$.settings_content_btn} ${$.settings_content_btn_save}`,onClick:s=>e(s),children:"Сохранить"}),t.jsx("button",{className:`${$.settings_content_btn} ${$.settings_content_btn_cancel}`,onClick:n,children:"Отмена"})]})}function Xs({item:e,setModalStatus:n}){const{TemporaryData:s,setTemporaryData:a}=w(),[l,c]=b.useState(""),[m,g]=b.useState(!1),[r,f]=b.useState(0),[u,i]=b.useState(0),[j,d]=b.useState(0),[_,y]=b.useState({});b.useEffect(()=>{console.log("pickedCategory",_)},[_]);function p(k){if(k.preventDefault(),r===0){g(!0),c("Выберите Суперкотегорию");return}else if(u===0){g(!0),c("Выберите Категорию");return}else if(j===0){g(!0),c("Выберите Подкотегорию");return}else s.forEach(S=>{S.id===e.id&&(S.crmCategory=_)}),a([...s]),v()}const v=()=>{f(0),i(0),d(0),c(""),g(!1),y({}),n(!1)};return t.jsx("div",{className:$.modalCategory,onClick:v,children:t.jsxs("div",{className:$.modalCategory_block,onClick:k=>k.stopPropagation(),children:[t.jsx(Bs,{setCancel:v}),t.jsx("p",{className:$.modalCategory_content_message,children:l||""}),t.jsxs("div",{className:$.modalCategory_content,children:[t.jsx(Hs,{superId:r,setSuperId:f,setCategoryId:i}),t.jsx(Us,{superId:r,categoryId:u,setCategoryId:i,setSubId:d}),t.jsx(Os,{categoryId:u,subId:j,setSubId:d,setPickedCategory:y}),t.jsx(Zs,{setPickedSubCategoryToProduct:p,setCancel:v})]})]})})}function Qs({item:e}){var r,f,u;const[n,s]=b.useState(!1),[a,l]=b.useState(!1),c=()=>{s(!0)},m=()=>{console.log("hover"),l(!0)},g=()=>{console.log("hover"),l(!1)};return t.jsxs("div",{className:o.table_body_category,children:[n&&t.jsx(Xs,{item:e,setModalStatus:s}),a&&t.jsx("span",{className:o.table_body_nameHover,children:(r=e==null?void 0:e.crmCategory)!=null&&r.name.ru?e==null?void 0:e.crmCategory.name.ru:""}),t.jsx("span",{className:o.table_body_category_span,onMouseEnter:m,onMouseLeave:g,children:(f=e==null?void 0:e.crmCategory)!=null&&f.name.ru?e==null?void 0:e.crmCategory.name.ru:""}),t.jsx("button",{onClick:c,className:o.table_body_category_btn,children:t.jsx("span",{children:(u=e==null?void 0:e.crmCategory)!=null&&u.name.ru?"Изменить":"Выбрать"})})]})}function Vs({item:e,column:n}){const{ikpuStatus:s,setSearchResponseItem:a,setIkpuStatus:l,setTemporaryData:c,TemporaryData:m,setOpenModalCategory:g,setCurrentProduct:r}=w(),f=(i,j)=>{j==="info photo"?(a(i),l({status:!s.status,type:"info photo"})):j==="photo"&&(a(i),l({status:!s.status,type:"photo"}))},u=()=>{m&&c(m.filter(i=>i.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:o.table_body_row,style:{gridTemplateColumns:`repeat(${n.length}, 200px) 110px 110px`},children:[n==null?void 0:n.map(i=>{var j,d,_,y,p,v,k,S;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:o.table_body_col,children:[(i==null?void 0:i.title)=="Количество"&&t.jsx(us,{item:e}),(i==null?void 0:i.title)=="Приходная цена"&&t.jsx(is,{item:e}),(i==null?void 0:i.title)=="Продажная цена"&&t.jsx(ds,{item:e}),(i==null?void 0:i.title)=="Наименование"&&t.jsx(ms,{item:e}),(i==null?void 0:i.title)=="Фото"?t.jsx("img",{onClick:()=>f(e,"photo"),src:((j=e.photos)==null?void 0:j[0])=="/noPhoto.jpg"?(d=e.photos)==null?void 0:d[0]:((_=e.photos)==null?void 0:_.length)==0?"/noPhoto.jpg":(p=(y=e.photos)==null?void 0:y[0])!=null&&p.startsWith("blob")?(v=e.photos)==null?void 0:v[0]:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+((k=e.photos)==null?void 0:k[0]),width:40,height:40,alt:"",className:o.table_body_img}):"",(i==null?void 0:i.title)=="QR Код"&&t.jsx(bs,{item:e}),(i==null?void 0:i.title)=="Ед.измерения"&&(e==null?void 0:e.packageNames)&&(((S=e==null?void 0:e.packageNames)==null?void 0:S[0].nameRu)??"-"),(i==null?void 0:i.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(i==null?void 0:i.title)=="Подкатегория"&&t.jsx(Qs,{item:e}),(i==null?void 0:i.title)=="Штрих-код"&&(e!=null&&e.internationalCode?e==null?void 0:e.internationalCode:t.jsx(fs,{item:e}))]},i==null?void 0:i.id)}),t.jsx("td",{className:`${o.table_body_minCol} ${o.table_body_minCol_still}`,children:t.jsx("span",{onClick:()=>f(e,"info photo"),className:o.table_body_still,children:t.jsx(R,{name:"EllipsisHorizontalIcon",className:o.table_body_icon})})}),t.jsx("td",{className:`${o.table_body_minCol} ${o.table_body_minCol_cancel}`,children:t.jsx("span",{className:o.table_body_del,onClick:u,children:t.jsx(R,{name:"TrashIcon",width:20,height:20})})})]})}function Ks({column:e}){const{TemporaryData:n}=w();return t.jsxs("table",{className:o.table,children:[t.jsx("thead",{className:o.table_head,children:t.jsxs("tr",{className:o.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px) 110px 110px`},children:[e==null?void 0:e.map(s=>t.jsx("td",{className:o.table_head_col,children:s.title},s.id)),t.jsx("td",{className:`${o.table_head_minCol} ${o.table_head_minCol_still}`,children:"Ещё"}),t.jsx("td",{className:`${o.table_head_minCol} ${o.table_head_minCol_cancel}`,children:"Отменить"})]})}),t.jsx("tbody",{className:o.table_body,children:n==null?void 0:n.map(s=>t.jsx(Vs,{item:s,column:e},s==null?void 0:s.id))})]})}function Js({clearTable:e,setData:n}){return t.jsxs("div",{className:o.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${o.formWrapper_btn} ${o.formWrapper_btn_save}`,onClick:n,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${o.formWrapper_btn} ${o.formWrapper_btn_cancel}`,onClick:s=>e(s),children:"Отмена"})]})}function Ys(){const e=b.useRef(null),[n,s]=b.useState(!1),[a,l]=b.useState(0),[c,m]=b.useState(0),g=h=>{e.current&&(s(!0),l(h.pageX-e.current.offsetLeft),m(e.current.scrollLeft))},r=()=>{s(!1)},f=()=>{s(!1)},u=h=>{if(!n||!e.current)return;h.preventDefault();const T=(h.pageX-e.current.offsetLeft-a)*2;e.current.scrollLeft=c-T},{settingsParams:i,ikpuStatus:j,TemporaryData:d,openModalCategory:_,setTemporaryData:y,setCheckedProducts:p}=w(),[v,k]=b.useState([]);b.useEffect(()=>{const h=i.filter(N=>N.checked);k(()=>[...h])},[i]);const S=async h=>{h.preventDefault();for(const N of d)await E(N)};async function E(h){var N,T,z;try{const U=Q.get("multi-store"),x={multiStoreId:Number(U),categoryId:Number((N=h==null?void 0:h.crmCategory)==null?void 0:N.id),barcode:Number(h==null?void 0:h.internationalCode),nameUz:"string",nameUzc:"string",nameRu:h.subPositionName?h.subPositionName:(T=h==null?void 0:h.crmNameProduct)==null?void 0:T.toString(),mxik:(z=h==null?void 0:h.mxikCode)==null?void 0:z.toString(),brand:h.brandName??null,oldPrice:Number(h==null?void 0:h.crmArrivalPrice),price:Number(h==null?void 0:h.crmSellingPrice),oldPriceCourse:0,priceCourse:0,nds:0,discount:0};await X.post("nomenclatures",x),y([]),p([])}catch(U){console.log(`Ошибка произошла при попытке добавить ${h==null?void 0:h.crmNameProduct} на сервер`,U)}}const C=h=>{h.preventDefault(),y([]),p([])};return t.jsxs("div",{className:o.formWrapper,children:[t.jsxs("div",{className:o.found,ref:e,onMouseDown:g,onMouseLeave:r,onMouseUp:f,onMouseMove:u,children:[j.status===!0&&t.jsx(_s,{}),t.jsx(Ks,{column:v})]}),t.jsx(Js,{clearTable:C,setData:S})]})}const tn="_layout_5my6h_1",en="_layout_back_5my6h_4",on="_layout_title_5my6h_14",sn="_layout_list_5my6h_19",nn="_layout_link_5my6h_25",an="_layout_link_active_5my6h_35",cn="_form_list_5my6h_39",ln="_form_check_5my6h_44",rn="_navSetting_5my6h_51",_n="_found_5my6h_55",dn="_table_5my6h_76",un="_table_head_5my6h_80",mn="_table_head_row_5my6h_83",gn="_table_head_col_5my6h_87",fn="_addSettings_list_5my6h_91",bn="_addSettings_li_5my6h_91",A={layout:tn,layout_back:en,layout_title:on,layout_list:sn,layout_link:nn,layout_link_active:an,form_list:cn,form_check:ln,navSetting:rn,found:_n,table:dn,table_head:un,table_head_row:mn,table_head_col:gn,addSettings_list:fn,addSettings_li:bn},pn=[{id:1,title:"отображения колонок",href:"/addingProducts/settingsAddProducts"},{id:2,title:"настройки",href:"/addingProducts/settingsAddProducts/settings"}];function hn(){const n=V().pathname;return t.jsxs("nav",{className:A.layout,children:[t.jsx(D,{className:A.layout_back,to:"/addingProducts",children:"Закрыть"}),t.jsx("h2",{className:A.layout_title,children:"Настройки"}),t.jsx("ul",{className:A.layout_list,children:pn.map(s=>t.jsx("li",{children:t.jsx(D,{to:s.href,className:`${A.layout_link} ${s.href==n?A.layout_link_active:""}`,children:s.title})},s.id))})]})}function jn(){const e=b.useRef([]),{necessarilySettings:n,settingsParams:s,setSettingsParams:a}=w();b.useEffect(()=>{e.current.forEach((c,m)=>{c&&(c.checked=s[m].checked,n.forEach(g=>{c.value==g&&(c.checked=!0)}))})},[s]);const l=c=>{const m=s.map(g=>({id:g.id,title:g.title,checked:g.title==c.currentTarget.value?c.currentTarget.checked:g.checked}));a(m)};return t.jsx("nav",{className:A.navSetting,children:t.jsx("form",{action:"",className:A.form,children:t.jsx("ul",{className:A.form_list,children:s==null?void 0:s.map((c,m)=>t.jsx("li",{children:t.jsxs("label",{className:A.form_check,children:[t.jsx("input",{type:"checkbox",value:c.title,ref:g=>{e.current[m]=g},onChange:g=>l(g)}),t.jsx("span",{className:A.form_check_text,children:c.title})]})},c.id))})})})}function yn(){const{globalRemember:e,setGlobalRemember:n,programRemember:s,setProgramRemember:a}=w(),l=c=>{console.log("val",c),c==="program"?a(!s):c==="global"&&n(!e)};return t.jsx("div",{className:A.addSettings,children:t.jsx("div",{className:"container",children:t.jsxs("ul",{className:A.addSettings_list,children:[t.jsxs("li",{className:A.addSettings_li,onClick:()=>l("program"),children:[t.jsx("span",{className:A.addSettings_span,children:"Отменить выбор программного поиска"}),t.jsx("input",{type:"checkbox",className:A.addSettings_input,checked:s,readOnly:!0})]}),t.jsxs("li",{className:A.addSettings_li,onClick:()=>l("global"),children:[t.jsx("span",{className:A.addSettings_span,children:"Отменить выбор глобального поиска"}),t.jsx("input",{type:"checkbox",className:A.addSettings_input,checked:e,readOnly:!0})]})]})})})}function xn(){const{settingsParams:e}=w(),s=V().pathname,[a,l]=b.useState([]);return b.useEffect(()=>{const c=e.filter(m=>m.checked);l(()=>[...c])},[e]),t.jsxs("div",{className:"container",children:[t.jsx(hn,{}),s=="/addingProducts/settingsAddProducts"&&t.jsx(jn,{}),s=="/addingProducts/settingsAddProducts/settings"&&t.jsx(yn,{}),t.jsx("section",{className:A.found,children:t.jsxs("table",{className:A.table,children:[t.jsx("thead",{className:A.table_head,children:t.jsx("tr",{className:A.table_head_row,style:{gridTemplateColumns:`repeat(${a.length}, 200px)`},children:a==null?void 0:a.map(c=>t.jsx("td",{className:A.table_head_col,children:c.title},c.id))})}),t.jsx("tbody",{className:A.table_body,children:t.jsx("tr",{className:A.table_body_row,children:t.jsx("td",{className:A.table_body_col})})})]})})]})}function kn({staticList:e}){return t.jsx("div",{className:o.left,children:t.jsxs("div",{className:o.left_content,children:[e.map(n=>t.jsxs("div",{className:o.left_content_item,children:[t.jsx("h3",{children:n.title}),t.jsx("p",{children:n.value})]},n.id)),t.jsx("span",{style:{fontSize:"14px"},children:"(нужны картинки с сервера при get, post, patch запрсе по name)"})]})})}function Pn(){const{stockImagesSrc:e,setStockImagesSrc:n}=w(),[s,a]=b.useState(null),l=b.useRef([]),c=d=>{l.current.forEach(_=>{_&&_.getAttribute("id")==d&&_.click()})};function m(d,_){a(_)}function g(d){d.target.style.background="white"}function r(d){d.target.style.background="white"}function f(d){d.preventDefault(),d.target.style.background="lightgray"}function u(d,_){d.preventDefault(),d.target.style.background="white";const y=e.map(p=>p.id===_.id?{...p,order:(s==null?void 0:s.order)||p.order}:p.id===(s==null?void 0:s.id)?{...p,order:_.order}:p);n(y),a(null)}function i(d,_){return d.order>_.order?1:-1}const j=d=>{var y,p;const _=(p=(y=d==null?void 0:d.target)==null?void 0:y.files)==null?void 0:p[0];if(_&&(_==null?void 0:_.type)==="image/jpeg"||(_==null?void 0:_.type)==="image/png"||(_==null?void 0:_.type)==="image/webp"){const v=d.target.getAttribute("id"),k=[...e],S=k.find(C=>C.id==v),E=k.findIndex(C=>C.id==v);if(S){const C=new FileReader;C.onload=h=>{var N;(N=h.target)!=null&&N.result&&(S.src=URL.createObjectURL(_),k.splice(E,1,S),n([...k]))},C.readAsDataURL(_)}}};return t.jsx("div",{className:o.right,children:t.jsx("div",{className:o.right_block,children:t.jsx("div",{className:o.right_bottom,children:e.sort(i).map((d,_)=>{var y;return t.jsxs("div",{draggable:!0,onDragStart:p=>m(p,d),onDragLeave:p=>g(p),onDragEnd:p=>r(p),onDragOver:p=>f(p),onDrop:p=>u(p,d),className:_==0?o.right_bottom_BaseItem:o.right_bottom_item,onDoubleClick:()=>c(d.id),children:[t.jsx("input",{id:d.id,type:"file",accept:"image/jpeg,image/png,image/webp",style:{display:"none"},onChange:j,ref:p=>{l.current[_]=p}}),t.jsx("img",{src:d.src=="/noPhoto.jpg"||((y=d.src)==null?void 0:y.toString().split(":")[0])=="blob"?d.src:"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+d.src,width:_==0?150:50,height:_==0?150:50,alt:"",className:`${_==0?o.right_bottom_baseImg:o.right_bottom_img}`})]},d.id)})})})})}function Nn({addingImgToProduct:e,handleCancel:n}){return t.jsxs("div",{className:o.ikpuWrapper_buttons,children:[t.jsx(D,{to:"#",className:o.ikpuWrapper_save,onClick:s=>e(s),children:"Coхранить"}),t.jsx(D,{to:"#",className:o.ikpuWrapper_delete,children:"Удалить товар"}),t.jsx(D,{to:"#",onClick:s=>n(s),className:o.ikpuWrapper_cancel,children:"Отмена"})]})}const Y=[{id:1,title:"ИКПУ:",value:""},{id:2,title:"Штрих-код:",value:""},{id:7,title:"Наименование:",value:""},{id:8,title:"Бренд:",value:""}];function vn(){const{searchResponseItem:e,stockImagesSrc:n,setStockImagesSrc:s,setSearchResponseItem:a,setStockIkpuStatus:l}=w(),[c,m]=b.useState([]);b.useEffect(()=>{if(e){const f=Y==null?void 0:Y.map(u=>{var j;let i;return u.title=="ИКПУ:"&&(i=e.mxik),u.title=="Штрих-код:"&&(i=e.barcode),u.title=="Группа:"&&(i=e.groupName),u.title=="Класс:"&&(i=e.className),u.title=="Позиция:"&&(i=e.positionName),u.title=="Субпозиция:"&&(i=e.subPositionName),u.title=="Наименование:"&&(i=(j=e.name)==null?void 0:j.ru),u.title=="Бренд:"&&(i=e.brand),u.title=="Описание:"&&(i=e.description),{id:u.id,title:u.title,value:i}});m([...f])}},[e]),b.useEffect(()=>{if(e.photos){const f=n.map((u,i)=>{var j,d;return{id:u.id,order:u.order,src:(j=e==null?void 0:e.photos)!=null&&j[i]?(d=e==null?void 0:e.photos)==null?void 0:d[i]:"/noPhoto.jpg"}});f&&s(f)}},[]);const g=f=>{f.preventDefault();const u=n==null?void 0:n.map(i=>i.src);e.photos=u,a(e),l(!1)};function r(f){f.preventDefault();const u=n.map(i=>({id:i.id,order:i.order,src:i.src}));s(u),l(!1)}return t.jsx(t.Fragment,{children:t.jsx("div",{className:o.ikpuWrapper,onClick:r,children:t.jsxs("div",{className:o.ikpuWrapper_ikpuModalBlock,onClick:f=>f.stopPropagation(),children:[t.jsxs("div",{className:o.ikpuWrapper_content,children:[t.jsx(kn,{staticList:c}),t.jsx(Pn,{})]}),t.jsx(Nn,{addingImgToProduct:g,handleCancel:r})]})})})}function Sn({item:e}){const[n,s]=b.useState(e.oldPrice),{stockTemporaryData:a,setStockTemporaryData:l}=w(),c=m=>{const g=m.target.value;s(Number(g));const r=a.filter(u=>u.id==e.id)[0],f=a.findIndex(u=>u.id==e.id);r&&(r.oldPrice=Number(g),a.splice(f,1,r),l([...a]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:o.table_body_amount,min:0,onChange:c})})}function Mn({item:e}){const[n,s]=b.useState(e.price),{stockTemporaryData:a,setStockTemporaryData:l}=w(),c=m=>{const g=m.target.value;s(Number(g));const r=a.filter(u=>u.id==e.id)[0],f=a.findIndex(u=>u.id==e.id);r.price&&(r.price=Number(g),a.splice(f,1,r),l([...a]))};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,className:o.table_body_amount,min:0,onChange:c})})}function wn({item:e}){const[n,s]=b.useState(0),{stockTemporaryData:a,setStockTemporaryData:l}=w(),c=m=>{const g=m.target.valueAsNumber;s(g);const r=a.find(f=>f.id==e.id);if(r){const f=a.findIndex(i=>i.id==e.id),u=[...a];u.splice(f,1,r),l(u)}};return t.jsx("div",{children:t.jsx("input",{type:"number",value:n,min:0,className:o.table_body_amount,onChange:c})})}function Cn({item:e,column:n}){const{stockTemporaryData:s,setSearchResponseItem:a,setStockIkpuStatus:l,setStockTemporaryData:c}=w(),m=r=>{a(r),l(!0)},g=()=>{s&&c(s.filter(r=>r.id!==e.id))};return t.jsxs("tr",{"data-id":e==null?void 0:e.id,className:o.table_head_row,style:{gridTemplateColumns:`repeat(${n.length}, 200px)`},children:[n==null?void 0:n.map(r=>{var f;return t.jsxs("td",{"data-id":e==null?void 0:e.id,className:o.table_body_col,children:[(r==null?void 0:r.title)=="Количество"&&t.jsx(wn,{item:e}),(r==null?void 0:r.title)=="Приходная цена"&&t.jsx(Sn,{item:e}),(r==null?void 0:r.title)=="Продажная цена"&&t.jsx(Mn,{item:e}),(r==null?void 0:r.title)=="Наименование"&&t.jsx("span",{className:o.table_body_nameString,children:(f=e==null?void 0:e.name)==null?void 0:f.ru}),(r==null?void 0:r.title)=="Фото"?t.jsx("img",{src:"/noPhoto.jpg",width:40,height:40,alt:"",className:o.table_body_img}):"",(r==null?void 0:r.title)=="QR Код"&&(e==null?void 0:e.internationalCode),(r==null?void 0:r.title)=="ИКПУ"&&(e==null?void 0:e.mxikCode),(r==null?void 0:r.title)=="Добавить Фото"?t.jsx("span",{onClick:()=>m(e),children:t.jsx(R,{name:"FolderOpenIcon",className:o.table_body_icon})}):"",(r==null?void 0:r.title)=="Штрих-код"&&(e!=null&&e.barcode)?e==null?void 0:e.barcode:""]},r==null?void 0:r.id)}),t.jsx("td",{className:o.table_body_del,onClick:g,children:t.jsx(R,{name:"TrashIcon",width:20,height:20})})]})}function $n({column:e}){const{stockTemporaryData:n}=w(),[s,a]=b.useState([]);return b.useEffect(()=>{a(n)},[n]),t.jsxs("table",{className:o.table,children:[t.jsx("thead",{className:o.table_head,children:t.jsx("tr",{className:o.table_head_row,style:{gridTemplateColumns:`repeat(${e.length}, 200px)`},children:e==null?void 0:e.map(l=>t.jsx("td",{className:o.table_head_col,children:l.title},l.id))})}),t.jsx("tbody",{className:o.table_body,children:s==null?void 0:s.map(l=>t.jsx(Cn,{item:l,column:e},l==null?void 0:l.id))})]})}function In({clearTable:e,setData:n}){return t.jsxs("div",{className:o.formWrapper_buttons,children:[t.jsx("button",{name:"myForm",type:"submit",className:`${o.formWrapper_btn} ${o.formWrapper_btn_save}`,onClick:n,children:"Сохранить"}),t.jsx("button",{name:"myForm",className:`${o.formWrapper_btn} ${o.formWrapper_btn_cancel}`,onClick:s=>e(s),children:"Отмена"})]})}function An(){const e=b.useRef(null),[n,s]=b.useState(!1),[a,l]=b.useState(0),[c,m]=b.useState(0),g=h=>{e.current&&(s(!0),l(h.pageX-e.current.offsetLeft),m(e.current.scrollLeft))},r=()=>{s(!1)},f=()=>{s(!1)},u=h=>{if(!n||!e.current)return;h.preventDefault();const T=(h.pageX-e.current.offsetLeft-a)*2;e.current.scrollLeft=c-T},{settingsParams:i,stockIkpuStatus:j,stockTemporaryData:d,openModalCategory:_,setStockTemporaryData:y,setCheckedProducts:p}=w(),[v,k]=b.useState([]);b.useEffect(()=>{const h=i.filter(N=>N.checked&&N.title!="Подкатегория");k(()=>[...h])},[i]);const S=h=>{h.preventDefault(),d.forEach(N=>{E(N)})};async function E(h){var N;try{const T={nameRu:(N=h.name)==null?void 0:N.ru,oldPrice:h.oldPrice,price:h.price};await X.patch(`nomenclatures/${h.id}`,T),y([]),p([])}catch(T){console.log(`Ошибка произошла при попытке добавить ${h==null?void 0:h.crmNameProduct} на сервер`,T)}}const C=h=>{h.preventDefault(),y([]),p([])};return t.jsxs("div",{className:o.formWrapper,children:[_&&t.jsx(dt,{}),t.jsxs("div",{className:o.found,ref:e,onMouseDown:g,onMouseLeave:r,onMouseUp:f,onMouseMove:u,children:[j&&t.jsx(vn,{}),t.jsx($n,{column:v})]}),t.jsx(In,{clearTable:C,setData:S})]})}async function lt(e,n,s,a,l){try{if(e==="По тексту"){console.log("fetchStockProducts page",a,"perPage",l);const c=await X.get(`nomenclatures?multiStoreId=${n}&name=${s}&page=${a}&perPage=${l}`);console.log("fetchStockProducts res",c);const m=await c.data.data,g=await c.data.pagination.total,r=await c.data.pagination.total_pages;return{data:m,totalElements:g,totalPages:r}}}catch(c){console.log("Ошибка при получении продуктов со склада",c)}}function En(){const n=V().pathname,{stockPickedSearch:s,setStockPickedSearch:a,stockSearchParams:l,stockSearchText:c,setStockSearchText:m,setStockSearchResponse:g,stockTemporaryData:r,setTotalElementsStore:f,setTotalPagesStore:u,stockPage:i,perPage:j,setStockPage:d}=w(),[_,y]=b.useState("");b.useEffect(()=>{y(""),m("")},[n]),b.useEffect(()=>{(s=="По штрих-коду"||s=="По ИКПУ")&&(c.toString(),c.length<13&&a("По ТН ВЭД"),c.length==13&&a("По штрих-коду"),c.length>13&&a("По ИКПУ")),c.length>0&&y("")},[c]),b.useEffect(()=>{const k=document.querySelector(`input[name="search"][value="${s}"]`);k&&(k.checked=!0)},[s]);const p=k=>{a(k.currentTarget.value)},v=async k=>{k.preventDefault(),g([]),d(1);const S=Q.get("access_token"),E=Q.get("multi-store");if((!S||!E)&&await st(),c.length>0&&E){const{data:C,totalElements:h,totalPages:N}=await lt(s,E,c,i,j);console.log("totalElements",h,"totalPages",N),C.length==0&&y("ничего не найдено"),h&&N&&(f(h),u(N));const T=C.filter(z=>!r.some(U=>U.id===z.id));g(T)}};return t.jsx(t.Fragment,{children:t.jsxs("nav",{className:o.navStock,children:[t.jsxs("ul",{className:o.navStock_buttons,children:[t.jsx("li",{children:t.jsxs(D,{className:`${o.back} ${o.navStock_buttons_link}`,to:"/admin",children:[t.jsx("span",{children:"admin"}),t.jsx(R,{name:"BuildingLibraryIcon"})]})}),t.jsx("li",{children:t.jsxs(D,{to:"/addingProducts/settingsAddProducts",className:`${o.navStock_linkBtn} ${o.navStock_buttons_link}`,children:[t.jsx("span",{children:"settings"}),t.jsx(R,{name:"Cog8ToothIcon",className:o.navStock_buttons_iconSetting})]})})]}),t.jsxs("form",{action:"",className:o.stockForm,onSubmit:k=>v(k),children:[t.jsxs("fieldset",{children:[t.jsx("input",{value:c,type:s=="По штрих-коду"||s=="По ИКПУ"?"number":"text",className:o.stockForm_input,placeholder:s,onChange:k=>m(k.currentTarget.value)}),t.jsx("button",{type:"submit",className:o.stockForm_btn,children:"Поиск"})]}),t.jsx("ul",{className:o.stockForm_list,children:l==null?void 0:l.map(k=>t.jsx("li",{children:t.jsxs("label",{className:o.stockForm_check,children:[t.jsx("input",{type:"radio",name:"search",value:k.title,onClick:S=>p(S)}),t.jsx("span",{className:o.stockForm_check_text,children:k.title})]})},k.id))})]}),t.jsx("span",{className:o.navStock_error,children:_})]})})}function Dn({addSelectedProducts:e,setCancel:n}){const{setAddBlockStatus:s}=_t(),a=()=>{n(),s(!1)};return t.jsxs("div",{className:o.foundProducts_buttons,children:[t.jsx(D,{to:"#",className:`${o.foundProducts_btn} ${o.foundProducts_btn_save}`,onClick:()=>e(),children:"Сохранить"}),t.jsx("button",{className:`${o.foundProducts_btn} ${o.foundProducts_btn_cancel}`,onClick:a,children:"Отмена"})]})}function Tn(){const{stockSearchResponse:e,setStockSearchResponse:n,stockCheckedProducts:s,setStockCheckedProducts:a,stockTemporaryData:l,setStockTemporaryData:c,totalElementsStore:m,setTotalElementsStore:g,totalPagesStore:r,setTotalPagesStore:f,stockSearchText:u,setStockSearchText:i,stockPickedSearch:j,stockPage:d,setStockPage:_,setPerPage:y,perPage:p}=w(),[v,k]=b.useState([]),[S,E]=b.useState([]),[C,h]=b.useState(!1),N=b.useRef([]),T=b.useRef(null);b.useEffect(()=>{k([...e]),console.log("stockSearchResponse",e)},[e]);const z=()=>{s&&c([...s,...l]),n([]),a([]),M()},U=(P,I)=>{if(P){E([...S,I]);const L=v.filter(B=>B.id==I)[0];a([...s,L])}else if(!P&&T.current){const L=S.filter(F=>F!=I);E([...L]);const B=s.filter(F=>F.id!=I);a([...B]),h(!1),T.current.checked=!1}T.current&&P&&S.length+1==v.length&&(h(!0),T.current.checked=!0,a([...v]))},x=P=>{if(h(P),P){N.current.forEach(L=>{L&&(L.checked=P)});const I=v.map(L=>L.id);E([...I]),a([...v])}else E([]),N.current.forEach(I=>{I&&(I.checked=P)}),a([])},H=async P=>{P.preventDefault();const I=d+1;_(I);const L=Q.get("multi-store");if(L){const{data:B}=await lt(j,L,u,I,p),F=B.filter(Z=>!l.some(q=>q.id===Z.id));console.log("filteredSearchResponse",F),console.log("stockSearchResponse",e),console.log("stockSearchText",u),T.current&&(h(!1),T.current.checked=!1,n([...F,...e]))}},M=()=>{n([]),a([]),g(0),f(0),i(""),_(1),y(5)};return t.jsx("section",{className:o.foundProducts,onClick:M,children:t.jsxs("div",{className:o.foundProducts_modal,onClick:P=>P.stopPropagation(),children:[t.jsxs("div",{className:o.foundProducts_top,children:[t.jsxs("h2",{className:o.foundProducts_title,children:[t.jsxs("span",{children:["Найдено совпадений - ",m]}),t.jsxs("span",{children:["Текущее количество - ",v.length]}),t.jsxs("span",{children:["Выбрано элементов - ",S.length]})]}),d<r&&r!=1&&t.jsx("span",{className:o.foundProducts_more,onClick:P=>H(P),children:"добавить ещё..."}),v.length>1&&t.jsxs("label",{className:o.foundProducts_allActive,children:[t.jsx("input",{type:"checkbox",onChange:P=>x(P.target.checked),ref:T}),t.jsx("span",{children:C?"Отключить все":"Выбрать все"})]}),t.jsx(Dn,{addSelectedProducts:z,setCancel:M})]}),t.jsx("ul",{className:o.foundProducts_list,children:v==null?void 0:v.map((P,I)=>{var L;return t.jsxs("li",{className:o.foundProducts_item,children:[t.jsx("span",{className:o.foundProducts_item_photo,children:t.jsx("img",{src:"/noPhoto.jpg",width:50,height:50,alt:""})}),t.jsxs("ul",{className:o.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Штрихкод:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:P==null?void 0:P.barcode})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:P==null?void 0:P.mxik})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Бренд:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:P==null?void 0:P.brand})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Наименовани:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:(L=P==null?void 0:P.name)==null?void 0:L.ru})]}),t.jsxs("li",{children:[t.jsx("span",{className:o.foundProducts_item_title,children:"Единица измерения:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:P==null?void 0:P.attributeName})]})]}),t.jsxs("label",{className:`
                ${o.foundProducts_item_btn}
                ${C||S.includes(P.id)?o.foundProducts_item_btn_active:""}
                `,children:[t.jsx("input",{type:"checkbox",onChange:B=>U(B.target.checked,P.id),ref:B=>{N.current[I]=B}}),"Выбрать"]})]},P==null?void 0:P.id)})})]})})}async function Rn(e){try{const n=await G.get(`https://tasnif.soliq.uz/api/cl-api/integration-mxik/get/history/${e}`);return console.log("res ",n),await n.data.data.packageNames}catch(n){console.log("",n)}}function Wn(){const{searchResponse:e,searchText:n,TemporaryData:s,pickedSearch:a,setSearchText:l,setTemporaryData:c,setCheckedProducts:m,setSearchResponse:g,totalElementsStore:r,setTotalElementsStore:f,setTotalPagesStore:u,page:i,setPage:j,perPage:d,lang:_,errorMessage:y,setErrorMessage:p}=w(),[v,k]=b.useState([]),[S,E]=b.useState([]),C=b.useRef(null);b.useEffect(()=>{const x=setTimeout(()=>{p("")},1e3);return()=>{clearTimeout(x)}},[y]),b.useEffect(()=>{k([...e]);const x=S.filter(H=>e.some(M=>M.id===H));E(x),k([...e])},[e]);const h=async x=>{if(await nt(x))if(s.some(P=>P.mxikCode===x.mxikCode))p("Этот продукт уже выбран"),z();else{const P=await Rn(x.mxikCode);console.log("fetchPackageNames packageNames",P);const I={...x,crmNameProduct:x.subPositionName,crmAmount:0,crmArrivalPrice:0,crmSellingPrice:0,packageNames:P??null};console.log("addSelectedProducts myItem",I),c([I,...s]),z()}else p("Этот продукт уже есть на складе"),z()},N=async()=>{const x=i+1;j(x);const{data:H}=await tt(a,n,x,d,_),M=[];for(const P of H){const I=await et(P.mxikCode,_);M.push({...P,id:O(),photos:I})}g([...e,...M])},T=()=>{const x=C.current;if(x){const H=x.scrollHeight-x.scrollTop===x.clientHeight;H&&N(),console.log("isAtBottom",H)}},z=()=>{g([]),m([]),f(0),u(0),l(""),j(0)},U=()=>{const x={attributeName:null,brandName:null,classCode:"",className:"",commonUnitCode:null,commonUnitName:null,crmAmount:0,crmArrivalPrice:0,crmNameProduct:"",crmSellingPrice:0,groupCode:"",groupName:"",id:O(),internationalCode:null,mxikCode:"",myProduct:0,packages:null,photos:["/noPhoto.jpg"],positionCode:"",positionName:"",subPositionName:"",unitCode:null,unitName:null,units:[],createdByHand:!0};console.log("addNewLine TemporaryData",s),c([x,...s]),z()};return t.jsx("section",{className:o.foundProducts,onClick:z,children:t.jsxs("div",{ref:C,className:o.foundProducts_modal,onScroll:T,onClick:x=>x.stopPropagation(),children:[t.jsxs("div",{className:o.foundProducts_top,children:[t.jsx("h2",{className:o.foundProducts_title,children:t.jsxs("span",{children:["Найдено совпадений - ",r]})}),t.jsxs("div",{className:o.foundProducts_top_buttons,children:[t.jsxs("button",{className:o.foundProducts_top_add,onClick:U,children:[t.jsx(R,{name:"PlusCircleIcon"}),"Добавить в ручную"]}),t.jsx("button",{className:o.foundProducts_top_close,onClick:z,children:t.jsx(R,{name:"XMarkIcon"})})]})]}),t.jsx("ul",{className:o.foundProducts_list,children:v==null?void 0:v.map(x=>{var H;return t.jsxs("li",{className:o.foundProducts_item,onClick:()=>h(x),children:[t.jsxs("h2",{className:o.foundProducts_item_mxik,children:[t.jsx("span",{className:o.foundProducts_item_title,children:"ИКПУ:"}),t.jsx("span",{className:o.foundProducts_item_desc,children:x==null?void 0:x.mxikCode}),t.jsx("span",{className:o.foundProducts_item_desc,children:x==null?void 0:x.subPositionName})]}),t.jsxs("div",{className:o.foundProducts_item_content,children:[t.jsxs("ul",{className:o.foundProducts_item_list,children:[t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Группа:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(x==null?void 0:x.groupName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Класс:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(x==null?void 0:x.className)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Позиция:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(x==null?void 0:x.positionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Субпозиция:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(x==null?void 0:x.subPositionName)??"-"})]}),t.jsxs("li",{children:[t.jsxs("p",{className:o.foundProducts_item_list_box,children:[t.jsx("span",{className:o.foundProducts_item_myIcon}),t.jsx("span",{className:o.foundProducts_item_title,children:"Штрихкод:"})]}),t.jsx("span",{className:o.foundProducts_item_desc,children:(x==null?void 0:x.internationalCode)??"-"})]})]}),t.jsx("span",{className:o.foundProducts_item_photo,children:t.jsx("img",{src:(H=x==null?void 0:x.photos)!=null&&H[0]?"https://tasnif.soliq.uz/api/cls-api/integration-mxik/references/get/file/"+x.photos[0]:"/noPhoto.jpg",width:50,height:50,alt:""})})]})]},x==null?void 0:x.id)})})]})})}function Ln(){const n=V().pathname,[s,a]=b.useState(!1);return t.jsxs("div",{className:`${o.leftMenu} ${s?o.leftMenu_active:""}`,children:[t.jsx("button",{className:o.leftMenu_btn,onClick:()=>a(!s),children:t.jsx(R,{name:"Bars3Icon"})}),t.jsxs("ul",{className:o.leftMenu_list,children:[t.jsxs("li",{className:`${o.leftMenu_li} ${n=="/addingProducts"?o.leftMenu_li_active:""}`,children:[t.jsx(R,{name:"ShoppingCartIcon",className:`${o.leftMenu_li_icon} ${s?"":o.leftMenu_li_icon_active}`}),t.jsx(D,{to:"/addingProducts",className:`${o.leftMenu_link} ${s?o.leftMenu_link_active:""}`,children:"Добавить номенклатуру"}),t.jsx(R,{name:"ChevronRightIcon",className:`${o.leftMenu_linkArrow} ${s?o.leftMenu_linkArrow_active:""}`})]}),t.jsxs("li",{className:`${o.leftMenu_li} ${n!="/addingProducts"?o.leftMenu_li_active:""}`,children:[t.jsx(R,{name:"ShoppingCartIcon",className:`${o.leftMenu_li_icon} ${s?"":o.leftMenu_li_icon_active}`}),t.jsx(D,{to:"/addingProducts/stockProducts",className:`${o.leftMenu_link} ${s?o.leftMenu_link_active:""}`,children:"Создать номенклатуру"}),t.jsx(R,{name:"ChevronRightIcon",className:`${o.leftMenu_linkArrow} ${s?o.leftMenu_linkArrow_active:""}`})]})]})]})}function qn(){const n=V().pathname,{stockSearchResponse:s,TemporaryData:a,stockTemporaryData:l,setTemporaryData:c,setCheckedProducts:m,searchResponse:g}=w();b.useEffect(()=>{r()},[]);const r=()=>{c([]),m([])};return t.jsxs("div",{className:o.addingProducts,children:[t.jsx(Ln,{}),n=="/addingProducts"&&t.jsxs("div",{className:o.container,children:[t.jsx(as,{}),a.length>0&&g.length==0&&t.jsx(Ys,{}),g.length>0&&t.jsx(Wn,{})]}),n=="/addingProducts/stockProducts"&&t.jsxs("div",{className:o.container,children:[t.jsx(En,{}),s.length>0&&t.jsx(Tn,{}),l.length>0&&t.jsx(An,{})]}),n.startsWith("/addingProducts/settingsAddProducts")&&t.jsx(xn,{})]})}export{qn as default};
